[
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Updating CSS Border Radius When A Container Is Overflowing",
    "partialText": "<p>In this article we’ll create a container element that dynamically adjusts its <code>border-radius</code> when its contents overflows.</p>\n<p>This week I learned about <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/Properties/corner-shape\"><code>corner-shape</code></a> via <a href=\"https://nerdy.dev/squircles\">nerdy.dev</a>. This led me down the path of adding big squircle corners to code blocks in the FilePond documentation. Great! But unfortunately they looked terrible when the scrollbar was active.</p>\n<p>I wondered if I could detect (with CSS only) if a container is overflowing so I could dynamically lower the <code>border-radius</code> to fit the scrollbar, and I quickly found on <a href=\"https://www.bram.us/2025/11/25/use-overscroll-behavior-contain-to-prevent-a-page-from-scrolling-while-a-dialog-is-open/\">bram.us</a> that, yes, that’s very much possible.</p>\n<p>So here we are, the CSS below detects the <code>x</code> and <code>y</code> overflow and then sets the per corner <code>border-radius</code> accordingly.</p>\n<p>In short, the <code>--overflows-x</code> and <code>--overflows-y</code> custom properties are set to <code>1</code> if overflow is detected (with the CSS animation). The amount we subtract from the default border-radius <code>--tl</code> is multiplied by the <code>--overflows</code> variable which either sets it to <code>0</code> or results in a lowered border-radius.</p>\n<p>We use <code>max()</code> to set the <code>--br</code> border-radius so if either of the two <code>--overflows</code> variables is <code>1</code> the border-radius is lowered.</p>\n<p>Scroll down for demo’s, please note that at the time of this writing this only works in Chrome and Safari, see <a href=\"https://caniuse.com/mdn-css_properties_animation-timeline\">caniuse</a> for latest support stats.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">pre</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* fallback */</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 0.5em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* corners */</span>\n<span class=\"token atrule\"><span class=\"token rule\">@supports</span> <span class=\"token punctuation\">(</span><span class=\"token property\">animation-timeline</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scroll</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">pre</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--overflows-x</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">--overflows-y</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> detect-overflow-x<span class=\"token punctuation\">,</span> detect-overflow-y<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">animation-timeline</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scroll</span><span class=\"token punctuation\">(</span>x self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">scroll</span><span class=\"token punctuation\">(</span>y self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* the default border radius */</span>\n        <span class=\"token property\">--tl</span><span class=\"token punctuation\">:</span> 2em<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* what we subtract from the default when overflowing */</span>\n        <span class=\"token property\">--s</span><span class=\"token punctuation\">:</span> 1.5em<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* calculate the border radius for each corner */</span>\n        <span class=\"token property\">--tr</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--tl<span class=\"token punctuation\">)</span> - <span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--overflows-y<span class=\"token punctuation\">)</span> * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token property\">--br</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>\n            <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--tl<span class=\"token punctuation\">)</span> - <span class=\"token punctuation\">(</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--overflows-x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--overflows-y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token property\">--bl</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--tl<span class=\"token punctuation\">)</span> - <span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--overflows-x<span class=\"token punctuation\">)</span> * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--tl<span class=\"token punctuation\">)</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--tr<span class=\"token punctuation\">)</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--br<span class=\"token punctuation\">)</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--bl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> detect-overflow-x</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">from,\n    to</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--overflows-x</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> detect-overflow-y</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">from,\n    to</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--overflows-y</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"no-scrollbars\">No scrollbars</h2>\n<p>When no scrollbars are active all corners use a big border-radius.</p>\n<div class=\"demo\">\n<div class=\"pre\" style=\"width:280px;height:140px;\">\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.\n</div>\n</div>\n<h2 id=\"vertical-scrollbar\">Vertical scrollbar</h2>\n<p>We automatically lower the top right and bottom right border-radius.</p>\n<div class=\"demo\">\n<div class=\"pre\" style=\"width:280px;height:140px;\">\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n</div>\n</div>\n<h2 id=\"horizontal-scrollbar\">Horizontal scrollbar</h2>\n<p>When only a horizontal scrollbar is visible we lower the bottom left and bottom right border-radius.</p>\n<div class=\"demo\">\n<div class=\"pre\" style=\"width:280px;height:140px;\">\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmodtemporincididuntutlaboreetdoloremagna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.\n</div>\n</div>\n<h2 id=\"both-horizontal-and-vertical-scrollbar\">Both horizontal and vertical scrollbar</h2>\n<p>Now we lower all the border-radius values except for the top left one.</p>\n<div class=\"demo\">\n<div class=\"pre\" style=\"width:280px;height:140px;\">\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmodtemporincididuntutlaboreetdoloremagna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n</div>\n</div>\n\n<style>\n.pre {\n    font-family: monospace;\n    overflow: auto;\n    border: 1px solid currentColor;\n    padding: 1em;\n    border-radius:.5em;\n}\n@supports (animation-timeline: scroll(self)) {\n.pre {\n--overflows-x: 0;\n--overflows-y: 0;\nanimation: detect-overflow-x, detect-overflow-y;\nanimation-timeline: scroll(x self), scroll(y self);\n--s: 1.5em;\n--tl: 2em;\n--tr: calc(var(--tl) - (var(--overflows-y) * var(--s)));\n--br: calc(var(--tl) - (max(var(--overflows-x), var(--overflows-y)) * var(--s)));\n--bl: calc(var(--tl) - (var(--overflows-x) * var(--s)));\nborder-radius: var(--tl) var(--tr) var(--br) var(--bl);\n}\n}\n@keyframes detect-overflow-x {\nfrom,\nto {\n--overflows-x: 1;\n}\n}\n@keyframes detect-overflow-y {\nfrom,\nto {\n--overflows-y: 1;\n}\n}\n</style>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/update-container-border-radius-scrollbar-overflow/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "How To Disable Right Click With JavaScript",
    "partialText": "<p>In certain situations it might be useful to disable the browser right click context menu functionality. In this article I’ll quickly show you how it’s done. As the context menu is an important user interaction pattern we of course shouldn’t disable it lightly, let’s take a look.</p>\n<p>In my case I wanted to disable the right click interaction because it creates very strange situations when users drag an item and then accidentally click the right mouse button. Events fail to fire, or fire in another order, items get stuck, etc.</p>\n<p>However the context menu triggered by the right click contains important functionality for the user (searching, printing, translating), so it’s smart to only disable it temporarily. In my case I only disable it when the user starts dragging an item.</p>\n<p>Please note that at this time <a href=\"https://bugs.webkit.org/show_bug.cgi?id=213953\">the <code>&quot;contextmenu&quot;</code> event doesn’t fire on iOS Safari</a></p>\n<p>The code below will disable the context menu in all situations.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contextmenu'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>To only disable it in certain situations we can do with a basic <code>if</code> statement.</p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contextmenu'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// only disable the context menu when the user is doing something</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>userIsDoingSomething<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Alternatively we can add and remove the <code>contextmenu</code> event depending on if the user started a certain activity.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">preventContextMenu</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// user started doing something, let's disable the context menu</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">userStartsDoingSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contextmenu'</span><span class=\"token punctuation\">,</span> preventContextMenu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// user stopped doing something, let's enable the context menu</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">userStopsDoingSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contextmenu'</span><span class=\"token punctuation\">,</span> preventContextMenu<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Performance wise there’s not much difference between these solutions. However it’s a bit more clean to only listen for the <code>contextmenu</code> event when it’s relevant, instead of always listening and checking if we should prevent the menu every time the right mouse button is pressed.</p>\n<p>To disable right click on a selection of elements we can use the code below, in this case the event handler is attached to an element and the event will be prevented on the element and all its children.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-element<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Right click doesn't work here.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Select the element</span>\n    <span class=\"token keyword\">const</span> myElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#my-element'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Listen for the `contextmenu` event</span>\n    myElement<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'contextmenu'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Let’s see that in action.</p>\n<div class=\"demo\" id=\"demo\" style=\"outline:1px solid red;width:fit-content;padding:1em;\">\n    The right click context menu doesn't work here.\n</div>\n<script>\n    document.querySelector('#demo').addEventListener('contextmenu', (e) => {\n        e.preventDefault();\n    });\n</script>\n<p>Alright, that’s all there is to it, now you know how it’s done. Great power, great responsibility, please use it wisely.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/disable-right-click-with-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Crop An Image With Canvas",
    "partialText": "<p>Cropping images in the browser can be done with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API\">HTML5 canvas element</a>. In this tutorial we’ll load an image from a local URL, crop the image, and present the result on the same page.</p>\n<p>Okay, first we need an image. Let’s use the image below, it’s located at the URL: <code>https://pqina.nl/media/test.jpeg</code></p>\n<p><img src=\"https://pqina.nl/media/test.jpeg\" alt=\"A test image\" /></p>\n<p>Our next goal is to load this image into a canvas element.</p>\n<h2 id=\"loading-an-image-in-a-canvas-element\">Loading an image in a canvas element</h2>\n<p>To draw an image to a canvas element we need to use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage\"><code>drawImage</code></a> method on the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D\">2d context</a> of the canvas element.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-canvas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>This will create a <code>300 × 150</code> canvas on the page, we can adjust the width and height with the <code>width</code> and <code>height</code> attributes. For now we’ll try to draw our image.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// get a reference to the canvas element</span>\n<span class=\"token keyword\">const</span> myCanvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my-canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// then we need to access the 2d context of the canvas for drawing 2d imagery</span>\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> myCanvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// now we draw the image</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/media/test.jpeg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>That doesn’t work unfortunately. The <code>drawImage</code> method expects the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage#image\">image in a different format</a>, and it expects a <code>dx</code> and <code>dy</code> coordinate. Those are the <code>x</code> and <code>y</code> coordinates of the top left corner in the canvas where we start drawing the image.</p>\n<p>We’ll load the URL into an <code>&lt;img&gt;</code> and then we’ll draw it to our <code>&lt;canvas&gt;</code>, I’ve put a red outline around it so we can clearly see it’s borders.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// get a reference to the canvas element and its 2d context</span>\n<span class=\"token keyword\">const</span> myCanvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my-canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> myCanvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// the image we're going to draw</span>\n<span class=\"token keyword\">const</span> myImage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// we wait for the image to load, then we draw</span>\nmyImage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// draw myImage at 0,0</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>myImage<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// the image we want to load</span>\nmyImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">'/media/test.jpeg'</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Tadaa, there’s our image. And it’s already cropped!</p>\n<p><canvas id=\"my-canvas-0\" style=\"outline:1px solid red;\"></canvas></p>\n<script>\n{\n    const myCanvas = document.getElementById('my-canvas-0');\n    const ctx = myCanvas.getContext('2d');\n    const myImage = new Image();\n\n    myImage.onload = () => {\n        ctx.drawImage(myImage, 0, 0);\n    };\n\n    myImage.src = '/media/test.jpeg';\n}\n</script>\n<h2 id=\"cropping-a-square-image-in-canvas\">Cropping a square image in canvas</h2>\n<p>Let’s say we want to make a square crop. To achieve a square crop we’ll have to change the width and height of our canvas to the intended size of the resulting image.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-canvas<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>256<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>256<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span></code></pre>\n<p><canvas id=\"my-canvas-1\" width=\"256\" height=\"256\" style=\"outline:1px solid red;\"></canvas></p>\n<script>\n{\n    const myCanvas = document.getElementById('my-canvas-1');\n    const ctx = myCanvas.getContext('2d');\n    const myImage = new Image();\n\n    myImage.onload = () => {\n        ctx.drawImage(myImage, 0, 0);\n    };\n\n    myImage.src = '/media/test.jpeg';\n}\n</script>\n<p>Now we want to choose which part we crop, and that we can do with the <code>dx</code> and <code>dy</code> parameters.</p>\n<p>Let’s say we want to crop the center. This means we need to use the canvas size and the image size to calculate the correct <code>dx</code> and <code>dy</code> coordinates.</p>\n<p>We can get the image width and height using the <code>naturalWidth</code> and <code>naturalHeight</code> properties of the <code>Image</code> instance.</p>\n<p>To calculate the center we subtract the image width from the canvas width and then we divide by 2, that puts the top left corner exactly where we want it.</p>\n<pre class=\"language-js\"><code class=\"language-js\">myImage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> dx <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>myCanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">-</span> myImage<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> dy <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>myCanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">-</span> myImage<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>myImage<span class=\"token punctuation\">,</span> dx<span class=\"token punctuation\">,</span> dy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p><canvas id=\"my-canvas-2\" width=\"256\" height=\"256\" style=\"outline:1px solid red;\"></canvas></p>\n<script>\n{\n    const myCanvas = document.getElementById('my-canvas-2');\n    const ctx = myCanvas.getContext('2d');\n    const myImage = new Image();\n\n    myImage.onload = () => {\n        const dx = (myCanvas.width - myImage.naturalWidth) * .5;\n        const dy = (myCanvas.height - myImage.naturalHeight) * .5;\n        ctx.drawImage(myImage, dx, dy);\n    };\n\n    myImage.src = '/media/test.jpeg';\n}\n</script>\n<p>That’s it, that’s how you crop an image using the HTML canvas element.</p>\n<p>We can supply more parameters to the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage#syntax\"><code>drawImage</code></a> to also control the scaling of the image. We can control the quality of the scaling using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/imageSmoothingQuality\"><code>imageSmoothingQuality</code></a> property but at the time of this writing it’s <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/imageSmoothingQuality#browser_compatibility\">not available on Firefox</a>.</p>\n<h2 id=\"downloading-the-resulting-image\">Downloading the resulting image</h2>\n<p>Okay, we have our resulting image on the screen but we want it in our downloads folder.</p>\n<p>We can do so by converting the <code>&lt;canvas&gt;</code> into a <code>Blob</code> using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob\"><code>toBlob()</code></a> method on the <code>canvas</code> element (not the 2d context).</p>\n<p>We’ll use the <a href=\"https://pqina.nl/blog/how-to-prompt-the-user-to-download-a-file-instead-of-navigating-to-it/\"><code>downloadFile</code> function which we wrote in another article</a>.</p>\n<p>Additionally we’ll wrap the <code>toBlob</code> call inside a <code>try catch</code> statement, meaning that if something goes wrong, the site doesn’t crash and we can nicely handle the error.</p>\n<pre class=\"language-js\"><code class=\"language-js\">myImage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// make the square crop</span>\n    <span class=\"token keyword\">const</span> dx <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>myCanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">-</span> myImage<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> dy <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>myCanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">-</span> myImage<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>myImage<span class=\"token punctuation\">,</span> dx<span class=\"token punctuation\">,</span> dy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// convert to a blob</span>\n        myCanvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBlob</span><span class=\"token punctuation\">(</span>\n            <span class=\"token comment\">// this function runs when the blob has been created</span>\n            <span class=\"token punctuation\">(</span><span class=\"token parameter\">blob</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>blob <span class=\"token operator\">===</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token comment\">// something went wrong</span>\n                    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n\n                <span class=\"token comment\">// we use the `downloadFile` function from this article:</span>\n                <span class=\"token comment\">// https://pqina.nl/blog/how-to-prompt-the-user-to-download-a-file-instead-of-navigating-to-it/</span>\n                <span class=\"token function\">downloadFile</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n            <span class=\"token comment\">// the image type of the resulting blob</span>\n            <span class=\"token string\">'image/jpeg'</span><span class=\"token punctuation\">,</span>\n\n            <span class=\"token comment\">// the image quality of the resulting blob, a lower number means more compression</span>\n            <span class=\"token number\">0.5</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// something went wrong</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Please note that when loading images from remote URLs it’s possible that the remote site doesn’t allow drawing their images to a canvas.</p>\n<p>More information on <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/How_to/CORS_enabled_image\">canvas and remote images</a> can be found on MDN.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/crop-an-image-with-canvas/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Using CSS Color-Mix() to lower anchor underline opacity",
    "partialText": "<p>A tiny code sample showing how to use the CSS <code>color-mix</code> function with <code>currentColor</code> to automatically lower the opacity of anchor underlines.</p>\n<p>We can use CSS <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/color-mix\"><code>color-mix</code></a> to mix two colors and get a new color. The <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#currentcolor_keyword\"><code>currentColor</code></a> property holds the selected elements color value.</p>\n<p>Let’s combine them.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">a</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">text-decoration-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">color-mix</span><span class=\"token punctuation\">(</span>in srgb<span class=\"token punctuation\">,</span> currentColor 30%<span class=\"token punctuation\">,</span> transparent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.demo * {\n    all:revert;\n}\n\n.demo a {\n    text-decoration-color: color-mix(in srgb, currentColor 30%, transparent);\n}\n</style>\n<div class=\"demo\">\n    <p>In <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/color-mix\">this link to the color-mix function</a> on MDN, we can see the underline is less opaque.</p>\n</div>\n<p>Useful when you just want slightly nicer looking links.</p>\n<p>Keep in mind that lowering the opacity too much will result in accessibility issues.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/color-mix-anchor-underline/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Building A Birthdate Input Custom Element",
    "partialText": "<p>In this article we look at a <code>&lt;birthdate-input&gt;</code> custom element that automatically orders input fields based on the browser locale. Useful for asking your customers to input their birthdate without presenting them with a datepicker.</p>\n<p>Why not a datepicker? Because humans remember their birthdate as a string of numbers and the day of the week is not relevant.</p>\n<p>Entering those numbers is easier than navigating a date picker to find your birthdate.</p>\n<p>I posted about this on <a href=\"https://bsky.app/profile/rikschennink.com/post/3lcge6znro222\">Bluesky</a> and figured it’s probably useful to have a <a href=\"https://github.com/pqina/birthdate-input\">birthdate input custom element</a> for this that automatically adapts to the user browser locale.</p>\n<h2 id=\"the-base-html\">The Base HTML</h2>\n<p>The birthdate is defined by a set of labelled number inputs.</p>\n<p>We’ll wrap these inputs in a fieldset so they’re grouped as a birthdate.</p>\n<p>An optional <code>locale</code> attribute can be set on the <code>&lt;birtdate-input&gt;</code> to override the default browser locale.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fieldset</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>legend</span><span class=\"token punctuation\">></span></span>Birthdate<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>legend</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>birthdate-input</span> <span class=\"token attr-name\">locale</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en-US<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>day<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Day<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>day<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">min</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">max</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>31<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>number<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dd<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>month<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Month<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>month<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">min</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">max</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>12<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>number<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mm<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>year<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Year<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span>\n            <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>year<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">min</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1800<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">max</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>2025<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>number<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>yyyy<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>birthdate-input</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fieldset</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"the-birthdate-input-custom-element\">The Birthdate Input Custom Element</h2>\n<p>Now we need to register the <code>&lt;birthdate-input&gt;</code> custom element.</p>\n<p>This custom element automatically orders the fields based on the detected locale.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">BirthdateInput</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HTMLElement</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">connectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> defaultFields <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'day'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'month'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'year'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// get inputs</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>day<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">,</span> year<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"number\"]'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputs <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>day<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">,</span> year<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputRefs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> day<span class=\"token punctuation\">,</span> month<span class=\"token punctuation\">,</span> year <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// add field keys</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">,</span> input<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            input<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>key <span class=\"token operator\">=</span> defaultFields<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// order parts based on the browser default locale</span>\n        <span class=\"token keyword\">const</span> dateTimeFormat <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Intl<span class=\"token punctuation\">.</span>DateTimeFormat</span><span class=\"token punctuation\">(</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'locale'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">undefined</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> parts <span class=\"token operator\">=</span> dateTimeFormat<span class=\"token punctuation\">.</span><span class=\"token function\">formatToParts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> order <span class=\"token operator\">=</span> parts\n            <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">part</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> defaultFields<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>part<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">part</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> part<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// sort fields</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> key <span class=\"token keyword\">of</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputRefs<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// append the label</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">label[for=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>input<span class=\"token punctuation\">.</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// then append the input</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// just focussed other field, prevent tabbing out of it by accident</span>\n        <span class=\"token keyword\">let</span> preventTab <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keydown'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'Tab'</span> <span class=\"token operator\">&amp;&amp;</span> preventTab<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// auto jump to next field when user inputs numbers</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keyup'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// easier prop access</span>\n            <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> value<span class=\"token punctuation\">,</span> placeholder<span class=\"token punctuation\">,</span> dataset <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> input<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> currentIndex <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>dataset<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// move to previous field</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'Backspace'</span> <span class=\"token operator\">&amp;&amp;</span> value<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> previousField <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputRefs<span class=\"token punctuation\">[</span>order<span class=\"token punctuation\">[</span>currentIndex <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>previousField<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n                previousField<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token comment\">// not a number, ignore</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[0-9]</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// not filled out completely</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span>length <span class=\"token operator\">!==</span> placeholder<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// get next field</span>\n            <span class=\"token keyword\">const</span> nextField <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputRefs<span class=\"token punctuation\">[</span>order<span class=\"token punctuation\">[</span>currentIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>nextField<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// focus this field</span>\n            preventTab <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>preventTab <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">250</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            nextField<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">disconnectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// restore original order</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> input <span class=\"token keyword\">of</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\ncustomElements<span class=\"token punctuation\">.</span><span class=\"token function\">define</span><span class=\"token punctuation\">(</span><span class=\"token string\">'birthdate-input'</span><span class=\"token punctuation\">,</span> BirthdateInput<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<h2 id=\"demo-field\">Demo field</h2>\n<p>This is a live demo of the <code>&lt;birthdate-input&gt;</code> component. The order of the fields is determined by your browser default locale.</p>\n<div class=\"demo\">\n<fieldset>\n  <legend>Birthdate</legend>\n  <birthdate-input>\n    <label for=\"day\">Day</label>\n    <input id=\"day\" min=\"1\" max=\"31\" type=\"number\" placeholder=\"dd\" />\n    <label for=\"month\">Month</label>\n    <input id=\"month\" min=\"1\" max=\"12\" type=\"number\" placeholder=\"mm\" />\n    <label for=\"year\">Year</label>\n    <input id=\"year\" min=\"1800\" max=\"2025\" type=\"number\" placeholder=\"yyyy\" />\n  </birthdate-input>\n</fieldset>\n</div>\n<style>\nbirthdate-input {\n  display:flex;\n  gap: .5em;\n  & input {\n    appearance: none;\n    border: 1px solid black;\n    width: 4em;\n    padding:.25em;\n  }\n}\n</style>\n<script type=\"module\" src=\"https://unpkg.com/@pqina/birthdate-input/birthdate-input.js\"></script>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/building-birthdate-input-custom-element/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Animating And Transitioning CSS Custom Properties",
    "partialText": "<p>This code animates a CSS property, and transitions a custom CSS property. The transition property is used in the animation. This combination works on Chrome, but unfortunately fails on Firefox and Safari.</p>\n<p>See animation below, followed by the code snippet.</p>\n<p>The Bar element should pulse, but at the start of the animation pulses should start at low opacity (similar to Foo) and slowly fade in, which is what happens on Chrome.</p>\n<p>On Firefox and Safari the Foo element will fade in but the Bar element will pulse in the same manner no matter the transition state.</p>\n<div class=\"demo\" style=\"display:flex;\">\n    <p id=\"foo\">Foo</p>\n    <p id=\"bar\">Bar</p>\n</div>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token atrule\"><span class=\"token rule\">@property</span> --o</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">syntax</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;number>'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token property\">inherits</span><span class=\"token punctuation\">:</span> false<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">initial-value</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/* Test element so we can see that the custom property transition works */</span>\n    <span class=\"token selector\">#foo</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--o</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> --o 6s linear<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token selector\">#foo.in</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--o</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/* Element with transition and animation */</span>\n    <span class=\"token selector\">#bar</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--o</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> --o 6s linear<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token selector\">#bar.in</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--o</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> pulse 0.5s linear alternate infinite<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> pulse</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token selector\">from</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token selector\">to</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>foo<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Foo<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>bar<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Bar<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        foo<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'in'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        bar<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'in'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<style>\n    @property --o {\n        syntax: '<number>';\n        inherits: false;\n        initial-value: 0;\n    }\n\n    /* Test element so we can see that the custom property transition works */\n    #foo {\n        --o: 0;\n        width:fit-content;\n        transition: --o 6s linear;\n        color: rgba(var(--text));\n        background-color: rgba(var(--link), var(--o));\n        padding: .25em 1em;\n    }\n\n    #foo.in {\n        --o: 1;\n    }\n\n    /* Element with transition and animation */\n    #bar {\n        --o: 0;\n        width:fit-content;\n        color: rgba(var(--text));\n        transition: --o 6s linear;\n        padding: .25em 1em;\n    }\n\n    #bar.in {\n        --o: 1;\n        animation: pulse 0.5s linear alternate infinite;\n    }\n\n    @keyframes pulse {\n        from {\n            background-color: rgba(var(--link), 0);\n        }\n\n        to {\n            background-color: rgba(var(--link), var(--o));\n        }\n    }\n</style>\n<script>\n    setTimeout(() => {\n        foo.classList.add('in');\n        bar.classList.add('in');\n    }, 1000);\n</script>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/css-custom-property-mix-transition-animation/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Creating CSS Spring Animations With The Linear Easing Function",
    "partialText": "<p>While developing <a href=\"https://filepond.com/\">FilePond</a> I wanted to run a CSS powered spring animation, but the CSS API didn’t support it natively. So I built this tiny tool to generate <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/easing-function#linear_easing_function\">linear easing functions</a> that simulate spring animations in CSS.</p>\n<p>The app below uses a Svelte spring to animate a transition from <code>0</code> to <code>1</code>, it then records the spring steps and converts them to a <code>linear()</code> CSS transition. As a bonus it also creates a CSS animation. The generated CSS code is available for copy pasting below the app.</p>\n<p>Fine-tune the spring animation using the Stiffness and Damping controls.</p>\n<iframe src=\"https://pqina.nl/app/css-spring/\"></iframe>\n<p>The code blocks below will receive the resulting CSS transition and animation.</p>\n<pre><code id=\"appTransition\" style=\"overflow-x:scroll\">Waiting for data...</code></pre>\n<pre><code id=\"appAnimation\" style=\"overflow-x:scroll\">Waiting for data...</code></pre>\n<script>\nwindow.addEventListener('load', (e) => {\n    document.querySelector('iframe').contentWindow.addEventListener('message', (e) => {\n        const { data } = e;\n        appTransition.textContent = e.data.content.transitionStyle;\n        appAnimation.textContent = e.data.content.animationStyle;\n    })\n})\n</script>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/css-spring-animation-with-linear-easing-function/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Using Web Bluetooth To Read BBQ Temperature Sensor Data",
    "partialText": "<p>In this short read we’ll explore the <strong><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Bluetooth_API\">Web Bluetooth API</a></strong>. We’ll connect with my Bluetooth BBQ thermometer. Then we’ll try to read out its data and <strong>listen to its temperature updates</strong>. At the end of the article you’ll have a good idea about what you can do with the Web Bluetooth API.</p>\n<p>A couple months ago we purchased the Hermanos Grill 5.0 <strong>Bluetooth BBQ thermometer</strong>. It supports <strong>up to 6 temperature sensors</strong>, in this article I’ll connect 2. It also supports Bluetooth so you can connect your phone and see BBQ temperatures without having to get out of your chair.</p>\n<p>Ahhhh, we’re truly living in the future aren’t we!</p>\n<h2 id=\"connecting-to-the-device\">Connecting To The Device</h2>\n<p>At this time the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Bluetooth_API#browser_compatibility\">Web Bluetooth API is only supported by Chrome</a>. Unfortunately there’s no signal from other vendors that they’re working on adding support.</p>\n<p>So much for living in the future. 🤷‍♂️</p>\n<p>The first thing we need to do is connect to the Hermanos device over Bluetooth, we can do that by calling <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Bluetooth/requestDevice\"><code>navigator.bluetooth.requestDevice()</code></a></p>\n<p>We can pass filter parameters to have the browser only show the devices we’re interested it (we should do this in production), but for now we set <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Bluetooth/requestDevice#acceptalldevices\"><code>acceptAllDevices</code></a> to <code>true</code> so we can see every device around us.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Show us all the things!</span>\n    <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>The Web Bluetooth API requires a user interaction as trigger to connect, for security reasons you can’t just connect to a device on page load.</p>\n<p><strong>The user needs to click something that initiates the connection request.</strong></p>\n<p>Let’s add a connect button.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span> <span class=\"token special-attr\"><span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>Connect<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Pretty straightforward.</p>\n<p>Click our “Connect” button and Chrome opens a panel to select a Bluetooth device.</p>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/chrome-bluetooth-pair.png\" alt=\"A screenshot of the Chrome Bluetooth Pair panel showing the devices you can pair with\" width=\"500\" style=\"box-shadow: 0 0 0 1px rgba(255,255,255,.2);border-radius:.25em\" />\n</div>\n<p>With the device connection set up, let’s move on to the next steps:</p>\n<ul>\n<li>Connecting to the <abbr title=\"Generic ATTribute Profile\">GATT</abbr> server on the remote device.</li>\n<li>And then requesting the primary service.</li>\n</ul>\n<p>I had to look up the <abbr title=\"Generic ATTribute Profile\">GATT</abbr> acronym because I just can’t pass on an opportunity to use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/abbr\"><code>&lt;abbr&gt;</code></a> tag.</p>\n<p><abbr title=\"Generic ATTribute Profile\">GATT</abbr> is an acronym for “Generic ATTribute Profile”.</p>\n<p>It sets the terms for communication between two Bluetooth devices. So now you know.</p>\n<h2 id=\"connecting-to-the-bluetooth-gatt-server\">Connecting To The Bluetooth GATT Server</h2>\n<p>There’s nothing more to it than calling <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/BluetoothRemoteGATTServer/connect\"><code>device.gatt.connect()</code></a></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Connect to the GATT server</span>\n    <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> device<span class=\"token punctuation\">.</span>gatt<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Now that we have a reference to the GATT server, we can request the primary service.</p>\n<p>At this point, I struggled a tiny bit.</p>\n<p>To get the primary service we call <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/BluetoothRemoteGATTServer/getPrimaryService\"><code>server.getPrimaryService()</code></a></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> device<span class=\"token punctuation\">.</span>gatt<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// We fetch the primary service</span>\n    <span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">getPrimaryService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>This function however expects a Universally Unique Identifier.</p>\n<p>It should be called like this <code>getPrimaryService(uuid)</code></p>\n<p>I had no idea where to get this <abbr title=\"Universally Unique Identifier\">UUID</abbr> (another <code>&lt;abbr&gt;</code> 🥳), as I don’t have any documentation on this device I’m trying to connect to.</p>\n<p>After some looking around I stumbled uppon a handy Chrome utility. You can navigate to <a href=\"chrome://bluetooth-internals\">chrome://bluetooth-internals</a>, connect to a device, and inspect it.</p>\n<p>Chrome queries the device and displays an overview of the available internals:</p>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/chrome-bluetooth-internals.png\" alt=\"A screenshot of the Chrome Bluetooth Internals showing the device, services, characteristics and their matching identifiers\" style=\"box-shadow: 0 0 0 1px rgba(0,0,0,.1);border-radius:.25em\" />\n</div>\n<p>I just love how hardcore that interface is. Zero design. Those blue bar are clickable, it’s an accordion. The inspect button doesn’t always work, or inspects the incorrect device. Let’s say it’s probably a work in progress.</p>\n<p>But while it doesn’t look great, it’s functional. We can see the service with <strong>Type</strong> set to <strong>Primary</strong>, and it displays that UUID we’ve been looking for.</p>\n<p>We need to pass the UUID as a parameter to <code>getPrimaryService</code>, and we need to inform the device we’re going to do that by adding it to the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Bluetooth/requestDevice#optionalservices\"><code>optionalServices</code></a> array when we call <code>requestDevice</code></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 1. Store the UUID in a constant so we can use it more easily</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PRIMARY_SERVICE_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb0-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token comment\">// 2. Tell the device which services we want to use</span>\n        <span class=\"token literal-property property\">optionalServices</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> device<span class=\"token punctuation\">.</span>gatt<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 3. Fetch the primary service by UUID</span>\n    <span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">getPrimaryService</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Just like that the <code>service</code> variable contains a reference to the primary <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/BluetoothRemoteGATTService\"><code>BluetoothRemoteGATTService</code></a></p>\n<p>This GATT service has characteristics, we can see this in the Chrome Bluetooth Internals accordion.</p>\n<p>Let’s subscribe to the temperature characteristic for notifications!</p>\n<h2 id=\"subscribing-to-bluetooth-characteristic-notifications\">Subscribing To Bluetooth Characteristic Notifications</h2>\n<p>This specific BBQ temperature thingy has a notification characteristic, meaning it sends out temperature information (and probably some other stuff), and we can subscribe to those notifications.</p>\n<p>We know this because we can see it in the Chrome Bluetooth Internals accordion. It shows this nice green checkmark next to the <strong>Notify</strong> property.</p>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/chrome-bluetooth-internals-notify.png\" alt=\"A screenshot of the characteristic in the Chrome Bluetooth Internals panel showing a list of properties with checkmarks and crosses to indicate which features are supported\" style=\"box-shadow: 0 0 0 1px rgba(0,0,0,.1);border-radius:.25em\" />\n</div>\n<p>Let’s get access to the notification characteristic by calling <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/BluetoothRemoteGATTService/getCharacteristic\"><code>getCharacteristic()</code></a> and passing the characteristic UUID.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">PRIMARY_SERVICE_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb0-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 1. Add another constant</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb2-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">optionalServices</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> device<span class=\"token punctuation\">.</span>gatt<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">getPrimaryService</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 2. Get the notification characteristic from the primary service</span>\n    <span class=\"token keyword\">const</span> characteristic <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> primaryService<span class=\"token punctuation\">.</span><span class=\"token function\">getCharacteristic</span><span class=\"token punctuation\">(</span>\n        <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Now that we have our <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/BluetoothRemoteGATTCharacteristic\">Characteristic</a> we can listen for its <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/BluetoothRemoteGATTCharacteristic#oncharacteristicvaluechanged\"><code>'characteristicvaluechanged'</code></a> event.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">PRIMARY_SERVICE_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb0-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb2-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">optionalServices</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> device<span class=\"token punctuation\">.</span>gatt<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">getPrimaryService</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> characteristic <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> primaryService<span class=\"token punctuation\">.</span><span class=\"token function\">getCharacteristic</span><span class=\"token punctuation\">(</span>\n        <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Listen to the change event</span>\n    characteristic<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'characteristicvaluechanged'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// I'm called when the value changes</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>To get this show on the road we need to tell our characteristic to start notifying, this we can do with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/BluetoothRemoteGATTCharacteristic/startNotifications\"><code>startNotifications</code></a> method.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">PRIMARY_SERVICE_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb0-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb2-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">optionalServices</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> device<span class=\"token punctuation\">.</span>gatt<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">getPrimaryService</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> characteristic <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> primaryService<span class=\"token punctuation\">.</span><span class=\"token function\">getCharacteristic</span><span class=\"token punctuation\">(</span>\n        <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Tell it to start sending update notifications</span>\n    <span class=\"token keyword\">await</span> characteristic<span class=\"token punctuation\">.</span><span class=\"token function\">startNotifications</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Then we listen for changes</span>\n    characteristic<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'characteristicvaluechanged'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// I'm called when my value changes</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>The cached value of the notification characteristic is stored as a <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView\"><code>DataView</code></a> in the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/BluetoothRemoteGATTCharacteristic/value\"><code>characteristic.value</code></a> property.</p>\n<p>For clarity we’ll detach the event handler function and log the value.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">PRIMARY_SERVICE_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb0-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb2-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">optionalServices</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> device<span class=\"token punctuation\">.</span>gatt<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">getPrimaryService</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> characteristic <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> primaryService<span class=\"token punctuation\">.</span><span class=\"token function\">getCharacteristic</span><span class=\"token punctuation\">(</span>\n        <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">await</span> characteristic<span class=\"token punctuation\">.</span><span class=\"token function\">startNotifications</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Handles the 'characteristicvaluechanged' event</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleValueChanged</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Updated value</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>characteristic<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Move the event handler to a separate function</span>\n    characteristic<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'characteristicvaluechanged'</span><span class=\"token punctuation\">,</span>\n        handleValueChanged\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>In our developer console we can see the following log.</p>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/chrome-log-dataview.png\" alt=\"DataView(15)\" width=\"300\" style=\"box-shadow: 0 0 0 1px rgba(255,255,255,.2);border-radius:.25em\" />\n</div>\n<p>We have some data to work with! Let’s try to read the sensor temperatures from it.</p>\n<h2 id=\"getting-data-from-the-bluetooth-characteristic-dataview\">Getting Data From The BlueTooth Characteristic DataView</h2>\n<p>A DataView. What is this, and how do we get the temperature information from it? 🤔</p>\n<p>The DataView contains the <strong>binary data</strong> returned by the notification characteristic. If you have a manual telling you which data is where, that’s useful, but I didn’t have one.</p>\n<p>With some experimentation and perseverance we can figure this out.</p>\n<p>In the developer console we can expand <code>DataView</code>, then <code>buffer</code>, then <code>[[Int8Array]]</code></p>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/chrome-log-dataview-expand.png\" alt=\"A screenshot of the Chrome Memory inspector, it shows memory addresses and their values converted to various formats like int, uint, float, and string\" width=\"300\" style=\"box-shadow: 0 0 0 1px rgba(255,255,255,.2);border-radius:.25em\" />\n</div>\n<p>To figure out which data correlated to which sensor I detached all sensors and then plugged in each one while watching for changes.</p>\n<ol>\n<li>When I attached sensor 1, the values of index <code>2</code> changed from <code>-1</code> to <code>1</code>, and <code>3</code> changed from <code>-1</code> to an integer.</li>\n<li>The same happened for sensor 2, but it updated indexes <code>4</code> and <code>5</code></li>\n</ol>\n<p>So looks like that’s where the device stores the sensor data. Our next step is to convert these values to temperatures.</p>\n<p>This took me over an hour to figure out. For some reason I decided to click the little computer chip next to <code>DataView</code> and Chrome opened the <code>Memory inspector</code>.</p>\n<p>Honestly. This caught me off guard. I’ve logged <code>DataView</code> instances before but can’t remember seeing this icon, perhaps it’s new?</p>\n<p>Anyway, here’s the panel in all its glory:</p>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/chrome-memory-inspector.png\" alt=\"A screenshot of the Chrome Memory inspector, it shows memory addresses and their values converted to various formats like int, uint, float, and string\" style=\"box-shadow: 0 0 0 1px rgba(255,255,255,.2);border-radius:.25em\" />\n</div>\n<p>This is super useful.</p>\n<p>We can click through the memory locations and see what value each location contains. The <code>3F</code> location in the top right converts to <code>319</code> and that correlates quite nicely with the <strong>32 ℃</strong> the device display shows for sensor 1.</p>\n<pre><code>319 / 10 = 31,9\n</code></pre>\n<p>Plausible. Let’s read those bytes.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleValueChanged</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// We get the value at index 2 as `Uint16`</span>\n    <span class=\"token keyword\">const</span> sensorOneTemp <span class=\"token operator\">=</span> characteristic<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">getUint16</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// We get the value at index 4 as `Uint16`</span>\n    <span class=\"token keyword\">const</span> sensorTwoTemp <span class=\"token operator\">=</span> characteristic<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">getUint16</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Log the information to the dev console</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'characteristicvaluechanged'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#1'</span><span class=\"token punctuation\">,</span> sensorOneTemp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#2'</span><span class=\"token punctuation\">,</span> sensorTwoTemp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>And presto, we can see the result below. The temperature for sensor 2 increases when I hold it between my fingers.</p>\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\" style=\"box-shadow: 0 0 0 1px rgba(255,255,255,.1);border-radius:.25em\">\n    <source src=\"https://pqina.nl/media/bbq-bluetooth-sensor.mp4\" type=\"video/mp4\" />\n</video>\n<p>You can inspect the final code snippet below.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span> <span class=\"token special-attr\"><span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>Connect<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">PRIMARY_SERVICE_UUID</span> <span class=\"token operator\">=</span> <span class=\"token string\">'0000ffb0-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span> <span class=\"token operator\">=</span>\n        <span class=\"token string\">'0000ffb2-0000-1000-8000-00805f9b34fb'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> device <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> navigator<span class=\"token punctuation\">.</span>bluetooth<span class=\"token punctuation\">.</span><span class=\"token function\">requestDevice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">acceptAllDevices</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">optionalServices</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> device<span class=\"token punctuation\">.</span>gatt<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> server<span class=\"token punctuation\">.</span><span class=\"token function\">getPrimaryService</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PRIMARY_SERVICE_UUID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> characteristic <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> primaryService<span class=\"token punctuation\">.</span><span class=\"token function\">getCharacteristic</span><span class=\"token punctuation\">(</span>\n            <span class=\"token constant\">NOTIFICATION_CHARACTERISTIC_UUID</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">await</span> characteristic<span class=\"token punctuation\">.</span><span class=\"token function\">startNotifications</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleValueChanged</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> sensorOneTemp <span class=\"token operator\">=</span> characteristic<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">getUint16</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> sensorTwoTemp <span class=\"token operator\">=</span> characteristic<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span><span class=\"token function\">getUint16</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'characteristicvaluechanged'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#1'</span><span class=\"token punctuation\">,</span> sensorOneTemp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#2'</span><span class=\"token punctuation\">,</span> sensorTwoTemp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        characteristic<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">'characteristicvaluechanged'</span><span class=\"token punctuation\">,</span>\n            handleValueChanged\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>This is a real Connect button, it’s linked up to the finished script.</p>\n<p><button type=\"button\" onclick=\"connect()\">Connect</button></p>\n<p>If you own the same sensor, <em>in theory</em>, you should be able to connect to it on this page.</p>\n<script>\n// we put this postfix in a constant so we can re-use\nconst DEVICE_ID = '0000-1000-8000-00805f9b34fb';\n\n// the id of the primary service\nconst PRIMARY_SERVICE_UUID = `0000ffb0-${DEVICE_ID}`;\n\n// the id of the notification characteristic\nconst NOTIFICATION_CHARACTERISTIC_UUID = `0000ffb2-${DEVICE_ID}`;\n\n// function that connects to the device and starts reading data\nasync function connect() {\n\n    // let's connect to the device\n    const device = await navigator.bluetooth.requestDevice({\n        // so we can see all devices in the list, only use when testing\n        acceptAllDevices: true,\n\n        // to tell the device which services we want to use\n        optionalServices: [PRIMARY_SERVICE_UUID],\n    });\n\n    // then we connect to the server\n    const server = await device.gatt.connect();\n\n    // now we fetch the primary service\n    const primaryService = await server.getPrimaryService(PRIMARY_SERVICE_UUID);\n\n    // now we get from this service the notification characteristic\n    const characteristic = await primaryService.getCharacteristic(\n        NOTIFICATION_CHARACTERISTIC_UUID\n    );\n\n    // tell it to start sending update notifications\n    await characteristic.startNotifications();\n\n    // start listening for updates, log the dataView\n    characteristic.addEventListener('characteristicvaluechanged', (e) => {\n        // we get the value at index 2 as `Uint16`\n        const sensorOneTemp = characteristic.value.getUint16(2) / 10;\n\n        // we get the value at index 4 as `Uint16`\n        const sensorTwoTemp = characteristic.value.getUint16(4) / 10;\n\n        // Log the information to the dev console\n        console.clear();\n        console.log('characteristicvaluechanged');\n        console.log('#1', sensorOneTemp);\n        console.log('#2', sensorTwoTemp);\n    });\n}\n</script>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>It’s crazy to me how powerful web browsers have become, we linked up a Bluetooth device in under 10 lines of code. 🤯</p>\n<p>If you followed along you should have a good idea now about how you could use the Bluetooth Web API, there’s plenty of other and probably more useful use cases out there. Let me know what you decided to connect to!</p>\n<p>Let’s keeps our fingers crossed that Apple and Mozzila add support for the Web Bluetooth API soon so we can start creating truly cross platform web apps.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/web-bluetooth-api-read-bbq-temperature-sensor-data/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "What's the JavaScript version of sleep",
    "partialText": "<p>There’s no sleep function in JavaScript, how can we make one?</p>\n<p>Let’s jump right in and write the function.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">milliseconds</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> milliseconds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>It’s a basic function that when called returns a <code>Promise</code> that’s resolved after the given number of milliseconds.</p>\n<p>How do we use this function?</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sleep for 1 second</span>\n<span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// do this after 1 second</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// do this first</span></code></pre>\n<p>Please note that any code placed after <code>sleep</code> will run before the code inside the <code>then</code> function.</p>\n<p>We can also use <code>async</code>/<code>await</code></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sleep for 1 second</span>\n<span class=\"token keyword\">await</span> <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// do this after 1 second</span></code></pre>\n<p>That’s it. A super quick way to create a sleep function in JavaScript.</p>\n<p>Useful for when we, for example, want to sleep an authentication process a random number of milliseconds to obfuscate if our server is busy or not.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/whats-the-javascript-version-of-sleep/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Flexible CSS Colors With Custom Properties",
    "partialText": "<p>Let’s use CSS Custom Properties and <code>calc()</code> to create various CSS color effects, fasten your seatbelt, we’re going from 0 to 100 in 1.5 seconds.</p>\n<p>No time to waste, let’s go!</p>\n<style>\n.demo-row .demo {\n    display: block;\n}\n\n.page {\n    --foreground: 0, 0, 0;\n    --background: 255, 255, 255;\n    padding: 1em;\n    border-radius: .5rem;\n    color: rgb(var(--foreground));\n    background: rgb(var(--background));\n    box-shadow: 0 0 0 1px rgba(var(--text), .1);\n    align-items:flex-start;\n}\n\n.page-dark {\n    --foreground: 255, 255, 255;\n    --background: 0, 0, 0;\n}\n\n.page p {\n    width: fit-content;\n    text-align:left;\n}\n\n.page p + p {\n    margin-top: 1em !important;\n}\n\n.page .panel {\n    padding: 1em;\n    background: rgba(var(--foreground), 0.25);\n}\n\n.page .panel-dark {\n    padding: 1em;\n    background: rgba(var(--foreground), 0.5);\n}\n\n.page .panel-dark-offset {\n    margin-top:-1em !important;\n}\n\n.page .panel-dark-gradient {\n    --overlay: rgba(var(--foreground), 0.5);\n    background-image: linear-gradient(var(--overlay), var(--overlay));\n    background-color: rgb(var(--background));\n}\n</style>\n<h2 id=\"setting-up-a-basic-color-scheme\">Setting Up A Basic Color Scheme</h2>\n<p>First we create a basic black text on white background style for our page.</p>\n<p>Note that in the <code>:root</code> selector we don’t use <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/color_value\">functional notations for our colors</a>, we only set the numbers.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Our very plain page<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">:root</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">--foreground</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* black */</span>\n    <span class=\"token property\">--background</span><span class=\"token punctuation\">:</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* white */</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">html</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--background<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo page\">\n    <p>Our very plain page</p>\n</div>\n<p>A very plain page indeed, let’s add some different tints of grey.</p>\n<h2 id=\"creating-different-color-tints\">Creating Different Color Tints</h2>\n<p>Let’s add a paragraph with a grey background. We can do this by creating an <code>rgba</code> color and lowering its alpha value.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Our very plain page<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>panel<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>A panel with a grey background<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.panel</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.25<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo page\">\n    <p>Our very plain page</p>\n    <p class=\"panel\">\n        A panel with a grey background\n    </p>\n</div>\n<p>By adjusting the alpha value we can create various tints of grey.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Our very plain page<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>panel<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>A panel with a grey background<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>panel-dark<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>A panel with a dark grey background<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.panel-dark</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo page\">\n    <p>Our very plain page</p>\n    <p class=\"panel\">\n        A panel with a grey background\n    </p>\n    <p class=\"panel-dark\">\n        A panel with a dark grey background\n    </p>\n</div>\n<p>A useful trick, but in situations where our panels overlap it will quickly become apparent that their backgrounds aren’t opaque.</p>\n<p>Let’s move the bottom panel so it overlaps with the top one.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.panel-dark</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">margin-top</span><span class=\"token punctuation\">:</span> -1em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo page\">\n    <p>Our very plain page</p>\n    <p class=\"panel\">\n        A panel with a grey background\n    </p>\n    <p class=\"panel-dark panel-dark-offset\">\n        A panel with a dark grey background\n    </p>\n</div>\n<p>We can see the dark color where the top panel shows behind the bottom panel.</p>\n<p>To fix this we set can the <code>background-color</code> of the bottom panel to an opaque color and then overlay a <code>linear-gradient</code> on top of that. We can reduce code duplication by assigning the gradient color to a separate custom property.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.panel-dark</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">--overlay</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--overlay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--overlay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--background<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo page\">\n    <p>Our very plain page</p>\n    <p class=\"panel\">\n        A panel with a grey background\n    </p>\n    <p class=\"panel-dark panel-dark-offset panel-dark-gradient\">\n        A panel with a dark grey background\n    </p>\n</div>\n<p>Now our darker panel is opaque.</p>\n<p>You’d imagine it would be possible to use multiple background colors, but while the <code>background</code> property supports setting multiple background images <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_backgrounds_and_borders/Using_multiple_backgrounds\">it’s not possible to stack background colors</a>.</p>\n<h2 id=\"adding-a-dark-theme\">Adding A Dark Theme</h2>\n<p>Next up is adding a dark theme using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme\"><code>prefers-color-scheme: dark</code></a> media feature.</p>\n<p>We only have to swap the <code>--foreground</code> and <code>--background</code> values, and we’re set.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">:root</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">--foreground</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--background</span><span class=\"token punctuation\">:</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@media</span> <span class=\"token punctuation\">(</span><span class=\"token property\">prefers-color-scheme</span><span class=\"token punctuation\">:</span> dark<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">:root</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--foreground</span><span class=\"token punctuation\">:</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">--background</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Let’s view the light and dark themes side by side.</p>\n<div class=\"demo-row demo-row-fit\">\n    <div class=\"demo page\">\n        <p>Our very light page</p>\n        <p class=\"panel\">\n            A grey panel\n        </p>\n        <p class=\"panel-dark panel-dark-offset panel-dark-gradient\">\n            A dark grey panel\n        </p>\n    </div>\n    <div class=\"demo page page-dark\">\n        <p>Our very dark page</p>\n        <p class=\"panel\">\n            A grey panel\n        </p>\n        <p class=\"panel-dark panel-dark-offset panel-dark-gradient\">\n            A dark grey panel\n        </p>\n    </div>\n</div>\n<p>Great, our theme is working!</p>\n<p>Let’s step it up a notch by adding some more exiting styles.</p>\n<h2 id=\"using-css-custom-properties-as-style-modifiers\">Using CSS Custom Properties As Style Modifiers</h2>\n<p>We’re going to replace the text on our page with a button that we’ll try to make look good in both the bright and the dark theme.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Our button<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">button</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--background<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo demo-row demo-row-fit\">\n    <div class=\"demo page page-padded\">\n        <p><button type=\"button\">Do the thing!</button></p>\n    </div>\n    <div class=\"demo page page-padded page-dark\">\n        <p><button type=\"button\">Do the thing!</button></p>\n    </div>\n</div>\n<p>Our button is looking “good” and it’s automatically styled in dark mode as well.</p>\n<p>Let’s now add some more details to our button.</p>\n<p>We’ll try to make it look more realistic by simulating light shining from the top. This creates a shadow below the button and a highlight on top. To make this more apparent we will dim the page background color.</p>\n<style>\n.page-dimmed {\n    --overlay: rgba(var(--foreground), 0.2);\n    background-image: linear-gradient(var(--overlay), var(--overlay));\n    background-color: rgb(var(--background));\n}\n\n.page-padded {\n    padding: 3em;\n}\n\n.page button {\n    color: rgb(var(--background));\n    background: rgb(var(--foreground));\n    border: 0;\n    padding: .5rem 1.25rem;\n    cursor:pointer;\n}\n\n.page .button-detailed {\n    --shadow-behind: 0 .125rem .5rem rgba(0, 0, 0, .4);\n    --shadow-below: 0 .125rem .25rem rgba(0, 0, 0, .2), 0 .06125rem .125rem rgba(0, 0, 0, .2);\n\n    --highlight-outline: 0 0 0 1px rgba(var(--foreground), .5);\n    --highlight-inset: inset 0 0 0 1px rgba(255, 255, 255, .1);\n    --highlight-top: inset 0 1px 0 0 rgba(255, 255, 255, .3);\n    --highlight-bottom: inset 0 -1px 0 rgba(0, 0, 0, .4);\n\n    color: rgba(var(--background), .85);\n\n    background: linear-gradient(\n        rgba(var(--foreground), .6), \n        rgba(var(--foreground), .75)\n    );\n\n    box-shadow: \n        var(--highlight-outline),\n        var(--highlight-top),\n        var(--highlight-bottom),\n        var(--highlight-inset),\n        var(--shadow-below), \n        var(--shadow-behind);\n\n    border-radius:.5rem;\n\n    text-shadow: 0 -1px 0 rgba(var(--foreground), .9);\n}\n</style>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">html</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Dim page background color */</span>\n    <span class=\"token property\">--overlay</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--overlay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--overlay<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--background<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Same text color as before */</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Nicely rounded corners */</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 0.5rem<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Slightly dimmed color for text */</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--background<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.85<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* An inset shadow above the text */</span>\n    <span class=\"token property\">text-shadow</span><span class=\"token punctuation\">:</span> 0 -1px 0 <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.9<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* A subtle gradient as background */</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.75<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* A shadow and inset, define all the values used in the box-shadow, and then stack them */</span>\n    <span class=\"token property\">--shadow-behind</span><span class=\"token punctuation\">:</span> 0 0.125rem 0.5rem <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--shadow-below</span><span class=\"token punctuation\">:</span> 0 0.125rem 0.25rem <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0 0.06125rem 0.125rem\n            <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-outline</span><span class=\"token punctuation\">:</span> 0 0 0 1px <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-inset</span><span class=\"token punctuation\">:</span> inset 0 0 0 1px <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 0.1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-top</span><span class=\"token punctuation\">:</span> inset 0 1px 0 0 <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 0.3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-bottom</span><span class=\"token punctuation\">:</span> inset 0 -1px 0 <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--highlight-outline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--highlight-top<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>\n            --highlight-bottom\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--highlight-inset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--shadow-below<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--shadow-behind<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Let’s take a look at the results.</p>\n<div class=\"demo demo-row demo-row-fit\">\n    <div class=\"demo page page-padded page-dimmed\">\n        <p><button type=\"button\" class=\"button-detailed\">Do the thing!</button></p>\n    </div>\n    <div class=\"demo page page-padded page-dark page-dimmed\">\n        <p><button type=\"button\" class=\"button-detailed\">Do the thing!</button></p>\n    </div>\n</div>\n<p>The button looks excellent on the bright page, but on the dark page something it’s not great.</p>\n<ul>\n<li>The gradient is inverted, going from dark to light.</li>\n<li>The outline is too bright.</li>\n<li>The white text-shadow is very bright and should be below the text.</li>\n<li>The button is too bright overall which causes loss of detail.</li>\n</ul>\n<p>These problems are partly caused by blatantly inverting the colors, but it’s also related to our eyes being more sensitive details when it’s light.</p>\n<p>Let’s introduce 2 new CSS Custom Properties and update the button styles to fix gradient directions and improve contrast so details are better visible in dark mode.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">:root</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">--foreground</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--background</span><span class=\"token punctuation\">:</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* By default this is set to 1 so it doesn't cause inversions */</span>\n    <span class=\"token property\">--mod-invert</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@media</span> <span class=\"token punctuation\">(</span><span class=\"token property\">prefers-color-scheme</span><span class=\"token punctuation\">:</span> dark<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">:root</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">--foreground</span><span class=\"token punctuation\">:</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">--background</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* We set this one to -1 so we can use it to invert values */</span>\n        <span class=\"token property\">--mod-invert</span><span class=\"token punctuation\">:</span> -1<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* Set to 2 so we can use this to multiple values to increase contrast */</span>\n        <span class=\"token property\">--mod-contrast</span><span class=\"token punctuation\">:</span> 2<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Nicely rounded corners */</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 0.5rem<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Slightly dimmed color for text */</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--background<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0.85<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* \n    An inset shadow above the text \n    - Flip the text shadow direction \n    - Lower shadow opacity\n    */</span>\n    <span class=\"token property\">--text-shadow-y</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>-1px * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mod-invert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--text-shadow-alpha</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.9 * <span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mod-contrast<span class=\"token punctuation\">,</span> 4<span class=\"token punctuation\">)</span> * 0.25<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">text-shadow</span><span class=\"token punctuation\">:</span> 0 <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--text-shadow-y<span class=\"token punctuation\">)</span> 0 <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>\n            <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--text-shadow-alpha<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* \n    A subtle gradient as background\n    - Flip the gradient direction in dark mode \n    - Lower opacity in dark mode\n    */</span>\n    <span class=\"token property\">--linear-gradient-direction</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>90deg + <span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mod-invert<span class=\"token punctuation\">)</span> * 90deg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--linear-gradient-factor</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mod-contrast<span class=\"token punctuation\">,</span> 2.5<span class=\"token punctuation\">)</span> * 0.4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>\n        <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--linear-gradient-direction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.6 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--linear-gradient-factor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.75 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--linear-gradient-factor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* \n    A shadow and inset, define all the values used in the box-shadow, and then stack them\n    - Calculate factor to use for the button outline intensity\n    */</span>\n    <span class=\"token property\">--shadow-behind</span><span class=\"token punctuation\">:</span> 0 0.125rem 0.5rem <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--shadow-below</span><span class=\"token punctuation\">:</span> 0 0.125rem 0.25rem <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0 0.06125rem 0.125rem\n            <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-outline-alpha-factor</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mod-contrast<span class=\"token punctuation\">,</span> 2.85<span class=\"token punctuation\">)</span> * 0.35<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-outline</span><span class=\"token punctuation\">:</span> 0 0 0 1px <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--foreground<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.5 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--highlight-outline-alpha-factor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-inset</span><span class=\"token punctuation\">:</span> inset 0 0 0 1px <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.1 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mod-contrast<span class=\"token punctuation\">,</span> 1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-top</span><span class=\"token punctuation\">:</span> inset 0 1px 0 0 <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> 255<span class=\"token punctuation\">,</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.3 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mod-contrast<span class=\"token punctuation\">,</span> 1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--highlight-bottom</span><span class=\"token punctuation\">:</span> inset 0 -1px 0 <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.4 / <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mod-contrast<span class=\"token punctuation\">,</span> 1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--highlight-outline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--highlight-top<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>\n            --highlight-bottom\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--highlight-inset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--shadow-below<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--shadow-behind<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.page {\n    --mod-invert: 1;\n}\n\n.page-dark {\n    --mod-invert: -1;\n    --mod-contrast: 2;\n}\n\n.page .button-detailed-fixed {\n    color: rgba(var(--background), .85);\n\n    /* flip the gradient direction in dark mode */\n    --linear-gradient-direction: calc(90deg + (var(--mod-invert) * 90deg));\n\n    /* lower opacity in dark mode */\n    --linear-gradient-factor: calc(var(--mod-contrast, 2.22) * .45);\n    background: linear-gradient(\n        var(--linear-gradient-direction),\n        rgba(var(--foreground), calc(.6 * var(--linear-gradient-factor))), \n        rgba(var(--foreground), calc(.75 * var(--linear-gradient-factor)))\n    );\n\n    /* calculate factor to use for bright highlight intensity */\n    --shadow-behind: 0 .125rem .5rem rgba(0, 0, 0, .4);\n    --shadow-below: 0 .125rem .25rem rgba(0, 0, 0, .2), 0 .06125rem .125rem rgba(0, 0, 0, .2);\n    --highlight-outline-alpha-factor: calc(var(--mod-contrast, 2.85) * .35);\n    --highlight-outline: 0 0 0 1px rgba(var(--foreground), calc(\n        .5 * var(--highlight-outline-alpha-factor))\n    );\n    --highlight-inset: inset 0 0 0 1px rgba(255, 255, 255, calc(.1 * var(--mod-contrast, 1)));\n    --highlight-top: inset 0 1px 0 0 rgba(255, 255, 255, calc(.3 * var(--mod-contrast, 1)));\n    --highlight-bottom: inset 0 -1px 0 rgba(0, 0, 0, calc(.4 / var(--mod-contrast, 1)));\n\n    box-shadow: \n        var(--highlight-outline),\n        var(--highlight-top),\n        var(--highlight-bottom),\n        var(--highlight-inset),\n        var(--shadow-below), \n        var(--shadow-behind);\n\n    border-radius:.5rem;\n\n    /* flip the text shadow direction and lower shadow opacity */\n    --text-shadow-y: calc(-1px * var(--mod-invert));\n    --text-shadow-alpha: calc(.9 * (var(--mod-contrast, 4) * .25));\n    text-shadow: 0 var(--text-shadow-y) 0 rgba(var(--foreground), var(--text-shadow-alpha));\n}\n</style>\n<p>Let’s compare the old and the new dark button, the light version has stayed the same.</p>\n<div class=\"demo demo-row demo-row-fit\">\n    <div class=\"demo page page-padded page-dark page-dimmed\">\n        <p><button type=\"button\" class=\"button-detailed\">Do the thing!</button></p>\n    </div>\n    <div class=\"demo page page-padded page-dark page-dimmed\">\n        <p><button type=\"button\" class=\"button-detailed-fixed\">Do the thing!</button></p>\n    </div>\n</div>\n<p>Excellent, now let’s look at the light and dark pages next to each other.</p>\n<div class=\"demo demo-row demo-row-fit\">\n    <div class=\"demo page page-padded page-dimmed\">\n        <p><button type=\"button\" class=\"button-detailed\">Do the thing!</button></p>\n    </div>\n    <div class=\"demo page page-padded page-dark page-dimmed\">\n        <p><button type=\"button\" class=\"button-detailed-fixed\">Do the thing!</button></p>\n    </div>\n</div>\n<p>Quite the improvement!</p>\n<p>Admittedly this all escalated a bit fast in this last section, but I hope you learned a couple new tricks and this gives you some ideas on how to apply them to your code, see you in the next one!</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/css-colors-with-custom-properties/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Create Crisp Image Borders With CSS Pseudo Elements",
    "partialText": "<p>Transparent image borders can have contrast issues and look dull, let’s make them nice and crisp with this tiny CSS trick.</p>\n<style>\n/* normal */\n.border-normal img {\n    border-radius: 1rem;\n    border: 1px solid rgba(var(--text),.5);\n    max-width: calc(100% - 4px);\n}\n\n/* fancy */\n.border-fancy {\n    position: relative;\n    width: fit-content;\n    border-radius: 1rem;\n}\n\n.border-fancy img,\n.border-fancy::after {\n    border-radius: inherit;\n}\n\n.border-fancy img {\n    display: block;\n}\n\n.border-fancy::after {\n    content:'';\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    box-shadow: inset 0 0 0 1px rgba(var(--text),.25);\n    pointer-events: none;\n}\n</style>\n<p>The demo below shows a default half transparent image border.</p>\n<div class=\"demo demo-row\">\n    <div>\n        <div class=\"border-normal\">\n            <img src=\"https://pqina.nl/media/cat.jpeg\" alt=\"\" />\n        </div>\n        <span>Boring border</span>\n    </div>\n</div>\n<p>We can see that we lose contrast depending on the colors of the image near the border.</p>\n<p>The border looks nice when it’s near a contrasting area, but it kind of dissapears when near colors of the same brightness.</p>\n<p>In the example below we overlay the border on top of the image, this creates a very nice sharp edge.</p>\n<div class=\"demo demo-row\">\n    <div>\n        <div class=\"border-fancy\">\n            <img src=\"https://pqina.nl/media/cat.jpeg\" alt=\"\" />\n        </div>\n        <span>Fancy colorful border</span>\n    </div>\n</div>\n<p>The side-by-side comparison below makes it more clear.</p>\n<div class=\"demo demo-row demo-row-fit\">\n    <div>\n        <div class=\"border-normal\">\n            <img src=\"https://pqina.nl/media/cat.jpeg\" alt=\"\" />\n        </div>\n        <span>Boring border</span>\n    </div>\n    <div>\n        <div class=\"border-fancy\">\n            <img src=\"https://pqina.nl/media/cat.jpeg\" alt=\"\" />\n        </div>\n        <span>Fancy colorful border</span>\n    </div>\n</div>\n<p>For this CSS trick we use an inset <code>box-shadow</code> instead of a <code>border</code>, while an image can have an inset box-shadow it won’t show as that’s where its pixels are rendered.</p>\n<p>So to do this we’ll have to overlay another element on top. Let’s set up the HTML.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fancy-border<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>We’ll scale the <code>.fancy-border</code> element to be as wide as the image.</p>\n<p>Next we create a Pseudo Element with an inset <code>box-shadow</code> and overlay it on top of the image.</p>\n<p>Finally we set <code>pointer-events</code> to <code>none</code> to hide the Pseudo Element element from user interactions.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.fancy-border</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> fit-content<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 1rem<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.fancy-border img,\n.fancy-border::after</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> inherit<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.fancy-border img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.fancy-border::after</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span> inset 0 0 0 1px <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.25<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">pointer-events</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/crisp-image-borders-with-css-pseudo-elements/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Edit Images With Vue And Pintura",
    "partialText": "<p>In this quick tutorial we’ll build a Vue image editor using <a href=\"https://pqina.nl/pintura/\">Pintura</a> a powerful JavaScript image and video editor SDK.</p>\n<p>We could build a complete image editor ourselves but that would literally take months, it would turn this quick tutorial into a not-so-quick tutorial.</p>\n<p>To get started we’ll set up a basic Vue Composition API based template and then add Pintura.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">setup</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Coming up next...</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- File selection --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token comment\">&lt;!-- Editor output --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>While this tutorial is based on the Vue 3 Composition API, Pintura works just as well with Vue 2 or the Vue 3 template API.</p>\n<h2 id=\"receiving-user-selected-files\">Receiving User Selected Files</h2>\n<p>Let’s first write the logic get the selected image file from the file input.</p>\n<p>We’ll need to get the files, select the first file, and then make sure it’s an image.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">setup</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">function</span> <span class=\"token function\">handleFile</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get files from the file input</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Only need the first file</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>file<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> files<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We're only interested in images, also, if no file selected we can't continue</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">image</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We're ready to edit an image...</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@change</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleFile<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"editing-images-with-vue\">Editing Images With Vue</h2>\n<p>Now that we’re sure we’ve selected an image file we can add Pintura and edit the image.</p>\n<p>We’ll import the <code>openDefaultEditor</code> factory, this creates and opens a feature complete image editor instance in a modal.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">setup</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Import the default Pintura modal editor</span>\n    <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pqina/pintura'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">handleFile</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>file<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> files<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">image</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Open Pintura in a modal</span>\n        <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> file<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Fires when we're done editing the image</span>\n        editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Next up is showing the resulting image...</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@change</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleFile<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"showing-the-output-image\">Showing The Output Image</h2>\n<p>When we’re done editing an image the resulting image is returned in the callback assigned to the <code>'process'</code> event. The <code>dest</code> property contains the output image file.</p>\n<p>By defining a <code>reactive</code> property we can set the <code>src</code> attribute of the image by updating the <code>src</code> property of the <code>outputImage</code> object.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">setup</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pqina/pintura'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// The Vue reactive property helper</span>\n    <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> reactive <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// The source of the image we want to display</span>\n    <span class=\"token keyword\">const</span> outputImage <span class=\"token operator\">=</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">handleFile</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>file<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> files<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">image</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> file<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Show the resulting image file</span>\n            outputImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@change</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleFile<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">:src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>outputImage.src<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"uploading-the-resulting-image\">Uploading The Resulting Image</h2>\n<p>We can use Pintura to upload the edited image as well. We set the <a href=\"https://pqina.nl/pintura/docs/v8/api/image-editor/exports/#store\"><code>store</code></a> property on the <a href=\"https://pqina.nl/pintura/docs/v8/api/image-editor/exports/#createdefaultimagewriter\"><code>imageWriter</code></a>, this tells Pintura to POST the resulting image to the specified URL. Pintura will show a progress indicator while it’s busy uploading.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">setup</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pqina/pintura'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> reactive <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> outputImage <span class=\"token operator\">=</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">handleFile</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>file<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> files<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">image</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> file<span class=\"token punctuation\">,</span>\n\n            <span class=\"token comment\">// Here we pass the `store` property to the `imageWriter`, it'll</span>\n            <span class=\"token comment\">// POST our image as FormData to the defined end point at `/upload/`</span>\n            <span class=\"token literal-property property\">imageWriter</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">store</span><span class=\"token operator\">:</span> <span class=\"token string\">'/upload/'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            outputImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@change</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleFile<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">:src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>outputImage.src<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"conditionally-loading-pintura\">Conditionally Loading Pintura</h2>\n<p>Pintura weighs in at about half the size of a 5¼ inch floppy (about <code>200KB</code> gzipped), while super small for an image editor, that’s still quite a lot of data for slower connections.</p>\n<p>To improve page performance we can use tree-shaking and only import the internal Pintura modules we need, but on top of that we can wait with loading Pintura until the user selects an image to edit. It’s at that time we need the editor image editing.</p>\n<p>Let’s make this tiny change now, we’ll use a dynamic <code>import</code> to load the module.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">setup</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> reactive <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> outputImage <span class=\"token operator\">=</span> <span class=\"token function\">reactive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handleFile</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>file<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> files<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">image</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Dynamically load Pintura when the user has selected a valid image file</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@pqina/pintura'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> file<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">imageWriter</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">store</span><span class=\"token operator\">:</span> <span class=\"token string\">'/upload/'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            outputImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@change</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleFile<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">:src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>outputImage.src<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>With only a couple lines of code we’ve added a fully featured image editing solution to our project and we didn’t even use the <a href=\"https://pqina.nl/pintura/docs/v8/installation/vue/\">Vue Pintura Components</a>. While integrating Pintura we’ve learned about <a href=\"https://vuejs.org/guide/essentials/reactivity-fundamentals.html\">reactive</a> Vue objects and <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/import\">dynamic loading of JavaScript modules</a>.</p>\n<p>We’ve got everything we need to add image editing functionality to a Vue project, making it possible to crop profile pictures, build photo collages, <a href=\"https://pqina.nl/blog/annotate-image-with-javascript/\">annotate images</a>, <a href=\"https://pqina.nl/pintura/\">and much more</a>.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/edit-images-with-vue-and-pintura/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Compress An Image Before Upload With JavaScript",
    "partialText": "<p>In this quick tutorial <strong>we’ll use JavaScript to compress images</strong> selected with a file input element. We’ll compress images and save them back to the file input ready for upload.</p>\n<p>To make sure users can upload their images and prevent super big images from being uploaded we can compress image data before upload without bothering the user with all kinds of requirements.</p>\n<p>If you’re in a hurry, or find it easier to read the code itself, <a href=\"https://pqina.nl/blog/compress-image-before-upload/#saving-the-compressed-image-back-to-the-file-input\">you can jump to the final code snippet here</a></p>\n<h2 id=\"getting-the-selected-image-files\">Getting The Selected Image Files</h2>\n<p>In the example below we’ll accept all kinds of files but will only compress the images. The <code>multiple</code> attribute enables selection of more than one file.</p>\n<p>To prevent other files from being added we can optionally set the file input <code>accept</code> attribute to <code>&quot;image/*&quot;</code></p>\n<p>Let’s set up a file input field, we’ll listen for the <code>&quot;change&quot;</code> to detect when the user has selected one or more files. We’ll handle the <code>TODO</code> items in the next section.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">multiple</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-image-field<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Get the selected files from the file input</span>\n    <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.my-image-field'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    input<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get the files</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// No files selected</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>files<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// For every file in the files list</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> file <span class=\"token keyword\">of</span> files<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// We don't have to compress files that aren't images</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// TODO: Not an image</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token comment\">// TODO: Compress the image</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// TODO: Store the files</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Our code now runs when a user selects one or more image files. Next up is compressing the images.</p>\n<p>Since we’ve got some todo’s to take care of… I’ve been building a <a href=\"https://pqina.nl/hotlist/?ref=compressimagearticle\">macOS daily Todo tracking app called Hotlist</a> (a fun side project to learn app development), who knows, maybe it’s just what you’ve been looking for.</p>\n<p>Anyhow… Let’s get back to image compression!</p>\n<h2 id=\"compressing-the-images\">Compressing The Images</h2>\n<p>We’ll implement the <code>compressImage</code> function. This function will convert the passed <code>File</code> object to an <code>ImageBitmap</code>, draw it to a <code>&lt;canvas&gt;</code> element, and then the canvas returns a compressed JPEG using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob\"><code>toBlob</code></a> API.</p>\n<p>Please note that we could also ask for a WEBP but that this (at the time of this writing) <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob#browser_compatibility\">isn’t support on Safari</a> 🤷‍♂️</p>\n<p>Let’s get to it.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">multiple</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-image-field<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">compressImage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> quality <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>type <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get as image data</span>\n        <span class=\"token keyword\">const</span> imageBitmap <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createImageBitmap</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Draw to canvas</span>\n        <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> imageBitmap<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n        canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> imageBitmap<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>imageBitmap<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Turn into Blob</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n            canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBlob</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> quality<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get the selected file from the file input</span>\n    <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.my-image-field'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    input<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get the files</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// No files selected</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>files<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// For every file in the files list</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> file <span class=\"token keyword\">of</span> files<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// We don't have to compress files that aren't images</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// TODO: Not an image</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token comment\">// We compress the file by 50%</span>\n            <span class=\"token keyword\">const</span> compressedFile <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">compressImage</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// 0: is maximum compression</span>\n                <span class=\"token comment\">// 1: is no compression</span>\n                <span class=\"token literal-property property\">quality</span><span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n\n                <span class=\"token comment\">// We want a JPEG file</span>\n                <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'image/jpeg'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// TODO: Store the files</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>The <code>compressedFile</code> variable will now contain the compressed image file.</p>\n<p>Next up is saving the compressed image file (and the ignored files), back to the file input.</p>\n<h2 id=\"saving-the-compressed-image-back-to-the-file-input\">Saving The Compressed Image Back To The File Input</h2>\n<p>We’ll create a <code>DataTransfer</code> object with which we’ll create our new files list. This list we can then later <a href=\"https://pqina.nl/blog/set-value-to-file-input/\">save back to the file input</a></p>\n<p>The <code>DataTransfer</code> object only accepts <code>File</code> objects so we need to <a href=\"https://pqina.nl/blog/convert-a-blob-to-a-file-with-javascript/\">turn our Blob into a File</a>, let’s update the <code>compressImage</code> function.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">multiple</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-image-field<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">compressImage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> quality <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> type <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>type <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get as image data</span>\n        <span class=\"token keyword\">const</span> imageBitmap <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createImageBitmap</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Draw to canvas</span>\n        <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> imageBitmap<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n        canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> imageBitmap<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>imageBitmap<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Turn into Blob</span>\n        <span class=\"token keyword\">const</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n            canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toBlob</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">,</span> quality<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Turn Blob into File</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>blob<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> blob<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get the selected file from the file input</span>\n    <span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.my-image-field'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    input<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get the files</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> files <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// No files selected</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>files<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We'll store the files in this data transfer object</span>\n        <span class=\"token keyword\">const</span> dataTransfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataTransfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// For every file in the files list</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> file <span class=\"token keyword\">of</span> files<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// We don't have to compress files that aren't images</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>file<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Ignore this file, but do add it to our result</span>\n                dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token comment\">// We compress the file by 50%</span>\n            <span class=\"token keyword\">const</span> compressedFile <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">compressImage</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">quality</span><span class=\"token operator\">:</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'image/jpeg'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Save back the compressed file instead of the original file</span>\n            dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>compressedFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// Set value of the file input to our new files list</span>\n        e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files <span class=\"token operator\">=</span> dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Select one or more image files in the file input below to test out the code, no worries, nothing is uploaded, everything stays in the browser.</p>\n<div class=\"demo\">\n<input type=\"file\" name=\"image\" class=\"my-image-field\" multiple=\"\" />\n<script>\nconst compressImage = async (file, { quality = 1, type = file.type }) => {\n    // Get as image data\n    const imageBitmap = await createImageBitmap(file);\n    // Draw to canvas\n    const canvas = document.createElement('canvas');\n    canvas.width = imageBitmap.width;\n    canvas.height = imageBitmap.height;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(imageBitmap, 0, 0);\n    // Turn into Blob\n    const blob = await new Promise((resolve) =>\n        canvas.toBlob(resolve, type, quality)\n    );\n    // Turn Blob into file\n    return new File([blob], file.name, {\n        type: blob.type\n    });\n};\n// Get the selected file from the file input\nconst input = document.querySelector('.my-image-field');\ninput.addEventListener('change', async (e) => {\n// Get the files\nconst { files } = e.target;\n// No files selected\nif (!files.length) return;\nbefore.innerHTML = Array.from(files).map(file => `<li>${file.name} <b>${Math.round(file.size / 1000)}KB</li>`).join('')\n// We'll store the files in this data transfer object\nconst dataTransfer = new DataTransfer();\n// For every file in the files list\nfor (const file of files) {\n    // We don't have to compress files that aren't images\n    if (!file.type.startsWith('image')) {\n        // Ignore this file, but do add it to our result\n        dataTransfer.items.add(file);\n        continue;\n    }\n    // We compress the file by 50%\n    const compressedFile = await compressImage(file, {\n        quality: 0.5,\n        type: 'image/jpeg',\n    });\n    // Save back the compressed file instead of the original fiel\n    dataTransfer.items.add(compressedFile);\n}\n// Set value of the file input to our new files list\ne.target.files = dataTransfer.files;\nafter.innerHTML = Array.from(dataTransfer.files).map(file => `<li>${file.name} <b>${Math.round(file.size / 1000)}KB</b></li>`).join('')\ncomparison.style.display = 'flex';\n});\n</script>\n<div style=\"display:none;margin:2rem 0;\" id=\"comparison\">\n    <div>\n    <div>Before</div>\n    <ul style=\"margin:0 1rem 0 0;flex:1;padding:0 0 0 1.5rem;\" id=\"before\"></ul>\n    </div>\n    <div>\n    <div>After</div>\n    <ul style=\"margin:0 1rem 0 0;flex:1;padding:0 0 0 1.5rem;\" id=\"after\"></ul>\n    </div>\n</div>\n</div>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We’ve learned how to use canvas and DataTransfer to set up a tiny unobtrusive script to help us compress images before upload. This script will make it easier for our users to upload images.</p>\n<p>Of course there are still a lot of improvements to make, for example we could:</p>\n<ul>\n<li>Resize the image to fit a maximum bounding box.</li>\n<li><a href=\"https://pqina.nl/blog/cropping-images-to-an-aspect-ratio-with-javascript/\">Crop the image to a certain aspect ratio</a>.</li>\n<li>Better deal with erroneous input and show fitting error messages.</li>\n<li>Make sure we handle <a href=\"https://pqina.nl/blog/canvas-area-exceeds-the-maximum-limit/\">Safari memory issues</a>.</li>\n</ul>\n<p>If we’re looking for a more robust solution we could use <a href=\"https://pqina.nl/filepond/\">FilePond</a> to handle the file upload, it can do image resizing, compression, and more.</p>\n<p>If we need even more control we can use <a href=\"https://pqina.nl/pintura/\">Pintura</a> to enable our users to edit images before upload, Pintura is also a drop-in replacement for our <code>compressImage</code> function.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/compress-image-before-upload/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Creating A Custom Svelte Media Query Store",
    "partialText": "<p>In this short read we create a custom Svelte store to listen for Media Query changes. Super useful for when we want to react to the user changing the system theme or resizing the browser window.</p>\n<p>If you just want to get your hands on the ready made custom store you can <a href=\"https://pqina.nl/blog/svelte-media-query-store/#code\">jump to the code</a>, else let’s explore how to create this custom store together.</p>\n<h2 id=\"svelte-custom-stores\">Svelte Custom Stores</h2>\n<p>Svelte exports a <a href=\"https://svelte.dev/docs#run-time-svelte-store\">set of default stores</a>, namely <code>readable</code>, <code>writable</code>, and <code>derived</code>.</p>\n<p>We’re going to use the <a href=\"https://svelte.dev/docs#run-time-svelte-store-writable\"><code>writable</code></a> store and wrap our custom Media Query Listener store around it.</p>\n<p>This is what we’re going for.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Import our custom store</span>\n<span class=\"token keyword\">import</span> mediaQueryStore <span class=\"token keyword\">from</span> <span class=\"token string\">'./mediaQueryStore.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create a dark mode preference store</span>\n<span class=\"token keyword\">const</span> prefersDarkMode <span class=\"token operator\">=</span> <span class=\"token function\">mediaQueryStore</span><span class=\"token punctuation\">(</span><span class=\"token string\">'(prefers-color-scheme:dark)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This will log `true` when in dark mode, it'll automatically be</span>\n<span class=\"token comment\">// called again when the user changes the system preference</span>\n<span class=\"token literal-property property\">$</span><span class=\"token operator\">:</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>$prefersDarkMode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>The <code>$</code> symbol is Svelte magic.</p>\n<p>It means Svelte will automatically subscribe and unsubscribe to the store.</p>\n<p>You could rewrite the code snippet above without magic like this.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Import our custom store</span>\n<span class=\"token keyword\">import</span> mediaQueryStore <span class=\"token keyword\">from</span> <span class=\"token string\">'./mediaQueryStore.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Need to clean up the store when done</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> onDestroy <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'svelte'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create a dark mode preference store</span>\n<span class=\"token keyword\">const</span> prefersDarkMode <span class=\"token operator\">=</span> <span class=\"token function\">mediaQueryStore</span><span class=\"token punctuation\">(</span><span class=\"token string\">'(prefers-color-scheme:dark)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This will log `true` when in dark mode</span>\n<span class=\"token keyword\">const</span> unsub <span class=\"token operator\">=</span> prefersDarkMode<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Unsubscribe from store when destroying this component</span>\n<span class=\"token function\">onDestroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">unsub</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>We’re going to need the <code>writable</code> Svelte store and our store factory only accepts one parameter, the Media Query it should observe, so this is the base for our custom store.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// We need to use the writable Svelte store</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> writable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'svelte/store'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Svelte Media Query Store\n * @param mediaQueryString { string }\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">mediaQueryString</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Store here */</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Let’s see how we can listen for Media Query changes first.</p>\n<h2 id=\"listening-for-media-query-changes\">Listening For Media Query Changes</h2>\n<p>We can use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList\"><code>MediaQueryList</code></a> to listen for Media Query changes.</p>\n<p>To start watching we use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\"><code>matchMedia</code></a> method.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Create the MediaQueryList</span>\n<span class=\"token keyword\">const</span> mql <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">matchMedia</span><span class=\"token punctuation\">(</span><span class=\"token string\">'(prefers-color-scheme:dark)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Listen for changes</span>\nmql<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// e.matches is true when user prefers dark mode</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Prefers dark mode'</span><span class=\"token punctuation\">,</span> e<span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// mql.matches is true when user prefers dark mode</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Prefers dark mode'</span><span class=\"token punctuation\">,</span> mql<span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Fairly straightforward.</p>\n<p>Let’s now move this logic into a Svelte store so it’s even easier to use.</p>\n<h2 id=\"using-mediaquerylist-in-a-custom-svelte-store\">Using MediaQueryList In A Custom Svelte Store</h2>\n<p>Let’s create a <code>writable</code> store inside our media query store and set up its default logic.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> writable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'svelte/store'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Svelte Media Query Store\n * @param mediaQueryString { string }\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">mediaQueryString</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// We'll need the subscribe and set methods of the writable store</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> subscribe<span class=\"token punctuation\">,</span> set <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">writable</span><span class=\"token punctuation\">(</span>\n        <span class=\"token comment\">// The initial value of the store is undefined</span>\n        <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token comment\">// This function is called on first subscribe call</span>\n        <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Construct</span>\n            <span class=\"token comment\">// ...</span>\n\n            <span class=\"token comment\">// This function is called on last unsubscribe call</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Destroy</span>\n                <span class=\"token comment\">// ...</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// We only expose the subscribe method to the outside world</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> subscribe <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Now let’s add our <code>MediaQueryList</code> logic to the store.</p>\n<div id=\"code\"></div>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> writable <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'svelte/store'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Svelte Media Query Store\n * @param mediaQueryString { string }\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">mediaQueryString</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> subscribe<span class=\"token punctuation\">,</span> set <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">writable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Start observing media query</span>\n        <span class=\"token keyword\">let</span> mql <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">matchMedia</span><span class=\"token punctuation\">(</span>mediaQueryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Set first media query result to the store</span>\n        <span class=\"token function\">set</span><span class=\"token punctuation\">(</span>mql<span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Called when media query state changes</span>\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onchange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">set</span><span class=\"token punctuation\">(</span>mql<span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Listen for changes (need to support old `addListener` interface)</span>\n        <span class=\"token string\">'addEventListener'</span> <span class=\"token keyword\">in</span> mql\n            <span class=\"token operator\">?</span> mql<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> onchange<span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">:</span> mql<span class=\"token punctuation\">.</span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>onchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// when no more listeners</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// stop listening (need to support old `removeListener` interface)</span>\n            <span class=\"token string\">'removeEventListener'</span> <span class=\"token keyword\">in</span> mql\n                <span class=\"token operator\">?</span> mql<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> onchange<span class=\"token punctuation\">)</span>\n                <span class=\"token operator\">:</span> mql<span class=\"token punctuation\">.</span><span class=\"token function\">removeListener</span><span class=\"token punctuation\">(</span>onchange<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> subscribe <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>That’s it, we can now use this store in our Svelte projects like shown below.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> mediaQueryStore <span class=\"token keyword\">from</span> <span class=\"token string\">'./mediaQueryStore.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> prefersDarkMode <span class=\"token operator\">=</span> <span class=\"token function\">mediaQueryStore</span><span class=\"token punctuation\">(</span><span class=\"token string\">'(prefers-color-scheme:dark)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token literal-property property\">$</span><span class=\"token operator\">:</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>$prefersDarkMode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/svelte-media-query-store/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Set Fill Color of SVG Background-image",
    "partialText": "<p>A quick guide explaining how to change the color of an SVG when it’s used as a CSS background-image.</p>\n<p>If you want you can <a href=\"https://pqina.nl/blog/set-svg-background-image-fill-color/#the-complete-svg-background-image-style-code-snippet\">jump to the code</a>, else we can explore how this works together.</p>\n<h2 id=\"svg-background-color-fill-demo\">SVG Background Color Fill Demo</h2>\n<p>We’ll start with a live demo, focus, hover, or click on the circle below and the background color will animate.</p>\n<div class=\"demo demo-full\">\n<style>\n.demo-full button {\n    /* base styles */\n    display: block;\n    width: 4rem;\n    height: 4rem;\n    border: none;\n    cursor: pointer;\n    /* hide text */\n    overflow: hidden;\n    color: transparent;\n    /* color animation */\n    background-color: Crimson;\n    transition: background-color 0.25s;\n    /* Easy to reuse */\n    --svg: url('data:image/svg+xml,\\\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\\\n        <g stroke-linecap=\"round\" stroke-width=\"4\" fill=\"none\" stroke=\"rgb(0, 0, 0)\">\\\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\\\n            <path d=\"M7 11 H17\"/>\\\n        </g>\\\n    </svg>');\n    /* Chrome */\n    -webkit-mask: var(--svg);\n    /* Firefox and Safari */\n    mask: var(--svg);\n}\n.demo-full button:hover,\n.demo-full button:focus {\n    background-color: Turquoise;\n}\n.demo-full button:active {\n    background-color: Gold;\n}\n</style>\n<button type=\"button\">I'm a cool circle button</button>\n</div>\n<p>I’ll let the cat out of the bag.</p>\n<p>This is just a normal button with an SVG used as a <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/mask\">CSS mask</a></p>\n<p>Instead of changing the <code>fill</code> color of the SVG we change the <code>background-color</code> of the button. But that shouldn’t spoil the fun as it opens up a world of possibilities but we’ll get to that.</p>\n<h2 id=\"using-an-svg-as-a-css-mask\">Using An SVG As A CSS Mask</h2>\n<p>We can see our cool smiley SVG below 😎</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2000/svg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">viewBox</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0 0 24 24<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>g</span>\n        <span class=\"token attr-name\">stroke-linecap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>round<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">stroke-width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>4<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">stroke</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rgb(0, 0, 0)<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">fill</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>none<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>circle</span> <span class=\"token attr-name\">cx</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>12<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">cy</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>12<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">r</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>10<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>path</span> <span class=\"token attr-name\">d</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>M7 11 H17<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>g</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>What’s amazing about the timeline we live in is that we can pass the SVG to the CSS <code>url()</code> function without base64 encoding it or escaping all kinds of characters.</p>\n<ol>\n<li>Prefix the SVG with <code>data:image/svg+xml,</code></li>\n<li>Add some structure by ending a line with <code>\\</code></li>\n<li>Just like that a readable SVG has appeared in our CSS.</li>\n</ol>\n<p>Allright, let’s first assign the SVG to the <code>background</code> property so we can see it, we’ll turn it into a mask in a couple minutes.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">button</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ...Other styles */</span>\n\n    <span class=\"token comment\">/* Color */</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> Crimson<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Store the SVG in a variable so it's easy to re-use */</span>\n    <span class=\"token property\">--svg</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">'data:image/svg+xml,\\\n    &lt;svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\\\n        &lt;g stroke-linecap=\"round\" stroke-width=\"4\" stroke=\"rgb(0, 0, 0)\" fill=\"none\">\\\n            &lt;circle cx=\"12\" cy=\"12\" r=\"10\"/>\\\n            &lt;path d=\"M7 11 H17\"/>\\\n        &lt;/g>\\\n    &lt;/svg>'</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Assign the SVG variable */</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--svg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button:hover,\nbutton:focus</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> Turquoise<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button:active</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> Gold<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>We can interact with the live demo below to see the SVG has loaded and the styles are correctly applied.</p>\n<div class=\"demo demo-background\">\n<style>\n.demo-background button {\n    /* base styles */\n    display: block;\n    width: 4rem;\n    height: 4rem;\n    border: none;\n    cursor: pointer;\n    /* hide text */\n    overflow: hidden;\n    color: transparent;\n    /* color animation */\n    background-color: Crimson;\n    transition: background-color 0.25s;\n    /* Easy to reuse */\n    --svg: url('data:image/svg+xml,\\\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\\\n        <g stroke-linecap=\"round\" stroke-width=\"4\" fill=\"none\" stroke=\"rgb(0, 0, 0)\">\\\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\\\n            <path d=\"M7 11 H17\"/>\\\n        </g>\\\n    </svg>');\n    /* Use our SVG as background image */\n    background-image: var(--svg);\n}\n.demo-background button:hover,\n.demo-background button:focus {\n    background-color: Turquoise;\n}\n.demo-background button:active {\n    background-color: Gold;\n}\n</style>\n<button type=\"button\">I'm a cool circle button</button>\n</div>\n<p>Now it’s time to remove the <code>background</code> property and assign the <code>--svg</code> variable to the <code>mask</code> property.</p>\n<p>The black parts of the SVG will be the visible parts of the element and the transparent parts will become invisible.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">button</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* ...Other styles */</span>\n\n    <span class=\"token comment\">/* Chrome, still requires prefix in 2022 */</span>\n    <span class=\"token property\">-webkit-mask</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--svg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Firefox and Safari */</span>\n    <span class=\"token property\">mask</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--svg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Tadaa! 🥳</p>\n<div class=\"demo demo-full\">\n<button type=\"button\">I'm a cool circle button</button>\n</div>\n<p>If you have trouble getting the mask to work, a handy trick is to temporarily assign the mask to the <code>background-image</code> property.</p>\n<p>This allows us to visually see where the black and transparent parts of your mask are, this becomes especially useful when building more complex masks.</p>\n<div aria-hidden=\"true\" class=\"promoted-product-banner\">\n<p>Quick shoutout to some products I built that might be helpful to you.</p>\n<ul>\n<li class=\"product-item\">\n  <span class=\"logo-pintura\"></span>\n  <p class=\"implicit\">Pintura</p>\n  <p class=\"product-description\">\n    A JavaScript Image Editor that integrates with every stack.\n  </p>\n  <a href=\"https://pqina.nl/pintura/?ref=pqina-article\" target=\"_blank\">Get started with Pintura</a>\n</li>\n<li class=\"product-item\">\n  <span class=\"logo-filepond\"></span>\n  <p class=\"implicit\">FilePond</p>\n  <p class=\"product-description\">\n    A free JavaScript File Manager that uploads anything you throw at it.\n  </p>\n  <a href=\"https://pqina.nl/filepond/?ref=pqina-article\" target=\"_blank\">Get started with FilePond</a>\n</li>\n</ul>\n<p>Let's get back to our adventure!</p>\n</div>\n<h2 id=\"any-background-goes\">Any Background Goes</h2>\n<p>Because we’re masking the button we can use any background style or effect we can think of.</p>\n<div class=\"demo demo-row\">\n<div class=\"demo-gradient\">\n<style>\n.demo-gradient button {\n    position:relative;\n    /* base styles */\n    display: block;\n    width: 4rem;\n    height: 4rem;\n    border: none;\n    cursor: pointer;\n    /* hide text */\n    overflow: hidden;\n    color: transparent;\n    /* box-shadow animation */\n    background: linear-gradient(to bottom right, Crimson, Cyan);\n    /* Easy to reuse */\n    --svg: url('data:image/svg+xml,\\\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\\\n        <g stroke-linecap=\"round\" stroke-width=\"4\" fill=\"none\" stroke=\"rgb(0, 0, 0)\">\\\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\\\n            <path d=\"M7 11 H17\"/>\\\n        </g>\\\n    </svg>');\n    /* Chrome */\n    -webkit-mask: var(--svg);\n    /* Firefox and Safari */\n    mask: var(--svg);\n}\n</style>\n<button type=\"button\">I'm a cool circle button</button>\n</div>\n<div class=\"demo-photo\">\n<style>\n.demo-photo button {\n    position:relative;\n    /* base styles */\n    display: block;\n    width: 4rem;\n    height: 4rem;\n    border: none;\n    cursor: pointer;\n    /* hide text */\n    overflow: hidden;\n    color: transparent;\n    /* box-shadow animation */\n    background: url('/media/cat.jpeg') 0 0 / cover;\n    /* Easy to reuse */\n    --svg: url('data:image/svg+xml,\\\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\\\n        <g stroke-linecap=\"round\" stroke-width=\"4\" fill=\"none\" stroke=\"rgb(0, 0, 0)\">\\\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\\\n            <path d=\"M7 11 H17\"/>\\\n        </g>\\\n    </svg>');\n    /* Chrome */\n    -webkit-mask: var(--svg);\n    /* Firefox and Safari */\n    mask: var(--svg);\n}\n</style>\n<button type=\"button\">I'm a cool circle button</button>\n</div>\n<div class=\"demo-fixed\">\n<style>\n.demo-fixed button {\n    position:relative;\n    /* base styles */\n    display: block;\n    width: 4rem;\n    height: 4rem;\n    border: none;\n    cursor: pointer;\n    /* hide text */\n    overflow: hidden;\n    color: transparent;\n    /* box-shadow animation */\n    background: url('/media/stars.jpeg') 0 0 / 8rem;\n    background-attachment : fixed;\n    /* Easy to reuse */\n    --svg: url('data:image/svg+xml,\\\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\\\n        <g stroke-linecap=\"round\" stroke-width=\"4\" fill=\"none\" stroke=\"rgb(0, 0, 0)\">\\\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\\\n            <path d=\"M7 11 H17\"/>\\\n        </g>\\\n    </svg>');\n    /* Chrome */\n    -webkit-mask: var(--svg);\n    /* Firefox and Safari */\n    mask: var(--svg);\n}\n</style>\n<button type=\"button\">I'm a cool circle button</button>\n</div>\n</div>\n<h2 id=\"the-complete-svg-background-image-style-code-snippet\">The Complete SVG Background-image Style Code Snippet</h2>\n<p>You can find the copy button on the right hand side of the code snippet, enjoy!</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>I'm a cool circle button<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token selector\">button</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/* Base styles */</span>\n        <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 4rem<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 4rem<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* Hide button caption text */</span>\n        <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> transparent<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* The fill animation */</span>\n        <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> Crimson<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> background-color 0.2s<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* Store the SVG in a variable so it's easy to use */</span>\n        <span class=\"token property\">--svg</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">'data:image/svg+xml,\\\n        &lt;svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\\\n            &lt;g stroke-linecap=\"round\" stroke-width=\"4\" stroke=\"rgb(0, 0, 0)\" fill=\"none\">\\\n                &lt;circle cx=\"12\" cy=\"12\" r=\"10\"/>\\\n                &lt;path d=\"M7 11 H17\"/>\\\n            &lt;/g>\\\n        &lt;/svg>'</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* Chrome, still requires prefix in 2022 */</span>\n        <span class=\"token property\">-webkit-mask</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--svg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">/* Firefox and Safari */</span>\n        <span class=\"token property\">mask</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--svg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token selector\">button:hover,\n    button:focus</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> Turquoise<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token selector\">button:active</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> Gold<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We learned a nice trick where we used the CSS <code>mask</code> property to change the fill color of a SVG when it’s used as a <code>background-image</code></p>\n<p>On top of that we learned that the <code>mask</code> property is identical to the <code>background</code> property so we can switch them out to make debugging the <code>mask</code> image easier.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/set-svg-background-image-fill-color/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Edit Video and Images With React",
    "partialText": "<p>In this short step by step tutorial we’ll set up <a href=\"https://pqina.nl/pintura\">Pintura Image Editor</a> with its Video Editor extension to edit images and videos in the browser with React.</p>\n<p>We’re going to use Pintura because building a complete video editor from scratch is going to take ages. It let’s us skip over all the drama of dealing with various browser quirks and device differences to the fun part of integrating an image editor.</p>\n<p>Let’s set up a basic JSX file and then we’ll add Pintura.</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Hai!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre>\n<p>I did say basic.</p>\n<h2 id=\"adding-the-pintura-editor-component\">Adding The Pintura Editor Component</h2>\n<p>Let’s <a href=\"https://pqina.nl/pintura\">download Pintura</a> and add the React <code>&lt;PinturaEditor&gt;</code> component to the mix.</p>\n<p>We’ll also need to load the Pintura stylesheet, and to keep things concise we’ll import <code>getEditorDefaults</code>, a helper function that contains all the default editor settings.</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Import the editor styles</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'@pqina/pintura/pintura.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Import the editor default configuration</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getEditorDefaults <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pqina/pintura'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Import the editor component from `react-pintura`</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PinturaEditor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pqina/react-pintura'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// get default properties</span>\n<span class=\"token keyword\">const</span> editorConfig <span class=\"token operator\">=</span> <span class=\"token function\">getEditorDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PinturaEditor</span></span>\n                <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>editorConfig<span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./my-image.jpeg<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">PinturaEditor</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre>\n<p>One final thing we need to do is set a <code>height</code> to the PinturaEditor parent element, by default Pintura will try to fill all the available vertical space.</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> divStyle <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Assign height style to div</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>divStyle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PinturaEditor</span></span>\n                <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>editorConfig<span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./my-image.jpeg<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">PinturaEditor</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>When we now add an image to our project public folder and call it <code>my-image.jpeg</code> it loads in Pintura.</p>\n<h3 id=\"getting-the-resulting-image\">Getting the resulting image</h3>\n<p>We’ll set the <code>imageCropAspectRatio</code> to <code>1</code> so Pintura enforces a square image crop and we get an obviously different output image. If your input image is square already set it to <code>16/9</code> which will require a 16:9 crop.</p>\n<p>Now to get the resulting image file we add the <code>onProcess</code> callback.</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// called when user is done editing the image</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleProcessMedia</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// logs: { src:…, dest:… , imageState:…, store:… }</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>divStyle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PinturaEditor</span></span>\n                <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>editorConfig<span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./my-image.jpeg<span class=\"token punctuation\">\"</span></span>\n                <span class=\"token attr-name\">imageCropAspectRatio</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">onProcess</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleProcessMedia<span class=\"token punctuation\">}</span></span>\n            <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">PinturaEditor</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Let’s add an <code>&lt;img&gt;</code> element so we can preview the edited image.</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>editorResult<span class=\"token punctuation\">,</span> setEditorResult<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleProcessMedia</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get a reference to the file object</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Set an ObjectURL to the file object</span>\n        <span class=\"token function\">setEditorResult</span><span class=\"token punctuation\">(</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>divStyle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token punctuation\">{</span>editorResult <span class=\"token operator\">&amp;&amp;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>editorResult<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PinturaEditor</span></span>\n                <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>editorConfig<span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./my-image.jpeg<span class=\"token punctuation\">\"</span></span>\n                <span class=\"token attr-name\">imageCropAspectRatio</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">onProcess</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleProcessMedia<span class=\"token punctuation\">}</span></span>\n            <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">PinturaEditor</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>That’s it!</p>\n<div class=\"demo\">\n<style>\n.demo .preview {\n    margin: 2rem 0;\n}\n#a:not(:empty) {\n    height: 600px;\n    max-height: 90vh;\n    box-shadow: 0 0 0 1px rgba(var(--text),0.1);\n}\n#a:not(:empty)~button {\n    display:none;\n}\n</style>\n<div id=\"a\"></div>\n<button>Load demo</button>\n<script>\ndocument.querySelector('#a + button').addEventListener('click', e => {\n    // load \n    const loadingState = document.createElement('span');\n    loadingState.className = 'loading'\n    loadingState.textContent = 'Loading image…';\n    e.target.before(loadingState);\n    // preview\n    const showPreview = (dest) => {\n        const image = e.target.parentNode.querySelector('.preview') || new Image();\n        image.className = 'preview';\n        image.src && URL.revokeObjectURL(image.src);\n        image.src = URL.createObjectURL(dest);\n        e.target.before(image)\n    };\n    // edit\n    import('/pintura/demo/pintura.js').then(({ appendDefaultEditor }) => {\n        const editor = appendDefaultEditor('#a',{\n            src: '/media/cat.jpeg'\n        })\n        editor.on('load', () => {\n            loadingState.remove();\n        })\n        editor.on('process', ({ dest }) => {\n            showPreview(dest);\n        })\n    })\n});\n</script>\n</div>\n<p>With image editing implemented it’s finally time to move on to video editing.</p>\n<h2 id=\"video-editing\">Video Editing</h2>\n<p>To enable video editing we load the Pintura Video extension and import the relevant functionality.</p>\n<p>But first we need to decide which video encoder to use.</p>\n<h3 id=\"choosing-a-videoencoder\">Choosing a VideoEncoder</h3>\n<p>The Pintura Video extension ships with a MediaStreamEncoder and an FFmpegEncoder.</p>\n<h4 id=\"using-mediastreamencoder\">Using MediaStreamEncoder</h4>\n<p>The <a href=\"https://pqina.nl/pintura/docs/v8/api/video-editor/exports/#createmediastreamencoder\">MediaStreamEncoder</a> uses browser APIs to generate the output video. This results in a very lightweight package.</p>\n<p>Unfortunately the MediaStream API is still a bit limited and speeding up the video generation process is not possible. This means the time it takes to generate a video is equal to the total video clip play time. Video clip time means the amount of time remaining after trimming the video in Pintura.</p>\n<p>For short videos this is fine, for longer video’s it will take too long to generate a video resulting in a sub par user experience.</p>\n<h4 id=\"using-ffmpegencoder\">Using FFmpegEncoder</h4>\n<p>When using the <a href=\"https://pqina.nl/pintura/docs/v8/api/video-editor/exports/#createffmpegencoder\">FFmpegEncoder</a> we rely on the FFmpeg WASM library. It’s a versatile client-side video encoder. For longer video’s it’s a lot faster than using the MediaStreamEncoder.</p>\n<p>The downside of using the FFmpegEncoder is that it needs to download the FFmpeg core package which clocks in at 25MB, depending on the user connection, this can be quite a lot of data to transfer. Consider however that uploading a big video file to the server will also take a while so this might not be a huge problem.</p>\n<h3 id=\"adjusting-the-template\">Adjusting the template</h3>\n<p>Let’s first zoom in on the non-template part of the JSX file.</p>\n<p>We need to import the video editor specific functionality and load the video editor plugin styles.</p>\n<p>Then we adjust the default configuration so Pintura knows how to handle image input and video input.</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token string\">'@pqina/pintura/pintura.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Add video editor styles</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'@pqina/pintura-video/pinturavideo.css'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Add video editor trim plugin and export logic</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n    createDefaultVideoWriter<span class=\"token punctuation\">,</span>\n    createMediaStreamEncoder<span class=\"token punctuation\">,</span>\n    plugin_trim<span class=\"token punctuation\">,</span>\n    plugin_trim_locale_en_gb<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pqina/pintura-video'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// We need to import the default media writer</span>\n<span class=\"token comment\">// this allows us to handle images and videos</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n    getEditorDefaults<span class=\"token punctuation\">,</span>\n    setPlugins<span class=\"token punctuation\">,</span>\n    createDefaultMediaWriter<span class=\"token punctuation\">,</span>\n    createDefaultImageWriter<span class=\"token punctuation\">,</span>\n    imageStateToCanvas<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pqina/pintura'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PinturaEditor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@pqina/react-pintura'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Add the video trim plugin to Pintura</span>\n<span class=\"token function\">setPlugins</span><span class=\"token punctuation\">(</span>plugin_trim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Configure the editor to output videos and images</span>\n<span class=\"token keyword\">const</span> editorConfig <span class=\"token operator\">=</span> <span class=\"token function\">getEditorDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">locale</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>plugin_trim_locale_en_gb<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">imageWriter</span><span class=\"token operator\">:</span> <span class=\"token function\">createDefaultMediaWriter</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Images and videos will be resized down to 200 width,</span>\n            <span class=\"token comment\">// aspect ratio is maintained</span>\n            <span class=\"token literal-property property\">targetSize</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span>\n            <span class=\"token comment\">// Used for writing output images</span>\n            <span class=\"token function\">createDefaultImageWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Convert all input images to JPEGs</span>\n                <span class=\"token literal-property property\">mimeType</span><span class=\"token operator\">:</span> <span class=\"token string\">'image/jpeg'</span><span class=\"token punctuation\">,</span>\n\n                <span class=\"token comment\">// Compress image</span>\n                <span class=\"token literal-property property\">quality</span><span class=\"token operator\">:</span> <span class=\"token number\">0.75</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// Used for writing output videos</span>\n            <span class=\"token function\">createDefaultVideoWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">encoder</span><span class=\"token operator\">:</span> <span class=\"token function\">createMediaStreamEncoder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token comment\">// Required for drawing video output</span>\n                    imageStateToCanvas<span class=\"token punctuation\">,</span>\n\n                    <span class=\"token comment\">// Compress video</span>\n                    <span class=\"token literal-property property\">videoBitrate</span><span class=\"token operator\">:</span> <span class=\"token number\">384</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>The next step is to adjust the template so it loads an MP4 file and can preview a generated video.</p>\n<pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>editorResult<span class=\"token punctuation\">,</span> setEditorResult<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleProcessMedia</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get a reference to the file object</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Set an ObjectURL to the file object</span>\n        <span class=\"token function\">setEditorResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">video</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string\">'video'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'image'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>divStyle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token punctuation\">{</span>editorResult <span class=\"token operator\">&amp;&amp;</span>\n                <span class=\"token punctuation\">(</span>editorResult<span class=\"token punctuation\">.</span>type <span class=\"token operator\">===</span> <span class=\"token string\">'image'</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>editorResult<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n                <span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span> <span class=\"token attr-name\">src</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>editorResult<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PinturaEditor</span></span>\n                <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>editorConfig<span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">util</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>trim<span class=\"token punctuation\">\"</span></span>\n                <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./my-video.mp4<span class=\"token punctuation\">\"</span></span>\n                <span class=\"token attr-name\">imageCropAspectRatio</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span>\n                <span class=\"token attr-name\">onProcess</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleProcessMedia<span class=\"token punctuation\">}</span></span>\n            <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">PinturaEditor</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Let’s add a video called <code>my-video.mp4</code> to the public folder, when we refresh the page Pintura automatically loads the video and shows the trim utility.</p>\n<p>That’s all there is to it. Pintura can now be used to edit both images and video’s.</p>\n<p>To test the video editor functionality please visit either <a href=\"https://edit.video/\">edit.video</a> or try <a href=\"https://pqina.nl/pintura/#edit-video-in-the-browser\">this demo on the Pintura product page</a></p>\n<!-- The Pintura Stylesheet --->\n<link rel=\"stylesheet\" href=\"https://pqina.nl/pintura/demo/pintura.css\" />",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/edit-video-with-react/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Upload An Image With Node.js",
    "partialText": "<p>This short and concise guide shows how to set up image uploading with Node.js and Express.</p>\n<p>If you’re in a hurry you can <a href=\"https://pqina.nl/blog/upload-image-with-nodejs/#the-final-nodejs-image-upload-script\">jump to the complete code snippet</a> else let’s set it up step by step together.</p>\n<h2 id=\"set-up-the-server\">Set Up The Server</h2>\n<p>We’ll start with a basic <a href=\"https://expressjs.com/\">Express</a> server.</p>\n<p>Create a new folder and run <code>npm init</code> to generate a <code>package.json</code> file, then install Express.</p>\n<pre><code>npm install express\n</code></pre>\n<p>We’ll create an <code>index.js</code> file in the root of our folder and we’ll copy the <a href=\"https://expressjs.com/en/starter/hello-world.html\">Express Hello world example</a> to this file as a starting point.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Example app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Let’s start the server.</p>\n<pre><code>node index.js\n</code></pre>\n<p>Open a browser and navigate to <code>http://localhost:3000</code>, it should show “Hello World!”</p>\n<h2 id=\"adding-a-form\">Adding A Form</h2>\n<p>Let’s create a folder called <code>public</code> and add a file called <code>index.html</code> with the following HTML.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/upload<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">enctype</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>multipart/form-data<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Upload<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>We’ve added the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form#attr-enctype\"><code>enctype</code></a> form attribute and set it to <code>&quot;multipart/form-data&quot;</code>. This is needed to correctly post the file data contained in the file input field.</p>\n<p>Note that we’ve set the <code>name</code> attribute of our file input element to <code>&quot;image&quot;</code>, this is the name we’ll use to read the image data on the server.</p>\n<p>Our form will <code>POST</code> to the post <code>upload</code> route, which we’ll add soon. First we have to tell our server to serve the <code>index.html</code> page.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Add this line to serve our index.html page</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span><span class=\"token string\">'public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Example app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Next up we’ll add the <code>upload</code> route.</p>\n<pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/upload'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// We'll handle the image upload here</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>To handle file uploads we need the <code>express-fileupload</code> middleware, this will read the multipart/form-data and add a <code>files</code> property to the request object.</p>\n<p>Let’s install it now.</p>\n<pre><code>npm install express-fileupload\n</code></pre>\n<p>Now we’ll update the <code>index.js</code> file to use <code>express-fileupload</code></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fileUpload <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express-fileupload'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use the express-fileupload middleware</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">fileUpload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span><span class=\"token string\">'public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/upload'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Log the files to the console</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// All good</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Example app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Restart the server. When we refresh the page it now shows our form. When we upload a file, it logs the file to the server console.</p>\n<p>It’ll look something like this</p>\n<pre><code>[Object: null prototype] {\n  image: {\n    name: 'test.jpeg',\n    data: &lt;Buffer ff d8 ff e0 00 10 4a 46 49 46 00 01 01 01 00 48 00 48 00 00 ff e2 0c 58 49 43 43 5f 50 52 4f 46 49 4c 45 00 01 01 00 00 0c 48 4c 69 6e 6f 02 10 00 00 ... 1234567 more bytes&gt;,\n    size: 234732,\n    encoding: '7bit',\n    tempFilePath: '',\n    truncated: false,\n    mimetype: 'image/jpeg',\n    md5: 'c76564e19a5e8cd647a2d60478ad94b3',\n    mv: [Function: mv]\n  }\n}\n</code></pre>\n<p>The final step is to move the file to an upload folder.</p>\n<p>First let’s create a folder called <code>upload</code> in our project directory.</p>\n<p>Then we’ll adjust the <code>app.post</code> route to look like this.</p>\n<pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/upload'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Get the file that was set to our field named \"image\"</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> image <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If no image submitted, exit</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>image<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Move the uploaded image to our upload folder</span>\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">mv</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/upload/'</span> <span class=\"token operator\">+</span> image<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>You can now find the uploaded file in the upload folder.</p>\n<div aria-hidden=\"true\" class=\"promoted-product-banner\">\n<p>Quick shoutout to some products I built that might be helpful to you.</p>\n<ul>\n<li class=\"product-item\">\n  <span class=\"logo-pintura\"></span>\n  <p class=\"implicit\">Pintura</p>\n  <p class=\"product-description\">\n    A JavaScript Image Editor that integrates with every stack.\n  </p>\n  <a href=\"https://pqina.nl/pintura/?ref=pqina-article\" target=\"_blank\">Get started with Pintura</a>\n</li>\n<li class=\"product-item\">\n  <span class=\"logo-filepond\"></span>\n  <p class=\"implicit\">FilePond</p>\n  <p class=\"product-description\">\n    A free JavaScript File Manager that uploads anything you throw at it.\n  </p>\n  <a href=\"https://pqina.nl/filepond/?ref=pqina-article\" target=\"_blank\">Get started with FilePond</a>\n</li>\n</ul>\n<p>Let's get back to our adventure!</p>\n</div>\n<h2 id=\"securing-the-upload\">Securing The Upload</h2>\n<p>While this works it’s not super secure, our users can now upload anything to our server, let’s restrict them a bit so our server is more secure.</p>\n<h3 id=\"only-allowing-images\">Only Allowing Images</h3>\n<p>Let’s first block all uploaded files that aren’t images.</p>\n<pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/upload'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> image <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>image<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If doesn't have image mime type prevent from uploading</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^image</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>mimetype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">mv</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/upload/'</span> <span class=\"token operator\">+</span> image<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>This would cover most file uploads, it’s possible malicious actors use a different fake a different mimetype so to be absolutely sure a file is of a certain type we have to <a href=\"https://github.com/sindresorhus/file-type\">inspect the file contents itself</a>.</p>\n<h3 id=\"limit-upload-size\">Limit Upload Size</h3>\n<p>We can tell <code>express-fileupload</code> to limit the file upload size. This prevents users from uploading huge files in an attempt to <a href=\"https://en.wikipedia.org/wiki/Denial-of-service_attack\">DoS attack</a> our server.</p>\n<pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">fileUpload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">limits</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">fileSize</span><span class=\"token operator\">:</span> <span class=\"token number\">10000000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Around 10MB</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">abortOnLimit</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Now our server returns an <code>HTTP 413</code> statuscode when the file is too big.</p>\n<h3 id=\"preventing-malicious-file-names\">Preventing Malicious File Names</h3>\n<p>Malicious users can try to upload an image named ‘…/index.js’ but <code>express-fileupload</code> will automatically strip those dots and the file will still end up in the correct folder.</p>\n<h2 id=\"the-final-nodejs-image-upload-script\">The Final Node.js Image Upload Script</h2>\n<p>This the complete Node.js script ready for copy pasting.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fileUpload <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express-fileupload'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> port <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">fileUpload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">limits</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">fileSize</span><span class=\"token operator\">:</span> <span class=\"token number\">10000000</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">abortOnLimit</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Add this line to serve our index.html page</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span><span class=\"token string\">'public'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/upload'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Get the file that was set to our field named \"image\"</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> image <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If no image submitted, exit</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>image<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If doesn't have image mime type prevent from uploading</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^image</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>mimetype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Move the uploaded image to our upload folder</span>\n    image<span class=\"token punctuation\">.</span><span class=\"token function\">mv</span><span class=\"token punctuation\">(</span>__dirname <span class=\"token operator\">+</span> <span class=\"token string\">'/upload/'</span> <span class=\"token operator\">+</span> image<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// All good</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">sendStatus</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span>port<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Example app listening on port </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>port<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We’ve written a server script that can handle image uploads, we secured our code, and finally we’ve set up a form that allows users to select and upload images.</p>\n<p>We could take this a step further and enable our users to edit the images before upload. This saves server bandwidth and improves the quality of the images uploaded, for example by always forcing a square image.</p>\n<p>The <a href=\"https://pqina.nl/pintura/docs/v8/getting-started/installation/pintura-input/?ref=pqina\"><code>&lt;pintura-input&gt;</code></a> element makes this straight forward. This <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura</a> powered web component automatically opens a powerful image editor when an image is added to the file input field and enables your users to edit images before upload.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/upload-image-with-nodejs/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "How To Clone A File With JavaScript",
    "partialText": "<p>A short code example showing how to create a clone (or copy) from a File object received from a file input element.</p>\n<p>We’ll use a file input element as a source for the file.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// we'll get the first file in the file input</span>\n        <span class=\"token keyword\">const</span> original <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// no file received, exit</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>original<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// create our clone</span>\n        <span class=\"token keyword\">const</span> clone <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>original<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> original<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> original<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">lastModified</span><span class=\"token operator\">:</span> original<span class=\"token punctuation\">.</span>lastModified<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// log the original, the clone, and a comparison to the console</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>original<span class=\"token punctuation\">,</span> clone<span class=\"token punctuation\">,</span> original <span class=\"token operator\">===</span> clone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Open your developer console and test it out below:</p>\n<div class=\"demo\">\n<input type=\"file\" />\n<script>\n    document.querySelector('input').addEventListener('change', (e) => {\n        // we'll get the first file in the file input\n        const file = e.target.files[0];\n\n        // no file, exit\n        if (!file) return;\n\n        // create our clone\n        const clone = new File([file], file.name, {\n            type: file.type,\n            lastModified: file.lastModified,\n        });\n\n        // log the original, the clone, and a comparison to the console\n        console.log(file, clone, file === clone);\n    });\n</script>\n</div>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/how-to-clone-a-javascript-file-object/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "How To Set The Value Of A File Input",
    "partialText": "<p>It’s always been <a href=\"https://pqina.nl/blog/the-trouble-with-editing-and-uploading-files-in-the-browser/\">impossible</a> to <strong>set the value of a file input element with JavaScript</strong>, but this has changed last year and it’s now broadly supported, let’s see how it’s done.</p>\n<p>If you’re interested in why this is useful, read on below, else <a href=\"https://pqina.nl/blog/set-value-to-file-input/#updating-the-file-input-files-property\">jump to the solution</a></p>\n<h2 id=\"why-is-setting-the-value-of-a-file-input-useful%3F\">Why Is Setting The Value Of A File Input Useful?</h2>\n<p>Being able to set the value of a file input comes in handy when we’ve <a href=\"https://pqina.nl/pintura/?ref=pqina\">edited an image in the browser</a>, or when one or more files have been <a href=\"https://pqina.nl/filepond/ref=pqina\">dropped on the page</a> and we want to upload them to a server.</p>\n<p>In both situations we end up with File objects that we can’t leave anywhere but in memory. We can serve the files as downloads, upload them asynchronously, or <a href=\"https://pqina.nl/blog/convert-a-file-to-a-base64-string-with-javascript/\">convert them to base64 strings</a> and store them in a hidden text field, but we couldn’t store them in a file input element.</p>\n<p>When we’re in control of the backend we can create an API to handle asynchronous file uploads or convert base64 encoded files back to file ojects. But there are a lot of situations where we don’t control the backend.</p>\n<ul>\n<li>We’re using a NoCode platform or service.</li>\n<li>We built a web component and don’t know where it’s going to be used.</li>\n<li>There’s simply no time or people available to make the required backend changes.</li>\n<li>The backend is so old that literally no one wants to touch it.</li>\n</ul>\n<p>In all these situations there’s no way to upload File objects created in the browser.</p>\n<p>The moment we can set the value of a file input the backend seizes to be part of the equation, meaning we can finally progressively enhance the file input element.</p>\n<h2 id=\"updating-the-file-input-files-property\">Updating The File Input Files Property</h2>\n<p>We’ll set up a file input element and a short script that sets the file input <code>files</code> property.</p>\n<p>The script creates a new <code>File</code> object and stores it in <code>myFile</code></p>\n<p>We then use <code>DataTransfer</code> to wrap the file in a <code>FileList</code> which we can assign to the <code>files</code> property of our file input element.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Get a reference to our file input</span>\n    <span class=\"token keyword\">const</span> fileInput <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"file\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Create a new File object</span>\n    <span class=\"token keyword\">const</span> myFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'myFile.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">lastModified</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Now let's create a DataTransfer to get a FileList</span>\n    <span class=\"token keyword\">const</span> dataTransfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataTransfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>myFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    fileInput<span class=\"token punctuation\">.</span>files <span class=\"token operator\">=</span> dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>And presto! The file input now contains <em>“myFile.txt”</em></p>\n<div class=\"demo\">\n<input type=\"file\" id=\"a\" />\n<script>\n{\n    // Get a reference to our file input\n    const fileInput = document.querySelector('#a');\n    // Create a new File object\n    const myFile = new File(['Hello World!'], 'myFile.txt', {\n        type: 'text/plain',\n        lastModified: new Date(),\n    });\n    // Now let's create a FileList\n    const dataTransfer = new DataTransfer();\n    dataTransfer.items.add(myFile);\n    fileInput.files = dataTransfer.files;\n}\n</script>\n</div>\n<p>This works on all modern browsers. 🎉</p>\n<div aria-hidden=\"true\" class=\"promoted-product-banner\">\n<p>Quick shoutout to some products I built that might be helpful to you.</p>\n<ul>\n<li class=\"product-item\">\n  <span class=\"logo-pintura\"></span>\n  <p class=\"implicit\">Pintura</p>\n  <p class=\"product-description\">\n    A JavaScript Image Editor that integrates with every stack.\n  </p>\n  <a href=\"https://pqina.nl/pintura/?ref=pqina-article\" target=\"_blank\">Get started with Pintura</a>\n</li>\n<li class=\"product-item\">\n  <span class=\"logo-filepond\"></span>\n  <p class=\"implicit\">FilePond</p>\n  <p class=\"product-description\">\n    A free JavaScript File Manager that uploads anything you throw at it.\n  </p>\n  <a href=\"https://pqina.nl/filepond/?ref=pqina-article\" target=\"_blank\">Get started with FilePond</a>\n</li>\n</ul>\n<p>Let's get back to our adventure!</p>\n</div>\n<p>Don’t see any file info? You’re probably browsing the web on Safari for MacOS 👇</p>\n<h2 id=\"but-safari\">But Safari</h2>\n<p>Safari was the last browser to add support for the <code>DataTransfer</code> constructor, it was added in version 14.1.</p>\n<p>While Safari for MacOS detects the field has a value assigned it doesn’t show the file name. For some situations that’s fine, for others that is bad UX.</p>\n<p>Interestingly it does work correctly on Safari for iOS 🤷‍♂️</p>\n<p>Let’s give Safari for MacOS a little help using this knowledge:</p>\n<ul>\n<li>Webkit based browsers can render <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/::after\">pseudo-elements</a> inside a file input.</li>\n<li>The <code>content</code> of a pseudo-element can be set to an attribute value using <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/attr\"><code>attr()</code></a></li>\n<li>Safari populates the <code>webkitEntries</code> property, Chrome doesn’t.</li>\n</ul>\n<p>To target Safari we’ll check if <code>webkitEntries</code> has a length. Then we’ll set the current file name to the <code>data-file</code> attribute, finally we’ll add a pseudo-element and set its <code>content</code> property value to the value of the <code>data-file</code> attribute.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token comment\">/* Add pseudo-element only if data attribute is set */</span>\n    <span class=\"token selector\">input[data-file]::after</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token function\">attr</span><span class=\"token punctuation\">(</span>data-file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token property\">margin-left</span><span class=\"token punctuation\">:</span> 0.375em<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Get a reference to our file input</span>\n    <span class=\"token keyword\">const</span> fileInput <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"file\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Create a new File object</span>\n    <span class=\"token keyword\">const</span> myFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'myFile.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">lastModified</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Now let's create a FileList</span>\n    <span class=\"token keyword\">const</span> dataTransfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataTransfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>myFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    fileInput<span class=\"token punctuation\">.</span>files <span class=\"token operator\">=</span> dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Help Safari out</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>fileInput<span class=\"token punctuation\">.</span>webkitEntries<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        fileInput<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>file <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>The field below now shows the file name as well.</p>\n<div class=\"demo\">\n<style>\ninput::after {\n    content: attr(data-file);\n    margin-left:.375em;\n}\n</style>\n<input type=\"file\" id=\"b\" />\n<script>\n{\n    // Get a reference to our file input\n    const fileInput = document.querySelector('#b');\n    // Create a new File object\n    const myFile = new File(['Hello World!'], 'myFile.txt', {\n        type: 'text/plain',\n        lastModified: new Date(),\n    });\n    // Now let's create a FileList\n    const dataTransfer = new DataTransfer();\n    dataTransfer.items.add(myFile);\n    fileInput.files = dataTransfer.files;\n    if (fileInput.webkitEntries.length) {\n        fileInput.dataset.file = `${dataTransfer.files[0].name}`;\n    }\n}\n</script>\n</div>\n<p>In a real project we’d probably want a more robust solution.</p>\n<p>We could for example dispatch a custom <code>'change'</code> event and then update the <code>data-file</code> attribute according to the contents of the <code>files</code> property.</p>\n<p>Additionally we’d have to deal with multiple files, situations where the field is cleared, or where the user inputs a new file. But that’s for another time.</p>\n<p>For now let’s just celebrate the fact that we can <em>finally</em> set the value of a file input element. 😅</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We worked around the limitation of <a href=\"https://github.com/whatwg/html/issues/3269\"><code>FileList</code> not having a constructor</a> by creating a <code>DataTransfer</code> instance, populating it with files, and then getting the <code>files</code> property from it.</p>\n<p>To finish things of we helped Safari to correctly show the currently selected file name.</p>\n<p>That’s it. It took a while but we finally have a viable solution to set the value of a file input element. I’ve been using this solution with <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura</a> in production since last year, and it’s been working wonderfully.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/set-value-to-file-input/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Annotate Images With JavaScript",
    "partialText": "<p>In this tutorial we use Pintura, a JavaScript image editor, to quickly create a <strong>JavaScript image annotation solution</strong> to annotate and decorate user submitted images and photos.</p>\n<p>Our goal is to allows users to capture a photo using their mobile phone camera and then add annotations to it.</p>\n<p>We’ll start by setting up a basic HTML form, we’re not going to reinvent the wheel so let’s use <a href=\"https://pqina.nl/pintura/\">Pintura a JavaScript image editor SDK</a> to handle the image annotation process.</p>\n<h2 id=\"setting-up-the-initial-code\">Setting Up The Initial Code</h2>\n<p>We’ll start with a file input field, as that’s the most common way to request an image file from the user. We add the <code>accept</code> attribute to limit the file selection to images.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>Now to catch the image we listen for the <code>'change'</code> event to fire, when it fires we get the first image file from the file input element.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> imageFile <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// No image file selected, so nothing to edit</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>imageFile<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We have an image file, but what to do now?</span>\n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Note that when the user clicks the cancel button in the browse file system dialog, the change event will still fire but the <code>files</code> property will be an empty <code>FileList</code>, that’s why we check if <code>imageFile</code> is actually defined.</p>\n<p>This is the result, it doesn’t do anything, yet.</p>\n<div class=\"demo\">\n<input type=\"file\" accept=\"image/*\" />\n</div>\n<p>With our HTML file input ready we can now add <a href=\"https://pqina.nl/pintura/\">Pintura</a> to handle the image annotation process.</p>\n<h2 id=\"loading-the-image-editor\">Loading The Image Editor</h2>\n<p>We’ll only load the Pintura module after an image file has been selected. This speeds up the initial page load as the editor won’t be needed when a user skips our file upload field.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> imageFile <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>imageFile<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We have an image file, let's dynamically load Pintura</span>\n        <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pintura.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Pintura has loaded, let's edit the image</span>\n            <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> imageFile<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Pintura returns the resulting image and we store it in the file input</span>\n            editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> dataTransfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataTransfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files <span class=\"token operator\">=</span> dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>We’re going to have to improve the file input UX a tiny bit.</p>\n<p>Note that if you just want get on with annotating images <a href=\"https://pqina.nl/blog/annotate-image-with-javascript/#annotating-images\">skip ahead to the image annotation section</a></p>\n<h2 id=\"improving-the-file-input-ux\">Improving The File Input UX</h2>\n<p>This is what currently happens:</p>\n<ol>\n<li>When an image file is selected the Pintura JavaScript module will be loaded.</li>\n<li>When the module is finished loading Pintura will open the image file in a modal.</li>\n<li>When the user is finished editing the file it is <a href=\"https://pqina.nl/blog/set-value-to-file-input/\">saved back to the file input</a>.</li>\n</ol>\n<p>This “works” but creates a problem where <em>if</em> the editor module takes a bit longer to load in step 1, the interface doesn’t give any feedback and the user is left wondering about the state of things.</p>\n<p>To fix this we need to add an image loading indicator, it’ll let the user know what’s going on while waiting for the editor to load.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> imageFile <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>imageFile<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Show loading indicator</span>\n        <span class=\"token keyword\">const</span> loadingState <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        loadingState<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">;</span>\n        loadingState<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Loading image…'</span><span class=\"token punctuation\">;</span>\n        e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span>loadingState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We have an image file, let's dynamically load Pintura</span>\n        <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pintura.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Now ready</span>\n            loadingState<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Pintura has loaded, let's edit the image</span>\n            <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> imageFile<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Hide loading indicator when the editor modal is fully visible</span>\n            editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'show'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                loadingState<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Pintura returns the resulting image and we store it in the file input</span>\n            editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> dataTransfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataTransfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files <span class=\"token operator\">=</span> dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token comment\">/* Hide the file input while loading */</span>\n    <span class=\"token selector\">.loading ~ *</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Excellent!</p>\n<p>There’s one final UX thing to deal with.</p>\n<p>When we save the image back to the file input nothing changes, the file name is the same, so the file input still looks the same.</p>\n<p>We need to show that we’ve actually edited the image.</p>\n<p>We’ll do this by adding a tiny image thumbnail before the file input. It’ll show the currently selected image and give the user confidence that the changes have been applied successfully.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> imageFile <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>imageFile<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// This adds or updates the current image preview</span>\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">showPreview</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Create a new preview or re-use existing one</span>\n            <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span>\n                e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.preview'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            image<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'preview'</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// We don't want our preview to be too big</span>\n            image<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">32</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// If already loaded a preview, need to unload</span>\n            image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">&amp;&amp;</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">revokeObjectURL</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Set the src of the preview image to the file object in the file input</span>\n            image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Attach/move the preview to before the file input</span>\n            e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Render a tiny image preview of the currently selected file</span>\n        <span class=\"token function\">showPreview</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Show loading indicator</span>\n        <span class=\"token keyword\">const</span> loadingState <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        loadingState<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">;</span>\n        loadingState<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Loading image…'</span><span class=\"token punctuation\">;</span>\n        e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span>loadingState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We have an image file, let's dynamically load Pintura</span>\n        <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pintura.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Pintura has loaded, let's edit the image</span>\n            <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> imageFile<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Hide loading indicator when the editor modal is fully visible</span>\n            editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'show'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                loadingState<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Pintura returns the resulting image and we store it in the file input</span>\n            editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> dataTransfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataTransfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files <span class=\"token operator\">=</span> dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// Update our image preview with the edited file</span>\n                <span class=\"token function\">showPreview</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token comment\">/* Styles the preview to be similar to the file input button */</span>\n    <span class=\"token selector\">.preview</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline-block<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 1.5rem<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 1.5rem<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">object-fit</span><span class=\"token punctuation\">:</span> cover<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">margin-right</span><span class=\"token punctuation\">:</span> 0.3125rem<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">vertical-align</span><span class=\"token punctuation\">:</span> bottom<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 0.175rem<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/* Hide the file input and image preview while loading */</span>\n    <span class=\"token selector\">.loading ~ *</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>While we side tracked quite a bit, it gave us some greate insight into what is needed to offer a good user experience.</p>\n<p>Add an image to the field below to show the loading state and preview thumbnail.</p>\n<div class=\"demo\">\n<style>\n.demo .preview {\n    display: inline-block;\n    width: 1.5rem;\n    height: 1.5rem;\n    object-fit: cover;\n    margin-right: 0.3125rem;\n    vertical-align: bottom;\n    border-radius: 0.175rem;\n}\n.demo .loading ~ * {\n    display: none;\n}\n</style>\n<input type=\"file\" id=\"a\" />\n<script>\ndocument.querySelector('input#a').addEventListener('change', e => {\n    const imageFile = e.target.files[0];\n    if (!imageFile) return;\n    // load \n    const loadingState = document.createElement('span');\n    loadingState.className = 'loading'\n    loadingState.textContent = 'Loading image…';\n    e.target.before(loadingState);\n    // preview\n    const showPreview = () => {\n        const image = e.target.parentNode.querySelector('.preview') || new Image();\n        image.className = 'preview';\n        image.width = 32;\n        image.src && URL.revokeObjectURL(image.src);\n        image.src = URL.createObjectURL(e.target.files[0]);\n        e.target.before(image)\n    };\n    showPreview();\n    // edit\n    import('/pintura/demo/pintura.js').then(({ openDefaultEditor }) => {\n        const editor = openDefaultEditor({\n            src: imageFile,\n            enableMoveTool: true\n        })\n        editor.on('show', () => {\n            loadingState.remove();\n        })\n        editor.on('process', ({ dest }) => {\n            const dataTransfer = new DataTransfer();\n            dataTransfer.items.add(dest);\n            e.target.files = dataTransfer.files;\n            showPreview();\n        })\n    })\n});\n</script>\n</div>\n<p>That. Is. Nice. We’re finally ready to annotate images.</p>\n<h2 id=\"annotating-images\">Annotating Images</h2>\n<p>While Pintura offers a wide range of tools to edit images we’re only interested in the annotation tool, in the next step we’ll limit the toolset to the annotation tool.</p>\n<p><em>Note that starting from this code snippet we’re only altering the editor code, the rest of the code is hidden.</em></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pintura.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> imageFile<span class=\"token punctuation\">,</span>\n\n        <span class=\"token comment\">// Only show the annotation tool</span>\n        <span class=\"token literal-property property\">utils</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'annotate'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>The demo below reflects our changes. We’ve only selected one tool so the editor hides the toolbar creating more space for the active tool.</p>\n<p>Try it out in the demo below, we can annotate our image with <strong>text</strong>, <strong>draw lines</strong>, and <strong>add shapes like circles and squares</strong>.</p>\n<div class=\"demo\">\n<!-- styles are applied from demo #a -->\n<input type=\"file\" id=\"b\" />\n<script>\ndocument.querySelector('input#b').addEventListener('change', e => {\n    const imageFile = e.target.files[0];\n    if (!imageFile) return;\n    // load \n    const loadingState = document.createElement('span');\n    loadingState.className = 'loading'\n    loadingState.textContent = 'Loading image…';\n    e.target.before(loadingState);\n    // preview\n    const showPreview = () => {\n        const image = e.target.parentNode.querySelector('.preview') || new Image();\n        image.className = 'preview';\n        image.width = 32;\n        image.src && URL.revokeObjectURL(image.src);\n        image.src = URL.createObjectURL(e.target.files[0]);\n        e.target.before(image)\n    };\n    showPreview();\n    // edit\n    import('/pintura/demo/pintura.js').then(({ openDefaultEditor }) => {\n        const editor = openDefaultEditor({\n            src: imageFile,\n            utils: ['annotate'],\n            enableMoveTool: true\n        })\n        editor.on('show', () => {\n            loadingState.remove();\n        })\n        editor.on('process', ({ dest }) => {\n            const dataTransfer = new DataTransfer();\n            dataTransfer.items.add(dest);\n            e.target.files = dataTransfer.files;\n            showPreview();\n        })\n    })\n});\n</script>\n</div>\n<h2 id=\"adding-stickers\">Adding Stickers</h2>\n<p>To make our annotation editor more powerful we can add stickers.</p>\n<p>Stickers can be emoji, images, or shapes.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pintura.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> imageFile<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">utils</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'annotate'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token comment\">// Set the stickers tool as the active tool</span>\n        <span class=\"token literal-property property\">annotateActiveTool</span><span class=\"token operator\">:</span> <span class=\"token string\">'preset'</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token comment\">// Add some stickers</span>\n        <span class=\"token literal-property property\">annotatePresets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token comment\">// Add image based stickers</span>\n                <span class=\"token string\">'Numbers'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">[</span><span class=\"token string\">'sticker-one.svg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sticker-two.svg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sticker-three.svg'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token comment\">// Add emoji stickers</span>\n                <span class=\"token string\">'Emoji'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">[</span><span class=\"token string\">'👍'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'👎'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token comment\">// Add shape stickers</span>\n                <span class=\"token string\">'Shapes'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">[</span>\n                    <span class=\"token comment\">// A speech bubble</span>\n                    <span class=\"token punctuation\">{</span>\n                        <span class=\"token literal-property property\">thumb</span><span class=\"token operator\">:</span> <span class=\"token string\">'💬'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">alt</span><span class=\"token operator\">:</span> <span class=\"token string\">'Speech cloud'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">shape</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">256</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">128</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.85</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">cornerRadius</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">'Hello World'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Let’s try out the stickers below.</p>\n<div class=\"demo\">\n<!-- styles are applied from demo #a -->\n<input type=\"file\" id=\"c\" />\n<script>\ndocument.querySelector('input#c').addEventListener('change', e => {\n    const imageFile = e.target.files[0];\n    if (!imageFile) return;\n    // load \n    const loadingState = document.createElement('span');\n    loadingState.className = 'loading'\n    loadingState.textContent = 'Loading image…';\n    e.target.before(loadingState);\n    // preview\n    const showPreview = () => {\n        const image = e.target.parentNode.querySelector('.preview') || new Image();\n        image.className = 'preview';\n        image.width = 32;\n        image.src && URL.revokeObjectURL(image.src);\n        image.src = URL.createObjectURL(e.target.files[0]);\n        e.target.before(image)\n    };\n    showPreview();\n    // edit\n    import('/pintura/demo/pintura.js').then(({ openDefaultEditor }) => {\n        const editor = openDefaultEditor({\n            src: imageFile,\n            utils: ['annotate'],\n            enableMoveTool: true,\n            annotateActiveTool: 'preset', \n            annotatePresets: [\n                [\n                    'Numbers',\n                    [\n                        '/pintura/demo/sticker-one.svg',\n                        '/pintura/demo/sticker-two.svg',\n                        '/pintura/demo/sticker-three.svg'\n                    ],\n                ],\n                [\n                    'Markers',\n                    [\n                        '👍',\n                        '👎',\n                    ],\n                ],\n                [\n                    'Shapes',\n                    [\n                        {\n                            thumb: '💬',\n                            alt: 'Speech cloud',\n                            shape: {\n                                width: 256,\n                                height: 128,\n                                fontSize: 64,\n                                backgroundColor: [1, 1, 1, .85],\n                                color: [0, 0, 0],\n                                cornerRadius: 10,\n                                text: 'Hello World'\n                            },\n                        }\n                    ]\n                ]\n            ]\n        })\n        editor.on('show', () => {\n            loadingState.remove();\n        })\n        editor.on('process', ({ dest }) => {\n            const dataTransfer = new DataTransfer();\n            dataTransfer.items.add(dest);\n            e.target.files = dataTransfer.files;\n            showPreview();\n        })\n    })\n});\n</script>\n</div>\n<h2 id=\"dynamic-annotation-shapes\">Dynamic Annotation Shapes</h2>\n<p>Now for our final trick we’ll add a dynamic shape.</p>\n<p>Imagine you need an annotation tool to measure the distance in pixels between two points. We can achieve that by adding a line shape that automatically expands to a text showing the distance between the start and end point.</p>\n<p>In the code snippet below we first add the <code>&quot;measure&quot;</code> shape preset, this is the preset that we’ll expand in the next step.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pintura.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> imageFile<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">utils</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'annotate'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">annotateActiveTool</span><span class=\"token operator\">:</span> <span class=\"token string\">'preset'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">annotatePresets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">'Numbers'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">[</span><span class=\"token string\">'sticker-one.svg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sticker-two.svg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sticker-three.svg'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">'Emoji'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'👍'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'👎'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">'Shapes'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">[</span>\n                    <span class=\"token punctuation\">{</span>\n                        <span class=\"token literal-property property\">thumb</span><span class=\"token operator\">:</span> <span class=\"token string\">'💬'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">alt</span><span class=\"token operator\">:</span> <span class=\"token string\">'Speech cloud'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">shape</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">256</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">128</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.85</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">cornerRadius</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">'Hello World'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token comment\">// Add our dynamic measure shape</span>\n                    <span class=\"token punctuation\">{</span>\n                        <span class=\"token literal-property property\">thumb</span><span class=\"token operator\">:</span> <span class=\"token string\">'📏'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">alt</span><span class=\"token operator\">:</span> <span class=\"token string\">'Measure'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token literal-property property\">shape</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token literal-property property\">style</span><span class=\"token operator\">:</span> <span class=\"token string\">'measure'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">x1</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">y1</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">x2</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">y2</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">strokeWidth</span><span class=\"token operator\">:</span> <span class=\"token string\">'.5%'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">strokeColor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.85</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">lineEnd</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">lineStart</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Now we need to automatically expand shapes with the <code>'measure'</code> style property to show a text box, for this we’ll use a custom shape preprocessor.</p>\n<p>For brevity the example below only shows the <code>shapePreprocessor</code> code.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pintura.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> openDefaultEditor<span class=\"token punctuation\">,</span> shapeGetCenter<span class=\"token punctuation\">,</span> shapeGetLength<span class=\"token punctuation\">,</span> shapeGetLevel <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ... other editor properties here</span>\n\n            <span class=\"token comment\">// Set our custom shape preprocessor</span>\n            <span class=\"token literal-property property\">shapePreprocessor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">(</span><span class=\"token parameter\">shape<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token comment\">// Should return undefined if shape is not a match</span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>shape<span class=\"token punctuation\">.</span>style <span class=\"token operator\">||</span> shape<span class=\"token punctuation\">.</span>style <span class=\"token operator\">!==</span> <span class=\"token string\">'measure'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n                    <span class=\"token comment\">// Calculate the font size scalar so we can always read the font size info no matter the size of the image</span>\n                    <span class=\"token keyword\">const</span> scalar <span class=\"token operator\">=</span> options<span class=\"token punctuation\">.</span>isPreview\n                        <span class=\"token operator\">?</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span>scale <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n                    <span class=\"token comment\">// Calculate line midpoint</span>\n                    <span class=\"token keyword\">const</span> center <span class=\"token operator\">=</span> <span class=\"token function\">shapeGetCenter</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    <span class=\"token comment\">// Calculate line length</span>\n                    <span class=\"token keyword\">const</span> length <span class=\"token operator\">=</span> <span class=\"token function\">shapeGetLength</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    <span class=\"token comment\">// Properties for the text label</span>\n                    <span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>length<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">const</span> fontSize <span class=\"token operator\">=</span> <span class=\"token number\">24</span> <span class=\"token operator\">/</span> scalar<span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span>length <span class=\"token operator\">*</span> fontSize <span class=\"token operator\">*</span> <span class=\"token number\">0.75</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">const</span> lineHeight <span class=\"token operator\">=</span> fontSize <span class=\"token operator\">*</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">;</span>\n\n                    <span class=\"token comment\">// Return the text shape containing the line length</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">{</span>\n                            width<span class=\"token punctuation\">,</span>\n                            lineHeight<span class=\"token punctuation\">,</span>\n                            text<span class=\"token punctuation\">,</span>\n                            fontSize<span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">textAlign</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">fontFamily</span><span class=\"token operator\">:</span> <span class=\"token string\">'monospace'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">cornerRadius</span><span class=\"token operator\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span>\n\n                            <span class=\"token comment\">// This places the text box in the middle of the line</span>\n                            <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> center<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> width <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> center<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> lineHeight <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n\n                            <span class=\"token comment\">// This makes sure the text box isn't flipped or rotated</span>\n                            <span class=\"token operator\">...</span><span class=\"token function\">shapeGetLevel</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Let’s take a look at the final code, or skip to <a href=\"https://pqina.nl/blog/annotate-image-with-javascript/#demo\">the final demo</a>.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> imageFile <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// No image file selected, so nothing to edit</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>imageFile<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// This adds or updates the current image preview</span>\n        <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">showPreview</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Create a new preview or re-use existing one</span>\n            <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span>\n                e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.preview'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            image<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'preview'</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// We don't want our preview to be too big</span>\n            image<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">32</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// If already loaded a preview, need to unload</span>\n            image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">&amp;&amp;</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">revokeObjectURL</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Set the src of the preview image to the file object in the file input</span>\n            image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Attach/move the preview to before the file input</span>\n            e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Render a tiny image preview of the currently selected file</span>\n        <span class=\"token function\">showPreview</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Show loading indicator</span>\n        <span class=\"token keyword\">const</span> loadingState <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'span'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        loadingState<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> <span class=\"token string\">'loading'</span><span class=\"token punctuation\">;</span>\n        loadingState<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'Loading image…'</span><span class=\"token punctuation\">;</span>\n        e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span><span class=\"token function\">before</span><span class=\"token punctuation\">(</span>loadingState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We have an image file, let's dynamically load Pintura</span>\n        <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./pintura.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n            <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>\n                openDefaultEditor<span class=\"token punctuation\">,</span>\n                shapeGetCenter<span class=\"token punctuation\">,</span>\n                shapeGetLength<span class=\"token punctuation\">,</span>\n                shapeGetLevel<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Pintura has loaded, let's edit the image</span>\n                <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> <span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> imageFile<span class=\"token punctuation\">,</span>\n\n                    <span class=\"token comment\">// Set the stickers tool as the active tool</span>\n                    <span class=\"token literal-property property\">annotateActiveTool</span><span class=\"token operator\">:</span> <span class=\"token string\">'preset'</span><span class=\"token punctuation\">,</span>\n\n                    <span class=\"token comment\">// Add some stickers</span>\n                    <span class=\"token literal-property property\">annotatePresets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">[</span>\n                            <span class=\"token comment\">// Add image based stickers</span>\n                            <span class=\"token string\">'Numbers'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">[</span>\n                                <span class=\"token string\">'sticker-one.svg'</span><span class=\"token punctuation\">,</span>\n                                <span class=\"token string\">'sticker-two.svg'</span><span class=\"token punctuation\">,</span>\n                                <span class=\"token string\">'sticker-three.svg'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">[</span>\n                            <span class=\"token comment\">// Add emoji stickers</span>\n                            <span class=\"token string\">'Emoji'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">[</span><span class=\"token string\">'👍'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'👎'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">[</span>\n                            <span class=\"token comment\">// Add shape stickers</span>\n                            <span class=\"token string\">'Shapes'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">[</span>\n                                <span class=\"token comment\">// A speech bubble</span>\n                                <span class=\"token punctuation\">{</span>\n                                    <span class=\"token literal-property property\">thumb</span><span class=\"token operator\">:</span> <span class=\"token string\">'💬'</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">alt</span><span class=\"token operator\">:</span> <span class=\"token string\">'Speech cloud'</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">shape</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                                        <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">256</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">128</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">fontSize</span><span class=\"token operator\">:</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.85</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">cornerRadius</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">text</span><span class=\"token operator\">:</span> <span class=\"token string\">'Hello World'</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                                <span class=\"token comment\">// Add our dynamic measure shape</span>\n                                <span class=\"token punctuation\">{</span>\n                                    <span class=\"token literal-property property\">thumb</span><span class=\"token operator\">:</span> <span class=\"token string\">'📏'</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">alt</span><span class=\"token operator\">:</span> <span class=\"token string\">'Measure'</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">shape</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                                        <span class=\"token literal-property property\">style</span><span class=\"token operator\">:</span> <span class=\"token string\">'measure'</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">x1</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">y1</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">x2</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">y2</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">strokeWidth</span><span class=\"token operator\">:</span> <span class=\"token string\">'.5%'</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">strokeColor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.85</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">lineEnd</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span>\n                                        <span class=\"token literal-property property\">lineStart</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n                    <span class=\"token comment\">// Set our custom shape preprocessor</span>\n                    <span class=\"token literal-property property\">shapePreprocessor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                        <span class=\"token punctuation\">(</span><span class=\"token parameter\">shape<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token comment\">// Should return undefined if shape is not a match</span>\n                            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>shape<span class=\"token punctuation\">.</span>style <span class=\"token operator\">||</span> shape<span class=\"token punctuation\">.</span>style <span class=\"token operator\">!==</span> <span class=\"token string\">'measure'</span><span class=\"token punctuation\">)</span>\n                                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n                            <span class=\"token comment\">// Calculate the font size scalar so we can always read the font size info no matter the size of the image</span>\n                            <span class=\"token keyword\">const</span> scalar <span class=\"token operator\">=</span> options<span class=\"token punctuation\">.</span>isPreview\n                                <span class=\"token operator\">?</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">.</span>scale <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n                                <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n                            <span class=\"token comment\">// Calculate line midpoint</span>\n                            <span class=\"token keyword\">const</span> center <span class=\"token operator\">=</span> <span class=\"token function\">shapeGetCenter</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                            <span class=\"token comment\">// Calculate line length</span>\n                            <span class=\"token keyword\">const</span> length <span class=\"token operator\">=</span> <span class=\"token function\">shapeGetLength</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                            <span class=\"token comment\">// Properties for the text label</span>\n                            <span class=\"token keyword\">const</span> text <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>length<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n                            <span class=\"token keyword\">const</span> fontSize <span class=\"token operator\">=</span> <span class=\"token number\">24</span> <span class=\"token operator\">/</span> scalar<span class=\"token punctuation\">;</span>\n                            <span class=\"token keyword\">const</span> width <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span>length <span class=\"token operator\">*</span> fontSize <span class=\"token operator\">*</span> <span class=\"token number\">0.75</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token keyword\">const</span> lineHeight <span class=\"token operator\">=</span> fontSize <span class=\"token operator\">*</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">;</span>\n\n                            <span class=\"token comment\">// Return the text shape</span>\n                            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n                                <span class=\"token punctuation\">{</span>\n                                    width<span class=\"token punctuation\">,</span>\n                                    lineHeight<span class=\"token punctuation\">,</span>\n                                    text<span class=\"token punctuation\">,</span>\n                                    fontSize<span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">textAlign</span><span class=\"token operator\">:</span> <span class=\"token string\">'center'</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">fontFamily</span><span class=\"token operator\">:</span> <span class=\"token string\">'monospace'</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">color</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">cornerRadius</span><span class=\"token operator\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span>\n\n                                    <span class=\"token comment\">// This centers the text box to the line</span>\n                                    <span class=\"token literal-property property\">x</span><span class=\"token operator\">:</span> center<span class=\"token punctuation\">.</span>x <span class=\"token operator\">-</span> width <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token literal-property property\">y</span><span class=\"token operator\">:</span> center<span class=\"token punctuation\">.</span>y <span class=\"token operator\">-</span> lineHeight <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span>\n\n                                    <span class=\"token comment\">// This makes sure the text box isn't flipped or rotated</span>\n                                    <span class=\"token operator\">...</span><span class=\"token function\">shapeGetLevel</span><span class=\"token punctuation\">(</span>shape<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// Hide loading indicator when the editor modal is fully visible</span>\n                editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'show'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                    loadingState<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token comment\">// Pintura returns the resulting image and we store it in the file input</span>\n                editor<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'process'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> dest <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">const</span> dataTransfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataTransfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>dest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files <span class=\"token operator\">=</span> dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n                    <span class=\"token function\">showPreview</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token comment\">/* Styles the preview to be similar to the file input button */</span>\n    <span class=\"token selector\">.preview</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline-block<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 1.5rem<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 1.5rem<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">object-fit</span><span class=\"token punctuation\">:</span> cover<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">margin-right</span><span class=\"token punctuation\">:</span> 0.3125rem<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">vertical-align</span><span class=\"token punctuation\">:</span> bottom<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 0.175rem<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/* Hide the file input and image preview while loading */</span>\n    <span class=\"token selector\">.loading ~ *</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>The demo that implements the above code, try it out! 🚀</p>\n<div class=\"demo\" id=\"demo\">\n<!-- styles are applied from demo #a -->\n<input type=\"file\" id=\"d\" accept=\"image/*\" />\n<script>\ndocument.querySelector('input#d').addEventListener('change', e => {\n    const imageFile = e.target.files[0];\n    if (!imageFile) return;\n    // load \n    const loadingState = document.createElement('span');\n    loadingState.className = 'loading'\n    loadingState.textContent = 'Loading image…';\n    e.target.before(loadingState);\n    // preview\n    const showPreview = () => {\n        const image = e.target.parentNode.querySelector('.preview') || new Image();\n        image.className = 'preview';\n        image.width = 32;\n        image.src && URL.revokeObjectURL(image.src);\n        image.src = URL.createObjectURL(e.target.files[0]);\n        e.target.before(image)\n    };\n    showPreview();\n    // edit\n    import('/pintura/demo/pintura.js').then(({ openDefaultEditor,\n                shapeGetCenter,\n                shapeGetLength,\n                shapeGetLevel }) => {\n        const editor = openDefaultEditor({\n            src: imageFile,\n            utils: ['annotate'],\n            enableMoveTool: true,\n            annotateActiveTool: 'preset', \n            annotatePresets: [\n                [\n                    'Numbers',\n                    [\n                        '/pintura/demo/sticker-one.svg',\n                        '/pintura/demo/sticker-two.svg',\n                        '/pintura/demo/sticker-three.svg'\n                    ],\n                ],\n                [\n                    'Markers',\n                    [\n                        '👍',\n                        '👎',\n                    ],\n                ],\n                [\n                    'Shapes',\n                    [\n                        {\n                            thumb: '💬',\n                            alt: 'Speech cloud',\n                            shape: {\n                                width: 256,\n                                height: 128,\n                                fontSize: 64,\n                                backgroundColor: [1, 1, 1, .85],\n                                color: [0, 0, 0],\n                                cornerRadius: 10,\n                                text: 'Hello World'\n                            },\n                        },\n                        // Add our dynamic measure shape\n                        {\n                            thumb: '📏',\n                            alt: 'Measure',\n                            shape: {\n                                style: 'measure',\n                                x1: 0,\n                                y1: 0,\n                                x2: 100,\n                                y2: 100,\n                                strokeWidth: '.5%',\n                                strokeColor: [0.5, 0.85, 1],\n                                lineEnd: 'bar',\n                                lineStart: 'bar',\n                            },\n                        },\n                    ]\n                ]\n            ],\n            // Set our custom shape preprocessor\n            shapePreprocessor: [\n                (shape, options) => {\n                    // Should return undefined if shape is not a match\n                    if (!shape.style || shape.style !== 'measure')\n                        return;\n                    // when editing we calculate the\n                    const scalar = options.isPreview ? Math.min(1, options.scale * 2) : 1;\n                    // Calculate line midpoint\n                    const center = shapeGetCenter(shape);\n                    // Calculate line length\n                    const length = shapeGetLength(shape);\n                    // Properties for the text label\n                    const text = `${Math.round(length)}px`;\n                    const fontSize = 24 / scalar;\n                    const width = text.length * fontSize * 0.75;\n                    const lineHeight = fontSize * 1.5;\n                    // Return the text shape\n                    return [\n                        {\n                            width,\n                            lineHeight,\n                            text,\n                            fontSize,\n                            textAlign: 'center',\n                            fontFamily: 'monospace',\n                            color: [1, 1, 1],\n                            backgroundColor: [0, 0, 0],\n                            cornerRadius: 8,\n                            // This centers the text box to the line\n                            x: center.x - width * 0.5,\n                            y: center.y - lineHeight * 0.5,\n                            // This makes sure the text box isn't flipped or rotated\n                            ...shapeGetLevel(shape, options),\n                        },\n                    ];\n                },\n            ],\n        })\n        editor.on('show', () => {\n            loadingState.remove();\n        })\n        editor.on('process', ({ dest }) => {\n            const dataTransfer = new DataTransfer();\n            dataTransfer.items.add(dest);\n            e.target.files = dataTransfer.files;\n            showPreview();\n        })\n    })\n});\n</script>\n</div>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We’ve created a flexible and powerful image annotation solution. Along the way we’ve learned quite a bit about offering a good user experience.</p>\n<p>We can extend the editor further with more stickers and <a href=\"https://pqina.nl/pintura/docs/v8/api/image-editor/exports/#createshapepreprocessor\">custom shapes</a>.</p>\n<p>Additionally we can use the editor API to <a href=\"https://pqina.nl/pintura/docs/v8/api/markup-editor/stickers/#configuration-object\">disable stickers or sticker groups</a>, limit the amount of stickers that a user may apply, or <a href=\"https://pqina.nl/pintura/docs/v8/api/markup-editor/stickers/#altering-the-sticker-thumbnail\">customize the HTML of the sticker thumbnails</a>.</p>\n<!-- The Pintura Stylesheet --->\n<link rel=\"stylesheet\" href=\"https://pqina.nl/pintura/demo/pintura.css\" />",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/annotate-image-with-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Overlap Elements With CSS Grid Instead Of Position Absolute",
    "partialText": "<p>We can use CSS absolute positioning to overlap elements, but there’s some advantages to using CSS grid instead. Let’s explore using CSS grid as an alternative to position absolute.</p>\n<h2 id=\"overlapping-elements-with-position-absolute\">Overlapping Elements With Position Absolute</h2>\n<p>Using the styles below we can position multiple child elements relative to the first parent element that has a <code>position</code> property, in this case the direct parent.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>parent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>child<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Robert<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>child<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Charlene<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>child<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Baby<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token selector\">.parent</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token selector\">.child</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Below we can see <code>absolute</code> positioning in action, the different children names are rendered on top of each other.</p>\n<style>\n.demo {\n    min-height: 4.25em;\n}\n\n.parent {\n    position: relative;\n}\n\n.child {\n    position: absolute;\n    top: 0;\n    left: 0;\n    font-size: 3em;\n}\n</style>\n<div class=\"demo\">\n<div class=\"parent\">\n    <div class=\"child\">Robert</div>\n    <div class=\"child\">Charlene</div>\n    <div class=\"child\">Baby</div>\n</div>\n</div>\n<p>Right. That looks objectively horrible.</p>\n<p>Now let’s try to achieve the same result with CSS Grid.</p>\n<h2 id=\"overlapping-elements-with-grid\">Overlapping Elements With Grid</h2>\n<p>We set <code>display</code> to <code>grid</code> on the parent element, and we define one grid column. <code>1fr</code> means 1 part of all the available space, which in this case is everything.</p>\n<p>We instruct the children to all occupy this one grid column. ⛺️</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>parent<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>child<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Robert<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>child<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Charlene<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>child<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Baby<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token selector\">.parent</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> grid<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">grid-template-columns</span><span class=\"token punctuation\">:</span> 1fr<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token selector\">.child</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">grid-row-start</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">grid-column-start</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Let’s check out the equally horrible result below.</p>\n<style>\n.parent-grid {\n    display: grid;\n    grid-template-columns: 1fr;\n}\n\n.child-grid {\n    grid-row-start: 1;\n    grid-column-start: 1;\n    font-size: 3em;\n}\n</style>\n<div class=\"demo\">\n<div class=\"parent-grid\">\n    <div class=\"child-grid\">Robert</div>\n    <div class=\"child-grid\">Charlene</div>\n    <div class=\"child-grid\">Baby</div>\n</div>\n</div>\n<p>It looks the same, but there’s an important difference.</p>\n<p>Where the children in the absolute positioning example no longer affect page flow, meaning they no longer take up any vertical space, the children in the grid example do.</p>\n<p>The parent in the positioning example has <em>zero</em> height where the height of the parent in the grid example equals the max child height.</p>\n<p>Let’s look at them together, the position absolute example has a red outline, the grid example a green one.</p>\n<style>\n.demo-compare {\n    white-space:nowrap;\n}\n\n.demo-compare .parent {\n    border: 1px dashed #c85858;\n    border-radius: .5rem;\n}\n\n.demo-compare .parent-grid {\n    display: inline-grid;\n    border: 1px dashed #a5c858;\n    border-radius: .5rem;\n    margin-top: -2px;\n}\n</style>\n<div class=\"demo demo-compare\">\n    <div class=\"parent\">\n        <div class=\"child\">Robert</div>\n        <div class=\"child\">Charlene</div>\n        <div class=\"child\">Baby</div>\n    </div>\n    <div class=\"parent-grid\">\n        <div class=\"child-grid\">Robert</div>\n        <div class=\"child-grid\">Charlene</div>\n        <div class=\"child-grid\">Baby</div>\n    </div>\n</div>\n<p>So why is this relevant?</p>\n<p>This is very useful when we need to animate overlapping elements but want to retain normal page flow.</p>\n<p>Imagine a tab control where tab panels crossfade. With absolute positioning we would have to fix the height of the tab control. With grid the height is automatically derived from the child elements.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>Absolute positioning has historically been the only way to effectively overlap elements. Unfortunately this meant detaching elements from the document layout, forcing us to assign a fixed or minimum height.</p>\n<p>Using Grid we can overlap elements while retaining height resulting in more stable and clean code.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/css-grid-position-absolute-alternative/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Slim Image Cropper Alternative",
    "partialText": "<p>In this short tutorial we’ll use the PinturaInput Web Component to replace a Slim Image Cropper instance with the more powerful <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura Image Editor SDK</a>.</p>\n<p>The <code>&lt;pintura-input&gt;</code> web component core functionality is similar to Slim, it handles image editing and uploading for one image.</p>\n<p>Because the component is using Pintura image editor it offers a lot more additional functionality than the image cropping and rotation features in Slim.</p>\n<p>Let’s take a look at a working PinturaInput component.</p>\n<div class=\"demo\">\n<style>\n/* temporary styles until the component loads */\n:root pintura-input.hopper {\n    position: relative;\n    display: block;\n    width: 400px;\n    height: 300px;\n    overflow: hidden;\n    max-width: 100%;\n    background-color: rgba(var(--text),.1);\n    border-radius: 1em;\n}\n\n:root pintura-input.hopper:not(:has(input))::after {\n    position: absolute;\n    z-index: -1;\n    content: 'Loading...';\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom:0;\n    pointer-events: none;\n    display:flex;\n    justify-content: center;\n    align-items: center;\n}\n\n:root pintura-input.hopper img[onload],\n:root pintura-input.hopper img[onload] + span {\n    opacity:0;\n    transition: opacity .2s ease-out;\n}\n\n:root pintura-input.hopper img[data-complete],\n:root pintura-input.hopper img[data-complete] + span {\n    opacity:1;\n}\n</style>\n<pintura-input class=\"hopper\" src=\"https://pqina.nl/pintura/demo/mountains.jpeg\" image-crop-aspect-ratio=\"4/3\">\n    <template>\n        <div data-empty=\"\" data-drop=\"\">\n            <p>\n                Drag &amp; Drop your image here or\n                <button type=\"button\" data-browse=\"\">Browse</button>\n            </p>\n        </div>\n        <div data-load=\"\">\n            <img src=\"https://pqina.nl/pintura/demo/mountains.jpeg\" width=\"300\" alt=\"\" onload=\"this.dataset.complete=true\" />\n            <span>\n                <button type=\"button\" data-remove=\"\">Remove</button>\n                <button type=\"button\" data-edit=\"\">Edit</button>\n            </span>\n        </div>\n        <output data-process=\"\">\n            <img src=\"https://pqina.nl/blog/slim-image-cropper-alternative/%7Burl%7D\" width=\"300\" alt=\"\" />\n            <p role=\"status\">\"{filename}\" uploaded successfully</p>\n            <span>\n                <button type=\"button\" data-remove=\"\">Remove</button>\n                <button type=\"button\" data-edit=\"\">Edit</button>\n            </span>\n        </output>\n    </template>\n</pintura-input>\n</div>\n<h2 id=\"from-slim-image-cropper-to-pintura-input\">From Slim Image Cropper To Pintura Input</h2>\n<p>Let’s use a default Slim editor template as our starting point.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n    <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>slim<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">data-ratio</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16:9<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">data-service</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>async.php<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">data-size</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>800,600<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">data-min-size</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>400,300<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>slim[]<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Before we continue please note that in an effort to too keep the code snippets concise the PinturaInput <a href=\"https://pqina.nl/pintura/docs/v8/getting-started/installation/pintura-input/#templating\">default template</a> is not shown, instead we’ll show a placeholder comment.</p>\n<p>Let’s get started.</p>\n<p>We replace the Slim element with the <code>&lt;pintura-input&gt;</code> web component tag, we can remove the original file input element.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pintura-input</span> <span class=\"token attr-name\">image-crop-aspect-ratio</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16/9<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- template placeholder --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pintura-input</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>All serializable editor properties can be defined as an attribute on the PinturaInput element. Other properties will have to be defined elsewhere.</p>\n<p>Let’s see how we can convert the <code>data-size</code> and <code>data-min-size</code> attributes to Pintura.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    window<span class=\"token punctuation\">.</span>myPinturaInput <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">imageWriter</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">targetSize</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">imageCropMinSize</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">locale</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">labelButtonExport</span><span class=\"token operator\">:</span> <span class=\"token string\">'Confirm'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pintura-input</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>myPinturaInput<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">image-crop-aspect-ratio</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16/9<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- template placeholder --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pintura-input</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>We’ve created a global variable called <code>myPinturaInput</code> and have also set that as the <code>id</code> of our PinturaInput component.</p>\n<p>We used the <code>imageWriter</code> property to set the intended output size, and have set the <code>imageCropMinSize</code> property to defined the minimum crop size.</p>\n<p>Additionally we used the <code>locale</code> property to rename the button label to match the Slim Image Cropper button label.</p>\n<p>Let’s now look at the Slim <code>data-service</code> attribute.</p>\n<h2 id=\"uploading-synchronously\">Uploading Synchronously</h2>\n<p>Using the PinturaInput we aren’t required to upload our files asynchronously, edited images can be submitted with a normal form post. We no longer need the <code>data-service</code> attribute.</p>\n<p>Skip to <a href=\"https://pqina.nl/blog/slim-image-cropper-alternative/#uploading-asynchronously\">Uploading Asynchronously</a> if you still want to upload asynchronously.</p>\n<p>Let’s look at the code needed for a default form post with file upload and image edit field.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upload.php<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pintura-input</span> <span class=\"token attr-name\">image-crop-aspect-ratio</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16/9<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- template placeholder --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pintura-input</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Upload<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>This code above will submit the edited file to the <code>upload.php</code> PHP script, there it can be accessed with <code>$_FILES[&quot;image&quot;]</code>, see this <a href=\"https://pqina.nl/blog/image-upload-with-php/\">Image Uploading With PHP</a> tutorial for additional information.</p>\n<h2 id=\"uploading-asynchronously\">Uploading Asynchronously</h2>\n<p>If we still want upload images asynchronously we can do so with the <code>store</code> attribute, files can be handled with the same <code>upload.php</code> script. Uploads handled this way will show a nice progress indicator.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pintura-input</span> <span class=\"token attr-name\">image-crop-aspect-ratio</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16/9<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">store</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upload.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- template placeholder --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pintura-input</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>After the file has finished uploading the PinturaInput component will create a hidden <code>input</code> element and set the <code>name</code> attribute to the name of the PinturaInput component, the server response will be set to the <code>value</code> attribute.</p>\n<p>In the example below the server has returned <code>1234</code> representing the id of the file on the server.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pintura-input</span> <span class=\"token attr-name\">image-crop-aspect-ratio</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>16/9<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">store</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upload.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- This element is created by Pintura Input --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1234<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token comment\">&lt;!-- template placeholder --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pintura-input</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>With a couple of code adjustments we can switch to Pintura without much trouble and get a way more powerful image editor in return.</p>\n<p>Pintura ships with <a href=\"https://pqina.nl/pintura/docs/v8/getting-started/installation/#frameworks\">example projects for all kinds of JavaScript frameworks</a> making the switch from Slim to Pintura even easier.</p>\n<p>If you’ve decided to switch over and need any help transitioning from Slim Image Cropper to Pintura, <a href=\"https://pqina.nl/pintura/contact/\">get in touch</a>, I’m always happy to lend a hand.</p>\n<link href=\"https://pqina.nl/pintura/demo/pintura-input-styled.css\" rel=\"stylesheet\" />\n<link href=\"https://pqina.nl/pintura/demo/pintura-input.css\" rel=\"stylesheet\" />\n<script src=\"https://pqina.nl/pintura/demo/pintura-input.js\" async=\"\"></script>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/slim-image-cropper-alternative/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "How To Upload An Image With PHP",
    "partialText": "<p>In this quick tutorial we set up a basic HTML form to <strong>upload images with PHP</strong>, we also explore how to <strong>secure our PHP script</strong> so it can’t be abused by malicious users.</p>\n<h2 id=\"setting-up-an-image-upload-form\">Setting Up An Image Upload Form</h2>\n<p>We start with a basic form.</p>\n<p>The form contains a submit button and has an <code>action</code> attribute. The action attribute points to the page the form will post all its contents to when the submit button is clicked.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upload.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Upload<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>The form posts to a PHP file called <code>upload.php</code>. This file will handle the image upload. We’ll get to that in a minute.</p>\n<p>To allow users to select a file we add a file input field.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>upload.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">enctype</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>multipart/form-data<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Upload<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>At the same time we’ve also added the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form#attr-enctype\"><code>enctype</code></a> form attribute and set it to <code>&quot;multipart/form-data&quot;</code>. This is needed if we have a file input field in our form.</p>\n<p>Because we’re only uploading images we add the <code>accept</code> attribute to the file input element and set it to <code>image/*</code> telling it to only accept files that have a mimetype that starts with <code>image</code>, like <code>image/jpeg</code> or <code>image/png</code>.</p>\n<p>Let’s write the PHP image upload handler next.</p>\n<h2 id=\"handling-the-php-image-upload\">Handling the PHP Image Upload</h2>\n<p>We’ll create a new file called <code>upload.php</code> in the same directory as the page that contains our form.</p>\n<p>Next we create a directory called <code>&quot;images&quot;</code>, also in the same directory. This is where our script will store uploaded image files using the <a href=\"https://www.php.net/manual/en/function.move-uploaded-file.php\"><code>move_uploaded_file</code></a> function.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token comment\">// Get reference to uploaded image</span>\n<span class=\"token variable\">$image_file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"image\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Image not defined, let's exit</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'No file uploaded.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Move the temp image file to the images/ directory</span>\n<span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Temp image location</span>\n    <span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// New image location, __DIR__ is the location of the current PHP file</span>\n    <span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"/images/\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"name\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre>\n<p>We’re done. This is all that’s needed to make it work.</p>\n<p>Unfortunately not everyone on the internet is a saint. Our script currently allows <em>anyone</em> to upload <em>anything</em>, this is a security risk. We need to make sure people upload valid images and are not trying to harm our server.</p>\n<h2 id=\"securing-the-image-upload-process\">Securing The Image Upload Process</h2>\n<p>We’re going to make extra sure these three things are in order.</p>\n<ul>\n<li>The file needs to be an image.</li>\n<li>The file must be smaller than 5MB.</li>\n<li>The file must have a valid name.</li>\n</ul>\n<h3 id=\"making-sure-the-file-is-an-image\">Making Sure The File Is An Image</h3>\n<p>Let’s start by making sure the uploaded file is indeed an image.</p>\n<p>Using <a href=\"https://www.php.net/manual/en/function.exif-imagetype.php\"><code>exif_imagetype</code></a> we can get the image mimetype, the function returns <code>false</code> when the file is not an image.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token comment\">// Get reference to uploaded image</span>\n<span class=\"token variable\">$image_file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"image\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Exit if no file uploaded</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'No file uploaded.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Exit if is not a valid image file</span>\n<span class=\"token variable\">$image_type</span> <span class=\"token operator\">=</span> <span class=\"token function\">exif_imagetype</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$image_type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Uploaded file is not an image.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Move the temp image file to the images/ directory</span>\n<span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Temp image location</span>\n    <span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// New image location</span>\n    <span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"/images/\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"name\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre>\n<p>Next we need to stop users from uploading very large files.</p>\n<h3 id=\"limiting-the-file-size\">Limiting The File Size</h3>\n<p>In the example below we limit the image file size to 5MB, of course you can choose your own limit, but it’s a good idea to at least cap it at a certain point to prevent users from uploading gigabytes of data in an attempt to <a href=\"https://en.wikipedia.org/wiki/Denial-of-service_attack\">DoS attack</a> your server.</p>\n<p>In the directory of our <code>upload.php</code> script we create a <code>.htaccess</code> file and set its contents to the following.</p>\n<pre><code>LimitRequestBody 5242880\n</code></pre>\n<p>The <a href=\"https://httpd.apache.org/docs/2.4/mod/core.html#limitrequestbody\"><code>LimitRequestBody</code></a> prevents a request from exceeding 5MB, note that this includes other fields in the form.</p>\n<p>Now let’s make sure users can’t uploading 0 byte files. We use <code>filesize</code> to read out the actual file size instead of rely on the <code>[&quot;size&quot;]</code> reported by <code>$_FILES</code> as that can be modified by the user.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token comment\">// Get reference to uploaded image</span>\n<span class=\"token variable\">$image_file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"image\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Exit if no file uploaded</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'No file uploaded.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Exit if image file is zero bytes</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">filesize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Uploaded file has no contents.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Exit if is not a valid image file</span>\n<span class=\"token variable\">$image_type</span> <span class=\"token operator\">=</span> <span class=\"token function\">exif_imagetype</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$image_type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Uploaded file is not an image.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Move the temp image file to the images/ directory</span>\n<span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Temp image location</span>\n    <span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// New image location</span>\n    <span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"/images/\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"name\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre>\n<p>Let’s now make sure the file name of the image is valid.</p>\n<h3 id=\"guarding-against-malicious-file-names\">Guarding Against Malicious File Names</h3>\n<p>Malicious actors can try to upload an image with named <code>'../index.php'</code>, our PHP script would now store this “image” in <code>'images/../index.php'</code> possibly overwriting our own <code>index.php</code> file.</p>\n<p>We can try to sanitize the image file name, but a safer approach is to generate our own file name.</p>\n<p>We’ll generate some <a href=\"https://www.php.net/manual/en/function.random-bytes.php\"><code>random_bytes</code></a> and use those as the name for our image.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token comment\">// Get reference to uploaded image</span>\n<span class=\"token variable\">$image_file</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_FILES</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"image\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Exit if no file uploaded</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'No file uploaded.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Exit if image file is zero bytes</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">filesize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Uploaded file has no contents.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Exit if is not a valid image file</span>\n<span class=\"token variable\">$image_type</span> <span class=\"token operator\">=</span> <span class=\"token function\">exif_imagetype</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$image_type</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'Uploaded file is not an image.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Get file extension based on file type, to prepend a dot we pass true as the second parameter</span>\n<span class=\"token variable\">$image_extension</span> <span class=\"token operator\">=</span> <span class=\"token function\">image_type_to_extension</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_type</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create a unique image name</span>\n<span class=\"token variable\">$image_name</span> <span class=\"token operator\">=</span> <span class=\"token function\">bin2hex</span><span class=\"token punctuation\">(</span><span class=\"token function\">random_bytes</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$image_extension</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Move the temp image file to the images directory</span>\n<span class=\"token function\">move_uploaded_file</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// Temp image location</span>\n    <span class=\"token variable\">$image_file</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"tmp_name\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// New image location</span>\n    <span class=\"token constant\">__DIR__</span> <span class=\"token operator\">.</span> <span class=\"token string double-quoted-string\">\"/images/\"</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$image_name</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span></code></pre>\n<p>Our last step is to prevent code from being executed in our <code>images</code> directory.</p>\n<h3 id=\"preventing-code-execution-in-the-images-directory\">Preventing Code Execution In The Images Directory</h3>\n<p>In our <code>images</code> directory we create a <code>.htaccess</code> file and set its contents to the following to prevent any uploaded PHP files from being run.</p>\n<p>This make sure that PHP code in this folder won’t execute. So if someone still manages to upload a PHP file, for example a PHP file disguised as an image, it still won’t run.</p>\n<pre><code>php_flag engine off\n</code></pre>\n<p>Our file upload process is now secure. 🎉</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We’ve written a basic form with file input element, to handle the upload we created a PHP file that moves the uploaded image to a directory on the server. To secure the upload process, we made sure the filename is valid, the file size is not too high, and the uploaded file is actually an image.</p>\n<p>If you’re also looking to add image editing functionality to the file upload field you can use the <a href=\"https://pqina.nl/pintura/docs/v8/getting-started/installation/pintura-input/?ref=pqina\"><code>&lt;pintura-input&gt;</code></a> element. This <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura</a> powered web component automatically opens a powerful image editor when an image is added to the field and enables your users to edit images before upload.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/image-upload-with-php/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Fix HTML Video Autoplay Not Working",
    "partialText": "<p>To optimise pages on this blog I recently replaced the animated GIFs with auto-playing videos. It required a couple tries to get it right, so here’s how it works.</p>\n<p>The video below won’t autoplay.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span> <span class=\"token attr-name\">autoplay</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>video.mp4<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>video/mp4<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>video</span><span class=\"token punctuation\">></span></span></code></pre>\n<video autoplay=\"\">\n    <source src=\"https://pqina.nl/media/sample-mp4-file.mp4\" type=\"video/mp4\" />\n</video>\n<p>To fix this we add the <code>muted</code> attribute, this will disable the audio, making the video less intrusive.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span> <span class=\"token attr-name\">autoplay</span> <span class=\"token attr-name\">muted</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>video.mp4<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>video/mp4<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>video</span><span class=\"token punctuation\">></span></span></code></pre>\n<video autoplay=\"\" muted=\"\">\n    <source src=\"https://pqina.nl/media/sample-mp4-file.mp4\" type=\"video/mp4\" />\n</video>\n<p>However the video above still won’t autoplay on iOS Safari, Safari requires us to add the <code>playsinline</code> attribute.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span> <span class=\"token attr-name\">autoplay</span> <span class=\"token attr-name\">muted</span> <span class=\"token attr-name\">playsinline</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>video.mp4<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>video/mp4<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>video</span><span class=\"token punctuation\">></span></span></code></pre>\n<video autoplay=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/sample-mp4-file.mp4\" type=\"video/mp4\" />\n</video>\n<p>We can try to hack around these autoplay limitations with some JavaScript, but that will only work if the JavaScript is run as a result of a user action.</p>\n<p>The code below won’t work, it will throw a warning in the developer console.</p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>The play action below will work because the code runs as a result of a user action.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span>Play<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'video'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">play</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Press <button>Play</button> to play the first video on the page.</p>\n<script>\n    document.querySelector('button').addEventListener('click', () => {\n            document.querySelector('video').play();\n    });\n</script>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/fix-html-video-autoplay-not-working/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Convert An Image To A DataURL or Base64 String Using JavaScript",
    "partialText": "<p>In this short tutorial we explore 3 different JavaScript methods to convert an image into a Base64 string. We look at converting a File object or Blob, a canvas element, and an image tag.</p>\n<p>In all examples below we assume we already have a <code>&lt;canvas&gt;</code>, <code>&lt;img&gt;</code>, <code>File</code>, or <code>Blob</code> object available.</p>\n<p>We’ll be converting images to DataURLs, we can use the function below to convert a DataURL to a Base64 string.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getBase64StringFromDataURL</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">dataURL</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    dataURL<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data:'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^.+,</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Let’s get started.</p>\n<h2 id=\"image-is-a-file-object-or-blob\">Image is a File object or Blob</h2>\n<p>When the image is a <code>File</code> object or <code>Blob</code> we can use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileReader\"><code>FileReader</code></a> API please see this article on <a href=\"https://pqina.nl/blog/convert-a-file-to-a-base64-string-with-javascript/\">converting a file to base64 string or dataURL</a>.</p>\n<p>We’ll also use the FileReader API when <a href=\"https://pqina.nl/blog/convert-an-image-to-a-base64-string-with-javascript/#fetching-the-image-source\">converting an image tag to a Base64 string</a>.</p>\n<h2 id=\"image-is-a-canvas-element\">Image is a Canvas element</h2>\n<p>If we have a <code>&lt;canvas&gt;</code> that we want to turn into a Base64 string we can use <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL\"><code>toDataURL</code></a> on the Canvas element.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>150<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-canvas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my-canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Convert canvas to dataURL and log to console</span>\n    <span class=\"token keyword\">const</span> dataURL <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dataURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Logs data:image/png;base64,wL2dvYWwgbW9yZ...</span>\n\n    <span class=\"token comment\">// Convert to Base64 string</span>\n    <span class=\"token keyword\">const</span> base64 <span class=\"token operator\">=</span> <span class=\"token function\">getBase64StringFromDataURL</span><span class=\"token punctuation\">(</span>dataURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Logs wL2dvYWwgbW9yZ...</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>By default the canvas outputs to a lossless PNG, we can pass <code>'image/png'</code>, <code>'image/jpeg'</code> or <code>'image/webp'</code> to the <code>toDataURL</code> method to get a different format.</p>\n<p>When using <code>'image/jpeg'</code> or <code>'image/webp'</code> we can pass the image compression as the last argument, <code>0</code> means a lot of compression, <code>1</code> means no compression.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>300<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>150<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-canvas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my-canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Convert canvas to dataURL and log to console</span>\n    <span class=\"token keyword\">const</span> dataURL <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image/jpeg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dataURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Logs data:image/jpeg;base64,wL2dvYWwgbW9yZ...</span>\n\n    <span class=\"token comment\">// Convert to Base64 string</span>\n    <span class=\"token keyword\">const</span> base64 <span class=\"token operator\">=</span> <span class=\"token function\">getBase64StringFromDataURL</span><span class=\"token punctuation\">(</span>dataURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Logs wL2dvYWwgbW9yZ...</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"image-is-an-img-element\">Image is an img element</h2>\n<p>If our image is an <code>&lt;img&gt;</code> element we can <code>fetch</code> the image src and convert that to a Base64 string.</p>\n<p>Alternatively we can draw the image to a canvas and then convert the canvas to an image element, this would be useful if we’re looking for a specific image format.</p>\n<p>If the image is located on a remote server the CORS configuration of the remote server must allow our local script to access the image.</p>\n<div aria-hidden=\"true\" class=\"promoted-product-banner\">\n<p>Quick shoutout to some products I built that might be helpful to you.</p>\n<ul>\n<li class=\"product-item\">\n  <span class=\"logo-pintura\"></span>\n  <p class=\"implicit\">Pintura</p>\n  <p class=\"product-description\">\n    A JavaScript Image Editor that integrates with every stack.\n  </p>\n  <a href=\"https://pqina.nl/pintura/?ref=pqina-article\" target=\"_blank\">Get started with Pintura</a>\n</li>\n<li class=\"product-item\">\n  <span class=\"logo-filepond\"></span>\n  <p class=\"implicit\">FilePond</p>\n  <p class=\"product-description\">\n    A free JavaScript File Manager that uploads anything you throw at it.\n  </p>\n  <a href=\"https://pqina.nl/filepond/?ref=pqina-article\" target=\"_blank\">Get started with FilePond</a>\n</li>\n</ul>\n<p>Let's get back to our adventure!</p>\n</div>\n<h3 id=\"fetching-the-image-source\">Fetching the image source</h3>\n<p>Note that the MIME type returned by remote server in the <code>Content-Type</code> response header is reflected in the DataURL.</p>\n<p>If the MIME type is incorrect the DataURL will be incorrect as well.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-image.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-image<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my-image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get the remote image as a Blob with the fetch API</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">blob</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Read the Blob as DataURL using the FileReader API</span>\n            <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onloadend</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reader<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// Logs data:image/jpeg;base64,wL2dvYWwgbW9yZ...</span>\n\n                <span class=\"token comment\">// Convert to Base64 string</span>\n                <span class=\"token keyword\">const</span> base64 <span class=\"token operator\">=</span> <span class=\"token function\">getBase64StringFromDataURL</span><span class=\"token punctuation\">(</span>reader<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token comment\">// Logs wL2dvYWwgbW9yZ...</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<h3 id=\"drawing-the-image-to-a-canvas\">Drawing the image to a canvas</h3>\n<p>Drawing the image to a canvas first allows us to convert it to a different format.</p>\n<p>Please note that this approach is slower than simply fetching the image <code>src</code> as shown in the previous example.</p>\n<p>An additional caveat is that the canvas element has a maximum size, for some browsers <a href=\"https://pqina.nl/blog/canvas-area-exceeds-the-maximum-limit/\">this size limit is very low</a> causing problems when converting the image.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-image.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-image<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my-image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">toDataURL</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We use naturalWidth and naturalHeight to get the real image size vs the size at which the image is shown on the page</span>\n        canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">;</span>\n        canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// We get the 2d drawing context and draw the image in the top left</span>\n        canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Convert canvas to DataURL and log to console</span>\n        <span class=\"token keyword\">const</span> dataURL <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>dataURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// logs data:image/png;base64,wL2dvYWwgbW9yZ...</span>\n\n        <span class=\"token comment\">// Convert to Base64 string</span>\n        <span class=\"token keyword\">const</span> base64 <span class=\"token operator\">=</span> <span class=\"token function\">getBase64StringFromDataURL</span><span class=\"token punctuation\">(</span>dataURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>base64<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Logs wL2dvYWwgbW9yZ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If the image has already loaded, let's go!</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>complete<span class=\"token punctuation\">)</span> <span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Wait for the image to load before converting</span>\n    <span class=\"token keyword\">else</span> image<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> toDataURL<span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"wrapping-up\">Wrapping up</h2>\n<p>We converted a <code>File</code>, <code>Blob</code>, <code>&lt;canvas&gt;</code>, and <code>&lt;img&gt;</code> to DataURLs and we looked at how to convert a DataURL to a Base64 string. By looking at different methods to convert images to Base64 strings we now know the pros and cons of each approach.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/convert-an-image-to-a-base64-string-with-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Fix Google Search Console Mobile Usability Issues With A CSS Snippet",
    "partialText": "<p>Every other week Google Search Console will send me an email reporting <strong>Mobile Usability issues</strong> on this blog. I’ll log in, click “Validate Fix”, and find that everything is just peachy. What’s going on? More importantly, how do we fix this?</p>\n<p>Usually Google Search Console reports one or all of the following issues:</p>\n<ul>\n<li>Clickable elements too close together</li>\n<li>Text too small to read</li>\n<li>Content wider than screen</li>\n</ul>\n<p>The pages it finds these issues on are seemingly random.</p>\n<h2 id=\"what%E2%80%99s-causing-this%3F\">What’s causing this?</h2>\n<p>The origin of the issue is two-fold:</p>\n<ol>\n<li>Sometimes the Googlebot is in a hurry and will not fetch all page resources when it loads your page for indexing.</li>\n<li>One or several HTML elements on the page are wider than the mobile viewport but only so when your CSS fails to load.</li>\n</ol>\n<p>Things go haywire when Googlebot skips your CSS file on a page where some content forces the viewport to scale or scroll if it doesn’t receive a CSS style.</p>\n<p>This could for example be an <code>&lt;img&gt;</code> or <code>&lt;video&gt;</code> tag without a <code>width</code> attribute, or a code snippet with long lines in a <code>&lt;pre&gt;</code> (as seen in the image below).</p>\n<img style=\"max-width:14rem\" src=\"https://pqina.nl/media/phone-overflow-m.png\" alt=\"a code snippet with long lines forces the website to be way too wide\" />\n<p>Another culprit can be the content itself. Super long German words like <a href=\"https://en.wiktionary.org/wiki/Rechtsschutzversicherungsgesellschaften\"><em>Rechtsschutzversicherungsgesellschaften</em></a> won’t automagically wrap to the next line.</p>\n<h2 id=\"how-to-fix-it%3F\">How to fix it?</h2>\n<p>We can press “Validate Fix” and that’ll fix it the day after, but that gets old fast. Instead we need a more permanent solution.</p>\n<p>The fix is a small set of CSS styles. We can add the following code snippet to the <code>&lt;head&gt;</code> of the page.</p>\n<p>Preferably right before the <code>&lt;link&gt;</code> element that references our stylesheet.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token selector\">:where(body, iframe, pre, img, svg, video, canvas, select)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">max-width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">word-break</span><span class=\"token punctuation\">:</span> break-word<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>This snippet makes sure that when Googlebot ignores your page resources, it at least applies these styles to the elements in the <code>:where()</code> selector list.</p>\n<ul>\n<li><code>max-width: 100%</code> prevents the elements from being wider than the viewport.</li>\n<li><code>overflow: auto</code> makes sure that content inside an element won’t push an element over its width limit.</li>\n<li><code>word-break: break-word</code> makes sure long words are wrapped to the next line when they extend beyond the viewport width.</li>\n</ul>\n<p>We use the <code>:where()</code> selector so the styles are applied with <code>0</code> specificity. This means that we will be able to overwrite these styles in our stylesheet without having to make our selectors extra specific.</p>\n<p>After copying the snippet to your page, ask Google Search Console, for one final time, to “Validate The Fix”, the issues should go away over the next few days and will only return if you make an actual mistake in your stylesheet.</p>\n<p><img src=\"https://pqina.nl/media/mobile-usability-issues-gone.png\" alt=\"Google Search Console Mobile Usability issues dissapear after applying fix\" /></p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>Instead of gambling on the Googlebot we took matters into our own hands and secured our HTML elements against breaking the site by applying a tiny set of base styles.</p>\n<p>While this will make Googlebot happy it will also one day make one of your visitors happy when inevitably your stylesheet fails due to unforeseen consequences or the universe aligning in a weird way.</p>\n<p>Instead of rolling with our eyes we can now trust something is wrong when Google Search Console sends us a Mobile Usability issue report.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/fix-google-mobile-usability-issues/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Generate Social Image Covers With Eleventy And Node-Canvas",
    "partialText": "<p>This static blog is generated with <a href=\"https://www.11ty.dev/\">Eleventy</a> and all its social images are automatically generated with <a href=\"https://github.com/Automattic/node-canvas\">node-canvas</a>. In this tutorial we’ll set up a basic version of this script so you can use it on your blog as well.</p>\n<p>For this tutorial we assume you already have an Eleventy site that you want to add social images to.</p>\n<p>If you need to set up a new site you can follow the <a href=\"https://www.11ty.dev/docs/getting-started/\">Eleventy getting started guide</a> to set up your site.</p>\n<p>If you’re in a hurry and just want to copy paste the code, <a href=\"https://pqina.nl/blog/generate-social-image-covers-with-eleventy-and-node-canvas/#conclusion\">skip to the conclusion</a></p>\n<h2 id=\"installing-node-canvas\">Installing Node-Canvas</h2>\n<p><code>node-canvas</code> is an HTML Canvas implementation in Node. It allows us to draw to a canvas in Node just as we would in the browser, this makes it super easy to get started with.</p>\n<p>Note that we use <code>canvas</code> instead of <code>node-canvas</code> to install the package.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> canvas</code></pre>\n<p>We’ll leave our canvas in the oven while we work on preparing the Eleventy script.</p>\n<h2 id=\"configuring-the-eleventy-script\">Configuring the Eleventy Script</h2>\n<p>We’re going to edit the <code>.eleventy.js</code> file. It’s the file that we use to configure our Eleventy site. If this file doesn’t exist in your project, create it and paste the contents below.</p>\n<p>Please note that this tutorial assumes your site articles are located in the <code>src</code> directory and the output location is the <code>dist</code> directory. If your articles are in a different directory the code will still work but you might have to adjust some paths.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// .eleventy.js</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">eleventyConfig</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">dir</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">input</span><span class=\"token operator\">:</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Run <code>npx @11ty/eleventy</code> to test if the pages are generated in the <code>dist</code> folder.</p>\n<p>We insert the <code>addTransform</code> hook to intercept the moment Eleventy generates an article so we can create our social image at the same time.</p>\n<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">eleventyConfig</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    eleventyConfig<span class=\"token punctuation\">.</span><span class=\"token function\">addTransform</span><span class=\"token punctuation\">(</span><span class=\"token string\">'social-image'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">content</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// this will run each time a file is handled by Eleventy</span>\n        <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">dir</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">input</span><span class=\"token operator\">:</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>We’re only interested in articles, so let’s filter out any other files.</p>\n<p><code>this.inputPath</code> contains the location of the input file. We check if it ends with <code>.md</code> (for Markdown) and else we exit by returning the article contents.</p>\n<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">eleventyConfig</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    eleventyConfig<span class=\"token punctuation\">.</span><span class=\"token function\">addTransform</span><span class=\"token punctuation\">(</span><span class=\"token string\">'social-image'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">content</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// only handle blog posts</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputPath<span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.md'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// do something with the article</span>\n\n        <span class=\"token comment\">// return normal content</span>\n        <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">dir</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">input</span><span class=\"token operator\">:</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>It’s time to add the function that will generate the social image for our article.</p>\n<p>We create the <code>createSocialImageForArticle</code> function that returns a <code>Promise</code>. It receives the location of the <code>input</code> article and the location of the <code>output</code> social image.</p>\n<p>In the example below we use the same name as the input article but replace the extension with <code>.jpeg</code>.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSocialImageForArticle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">,</span> output</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// this is where we'll generate the social image</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">eleventyConfig</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    eleventyConfig<span class=\"token punctuation\">.</span><span class=\"token function\">addTransform</span><span class=\"token punctuation\">(</span><span class=\"token string\">'social-image'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">content</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// only handle blog posts</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputPath<span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.md'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">await</span> <span class=\"token function\">createSocialImageForArticle</span><span class=\"token punctuation\">(</span>\n                <span class=\"token comment\">// our input article</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputPath<span class=\"token punctuation\">,</span>\n\n                <span class=\"token comment\">// the output image name</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>outputPath<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.html'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.jpeg'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// return normal content</span>\n        <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">dir</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">input</span><span class=\"token operator\">:</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>We’ve filtered out non-articles and have set up a function to draw our canvas and output the matching social image, let’s move on to implementing the function.</p>\n<h2 id=\"drawing-the-social-image-with-node-canvas\">Drawing the Social Image with Node-Canvas</h2>\n<p>We’re now ready to draw the social image cover.</p>\n<p>In the code examples below we’ll only focus on the <code>createSocialImageForArticle</code> function, we won’t touch any other code so the rest of the code is hidden.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSocialImageForArticle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">,</span> output</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// this is where we'll generate the social image</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>First we need to load the node modules we’re going to use.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// for handling files</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// for managing path information</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// for creating the canvas</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// our good old function</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSocialImageForArticle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">,</span> output</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// this is where we'll generate the social image</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>For this part we’ll assume the title of the article is defined in the Front Matter of the file.</p>\n<pre><code>---\ntitle: My article title\n---\n</code></pre>\n<p>Our goal is to draw the title of the article on the cover image. To do that we’ll have to read out the file data and “parse” the YAML Front Matter.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSocialImageForArticle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">,</span> output</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// read data from input file</span>\n        <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// get title from file data</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">title:(.*)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// `title` contains the article title</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Alright, we’re ready to start drawing. Let’s create a canvas with a white background and draw our article title to it in black.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSocialImageForArticle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">,</span> output</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// read data from input file</span>\n        <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// get title from file data</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">title:(.*)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// draw cover image</span>\n        <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'black'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">'64px sans-serif'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>If you’ve worked with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API\">Canvas API</a> before this is all very familiar.</p>\n<p>Now for the final act, saving the canvas data to disk.</p>\n<p>We’re writing our image before Eleventy writes the article HTML file so we need to make sure the article directory already exists.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSocialImageForArticle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">,</span> output</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// read data from input file</span>\n        <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// get title from file data</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">title:(.*)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// draw cover image</span>\n        <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'black'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">'64px sans-serif'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// test if the output directory already exists, if not, create</span>\n        <span class=\"token keyword\">const</span> outputDir <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>outputDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirSync</span><span class=\"token punctuation\">(</span>outputDir<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">recursive</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// write the output image</span>\n        <span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        stream<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finish'</span><span class=\"token punctuation\">,</span> resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        stream<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        canvas\n            <span class=\"token punctuation\">.</span><span class=\"token function\">createJPEGStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">quailty</span><span class=\"token operator\">:</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>We’re done. If we now run <code>npx @11ty/eleventy</code> we should see a JPEG pop up next to our article HTML file.</p>\n<p>We can now reference the image in a open graph meta tag like so.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span>\n    <span class=\"token attr-name\">property</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>og:image<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://site.domain/article-path/index.jpeg<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">/></span></span></code></pre>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>Using two amazing open source tools we’ve quickly set up flexible and automated generation of social images.</p>\n<p>The <code>node-canvas</code> API allows us to easily finetune our graphics. It exports useful helper methods like <code>loadImage</code> to quickly load and draw images on top of your canvas, and <code>registerFont</code> to facilitate loading and using locally hosted fonts.</p>\n<p>Inspect the finished script below, it’s ready for some serious copy paste action.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// .eleventy.js</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> createCanvas <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createSocialImageForArticle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">input<span class=\"token punctuation\">,</span> output</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// read data from input file</span>\n        <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">encoding</span><span class=\"token operator\">:</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// get title from file data</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">title:(.*)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// draw cover image</span>\n        <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token number\">512</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'white'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'black'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">'64px sans-serif'</span><span class=\"token punctuation\">;</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// test if the output directory already exists, if not, create</span>\n        <span class=\"token keyword\">const</span> outputDir <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">dirname</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>outputDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirSync</span><span class=\"token punctuation\">(</span>outputDir<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">recursive</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// write the output image</span>\n        <span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        stream<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finish'</span><span class=\"token punctuation\">,</span> resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        stream<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        canvas\n            <span class=\"token punctuation\">.</span><span class=\"token function\">createJPEGStream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">quailty</span><span class=\"token operator\">:</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">eleventyConfig</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    eleventyConfig<span class=\"token punctuation\">.</span><span class=\"token function\">addTransform</span><span class=\"token punctuation\">(</span><span class=\"token string\">'social-image'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">content</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// only handle blog posts</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputPath<span class=\"token punctuation\">.</span><span class=\"token function\">endsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.md'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">await</span> <span class=\"token function\">createSocialImageForArticle</span><span class=\"token punctuation\">(</span>\n                <span class=\"token comment\">// our input article</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputPath<span class=\"token punctuation\">,</span>\n\n                <span class=\"token comment\">// the output image name</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>outputPath<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.html'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.jpeg'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// return normal content</span>\n        <span class=\"token keyword\">return</span> content<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">dir</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">input</span><span class=\"token operator\">:</span> <span class=\"token string\">'src'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token string\">'dist'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/generate-social-image-covers-with-eleventy-and-node-canvas/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Crop Images Before Upload With JavaScript",
    "partialText": "<p>In this 3 minute tutorial we use CropGuide, a JavaScript image cropper, to <strong>crop images before they’re uploaded to our server</strong> without making any changes to existing file upload code.</p>\n<p>For this tutorial we’ll assume that a form with a file upload field has already been set up.</p>\n<p>Our goal is to add image editing to this field without having to modify any existing code.</p>\n<h2 id=\"why-help-your-users-crop-images%3F\">Why help your users Crop Images?</h2>\n<ul>\n<li><strong>To speed up the image upload.</strong> A lower image size results in faster uploads, improved upload stability, and less disk usage;</li>\n<li><strong>To receive better user generated content.</strong> With some guidance users can crop the important parts of an image;</li>\n<li><strong>To lower image upload friction.</strong> Users aren’t designers. If an image isn’t in our desired aspect ratio or bigger than the maximum file size they won’t always know how to fix that;</li>\n</ul>\n<p>When we optimise images before uploading, we not only get better images, we also get more images because there’s less users that will exit our form out of frustration.</p>\n<h2 id=\"using-cropguide-to-crop-images\">Using CropGuide to Crop Images</h2>\n<p>In this tutorial we’ll use <a href=\"https://crop.guide/?ref=pqina\">CropGuide</a> as our JavaScript image cropping solution.</p>\n<p>CropGuide helps with:</p>\n<ul>\n<li>Enforcing a crop aspect ratio;</li>\n<li>Requiring a minimum image size;</li>\n<li>Automatically scale images to a maximum size;</li>\n<li>Compressing images or converting image formats;</li>\n<li>Fixing image orientation issues;</li>\n</ul>\n<p>Installation only takes a couple minutes and requires two steps:</p>\n<ol>\n<li>\n<p><a href=\"https://app.crop.guide/Account/Register\">We create a CropGuide account</a></p>\n</li>\n<li>\n<p>We add the CropGuide <code>&lt;script&gt;</code> to our webpage</p>\n</li>\n<li>\n<p>Done!</p>\n</li>\n</ol>\n<p>CropGuide now automatically intercepts each file upload and offers an image editor to the user. We can set our image requirements in the CropGuide dashboard.</p>\n<p><em><strong>Important:</strong> Images aren’t uploaded to CropGuide, image editing happens in the browser which is great for privacy and performance.</em></p>\n<p>This is what our code looks like.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- The existing file input somewhere in our form --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token comment\">&lt;!-- The script tag we just added to our page --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">defer</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdn.crop.guide/loader/l.js?c=123ABC<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Try out the image editor by selecting an image below. Images are edited in the browser, nothing is uploaded.</p>\n<div class=\"demo\">\n<input type=\"file\" />\n<script defer=\"\" src=\"https://cdn.crop.guide/loader/l.js?c=HUYVQP\"></script>\n</div>\n<p>While this is a very basic file input, CropGuide works just as well with advanced JavaScript file upload libraries.</p>\n<h2 id=\"nocode-image-cropping\">NoCode Image Cropping</h2>\n<p>CropGuide can be installed and configured without any code changes, making it perfect for use with NoCode services.</p>\n<p>It has been tested with popular tools like Bubble, Shopify, Webflow, Weebly, Squarespace, and Carrd. <a href=\"https://crop.guide/integrations/?ref=pqina\">It just works</a> ™</p>\n<p>It’s also suitable for products like WordPress. <a href=\"https://crop.guide/integrations/wordpress/?ref=pqina\">Follow this WordPress tutorial</a> on how to add the CropGuide script tag and get image editing on your WordPress form.</p>\n<p><strong>If a user can upload an image on your website, you can use CropGuide to offer image cropping.</strong></p>\n<h2 id=\"wrapping-up\">Wrapping up</h2>\n<p>We’ve added image cropping to our website by inserting a single script tag on our webpage. There was no need to edit any server logic, or adjust any JavaScript, saving us lots of time.</p>\n<p>Our users can now more easily upload images, resulting in higher quality images and more images uploaded. We save time correcting image problems on the server and helping users prepare their images.</p>\n<p>If you’re looking for a more tightly integrated image editor solution with a bigger featureset then <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura</a> is be a great fit.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/crop-image-before-upload-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Total Canvas Memory Use Exceeds The Maximum Limit",
    "partialText": "<p>You’re using the HTML Canvas Element in your new web app and decide to quickly test on iOS Safari. Suddenly your canvas isn’t drawn and the console shows a yellow warning “Total canvas memory use exceeds the maximum limit”. What gives?</p>\n<p>While you were busy building, Safari was busy stuffing itself.</p>\n<p>Safari has a thing for hoarding <code>&lt;canvas&gt;</code> elements. When you’re done with a canvas, Safari will hold on to it for a while, even if you’re not referencing it.</p>\n<p>It has a cute little showcase where it presents all the canvas elements it’s currently holding on to.</p>\n<p><img src=\"https://pqina.nl/media/safari-canvas-memory.jpeg\" alt=\"A grid layout showing canvas contents previews, canvas sizes, and the memory size of each canvas\" /></p>\n<p>That’s. Just. Great.</p>\n<p>Safari on iOS has the same hobby. It desperatly wants to keep up with its big brother on MacOs but it just doesn’t have the same storage capacity.</p>\n<p>Once the storage box is full, it’ll throw this message and start drawing transparent canvas elements.</p>\n<p><img src=\"https://pqina.nl/media/safari-canvas-memory-exceeds.png\" alt=\"Total canvas memory use exceeds the maximum limit\" /></p>\n<p>So how do we deal with this?</p>\n<p>We’re going to have to help out Safari to clean up its mess. Get rid of the things it can’t or won’t throw away.</p>\n<p>When we’re done with a <code>&lt;canvas&gt;</code> element we have to manually “release” it.</p>\n<p>Meaning we resize the canvas to a very small size and clear its contents, this tricks Safari in to replacing the canvas in its storage with our compressed version.</p>\n<p>The following function will do just that.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">releaseCanvas</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">canvas</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx <span class=\"token operator\">&amp;&amp;</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Safari will still hold on to the <code>&lt;canvas&gt;</code> for a while, but at least now it won’t blow the roof of its storage depot.</p>\n<p>Unfortunately the memory limit on iOS Safari is rather low. It’s limited to 384MB on version 15, it’s lower on earlier versions, and it’s probably device specific as well.</p>\n<p>A canvas pixel is made up of 4 values, red, green, blue, and an alpha value. Combining this with the canvas size we can calculate the amount of memory a canvas requires.</p>\n<p>4096 × 4096 × 4 = 67108864 Bytes = 64 Megabytes</p>\n<p><a href=\"https://pqina.nl/blog/canvas-area-exceeds-the-maximum-limit/\">This is also the max size of a canvas on Safari</a></p>\n<p>Let’s exceed the 384MB limit by creating 8 of these canvas elements.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">4096</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">4096</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx <span class=\"token operator\">&amp;&amp;</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>If the maximum limit was exceeded earlier the <code>getContext('2d')</code> method will return <code>null</code> so that’s why we check if the <code>ctx</code> variable is set before calling <code>fillRect</code></p>\n<p>When we add the <code>releaseCanvas</code> function we force Safari to free up some memory and the warning goes away.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">4096</span><span class=\"token punctuation\">;</span>\n    canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">4096</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx <span class=\"token operator\">&amp;&amp;</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Force release each canvas</span>\n    <span class=\"token function\">releaseCanvas</span><span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>What we should keep in mind is that Safari either:</p>\n<ul>\n<li>caches canvas elements across sessions</li>\n<li>or doesn’t recalculate the free memory correctly on page refresh</li>\n</ul>\n<p>So a page refresh might not clean up the error immediately, it might still show and only dissapear after multiple refreshes or clearing the cache.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/total-canvas-memory-use-exceeds-the-maximum-limit/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Canvas Area Exceeds The Maximum Limit",
    "partialText": "<p>If there’s one thing I’m sure of it’s that Safari and the HTML canvas element aren’t sitting in a tree together. It’s 2022 and Safari still can’t handle canvas elements having more than 16777216 pixels.</p>\n<p>Safari simply cannot draw large canvas elements. The limit is set at 16.777.216 pixels. Create a canvas with more pixels and iOS Safari will tell us it exceeds the memory limit.</p>\n<p>When we open this page on iOS Safari, it’ll show the following warning in the developer console.</p>\n<p><img src=\"https://pqina.nl/media/safari-canvas-area-warning.png\" alt=\"Canvas area exceeds the maximum limit (width * height &gt; 16777216).\" /></p>\n<p>That’s because the page creates a canvas that is 4097 × 4096 pixels in size and tries to use its 2d context.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">4097</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">4096</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<script>\nconst canvas = document.createElement('canvas');\ncanvas.width = 4097;\ncanvas.height = 4096;\n\nconst ctx = canvas.getContext('2d');\nctx.fillRect(0, 0, 100, 100);\n</script>\n<p>All is fine until we want to fill our rectangle. That’s where Safari draws a line in the sand.</p>\n<p>As we can see it doesn’t matter if we only use part of the canvas. The moment we try to interact with the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D\">canvas rendering context</a> Safari warns the canvas is too big.</p>\n<p>Well at least on MacOS Safari we don’t get the memory limit warning.</p>\n<p>Problem is, if we want to get the <code>ImageData</code> in the canvas, MacOS Safari will invalidate the canvas element if the requested data amount exceeds the maximum size.</p>\n<pre class=\"language-js\"><code class=\"language-js\">ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getImageData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4097</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4096</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>If you’re on Safari, click below to run the above code.</p>\n<div class=\"demo\">\n<button onclick=\"getTheImageData()\">Throw error on Safari for Mac</button>\n</div>\n<script>\nfunction getTheImageData()  {\n    ctx.getImageData(0, 0, 4097, 4096);\n}\n</script>\n<p>Say hello to these errors in your developer console.</p>\n<p><img src=\"https://pqina.nl/media/safari-canvas-invalid-state-error.png\" alt=\"Unable to get image data from canvas. Requested size was 4097 x 4096. InvalidStateError: The object is in an invalid state.\" /></p>\n<p>So how to deal with this limitation.</p>\n<p>We can create canvas elements that exceed 4096 pixels in width or height as long as the total amount of pixels is below 16777216.</p>\n<p>This will work:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">5120</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">3072</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>To make it easier to stay below the limit we can use the following function. It returns a relatively scaled <code>size</code> below the <code>maximumPixels</code> passed.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">limitSize</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">size<span class=\"token punctuation\">,</span> maximumPixels</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> width<span class=\"token punctuation\">,</span> height <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> size<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> requiredPixels <span class=\"token operator\">=</span> width <span class=\"token operator\">*</span> height<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>requiredPixels <span class=\"token operator\">&lt;=</span> maximumPixels<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> width<span class=\"token punctuation\">,</span> height <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> scalar <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>maximumPixels<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>requiredPixels<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>width <span class=\"token operator\">*</span> scalar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>height <span class=\"token operator\">*</span> scalar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Conclusion, when we’re dealing with Safari, we should always make sure to limit the size of our canvas elements before drawing to it. Other browsers have limits at a much higher level that we’re unlikely to exceed.</p>\n<p>Our suffering doesn’t end here, the worst is yet to come.</p>\n<p>When we create too many canvas elements we’ll run into a secondary Safari issue. We’ll explore that issue in the follow up article <a href=\"https://pqina.nl/blog/total-canvas-memory-use-exceeds-the-maximum-limit/\">Total canvas memory use exceeds the maximum limit</a></p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/canvas-area-exceeds-the-maximum-limit/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Drawing Wrapped Text With The HTML Canvas Element",
    "partialText": "<p>The HTML canvas element can draw text but it cannot wrap text. Text wrapping is complicated so in this tutorial, instead of breaking text lines with JavaScript, we’ll lean on native browser tech to draw wrapped text lines.</p>\n<style>\np#exampleParagraph {\n    font-weight: normal;\n    font-family: serif;\n    font-size: 20px;\n    line-height: 32px;\n}\n\n.article .demo img,\n.article .demo svg,\n.article .demo canvas,\n.article .demo p#exampleParagraph {\n    width: 280px;\n    height: 100px;\n    background: #fff;\n    color: #000;\n}\n</style>\n<p>Let’s try to draw the paragraph below to a canvas element.</p>\n<div class=\"demo\" data-theme=\"reveal-bounds\">\n<p id=\"exampleParagraph\">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>\n</div>\n<h2 id=\"using-canvas-filltext\">Using Canvas fillText</h2>\n<p>We’ll first give <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/fillText\"><code>fillText()</code></a> a go. As the native canvas text drawing method it deserves a fair chance.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Get the 2d drawing context of our canvas</span>\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Set the font-size and font-family to mimic our paragraph</span>\nctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token string\">'20px serif'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Draw the text</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Lorem Ipsum is … typesetting industry.'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>As we can see below, the text won’t wrap.</p>\n<div class=\"demo\" data-theme=\"reveal-bounds\">\n<canvas id=\"canvasFillText\" width=\"280\" height=\"100\"></canvas>\n</div>\n<script>\n{\n    const canvas = document.getElementById('canvasFillText');\n    const ctx = canvas.getContext('2d');\n    ctx.font = '20px serif';\n    ctx.fillText('Lorem Ipsum is simply dummy text of the printing and typesetting industry.', 0, 20);\n}\n</script>\n<p>The HTML canvas API exposes some other methods to draw basic shapes and paths but those aren’t of use to us when we want to draw text.</p>\n<p>We’re left with <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage\"><code>drawImage()</code></a>. The method used to draw ImageData to a canvas element.</p>\n<p>If we can only use <code>drawImage</code> it means we have to get our text in a format that can be passed to the <code>drawImage</code> method.</p>\n<p>The method accepts:</p>\n<ul>\n<li><code>HTMLCanvasElement</code></li>\n<li><code>HTMLImageElement</code></li>\n<li><code>SVGImageElement</code></li>\n<li><code>HTMLVideoElement</code></li>\n<li><code>ImageBitmap</code></li>\n<li><code>OffscreenCanvas</code></li>\n</ul>\n<p>Let’s keep those in mind and go back to drawing wrapped text.</p>\n<h2 id=\"text-wrapping-in-a-graphic-format\">Text wrapping in a graphic format</h2>\n<p>What other ways can we use to draw wrapped text? We’ve already drawn wrapped text to the screen with our reference paragraph above, but unfortunatley we cannot pass HTML to the <code>drawImage</code> method.</p>\n<p>We can however pass an image element, so maybe we can use SVG to draw wrapped text. Let’s try it now.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>280<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2000/svg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>text</span> <span class=\"token attr-name\">x</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>20<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Lorem Ipsum is … typesetting industry.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>text</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre>\n<div class=\"demo\" data-theme=\"reveal-bounds\">\n<svg width=\"280\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\">\n    <text x=\"0\" y=\"20\" font-family=\"serif\" font-size=\"20\">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</text>\n</svg>\n</div>\n<p>Nope.</p>\n<p>The SVG <code>&lt;text&gt;</code> element seems to be related to the canvas <code>fillText</code> method.</p>\n<p>Luckily our friend <code>&lt;foreignObject&gt;</code> enables us to put HTML in SVG.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>svg</span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>280<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/2000/svg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>foreignObject</span> <span class=\"token attr-name\">x</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">y</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>280<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>100<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n            <span class=\"token selector\">p</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n                <span class=\"token property\">font-weight</span><span class=\"token punctuation\">:</span> normal<span class=\"token punctuation\">;</span>\n                <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> serif<span class=\"token punctuation\">;</span>\n                <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> 20px<span class=\"token punctuation\">;</span>\n                <span class=\"token property\">line-height</span><span class=\"token punctuation\">:</span> 32px<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- Yo! --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">xmlns</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://www.w3.org/1999/xhtml<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            Lorem Ipsum is … typesetting industry.\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>foreignObject</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>svg</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Check it out below and let’s claim this small victory!</p>\n<div class=\"demo\" data-theme=\"reveal-bounds\">\n<svg id=\"svg\" width=\"280\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\">\n    <foreignObject x=\"0\" y=\"0\" width=\"280\" height=\"100\">\n        <style>\n        p[xmlns] {\n            margin:0;\n            font-weight: normal;\n            font-family: serif;\n            font-size: 20px;\n            line-height: 32px;\n        }\n        </style>\n        <p xmlns=\"http://www.w3.org/1999/xhtml\">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>\n    </foreignObject>\n</svg>\n</div>\n<p>But just like we can’t pass our HTML paragraph to the <code>drawImage</code> method we can’t pass this SVG code to the <code>drawImage</code> method.</p>\n<p>But unlike HTML we can pass SVG to an image element and we can pass an image element to the <code>drawImage</code> method.</p>\n<p>To do that we need to convert our SVG to a dataURL.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>data:image/svg+xml,…<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<h2 id=\"loading-inline-svg-to-an-image-element\">Loading inline SVG to an image element</h2>\n<p>We’ll load the SVG from the previous example and convert it to a dataURL which we can assign to our image src attribute.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Get a reference to the svg element</span>\n<span class=\"token keyword\">const</span> svgElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'svg'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Get the SVG code in string format &lt;svg>...</span>\n<span class=\"token keyword\">const</span> svgCode <span class=\"token operator\">=</span> svgElement<span class=\"token punctuation\">.</span>outerHTML<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Remove newlines and replace double quotes with single quotes</span>\n<span class=\"token keyword\">const</span> svgCodeEncoded <span class=\"token operator\">=</span> svgCode<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\n</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\"</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Get the image element and use our svg as src</span>\n<span class=\"token keyword\">const</span> imgElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'svgImage'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nimgElement<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">data:image/svg+xml,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>svgCodeEncoded<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre>\n<p>Below we can see that the SVG is loaded in our image element.</p>\n<div class=\"demo\" data-theme=\"reveal-bounds\">\n<img src=\"https://pqina.nl/blog/wrap-text-with-html-canvas/\" width=\"280\" height=\"100\" id=\"svgImage\" />\n</div>\n<script>\n{\n    const svgElement = document.getElementById('svg'); \n\n    const svgCode = svgElement.outerHTML;\n\n    const svgCodeEncoded = svgCode.replace(/\\[xmlns\\]/,'').replace(/\\n/g,'').replace(/\"/g,\"'\");\n\n    const imgElement = document.getElementById('svgImage'); \n    imgElement.src =`data:image/svg+xml,${svgCodeEncoded}`;\n}\n</script>\n<p>Now for our final trick we have to draw the image element containing our inline SVG to our canvas element. We’re now three layers deep, let’s not stay too long as time flows slow down here.</p>\n<h2 id=\"drawing-our-example-html-paragraph-to-a-canvas\">Drawing our example HTML paragraph to a canvas</h2>\n<p>Let’s combine all steps together.</p>\n<p>We’ll load the HTML paragraph and dynamically create an SVG that we’ll then load to a canvas.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Get a reference to the example paragraph at the start of the article</span>\n<span class=\"token keyword\">const</span> exampleParagraph <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'exampleParagraph'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Generate SVG code with JavaScript</span>\n<span class=\"token comment\">// Note that we wrap the paragraph HTML in a &lt;div></span>\n<span class=\"token keyword\">const</span> svgCode <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;svg width=\"280\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\">\n        &lt;foreignObject x=\"0\" y=\"0\" width=\"280\" height=\"100\">\n            &lt;style>\n            p {\n                margin:0;\n                font-weight: normal;\n                font-family: serif;\n                font-size: 20px;\n                line-height: 32px;\n            }\n            &lt;/style>\n            &lt;div xmlns=\"http://www.w3.org/1999/xhtml\">\n                </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>exampleParagraph<span class=\"token punctuation\">.</span>outerHTML<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n            &lt;/div>\n        &lt;/foreignObject>\n    &lt;/svg></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Remove newlines and replace double quotes with single quotes</span>\n<span class=\"token keyword\">const</span> svgCodeEncoded <span class=\"token operator\">=</span> svgCode<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\n</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\"</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"'\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Dynamically create an image element</span>\n<span class=\"token keyword\">const</span> img <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Wait for the image to load before drawing it to the canvas</span>\nimg<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Get the output canvas context</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvasDrawImage'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Draw the image to the canvas</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Load our SVG to the image</span>\nimg<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">data:image/svg+xml,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>svgCodeEncoded<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre>\n<script>\n{\n    // Get a reference to the svg element\n    const exampleParagraph = document.getElementById(\"exampleParagraph\");\n\n    // Generate SVG code\n    const svgCode = `<svg width=\"280\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\"><foreignObject x=\"0\" y=\"0\" width=\"280\" height=\"100\"><style>p {margin:0;font-weight: normal;font-family: serif;font-size: 20px;line-height: 32px;}</style&gt;<div xmlns=\"http://www.w3.org/1999/xhtml\">${exampleParagraph.outerHTML}</div></foreignObject></svg>`;\n\n    // Remove newlines and replace double quotes with single quotes\n    const svgCodeEncoded = \n        // only needed for this article\n        svgCode.replace(/\\[xmlns\\]/,'').replace(/&gt;/,'>')\n        // same as code example\n        .replace(/\\n/g, \"\").replace(/\"/g, \"'\");\n\n    // Dynamically create an image element and load our SVG to it\n    const img = document.createElement(\"img\");\n    img.onload = () => {\n        const canvas = document.getElementById('canvasDrawImage');\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0);\n    }\n    img.src = `data:image/svg+xml,${svgCodeEncoded}`;\n\n}\n</script>\n<p>And there we go!</p>\n<div class=\"demo\" data-theme=\"reveal-bounds\">\n<canvas id=\"canvasDrawImage\" width=\"280\" height=\"100\"></canvas>\n</div>\n<p>The result might appear a bit blurry on high res displays. To change that we can draw the text to a higher resolution canvas and then scale down the canvas with CSS.</p>\n<div class=\"demo\" data-theme=\"reveal-bounds\">\n<canvas id=\"canvasDrawImageHighRes\" width=\"560\" height=\"200\"></canvas>\n</div>\n<script>\n{\n    // Get a reference to the svg element\n    const exampleParagraph = document.getElementById(\"exampleParagraph\");\n\n    // Generate SVG code\n    const svgCode = `<svg width=\"560\" height=\"200\" xmlns=\"http://www.w3.org/2000/svg\"><foreignObject x=\"0\" y=\"0\" width=\"560\" height=\"200\"><style>p {margin:0;font-weight: normal;font-family: serif;font-size: 40px;line-height: 64px;}</style&gt;<div xmlns=\"http://www.w3.org/1999/xhtml\">${exampleParagraph.outerHTML}</div></foreignObject></svg>`;\n\n    // Remove newlines and replace double quotes with single quotes\n    const svgCodeEncoded = \n        // only needed for this article\n        svgCode.replace(/\\[xmlns\\]/,'').replace(/&gt;/,'>')\n        // same as code example\n        .replace(/\\n/g, \"\").replace(/\"/g, \"'\");\n\n    // Dynamically create an image element and load our SVG to it\n    const img = document.createElement(\"img\");\n    img.onload = () => {\n        const canvas = document.getElementById('canvasDrawImageHighRes');\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0);\n    }\n    img.src = `data:image/svg+xml,${svgCodeEncoded}`;\n\n}\n</script>\n<p>To use this in production you would probably rewrite this logic to a function. There are some additional caveats to keep in mind.</p>\n<ul>\n<li>In the example we’re using basic characters only, we have to correctly encode all SVG content for the DataURL to work.</li>\n<li>Any custom fonts need to be embedded in the SVG. This can be done by converting the custom font to a dataURL as well.</li>\n</ul>\n<p>When done correctly this yields a very exact rendering of text. Lines are broken were you expect them to break and the resulting code is relatively small compared to writing custom line break logic that is as precise as the browser (if that’s even possible).</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/wrap-text-with-html-canvas/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "How To Prevent Scrolling The Page On iOS Safari 15",
    "partialText": "<p>If we show a modal on iOS we need to prevent events inside the modal from interacting with the page behind the modal. On a previous episode of “Fun with Safari” we could use <code>preventDefault()</code> on the <code>&quot;touchmove&quot;</code> event but on iOS 15 that no longer works. Here we go.</p>\n<div class=\"measure\"><span></span></div>\n<p>To make this work we need iOS to think that there is nothing to scroll.</p>\n<p>But how do we do this?</p>\n<p>We set the height of both the <code>html</code> and the <code>body</code> element to the window height and then set <code>overflow</code> on these elements to <code>hidden</code> so the content gets cut off.</p>\n<div id=\"section-100px\">\nBut what does \"window height\" really mean. To explore this a measure is visible on the right side of the page. It'll scale with the height defined by the properties used in the examples on this page.\n<p>For now it’s set to <code>100px</code>.</p>\n<style>\n.measure {\n    position: fixed;\n    right: 0;\n    top: 0;\n    width: 0;\n    pointer-events:none;\n    user-select:none;\n    height: var(--measure-height, 100px);\n    z-index:2;\n    opacity: 0;\n    transition: opacity .1s ease-out;\n}\n\n.measure[data-visible='true'] {\n    opacity: 1;\n}\n\n.measure span {\n    position: absolute;\n    top: 1rem;\n    right: 1.25rem;\n    font-family: monospace;\n    word-break: normal;\n}\n\n.measure::after {\n    content: '';\n    position: absolute;\n    top: .5rem;\n    bottom: .5rem;\n    width: 2rem;\n    right: .5rem;\n    border-top: 2px dashed currentColor;\n    border-right: 2px dashed currentColor;\n    border-bottom: 2px dashed currentColor;\n}\n\n</style>\n<script>\nconst measure = document.querySelector('.measure');\nwindow.addEventListener('scroll', (e) => {\n    if (window.scrollY > 60) {\n        measure.dataset.visible = true;\n    }\n    else {\n        measure.dataset.visible = false;\n    }\n})\nconst measureHeight = document.querySelector('.measure span');\nlet height;\nsetInterval(() => {\n    const newHeight = measure.offsetHeight;\n    if (height === newHeight) return;\n    height = newHeight;\n    measureHeight.textContent = `${newHeight}px`;\n}, 250)\n\nconst updateHeight = () => {\n    document.documentElement.style.setProperty('--measure-height', `${window.innerHeight}px`);\n}\n\nconst handlers = {\n    'section-100px': {\n        on: () => {\n            document.documentElement.style.setProperty('--measure-height', '100px');\n        },\n        off: () => {\n            \n        }\n    },\n    'section-100vh': {\n        on: () => {\n            document.documentElement.style.setProperty('--measure-height', '100vh');\n        },\n        off: () => {\n            \n        }\n    },\n    'section-webkit-fill-available': {\n        on: () => {\n            document.documentElement.style.setProperty('--measure-height','-webkit-fill-available');\n        },\n        off: () => {\n            \n        }\n    },\n    'section--window-inner-height': {\n        on: () => {\n            updateHeight();\n            window.addEventListener('resize', updateHeight);\n        },\n        off: () => {\n            window.removeEventListener('resize', updateHeight);\n        }\n    }\n}\nconst handleIntersections = (entries, observer) => {\n    entries.forEach(entry => {\n        if (entry.isIntersecting) {\n            handlers[entry.target.id].on();\n        }\n        else {\n            handlers[entry.target.id].off();\n        }\n    });\n};\n\nconst observer = new IntersectionObserver(handleIntersections, {\n    rootMargin: '-50% 0% -50% 0%',\n});\n</script>\n</div>\n<script>\nobserver.observe(document.querySelector('#section-100px'));\n</script>\n<h2 id=\"a-height-of-vh\">A height of 100vh</h2>\n<div id=\"section-100vh\">\n<p>A <code>vh</code> is a viewport height unit, <code>1vh</code> means <code>1%</code> of the viewport height.</p>\n<p>Great. Let’s set the measure to <code>100vh</code> and observe what happens.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.measure</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100vh<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Nope. This is not going to work. On iOS <code>100vh</code> is always the full height of the viewport, even if the footer shows.</p>\n<p>If you’re browsing this page on iOS Safari, scroll up and down a bit to see the height stays fixed no matter of the footer is active or not.</p>\n</div>\n<script>\nobserver.observe(document.querySelector('#section-100vh'));\n</script>\n<h2 id=\"using--webkit-fill-available\">Using -webkit-fill-available</h2>\n<div id=\"section-webkit-fill-available\">\n<p>Let’s try the <code>-webkit-fill-available</code> property instead.</p>\n<p>This is a <code>-webkit-</code> thing, so if you’re on Firefox the measure will now snap to <code>0</code></p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.measure</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> -webkit-fill-available<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>This will do the trick. But it results in a modal that is not filling up all available space.</p>\n<p><code>-webkit-fill-available</code> will fill the “safe” space, so it excludes the room the footer will take up if it’s active.</p>\n<p>We want all the space.</p>\n<p>It turns out that <code>window.innerHeight</code> reflects the actual available space. So what we want is this.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.measure</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> window.innerHeight<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>But you and I both know that this won’t fly because <code>window.innerHeight</code> is a JavaScript property.</p>\n</div>\n<script>\nobserver.observe(document.querySelector('#section-webkit-fill-available'));\n</script>\n<h2 id=\"syncing-windowinnerheight\">Syncing window.innerHeight</h2>\n<div id=\"section--window-inner-height\">\n<p>Luckily we can use CSS Custom Properties to make this tick.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.measure</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Now we switch to JavaScript land where we update the custom property when the window is resized.</p>\n<p>The <code>'resize'</code> event is trigged when the iOS Safari footer changes in height, so this nicely aligns our measure with the page height.</p>\n<pre class=\"language-js\"><code class=\"language-js\">window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    measure<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">'--height'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>I know we could also “just” set <code>measure.style.height</code> but as we’re going to use Custom Properties for our modal in a minute so we might as well go the extra mile here.</p>\n<p>If you’re on iOS, see if the measure scales correctly by scrolling up and down a bit.</p>\n</div>\n<script>\nobserver.observe(document.querySelector('#section--window-inner-height'));\n</script>\n<h2 id=\"the-modal\">The modal</h2>\n<p>We’re almost out of the woods. Our measure is now be the right size no matter if the iOS Safari footer is visible or not.</p>\n<p>Now we’re going to apply this height to the <code>html</code> and <code>body</code> elements when our modal is activated. This prevents the page from scrolling.</p>\n<p>We’ll add an <code>is-locked</code> class to our html element when we show the modal.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// get reference to the modal</span>\n<span class=\"token keyword\">const</span> modal <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.modal'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">showModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// assign lock to html element</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-locked'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// open modal</span>\n    modal<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-open'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">hideModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// remove lock from html element</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-locked'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// close modal</span>\n    modal<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-open'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>When the <code>is-locked</code> class is assigned we use it to set the required styles so the page cannot be scrolled.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">html.is-locked,\nhtml.is-locked body</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* want to fix the height to the window height */</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--window-inner-height<span class=\"token punctuation\">)</span> - 1px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* want to block all overflowing content */</span>\n    <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* want to exclude padding from the height */</span>\n    <span class=\"token property\">box-sizing</span><span class=\"token punctuation\">:</span> border-box<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* very basic modal styles for brevity */</span>\n<span class=\"token selector\">.modal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> fixed<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> black<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.model.is-open</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Wait a minute, what is that <code>calc()</code> doing there?!</p>\n<p>Let me try to explain. If the iOS Safari footer is hidden when the modal opens, iOS will reveal the footer if the user makes a vertical pan gesture, the <code>1px</code> prevents this from happening.</p>\n<p>I don’t know why, I just know that I’m so tired. 🤷‍♂️</p>\n<p>Let’s just move on.</p>\n<p>Now we listen for the <code>'resize'</code> event to keep the <code>--window-inner-height</code> CSS Custom Property synced with the <code>window.innerHeight</code> in JavaScript land.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">syncHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span><span class=\"token function\">setProperty</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string\">'--window-inner-height'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>window<span class=\"token punctuation\">.</span>innerHeight<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px</span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'resize'</span><span class=\"token punctuation\">,</span> syncHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>To prevent iOS from hiding the footer when the modal is visible <em>and</em> the footer is visible we need to prevent the default action of the <code>'pointermove'</code> event.</p>\n<p><em>If we want to support iOS 14 we need to add <code>'touchmove'</code> as well.</em></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> modal <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.modal'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// helper function to run preventDefault</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">showModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-locked'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    modal<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-open'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// block pointer events</span>\n    modal<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pointermove'</span><span class=\"token punctuation\">,</span> preventDefault<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">hideModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-locked'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    modal<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-open'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// resume pointer events</span>\n    modal<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pointermove'</span><span class=\"token punctuation\">,</span> preventDefault<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>We’re nearly done. 🫠</p>\n<p>Because we’re resizing the document the user scroll position is lost when the modal opens. So we need to remember that position before it opens and restore it when the modal closes.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> scrollY<span class=\"token punctuation\">;</span> <span class=\"token comment\">// we'll store the scroll position here</span>\n\n<span class=\"token keyword\">const</span> modal <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.modal'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">showModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// remember scroll position</span>\n    scrollY <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>scrollY<span class=\"token punctuation\">;</span>\n\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-locked'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    modal<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-open'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    modal<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pointermove'</span><span class=\"token punctuation\">,</span> preventDefault<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">hideModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-locked'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    modal<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token string\">'is-open'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    modal<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pointermove'</span><span class=\"token punctuation\">,</span> preventDefault<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// restore scroll position</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">scrollTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> scrollY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>There we go! 😅</p>\n<p>Try it out on iOS Safari 15 by clicking the “Open modal” button below. It’s been tested with the address bar at the bottom of the viewport (which is the default) and at the top. We can move it to the top by tapping “aA” and then “Show Top Address Bar”.</p>\n<p>The modal is slightly transparent on purpose so we can see that the page is scrolled to the top. We can assign the <code>backdrop-filter: blur(20px)</code> style to the modal root element to make this less obvious.</p>\n<p><button data-action=\"open\">Open modal</button></p>\n<p>I sincerely hope the Apple Safari dev team will fix this mess in the next upate, but I’m not holding my breath.</p>\n<div class=\"modal\">\n<button data-action=\"close\">Close modal</button>\n</div>\n<style>\nhtml.lock,\nhtml.lock body {\n    box-sizing: border-box;\n    height: calc(var(--window-inner-height) - 1px);\n    overflow: hidden;\n}\n\n.modal {\n    display: none;\n}\n\nhtml.lock .modal {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0,0,0,.85);\n    z-index: 1;\n}\n\nhtml.lock .measure {\n    height: 100%;\n    color: #fff;\n}\n</style>\n<script>\n\n// this syncs the window height\nconst syncWindowHeight = () => {\n    document.documentElement.style.setProperty(\n        \"--window-inner-height\",\n        `${window.innerHeight}px`\n    );\n}\n\n// for iOS 15, prevents re-hiding of footer\ndocument.querySelector('.modal').addEventListener('pointermove', e => {\n    e.preventDefault()\n})\n \n// bonus for iOS 14, prevents re-hiding of footer\ndocument.querySelector('.modal').addEventListener('touchmove', e => {\n    e.preventDefault()\n})\n\n// this locks the body and remembers the scroll position\nlet scrollY;\ndocument.documentElement.addEventListener('click', (e) => {\n\n    if (e.target.dataset.action==='open') {\n        \n        syncWindowHeight();\n\n        scrollY = window.scrollY;\n        document.documentElement.classList.add('lock');\n\n        window.addEventListener(\"resize\", syncWindowHeight);\n\n    }\n    else if (e.target.dataset.action==='close') {\n\n        window.removeEventListener(\"resize\", syncWindowHeight);\n\n        document.documentElement.classList.remove('lock');\n        window.scrollTo(0, scrollY);\n    }\n})\n</script>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/how-to-prevent-scrolling-the-page-on-ios-safari/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Use The JavaScript EyeDropper API To Select Colors On The Web",
    "partialText": "<p>The EyeDropper API just landed in Chrome Canary. In this is a mini tutorial we’ll quickly look at how to use it in our web apps to select colors.</p>\n<p>Let’s get to it, the API is fairly straightforward.</p>\n<p>We create a new <code>EyeDropper</code> instance and can then ask it to open the eye dropper with the <code>open</code> method.</p>\n<p>The <code>open</code> method returns a Promise that resolves when a color is selected, it rejects if the user cancels the color selection by pressing escape.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> eyeDropper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">EyeDropper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> selectedColor <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> eyeDropper<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>selectedColor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// logs: { sRGBHex: '#ff0000' }</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'color selection cancelled'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>You can test for support of <code>EyeDropper</code> using the following snippet, if you’re browsing with a browser that supports the <code>EyeDropper</code> API a button will be rendered below the code snippet.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'EyeDropper'</span> <span class=\"token keyword\">in</span> window<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// supported</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p><button style=\"display:none;align-items:center;margin: 1em 0; \" class=\"drop\">Select a Color <span></span></button></p>\n<script>\nif (\"EyeDropper\" in window) {\n  const btn = document.querySelector('.drop');\n  btn.style.display = 'flex';\n  btn.onclick = async (e) => {\n        const eyeDropper = new EyeDropper();\n        try {\n            const selectedColor = await eyeDropper.open();\n            btn.querySelector('span').style.cssText = `display:inline-block;background-color: ${selectedColor.sRGBHex}; width: .875em;height:.875em;border:1px solid #fff;margin-left:.625em;border-radius:.25em;margin-top:.125em;margin-right:-.25em`;\n        }\n        catch(err) {\n            btn.querySelector('span').style.cssText = '';\n        }\n  }\n}\n</script>\n<p>There we go! Fingers crossed we can start using this in the near future.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/use-the-javascript-eye-dropper-api-to-select-colors-on-the-web/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Styling Password Fields To Get Better Dots",
    "partialText": "<p>Make the dots in a password field bigger with this basic CSS style. It’ll make it easier to see the number of dots in the field, helping both yourself and the visually impaired.</p>\n<p><img src=\"https://pqina.nl/media/social-password.jpeg\" alt=\"\" /></p>\n<p>Depending the font used the dots in the password field look like this. The <code>font-family</code> on the field below is set to <code>sans-serif</code></p>\n<input type=\"password\" value=\"12345678\" style=\"font-family: sans-serif; background-color:white; color: black; border:1px solid #ddd; font-size: 1rem; width: 120px; margin: 1rem 0;  padding: .5rem .75rem;\" />\n<p>We can use the <code>Verdana</code> font to scale the dots to a more comfortable size.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">input[type='password']</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> Verdana<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<input type=\"password\" value=\"12345678\" style=\"font-family: Verdana; background-color:white; color: black; border:1px solid #ddd; font-size: 1rem; width: 120px; margin: 1rem 0;  padding: .5rem .75rem;\" />\n<p>That’s better already, now let’s separate the individual dots.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">input[type='password']</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> Verdana<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">letter-spacing</span><span class=\"token punctuation\">:</span> 0.125em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<input type=\"password\" value=\"12345678\" style=\"font-family: Verdana; letter-spacing: .125em; background-color:white; color: black; border:1px solid #ddd; font-size: 1rem; width: 120px; margin: 1rem 0; padding: .5rem .75rem;\" />\n<p>Much better. It’s now a lot easier to see the individual dots, and the dots nicely take up space in the field.</p>\n<p>This works on Mac Firefox / Mac Chrome / Mac Safari / Win Chrome (+Edge). Android doesn’t have Verdana so shows dots that are a bit smaller.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/styling-password-field-dots/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Create A Fade Out Overflow Effect Using CSS Mask-Image",
    "partialText": "<p>Learn how to create an overflow fade out effect using CSS <code>mask-image</code>. This helps indicate to the user that there’s more content to be seen. Masking is very useful when overflowing content that’s placed over an image or a non-uniform background.</p>\n<p>Let’s take a look at the example below. When scrolling the custom scrollbar we can see that the content area overlows and the content is faded out.</p>\n<style>\n.demo {\n\t/* margin: 2rem 0 !important; */\n\tpadding: 2rem;\n  background-color: #222;\n\tcolor: #eee;\n\tbackground-image: url(\"/media/brian-patrick-tagalog.jpeg\");\n\tbackground-size: cover;\n}\n\n.demo .h1,\n.demo .h2 {\n\tdisplay: block;\n\tmargin: 1rem 0;\n}\n\n.demo .h1 {\n\tfont-weight: bold;\n\tfont-size: 2rem;\n}\n\n.demo .h2 {\n\tfont-size: 1.5rem;\n}\n\n.demo img {\n\tfilter: grayscale(70%) contrast(1.5);\n\tborder: 5px solid #fff;\n}\n\n.demo .scroller {\n\t\n\t/* scroll bar width, for use in mask calculations */\n  --scrollbar-width: 8px;\n\n  /* mask fade distance, for use in mask calculations */\n  --mask-height: 32px;\n\n  /* If contet exceeds height of container, overflow! */\n  overflow-y: auto;\n\n  /* Our height limit */\n  height: 264px;\n\n  /* Need to make sure container has bottom space,\n  otherwise content at the bottom is always faded out */\n  padding-bottom: var(--mask-height);\n\n  /* Keep some space between content and scrollbar */\n  padding-right: 20px;\n\n  /* The CSS mask */\n\n  /* The content mask is a linear gradient from top to bottom */\n  --mask-image-content: linear-gradient(\n    to bottom,\n    transparent,\n    black var(--mask-height),\n    black calc(100% - var(--mask-height)),\n    transparent\n  );\n\n  /* Here we scale the content gradient to the width of the container \n  minus the scrollbar width. The height is the full container height */\n  --mask-size-content: calc(100% - var(--scrollbar-width)) 100%;\n\n  /* The scrollbar mask is a black pixel */\n  --mask-image-scrollbar: linear-gradient(black, black);\n\n  /* The width of our black pixel is the width of the scrollbar.\n  The height is the full container height */\n  --mask-size-scrollbar: var(--scrollbar-width) 100%;\n\n  /* Apply the mask image and mask size variables */\n  -webkit-mask-image: var(--mask-image-content), var(--mask-image-scrollbar);\n  -webkit-mask-size: var(--mask-size-content), var(--mask-size-scrollbar);\n\n  /* Position the content gradient in the top left, and the \n  scroll gradient in the top right */\n  -webkit-mask-position: 0 0, 100% 0;\n\n  /* We don't repeat our mask images */\n  -webkit-mask-repeat: no-repeat, no-repeat;\n\n\n  /* Apply the mask image and mask size variables */\n  -moz-mask-image: var(--mask-image-content), var(--mask-image-scrollbar);\n  -moz-mask-size: var(--mask-size-content), var(--mask-size-scrollbar);\n\n  /* Position the content gradient in the top left, and the \n  scroll gradient in the top right */\n  -moz-mask-position: 0 0, 100% 0;\n\n  /* We don't repeat our mask images */\n  -moz-mask-repeat: no-repeat, no-repeat;\n\n\n  /* Apply the mask image and mask size variables */\n  mask-image: var(--mask-image-content), var(--mask-image-scrollbar);\n  mask-size: var(--mask-size-content), var(--mask-size-scrollbar);\n\n  /* Position the content gradient in the top left, and the \n  scroll gradient in the top right */\n  mask-position: 0 0, 100% 0;\n\n  /* We don't repeat our mask images */\n  mask-repeat: no-repeat, no-repeat;\n}\n\n/* moz */\n.demo .scroller {\n\tscrollbar-width: thin;\n\tscrollbar-color: currentColor transparent;\n}\n\n/* webkit */\n.demo .scroller::-webkit-scrollbar {\n\twidth: var(--scrollbar-width);\n}\n\n.demo .scroller::-webkit-scrollbar-thumb {\n\tbackground-color: currentColor;\n\tborder-radius: 9999px;\n}\n\n.demo .scroller::-webkit-scrollbar-track {\n\tbackground-color: transparent;\n}\n</style>\n<div class=\"demo\">\n<div class=\"scroller\">\n<span class=\"h1\">Lorem Ipsum</span>\n<span class=\"h2\">What is Lorem Ipsum?</span>\n<p>\n    Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.\n</p>\n<p><img src=\"https://pqina.nl/media/cat.jpeg\" width=\"240\" alt=\"\" /></p>\n<p>\n\tIt has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.\n</p>\n<span class=\"h2\">Where does it come from?</span>\n<p>\n    Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. \n</p>\n<p>Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of \"de Finibus Bonorum et Malorum\" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, \"Lorem ipsum dolor sit amet..\", comes from a line in section 1.10.32.\n</p>\n</div>\n</div>\n<p>The HTML used for this effect is a normal block-level element that can have any kind of content.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>masked-overflow<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>What is Lorem Ipsum?<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Then using CSS we apply the mask.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.masked-overflow</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* scroll bar width, for use in mask calculations */</span>\n    <span class=\"token property\">--scrollbar-width</span><span class=\"token punctuation\">:</span> 8px<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* mask fade distance, for use in mask calculations */</span>\n    <span class=\"token property\">--mask-height</span><span class=\"token punctuation\">:</span> 32px<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* If content exceeds height of container, overflow! */</span>\n    <span class=\"token property\">overflow-y</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Our height limit */</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 300px<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Need to make sure container has bottom space,\n  otherwise content at the bottom is always faded out */</span>\n    <span class=\"token property\">padding-bottom</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mask-height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Keep some space between content and scrollbar */</span>\n    <span class=\"token property\">padding-right</span><span class=\"token punctuation\">:</span> 20px<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* The CSS mask */</span>\n\n    <span class=\"token comment\">/* The content mask is a linear gradient from top to bottom */</span>\n    <span class=\"token property\">--mask-image-content</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>\n        to bottom<span class=\"token punctuation\">,</span>\n        transparent<span class=\"token punctuation\">,</span>\n        black <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mask-height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        black <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>100% - <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mask-height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        transparent\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Here we scale the content gradient to the width of the container \n  minus the scrollbar width. The height is the full container height */</span>\n    <span class=\"token property\">--mask-size-content</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>100% - <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--scrollbar-width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> 100%<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* The scrollbar mask is a black pixel */</span>\n    <span class=\"token property\">--mask-image-scrollbar</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>black<span class=\"token punctuation\">,</span> black<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* The width of our black pixel is the width of the scrollbar.\n  The height is the full container height */</span>\n    <span class=\"token property\">--mask-size-scrollbar</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--scrollbar-width<span class=\"token punctuation\">)</span> 100%<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Apply the mask image and mask size variables */</span>\n    <span class=\"token property\">mask-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mask-image-content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mask-image-scrollbar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">mask-size</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mask-size-content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--mask-size-scrollbar<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* Position the content gradient in the top left, and the \n  scroll gradient in the top right */</span>\n    <span class=\"token property\">mask-position</span><span class=\"token punctuation\">:</span> 0 0<span class=\"token punctuation\">,</span> 100% 0<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* We don't repeat our mask images */</span>\n    <span class=\"token property\">mask-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">,</span> no-repeat<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Note that you should either use <code>autoprefixer</code> or prepend the <code>mask</code> properties with <code>-moz-</code> and <code>-webkit-</code> to make them work.</p>\n<p>We need these two mask images because when a mask is applied, transparent pixels in the <code>mask</code> are the pixels that become masked. When applying only the content mask the scrollbar gets masked as well because the pixels behind it are transparent.</p>\n<p>While the scrollbar still works, visually it’s not that attractive.</p>\n<p>Our <code>--mask-image-scrollbar</code> paints a set of black opaque pixels behind the scroll area making the scrollbar always visible.</p>\n<p>The custom scrollbar is created with this CSS, we use the current text color as scrollbar color.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* Firefox */</span>\n<span class=\"token selector\">.masked-overflow</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">scrollbar-width</span><span class=\"token punctuation\">:</span> thin<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* can also be normal, or none, to not render scrollbar */</span>\n    <span class=\"token property\">scrollbar-color</span><span class=\"token punctuation\">:</span> currentColor transparent<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* foreground background */</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Webkit / Blink */</span>\n<span class=\"token selector\">.masked-overflow::-webkit-scrollbar</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--scrollbar-width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.masked-overflow::-webkit-scrollbar-thumb</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> currentColor<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 9999px<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* always round */</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.masked-overflow::-webkit-scrollbar-track</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> transparent<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/fade-out-overflow-using-css-mask-image/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "What Do HTML Elements Sound Like?",
    "partialText": "<p>A video overview of HTML elements and how they sound when being navigated with assistive technology like the screenreader VoiceOver.</p>\n<ul>\n<li><a href=\"https://pqina.nl/blog/what-do-html-elements-sound-like/#what-does-a-fieldset-sound-like%3F\">What does a fieldset sound like?</a></li>\n<li><a href=\"https://pqina.nl/blog/what-do-html-elements-sound-like/#what-does-an-img-sound-like%3F\">What does an img sound like?</a></li>\n<li><a href=\"https://pqina.nl/blog/what-do-html-elements-sound-like/#what-does-a-list-sound-like%3F\">What does a list sound like?</a></li>\n<li><a href=\"https://pqina.nl/blog/what-do-html-elements-sound-like/#what-does-a-br-sound-like%3F\">What does a br sound like?</a></li>\n<li><a href=\"https://pqina.nl/blog/what-do-html-elements-sound-like/#what-does-a-time-sound-like%3F\">What does a time sound like?</a></li>\n</ul>\n<p><img src=\"https://pqina.nl/media/sound.png\" alt=\"\" /></p>\n<h2 id=\"what-does-a-fieldset-sound-like%3F\">What does a fieldset sound like?</h2>\n<p>A <code>&lt;fieldset&gt;</code> can be used to group similar fields together. Think radiobuttons, checkboxes, or a billing and shipping address. Use the <code>&lt;legend&gt;</code> element to describe the group.</p>\n<p><strong>Assistive technology can now tell what group the inner fields belong to.</strong></p>\n<p><a href=\"https://twitter.com/rikschennink/status/1410534857365676033?s=20\">Retweet “what a fieldset sounds like” and help raise accessibility awareness</a></p>\n<video controls=\"\">\n    <source src=\"https://pqina.nl/media/what-does-a-fieldset-sound-like.mp4\" type=\"video/mp4\" />\n</video>\n<p>Fieldsets can be nested, please show restraint as the NVDA screenreader will read out the fieldset legend for each focussed field.</p>\n<p>On first sight, the radios might seem like a list because they are. It might be tempting to wrap them in a list element. Note that in the video above the assistive tech announces the total radio buttons and the current index without a list. If you wrap the radio buttons in a list the screenreader will announce the index and amount twice.</p>\n<h2 id=\"what-does-an-img-sound-like%3F\">What does an img sound like?</h2>\n<p>The <code>&lt;img&gt;</code> element describes an image on the page. <strong>Always add the <code>alt</code> atrtribute.</strong> Set the <code>alt</code> attribute to an empty value if the image is decorative, it is decorative if it doesn’t add any additional information to the content. If it does add information to the content, add a description of the image contents to the <code>alt</code> attribute instead of leaving it empty.</p>\n<p><strong>Assistive technology will read out the alt attribute value. If the alt attribute is not set it will read out the image filename, which should be avoided at all costs.</strong></p>\n<p><a href=\"https://twitter.com/rikschennink/status/1410615677220573188?s=20\">Retweet “what an img sounds like” and help raise accessibility awareness</a></p>\n<video controls=\"\">\n    <source src=\"https://pqina.nl/media/what-does-an-img-sound-like.mp4\" type=\"video/mp4\" />\n</video>\n<p>As you can see, CSS background images are ignored by screenreaders as they should only be used for decorative purposes, the screenreader also skips over the image element with the empty <code>alt</code> attribute.</p>\n<h2 id=\"what-does-a-list-sound-like%3F\">What does a list sound like?</h2>\n<p>The <code>&lt;ul&gt;</code> element describes a list of items in no particular order. Use an <code>&lt;ol&gt;</code> if the list items wouldn’t make sense when re-ordered (e.g. steps in an IKEA manual, search results, article comments).</p>\n<p><strong>Assistive technology will inform the user of the list length, the focussed item symbol name or number, and its index.</strong></p>\n<p><a href=\"https://twitter.com/rikschennink/status/1410566705705848832?s=20\">Retweet “what a list sounds like” and help raise accessibility awareness</a></p>\n<video controls=\"\">\n    <source src=\"https://pqina.nl/media/what-does-a-list-sound-like.mp4\" type=\"video/mp4\" />\n</video>\n<p>Sometimes when writing HTML every bit of content starts to look like a list. A good question to ask yourself to truly know if you’re looking at a list is: “Should a screenreader announce the number of items?” If that’s a yes, then you got yourself a list.</p>\n<h2 id=\"what-does-a-br-sound-like%3F\">What does a br sound like?</h2>\n<p>A <code>&lt;br&gt;</code> element forces a line break but should only be used when the location of the break is semantically important, for example when formatting a poem or address.</p>\n<p><strong>Assistive technology will insert an appropriate pause when encountering the break.</strong></p>\n<p><a href=\"https://twitter.com/rikschennink/status/1410559321335898114?s=20\">Retweet “what a br sounds like” and help raise accessibility awareness</a></p>\n<video controls=\"\">\n    <source src=\"https://pqina.nl/media/what-does-a-br-sound-like.mp4\" type=\"video/mp4\" />\n</video>\n<h2 id=\"what-does-a-time-sound-like%3F\">What does a time sound like?</h2>\n<p>Use the <code>&lt;time&gt;</code> element with a <code>datetime</code> attribute to describe dates, times, and durations. A time, date, or a datetime are all supported as long as supplied in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format, so <code>09:45</code> will work and <code>9:45</code> won’t.</p>\n<p>Timezones don’t seem to work, when set, VoiceOver ignores the <code>datetime</code> attribute.</p>\n<p><strong>Assistive technology can now tell the user the time or duration in their native language.</strong></p>\n<p><a href=\"https://twitter.com/rikschennink/status/1410875051944128514?s=20\">Retweet “what a time sounds like” and help raise accessibility awareness</a></p>\n<video controls=\"\">\n    <source src=\"https://pqina.nl/media/what-does-a-time-sound-like.mp4\" type=\"video/mp4\" />\n</video>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>I hope this list of VoiceOver soundbites helps you understand how visually impaired users might be using your web product. Check back later, I plan to extend the list with additional videos regularly.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/what-do-html-elements-sound-like/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Integrating Uppy With Pintura Image Editor A JavaScript Image Editor",
    "partialText": "<p>In this tutorial we’ll integrate Uppy with <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura Image Editor</a> to visually optimise and compress images before they’re uploaded to the server.</p>\n<p>Compressing and cropping images before they’re send to the server can save bandwidth, save manual cropping work, and allows the user to have more control over their own content.</p>\n<p>Use the techniques described in this article to enable your users to edit profile pictures, photo albums, or any other imagery that they upload to your server. All while still being able to set content restrictions, like crop aspect ratio, minimum image size, and available filters.</p>\n<p>We’ll start with the default <a href=\"https://uppy.io/\">Uppy</a> implementation. Once we have that up and running we’ll add the <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura Image Editor</a> integration.</p>\n<p>Please note that Uppy doesn’t currently support editing remote files, so Pintura won’t be able to edit images provided by Uppy Companion plugins.</p>\n<h2 id=\"setting-up-uppy\">Setting up Uppy</h2>\n<p>Let’s begin by adding the Uppy stylesheet and script to the page.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Uppy<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n\n        <span class=\"token comment\">&lt;!-- add the Uppy styles to the head --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span>\n            <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://transloadit.edgly.net/releases/uppy/v1.2.0/uppy.min.css<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- add the Uppy script to right before the closing body element --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://transloadit.edgly.net/releases/uppy/v1.2.0/uppy.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Now we’ll add the HTML element that will contain the Uppy instance.</p>\n<p>Note that I’ve shortened the style and script tags to keep the code snippet readable.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Uppy<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>uppy.min.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- add the Uppy HTML element --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>drag-drop-area<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>uppy.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>All right, let’s extend the <code>script</code> to load Uppy.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>drag-drop-area<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>uppy.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token comment\">&lt;!-- add the Uppy script init logic --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n        <span class=\"token keyword\">var</span> uppy <span class=\"token operator\">=</span> Uppy<span class=\"token punctuation\">.</span><span class=\"token function\">Core</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Uppy<span class=\"token punctuation\">.</span>Dashboard<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">inline</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">'#drag-drop-area'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Uppy<span class=\"token punctuation\">.</span>Tus<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">endpoint</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://master.tus.io/files/'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        uppy<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n                <span class=\"token string\">'Upload complete! We’ve uploaded these files:'</span><span class=\"token punctuation\">,</span>\n                result<span class=\"token punctuation\">.</span>successful\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Refresh your browser window and Uppy should now appear like shown below:</p>\n<p><img src=\"https://pqina.nl/media/uppy-shows.png\" alt=\"Uppy as it shows on first render\" /></p>\n<p>You can drop files and upload them as well, it’ll all work automagically.</p>\n<p>Let’s move on to the Pintura Image Editor integration.</p>\n<h2 id=\"integrating-pintura-image-editor-with-uppy\">Integrating Pintura Image Editor with Uppy</h2>\n<p>To allow editing of the image we need to load Pintura when an image is dropped. We can do this by leveraging the <code>onBeforeFileAdded</code> function.</p>\n<p>First however we’ll need to add the Pintura styles and scripts.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Uppy<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>uppy.min.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n        <span class=\"token comment\">&lt;!-- Add the Pintura style tag --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pintura.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>drag-drop-area<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>uppy.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n        <span class=\"token comment\">&lt;!-- Add the Pintura bridge function tag --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>useEditorWithUppy.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n        <span class=\"token comment\">&lt;!-- Uppy script init logic --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Now we’ll link up with the Uppy <code>onBeforeFileAdded</code> function. We’ll zoom in on the JavaScript code to make things easier to read.</p>\n<p>The <code>onBeforeFileAdded</code> function allows us to validate the dropped file. If we return <code>false</code> the file will be rejected, if we return <code>true</code>, it will be added to the list. We need to edit the file and then add the result of the user edit to the list of files.</p>\n<p>It’s the best location to integrate our image editing flow.</p>\n<p>Let’s set up the script so it prevents files from being added.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// initialise Uppy</span>\n    <span class=\"token keyword\">var</span> uppy <span class=\"token operator\">=</span> Uppy<span class=\"token punctuation\">.</span><span class=\"token function\">Core</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function-variable function\">onBeforeFileAdded</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// prevent the file from being added</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Uppy<span class=\"token punctuation\">.</span>Dashboard<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">inline</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">'#drag-drop-area'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Uppy<span class=\"token punctuation\">.</span>Tus<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">endpoint</span><span class=\"token operator\">:</span> <span class=\"token string\">'https://master.tus.io/files/'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Now we need to edit the file we just rejected with Pintura. We’ll add the <code>useEditorWithUppy</code> bridge and load pintura.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// import the function to open the editor</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> openDefaultEditor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./pintura/pintura.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// initialise Uppy</span>\n<span class=\"token keyword\">var</span> uppy <span class=\"token operator\">=</span> Uppy<span class=\"token punctuation\">.</span><span class=\"token function\">Core</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">onBeforeFileAdded</span><span class=\"token operator\">:</span> <span class=\"token function\">useEditorWithUppy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Method used to create Pintura Image Editor</span>\n    openDefaultEditor<span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// The editor options</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">imageCropAspectRatio</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// Reference to Uppy addFile API</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> uppy<span class=\"token punctuation\">.</span>addFile\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Uppy<span class=\"token punctuation\">.</span>Dashboard<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">inline</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#drag-drop-area\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>Uppy<span class=\"token punctuation\">.</span>Tus<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">endpoint</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://master.tus.io/files/\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>You can now use the Uppy file upload library together with Pintura to handle image uploads.</p>\n<p>See the results below. Please note that this animation shows version 6 of the editor.</p>\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/uppy-editor.mp4\" type=\"video/mp4\" />\n</video>\n<p><a href=\"https://pqina.nl/pintura/?ref=pqina\">Find out more about Pintura Image Editor on the product site</a></p>\n<p>If you’re using DropZoneJS you might also be interested in <a href=\"https://itnext.io/integrating-dropzone-with-javascript-image-cropper-optimise-image-upload-e22b12ac0d8a\">Integrating DropzoneJS with a JavaScript Image Cropper to Optimise Image Uploads</a></p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/editing-images-with-uppy-and-pintura/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Resize Images Proportionally While Keeping The Aspect Ratio",
    "partialText": "<p>Sometimes images are just too big to display on the web page. We don’t need JavaScript to fix this. We can resize images proportionally with HTML image tags or CSS background styles. Let’s look at the different options we have to size images while keeping their aspect ratio in check.</p>\n<p><img src=\"https://pqina.nl/media/resize.png\" alt=\"\" /></p>\n<style>\n/* .article-content .demo {\n    margin: 2em auto;\n    width: fit-content;\n}\n\n.article-content .demo img {\n    max-width: none;\n    margin: 0;\n} */\n</style>\n<h2 id=\"resizing-html-image-tags\">Resizing HTML image tags</h2>\n<p>Our first choice is to set only one size property, either <code>width</code> or <code>height</code>, the browser will automatically calculate the size of the other edge.</p>\n<p>Imagine we have a cat picture with an aspect ratio of <code>4:3</code>, in other words, it’s dimensions are <code>4032 × 3024</code>, that’s a lot of cat.</p>\n<p>If we want it to show a bit smaller we can set the <code>width</code> to <code>240</code>, the browser will then automatically calculate the height to be <code>180</code>.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>240<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>There’s a caveat. Images aren’t immediately available.</p>\n<p>The browser will render the page, wait for the image source to load, and then update the <code>height</code> of the image element. This will most likely cause the browser to render the page twice, because after the height of the image is updated all items below the image are pushed down.</p>\n<p>This is bad news for your page performance.</p>\n<p>Best to set the intended size so the browser can reserve space.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>240<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>180<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>But what if we don’t know the aspect ratio of the image and we get a square cat picture? Won’t our cat be squished? Yes, yes it would, poor cat.</p>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/cat-square.jpeg\" alt=\"\" width=\"240\" height=\"180\" />\n</div>\n<p>But fear not, we can fix this with CSS.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">object-fit</span><span class=\"token punctuation\">:</span> contain<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/cat-square.jpeg\" alt=\"\" width=\"240\" height=\"180\" style=\"object-fit:contain\" />\n</div>\n<p>Pass <code>cover</code> instead of <code>contain</code> to tell the browser to fill the entire image tag with cat pixels.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">object-fit</span><span class=\"token punctuation\">:</span> cover<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo\">\n    <img src=\"https://pqina.nl/media/cat-square.jpeg\" alt=\"\" width=\"240\" height=\"180\" style=\"object-fit:cover;\" class=\"mobile-image\" />\n</div>\n<p>What if our image needs to be limited to the width of a parent element? In that situation we can use CSS <code>max-width</code> or <code>width</code> to fit the image.</p>\n<div aria-hidden=\"true\" class=\"promoted-product-banner\">\n<p>Quick shoutout to some products I built that might be helpful to you.</p>\n<ul>\n<li class=\"product-item\">\n  <span class=\"logo-pintura\"></span>\n  <p class=\"implicit\">Pintura</p>\n  <p class=\"product-description\">\n    A JavaScript Image Editor that integrates with every stack.\n  </p>\n  <a href=\"https://pqina.nl/pintura/?ref=pqina-article\" target=\"_blank\">Get started with Pintura</a>\n</li>\n<li class=\"product-item\">\n  <span class=\"logo-filepond\"></span>\n  <p class=\"implicit\">FilePond</p>\n  <p class=\"product-description\">\n    A free JavaScript File Manager that uploads anything you throw at it.\n  </p>\n  <a href=\"https://pqina.nl/filepond/?ref=pqina-article\" target=\"_blank\">Get started with FilePond</a>\n</li>\n</ul>\n<p>Let's get back to our adventure!</p>\n</div>\n<p>Use <code>max-width: 100%</code> to limit the size but allow smaller image sizes, use <code>width: 100%</code> to always scale the image to fit the parent container width.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>240<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>180<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">div</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 240px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid pink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">max-width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">object-fit</span><span class=\"token punctuation\">:</span> contain<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo\">\n    <div style=\"width:240px;border: 1px solid pink;display:inline-block;\">\n        <img src=\"https://pqina.nl/media/cat.jpeg\" alt=\"\" width=\"240\" height=\"180\" style=\"max-width:100%;object-fit: contain;\" />\n    </div>\n</div>\n<p>We can further use CSS to fix the aspect ratio of the image, <a href=\"https://pqina.nl/blog/presenting-images-in-an-aspect-ratio-with-css/\">learn more about presenting images in a specific aspect ratio</a>.</p>\n<h2 id=\"resizing-css-background-images\">Resizing CSS background images</h2>\n<p>By default a <code>background-image</code> will be repeated over the background of an element if it’s smaller, if it’s bigger it won’t be scaled but parts of the image won’t be visible. In the example below, the bottom and right part of our cat aren’t rendered.</p>\n<div class=\"demo demo-clip\">\n    <div style=\"width:200px; height:200px;\"></div>\n</div>\n<style>\n.demo-clip div {\n    border: 1px solid pink;\n  background-repeat: no-repeat;\n  background-image: url(\"/media/cat.jpeg\");\n}\n</style>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">width</span><span class=\"token punctuation\">:</span>200px<span class=\"token punctuation\">;</span> <span class=\"token property\">height</span><span class=\"token punctuation\">:</span>200px<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">div</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">'cat.jpeg'</span><span class=\"token punctuation\">)</span></span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid pink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>We can fix this by setting the <code>background-size</code> property. To fit the image inside the element we use the <code>contain</code> value. The browser will fit the image inside the element bounds and scale it proportionally.</p>\n<div class=\"demo demo-contain\">\n    <div style=\"width:200px; height:200px;\"></div>\n</div>\n<style>\n.demo-contain div {\n    border: 1px solid pink;\n    background: url(\"/media/cat.jpeg\") no-repeat;\n    background-size: contain;\n    background-position: center;\n}\n</style>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">width</span><span class=\"token punctuation\">:</span>200px<span class=\"token punctuation\">;</span> <span class=\"token property\">height</span><span class=\"token punctuation\">:</span>200px<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">div</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">'cat.jpeg'</span><span class=\"token punctuation\">)</span></span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> contain<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* scales the image */</span>\n    <span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* centers the image */</span>\n    <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid pink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Similar to <code>object-fit</code> we can also use the <code>cover</code> value to tell the browser to cover the element with cat pixels. As you can see below, this will cause it to scale down just enough to fit the vertical space, now only the right side of our cat is cropped.</p>\n<div class=\"demo demo-cover\">\n    <div style=\"width:200px; height:200px;\"></div>\n</div>\n<style>\n.demo-cover div {\n    border: 1px solid pink;\n  background: url(\"/media/cat.jpeg\") no-repeat;\n  background-size: cover;\n}\n</style>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">width</span><span class=\"token punctuation\">:</span>200px<span class=\"token punctuation\">;</span> <span class=\"token property\">height</span><span class=\"token punctuation\">:</span>200px<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">div</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">'cat.jpeg'</span><span class=\"token punctuation\">)</span></span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> cover<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid pink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>We can also supply a singular <code>width</code> value to the <code>background-size</code> property. Similar to the <code>img</code> element, the <code>height</code> will be automatically calculated.</p>\n<div class=\"demo demo-100\">\n    <div style=\"width:200px; height:200px;\"></div>\n</div>\n<style>\n.demo-100 div {\n    border: 1px solid pink;\n  background: url(\"/media/cat.jpeg\") no-repeat;\n  background-size: 200px;\n}\n</style>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">width</span><span class=\"token punctuation\">:</span>200px<span class=\"token punctuation\">;</span> <span class=\"token property\">height</span><span class=\"token punctuation\">:</span>200px<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">div</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">'cat.jpeg'</span><span class=\"token punctuation\">)</span></span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> 200px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid pink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>That’s it!</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/resize-images-proportionally-while-keeping-the-aspect-ratio/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Edit Images Before Uploading Them To Your WordPress Media Library",
    "partialText": "<p>In this short tutorial we’ll use a custom <code>&lt;pintura-input&gt;</code> element to add image editing and uploading to any WordPress website front-end.</p>\n<p>Let’s take a look below at what we’re building. Select a file to start editing, click done and the file will be uploaded. The image edit functionality and custom field are provided by <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura Image Editor</a>.</p>\n<p style=\"opacity:.5;\"><small>For privacy reasons the file upload in this demo is simulated.</small></p>\n<!-- This is only for demo purposes, see below URL for actual implementation -->\n<!-- https://pqina.nl/pintura/docs/latest/getting-started/installation/pintura-input/ -->\n<link href=\"https://pqina.nl/pintura/demo/pintura.css\" rel=\"stylesheet\" />\n<style>\n.pintura-editor {\n    --editor-max-width: 70em;\n    --editor-max-height: 50em;\n}\n\noutput {\n    font-size: .875em;\n}\n\noutput span {\n    gap: 0;\n    margin: 0 1em;\n}\n</style>\n<div class=\"demo\" style=\"margin: 3em 1em\">\n    <input type=\"file\" id=\"my_file_field\" accept=\"image/*\" />\n</div>\n<script type=\"module\">\n\nimport {\n    openDefaultEditor,\n    createDefaultImageWriter\n} from '/pintura/demo/pintura.js';\n\nconst input = document.querySelector('#my_file_field');\n\ninput.addEventListener('change', e => {\n\n    const file = e.target.files[0];\n\n    if (!file) return;\n\n    if (!/image/.test(file.type)) return;\n\n    const editor = openDefaultEditor({\n        src: file,\n\n        // Needed to simulate upload\n        imageWriter: createDefaultImageWriter({\n            store: (state, options, onprogress) => new Promise((resolve) => {\n\n                let p = 0;\n\n                const sim = () => {\n                    p += Math.random() / 10;\n\n                    onprogress(\n                        new ProgressEvent('progress', {\n                            lengthComputable: true, \n                            loaded: Math.min(100, p * 100), \n                            total: 100\n                        })\n                    )\n\n                    if (p >=1) {\n                        resolve(state)\n                    }\n                    else {\n                        setTimeout(() => {\n                            sim();\n                        }, Math.random() * 50)\n                    }\n                }\n\n                sim();\n            })\n        })\n    });\n\n    const resetInput = () => {\n        input.value = '';\n        if (!/safari/i.test(navigator.userAgent)) {\n            input.type = '';\n            input.type = 'file';\n        }\n    }\n\n    const didProcess = (res) => {\n\n        const output = document.createElement('output');\n        output.style = 'display:flex;align-items:center;gap:1em;pointer-events:none;';\n\n        const image = new Image();\n        image.src = URL.createObjectURL(res.dest);\n        image.alt = '';\n        image.style = 'margin:0;object-fit:cover;width:auto;height:1.5em;';\n\n        const status = document.createElement('span');\n        status.textContent = `\"${res.dest.name}\" uploaded successfully`\n\n        const button = document.createElement('button');\n        button.type = 'button';\n        button.setAttribute('aria-label', 'Reset');\n        button.style = 'pointer-events:all;all:initial;cursor:pointer;';\n        button.innerHTML = '&times;';\n        button.onclick = function() {\n            resetInput();\n            URL.revokeObjectURL(image.src);\n            output.remove();\n            input.hidden = false;\n        }\n\n        output.append(image, status, button);\n        \n        input.after(output);\n        input.hidden = true;\n    }\n\n    const didCancel = () => {\n        resetInput();\n    }\n\n    editor.on('loaderror', () => {\n        editor.close();\n        didCancel();\n    });\n    editor.on('close', didCancel)\n\n    editor.on('process', didProcess)\n\n})\n</script>\n<p><strong>Let’s get started!</strong></p>\n<p>To help our visitors edit and upload images we need to make three small changes to our website.</p>\n<ol>\n<li>Load the <code>pintura</code>, and <code>pintura-input</code> styles and scripts.</li>\n<li>Copy a PHP script to handle the upload to the media library.</li>\n<li>Add the <code>pintura-input</code> element to the page we want to upload from.</li>\n</ol>\n<p>We’ll go over them step by step.</p>\n<h2 id=\"%23-loading-the-pintura%2C-and-pintura-input-styles-and-scripts\">#1 Loading the pintura, and pintura-input styles and scripts</h2>\n<p>First we download the files, we need to <a href=\"https://pqina.nl/pintura/guide/#zip-panel\">download Pintura</a> and <a href=\"https://github.com/pqina/pintura-component-pintura-input/archive/refs/heads/main.zip\">download the Pintura Input component</a> files.</p>\n<p>Let’s navigate to our themes <code>functions.php</code> file. We can find it in the admin menu by clicking <code>Appearance</code> -&gt; <code>Theme Editor</code> -&gt; <code>Theme Functions</code>.</p>\n<p>Alternatively we can open the theme folder and find the <code>functions.php</code> file using an FTP client.</p>\n<p>We’ll start by adding the following two lines to the <code>functions.php</code> file of the theme. This will load the editor styles and scripts. We can add the snippet to the top of the file.</p>\n<p>Note that this setup assumes that:</p>\n<ul>\n<li><code>pintura.css</code> and <code>pintura-iife.js</code> are located in <code>theme-folder-name/pintura/</code></li>\n<li><code>pinturainput-iife.js</code> is located in <code>theme-folder-name/pintura-input/</code></li>\n</ul>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// This function will load the pintura scripts</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">pintura_enqueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// This loads the Pintura styles</span>\n    <span class=\"token function\">wp_enqueue_style</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string single-quoted-string\">'pintura-input-style'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">get_template_directory_uri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/pintura/pintura.css'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">false</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// This loads the Pintura scripts</span>\n    <span class=\"token function\">wp_enqueue_script</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string single-quoted-string\">'pintura-input-script'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">get_template_directory_uri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/pintura/pintura-iife.js'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// This loads the Pintura Input custom element</span>\n    <span class=\"token function\">wp_enqueue_script</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string single-quoted-string\">'pintura-input-script'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">get_template_directory_uri</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'/pintura-input/pinturainput-iife.js'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// This action will call the Pintura script loader on the front-end</span>\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'wp_enqueue_scripts'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'pintura_enqueue'</span><span class=\"token punctuation\">)</span></code></pre>\n<p>We’ll need to make some more changes to the <code>functions.php</code> file in the next step.</p>\n<h2 id=\"%23-set-up-the-php-script-that-handles-the-image-upload\">#2 Set up the PHP script that handles the image upload</h2>\n<p>Copy the PHP snippet below and paste it just below the code we added in step 1.</p>\n<p>This code will handle the image upload and move uploaded images to the WordPress media library.</p>\n<p>Note that in this example <code>&quot;my_field&quot;</code> is the name of the file input field being handled, we’ll use it again in step #3. If your field is named differently, or you want to use a different name, make sure to change it everywhere.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'wp_ajax_image_upload'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'handle_input_image'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'wp_ajax_nopriv_image_upload'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'handle_input_image'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">handle_input_image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// Allow this image to be uploaded?</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">wp_verify_nonce</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'nonce'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'my_field'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">// Log error message to console so we know what's up</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Image upload not allowed'</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Respond with a 403 forbidden error</span>\n        <span class=\"token function\">http_response_code</span><span class=\"token punctuation\">(</span><span class=\"token number\">403</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// These files need to be included to upload the image</span>\n    <span class=\"token keyword\">require_once</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ABSPATH</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'wp-admin/includes/image.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require_once</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ABSPATH</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'wp-admin/includes/file.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require_once</span><span class=\"token punctuation\">(</span><span class=\"token constant\">ABSPATH</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'wp-admin/includes/media.php'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Let WordPress handle the upload</span>\n    <span class=\"token variable\">$image_id</span> <span class=\"token operator\">=</span> <span class=\"token function\">media_handle_upload</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'my_field'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Test if upload succeeded</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_wp_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image_id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">// Log error message to console so we know what's up</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$image_id</span><span class=\"token operator\">-></span><span class=\"token function\">get_error_message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Respond with a 500 error</span>\n        <span class=\"token function\">http_response_code</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Finished upload, return the image id</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$image_id</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">http_response_code</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"%23-add-the-pintura-input-html-element\">#3 Add the pintura-input HTML element</h2>\n<p>We’re nearly done, all that is left is adding the <code>pintura-input</code> HTML element to a page.</p>\n<p>We’ll open the webpage we want to allow visitors of our website to upload from and add the following HTML to the page.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pintura-input</span>\n  <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my_field<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">store</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token function\">admin_url</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'wp_ajax.php'</span><span class=\"token punctuation\">)</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">post-action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image_upload<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">post-nonce</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token function\">wp_create_nonce</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'my_field'</span><span class=\"token punctuation\">)</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pintura-input</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>If we can’t find <code>wp_ajax.php</code> we can use <code>admin_ajax.php</code> instead.</p>\n<p>The <code>image_upload</code> name in the <code>post-action</code> attribute links our field to the <code>add_action</code> hooks both ending with <code>image_upload</code>.</p>\n<p>The name of the field <code>my_field</code> is also used in the PHP code to know which field to look for in the sent data.</p>\n<p>Finally the <code>post-nonce</code> is used to check if the data was sent in a secure manner.</p>\n<p>After refreshing the webpage we’re ready to upload our first image!</p>\n<p>If you want to change the behaviour of the editor you can find <a href=\"https://pqina.nl/pintura/docs/latest/getting-started/installation/pintura-input/\">more information on the <code>pintura-input</code> element here</a>.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/edit-images-before-uploading-them-to-your-wordpress-media-library/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "TypeScript Interface Merging And Extending Modules",
    "partialText": "<p>FilePond is split up in a core library and a wide range of plugins. The plugins add properties to the core. But how do we extend the core TypeScript Interface to show the plugin properties?</p>\n<p>Let’s take a look.</p>\n<p>We have a core library, in this case <a href=\"https://pqina.nl/filepond/\">FilePond</a>, and we have a plugin that dynamically adds a property called <code>allowFilePoster</code> to the core instance.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> create <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'filepond'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> FilePondPluginFilePoster <span class=\"token keyword\">from</span> <span class=\"token string\">'filepond-plugin-file-poster'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span>inputElement<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">allowFilePoster</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// error!</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>If the <code>'filepond-plugin-file-poster'</code> module doesn’t extend the core interface, TypeScript will throw this error:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* Property 'allowFilePoster' does not exist on type 'FilePond'. ts(2339) */</span></code></pre>\n<p>And rightly so, because this property isn’t available on the core interface.</p>\n<p>To quickly work around this we could define the property in the core interface, but that would make third-party plugin development impossible as they wouldn’t have access to the core interface.</p>\n<p>Instead we need a way to extend the core interface with additional declarations.</p>\n<p>Searching <em>“extend interface”</em> doesn’t yield a lot of answers as extending interfaces is also possible with TypeScript but it’s not what we want, we want to add declarations to an existing interface.</p>\n<h2 id=\"adding-declarations-to-an-interface\">Adding declarations to an interface</h2>\n<p>The FilePond module exports the <code>FilePondOptions</code> interface, it’s located in the <code>types/index.d.ts</code> folder of <a href=\"https://github.com/pqina/filepond/\">the repository</a>.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FilePondOptions</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/** Enable or disable drag n’ drop */</span>\n    allowBrowse<span class=\"token operator\">?</span><span class=\"token operator\">:</span> boolean<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Other FilePond core options here...</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>In the plugin repository types we set things up like shown below.</p>\n<p>We import <code>'filepond'</code> and then, declare a module under the same name, and then extend the core <code>FilePondOptions</code> interface.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// @ts-ignore</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FilePondOptions <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"filepond\"</span><span class=\"token punctuation\">;</span>\n\ndeclare module <span class=\"token string\">\"filepond\"</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FilePondOptions</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/** Enable or disable file poster */</span>\n    allowFilePoster<span class=\"token operator\">?</span><span class=\"token operator\">:</span> boolean<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Other FilePond plugin options here...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Note that in my development environment I had to add the <code>@ts-ignore</code> statement to prevent it from throwing the following warning.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* 'FilePondOptions' is declared but its value is never read. ts(6133) */</span></code></pre>\n<p>Now if both the core and the plugin modules have been imported, the <code>allowFilePoster</code> property is recognized on the FilePond instance and we can set it without it throwing an error.</p>\n<p>You can read more on this in the official TypeScript documentation in this <a href=\"https://www.typescriptlang.org/docs/handbook/declaration-files/templates/module-plugin-d-ts.html\">entry about extending modules</a>.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/typescript-interface-merging-and-extending-modules/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Convert A Blob To A File Using JavaScript",
    "partialText": "<p>Sometimes you get a Blob object when instead you would like to have a File. For example, when you use <code>blob()</code> on a <code>fetch</code> response object. In this quick tutorial we’ll explore how to turn a Blob into a File.</p>\n<h2 id=\"fetch\">Fetch</h2>\n<p>The script below converts a <code>fetch</code> response into a <code>Blob</code>.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./image.jpeg'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">myBlob</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myBlob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// logs: Blob { size: 1024, type: \"image/jpeg\" }</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>But what if we want a <code>File</code>?</p>\n<p>The main difference between a <code>Blob</code> and a <code>File</code> is that the <code>File</code> has a <code>name</code> and <code>lastModified</code> property, it inherits all it’s other properties from <code>Blob</code>.</p>\n<p>We can take two routes, either we add these two properties to the <code>Blob</code> to make it seem like a <code>File</code>. Or we create an actual <code>File</code> instance.</p>\n<h2 id=\"making-a-blob-quack-like-a-file\">Making a Blob quack like a File</h2>\n<p>Let’s add the two properties to our <code>Blob</code> instance (the one from our <code>fetch</code> request above).</p>\n<pre class=\"language-js\"><code class=\"language-js\">myBlob<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'image.jpeg'</span><span class=\"token punctuation\">;</span>\nmyBlob<span class=\"token punctuation\">.</span>lastModified <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Our <code>Blob</code> now seems like a <code>File</code> but it’s not a real <code>File</code>, we can easily check this:</p>\n<pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myBlob <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// logs: false</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myBlob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// logs: Blob { name: \"image.jpeg\", lastModified: ..., size: 1024, type: \"image/jpeg\" }</span></code></pre>\n<p>This might cause a problem if we use this with a third-party script which requires an actual <code>File</code> object.</p>\n<h2 id=\"creating-an-actual-file\">Creating an actual File</h2>\n<p>This is the better approach, it’ll give us an actual <code>File</code> object.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> myFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>myBlob<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'image.jpeg'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> myBlob<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// logs: File { name: \"image.jpeg\", lastModified: ..., size: 1024, type: \"image/jpeg\" }</span></code></pre>\n<p>Now when we check the instance it’ll be a <code>File</code>.</p>\n<pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myFile <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// logs: true</span></code></pre>\n<p>But, as it inherits from <code>Blob</code> it’ll also be a <code>Blob</code>.</p>\n<pre class=\"language-js\"><code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myFile <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// logs: true</span></code></pre>\n<p>Why did we discuss the quack likes a duck method? Because IE11 doesn’t support the <code>File</code> constructor so if you still need to support Internet Explorer, that’s the way to go.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/convert-a-blob-to-a-file-with-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "How To Prompt The User To Download A File",
    "partialText": "<p>Sometimes we just want to download an image file instead of opening it in the browser. For these situations we can use the <code>download</code> attribute. In this article we’ll learn how to use it and how we can automate its behavior with JavaScript.</p>\n<p>The <a href=\"https://developer.mozilla.org/nl/docs/Web/HTML/Element/a#attributes\"><code>download</code></a> attribute tells the browser to download a link target when it’s clicked.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/media/cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">download</span><span class=\"token punctuation\">></span></span>cat.jpeg<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Try it here: <a href=\"https://pqina.nl/media/cat.jpeg\" download=\"\">cat.jpeg</a></p>\n<p>We can also supply the name of the file by setting the value of the <code>download</code> attribute, in this example we set it to <code>'my-cat.jpeg'</code>.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/media/cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">download</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-cat.jpeg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>cat.jpeg<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Try it here: <a href=\"https://pqina.nl/media/cat.jpeg\" download=\"my-cat.jpeg\">cat.jpeg</a></p>\n<h2 id=\"automating-the-download\">Automating the download</h2>\n<p>Suppose we’ve generated a file in the browser, how can we serve that file to the user without having to ask the user to click a link.</p>\n<p>JavaScript to the rescue!</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">downloadFile</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Create a link and set the URL using `createObjectURL`</span>\n    <span class=\"token keyword\">const</span> link <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    link<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">;</span>\n    link<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    link<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// It needs to be added to the DOM so it can be clicked</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    link<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// To make this work on Firefox we need to wait</span>\n    <span class=\"token comment\">// a little while before removing it.</span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">revokeObjectURL</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        link<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>We can use it like this:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Dynamically create a File</span>\n<span class=\"token keyword\">const</span> myFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">: Meow!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'my-cat.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Download it using our function</span>\n<span class=\"token function\">downloadFile</span><span class=\"token punctuation\">(</span>myFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Click on the button below to give it a go.</p>\n<p><button class=\"file-button\">Give me a file</button></p>\n<script>\nfunction downloadFile(file) {\n  const link = document.createElement(\"a\");\n  link.style.display = \"none\";\n  link.href = URL.createObjectURL(file);\n  link.download = file.name;\n\n  document.body.appendChild(link);\n  link.click();\n\n  setTimeout(() => {\n    URL.revokeObjectURL(link.href);\n    link.parentNode.removeChild(link);\n  }, 0);\n}\n\ndocument.querySelector('.file-button').addEventListener('click', () => {\n\n    const myFile = new File([`${ new Date() }: Meow!`], \"my-cat.txt\");\n\n    downloadFile(myFile);\n})\n</script>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/how-to-prompt-the-user-to-download-a-file-instead-of-navigating-to-it/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Convert A File To A Base64 String Or DataURL Using JavaScript",
    "partialText": "<p>Converting JavaScript file objects or blobs to Base64 strings can be useful. For example when we can only send string based data to the server. In this tutorial we’ll explore how to use JavaScript to generate a Base64 string and a DataURL from a file object.</p>\n<p>In both examples we’ll use a file obtained from a file input field.</p>\n<h2 id=\"encoding-a-file-as-a-dataurl\">Encoding a File as a DataURL</h2>\n<p>We use <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileReader\"><code>FileReader</code></a> to convert the file object to a dataUR this is done by using the <code>readAsDataURL</code> method.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Get a reference to the file input</span>\n    <span class=\"token keyword\">const</span> fileInput <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Listen for the change event so we can capture the file</span>\n    fileInput<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get a reference to the file</span>\n        <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Encode the file using the FileReader API</span>\n        <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onloadend</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reader<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Logs data:&lt;type>;base64,wL2dvYWwgbW9yZ...</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"encoding-the-file-as-a-base-string\">Encoding the File as a Base64 string</h2>\n<p>The snippet below creates a base64 string, it’s identical to the previous example but it uses a regular expression to remove the Data URL part.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Get a reference to the file input</span>\n    <span class=\"token keyword\">const</span> fileInput <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Listen for the change event so we can capture the file</span>\n    fileInput<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get a reference to the file</span>\n        <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Encode the file using the FileReader API</span>\n        <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onloadend</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Use a regex to remove data url part</span>\n            <span class=\"token keyword\">const</span> base64String <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span>result\n                <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data:'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^.+,</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>base64String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Logs wL2dvYWwgbW9yZ...</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<h2 id=\"generating-a-url-that-points-to-a-file-object\">Generating a URL that points to a File object</h2>\n<p>Sometimes we just want to use an <code>File</code> object as an image source. But how to add the file object to the <code>&lt;img&gt;</code> <code>src</code> attribute?</p>\n<p>The <code>URL.createObjectURL()</code> method can help here.</p>\n<p>The following code snippet will update the image source to the file that is loaded in the file input.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Get a reference to the file input</span>\n    <span class=\"token keyword\">const</span> imageElement <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'img'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get a reference to the file input</span>\n    <span class=\"token keyword\">const</span> fileInput <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Listen for the change event so we can capture the file</span>\n    fileInput<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Get a reference to the file</span>\n        <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Set file as image source</span>\n        imageElement<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>We need to make sure to revoke the URL if we no longer need the file. If we don’t this causes memory leaks.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">revokeObjectURL</span><span class=\"token punctuation\">(</span>fileUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>That’s it!</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/convert-a-file-to-a-base64-string-with-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Applying A Circular Crop Mask To An Image",
    "partialText": "<p>Profile pictures are often masked by a circle. How can we present our images in such a circle. Lets explore two options, one where we use CSS and one where we actually mask the image data.</p>\n<h2 id=\"applying-the-mask-using-css\">Applying the mask using CSS</h2>\n<p>Applying a circular mask to an image using CSS is quite straightforward. We only have to set the <code>border-radius</code> property and we’re done.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 50%<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/media/cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>But what if our image isn’t a square?</p>\n<div class=\"demo\">\n<img width=\"128\" class=\"demo-cat\" src=\"https://pqina.nl/media/cat.jpeg\" />\n</div>\n<style>\n.demo-cat {\n    border-radius: 50%;\n}\n</style>\n<p>To prevent elliptic cats we have to make sure our image is a square.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 128px<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 128px<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 50%<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/media/cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<div class=\"demo\">\n<img width=\"128\" class=\"demo-cat-circle\" src=\"https://pqina.nl/media/cat.jpeg\" />\n</div>\n<style>\n.demo-cat-circle {\n    width: 128px;\n    height: 128px;\n    border-radius: 50%;\n}\n</style>\n<p>Okay, but now our cat is squished. Let’s unsquish it using CSS <code>object-fit</code>.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n    <span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 128px<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 128px<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">object-fit</span><span class=\"token punctuation\">:</span> cover<span class=\"token punctuation\">;</span>\n        <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 50%<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/media/cat.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<div class=\"demo\">\n<img width=\"128\" class=\"demo-cat-unsquish\" src=\"https://pqina.nl/media/cat.jpeg\" />\n</div>\n<style>\n.demo-cat-unsquish {\n    width: 128px;\n    height: 128px;\n    object-fit: cover;\n    border-radius: 50%;\n}\n</style>\n<p>Done!</p>\n<h2 id=\"applying-a-circular-mask-using-canvas\">Applying a Circular Mask using Canvas</h2>\n<p>To modify the actual image data we can use the <code>&lt;canvas&gt;</code> element and apply the circular mask to the image itself.</p>\n<p>Let’s use a file input element and apply the mask to the added file.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">hidden</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// get a reference to the file input</span>\n    <span class=\"token keyword\">const</span> fileInput <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// get a reference to the output canvas</span>\n    <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// listen for the change event so we can capture the file</span>\n    fileInput<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// get a reference to the file</span>\n        <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// let's load the image data</span>\n        <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        image<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// use min size so we get a square</span>\n            <span class=\"token keyword\">const</span> size <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// let's update the canvas size</span>\n            canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> size<span class=\"token punctuation\">;</span>\n            canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> size<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// draw image to canvas</span>\n            <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// only draw image where mask is</span>\n            ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> <span class=\"token string\">'destination-in'</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// draw our circle mask</span>\n            ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'#000'</span><span class=\"token punctuation\">;</span>\n            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">beginPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">arc</span><span class=\"token punctuation\">(</span>\n                size <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// x</span>\n                size <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// y</span>\n                size <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// radius</span>\n                <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// start angle</span>\n                <span class=\"token number\">2</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token comment\">// end angle</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// restore to default composite operation (is draw over current image)</span>\n            ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> <span class=\"token string\">'source-over'</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// show canvas</span>\n            canvas<span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Try it below!</p>\n<p><input type=\"file\" accept=\"image/*\" /></p>\n<p><canvas style=\"width:256px;height:256px;\" hidden=\"\" class=\"demo-canvas\"></canvas></p>\n<script>\n// get a reference to the file input\nconst fileInput = document.querySelector('input[type=\"file\"]');\n\n// get a reference to the output canvas\nconst canvas = document.querySelector('.demo-canvas');\n\n// listen for the change event so we can capture the file\nfileInput.addEventListener('change', (e) => {\n\n    // get a reference to the file\n    const file = e.target.files[0];\n\n    // let's load the image data\n    const image = new Image();\n    image.onload = () => {\n\n        // use min size so we get a square\n        const size = Math.min(image.naturalWidth, image.naturalHeight);\n\n        // let's update the canvas size\n        canvas.width = size;\n        canvas.height = size;\n\n        // draw image to canvas\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(image, 0, 0);\n\n        // only draw image where mask is\n        ctx.globalCompositeOperation = 'destination-in';\n\n        // draw our circle mask\n        ctx.fillStyle = '#000';\n        ctx.beginPath();\n        ctx.arc(\n            size * .5,          // x\n            size * .5,          // y\n            size * .5,          // radius\n            0,                  // start angle\n            2 * Math.PI         // end angle\n        );\n        ctx.fill();\n\n        // restore to default composite operation (is draw over current image)\n        ctx.globalCompositeOperation = 'source-over';\n\n        // show canvas\n        canvas.hidden = false;\n    }\n    image.src = URL.createObjectURL(file);\n\n});\n</script>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/applying-a-circular-crop-mask-to-an-image/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Drawing Decorative Lines With CSS",
    "partialText": "<p>In this short article we’ll explore drawing decorative lines with CSS using Pseudo Elements, Background Images, and SVG. After reading you’ll have learned a couple of interesting techniques for drawing section separators or other decorative line elements with CSS.</p>\n<p><img src=\"https://pqina.nl/media/decorative-line.png\" alt=\"\" /></p>\n<h2 id=\"pseudo-elements\">Pseudo elements</h2>\n<p>We can generate a <code>pseudo-element</code> using the <code>::before</code> or <code>::after</code> selectors. This adds a new child to our targeted element that we can then style as if it was a normal element.</p>\n<p>To get the browser to render the pseudo-element we need to set the <code>content</code> property.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.my-element::before</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"I'm a pseudo-element!\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> pink<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 0.25rem<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.my-element::before {\n  content: 'I\\'m a pseudo-element!';\n  background: pink;\n  padding: .25rem;\n}\n</style>\n<p>The result:</p>\n<p class=\"my-element\"></p>\n<p>Now to create a decorative line we position our pseudo-element inside the element we want to draw a line in.</p>\n<p>In the demos below I’ve centered the text and given the element a height so we can clearly see the horizontal line running behind the text, note that these properties are not shown in the example CSS.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.my-element</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.my-element::before</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* we want to draw a line, so no content needed */</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* this sets the position and size of the pseudo-element */</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 50%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 2px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> pink<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* draw behind child elements */</span>\n    <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> -1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.pseudo-demo {\n  position: relative;\n  box-shadow: inset 0 0 0 1px rgba(var(--text), .2);\n  z-index: 0;\n  color: #777;\n}\n\n.pseudo-demo::before {\n  content: '';\n  position: absolute;\n  top: 50%;\n  width: 100%;\n  display: block;\n  height: 2px;\n  background-color: pink;\n  z-index: -1;\n}\n</style>\n<p>The result:</p>\n<p class=\"pseudo-demo\" style=\"height:5rem;\">\n  <span style=\"display:block;line-height:5rem;text-align:center;\">The <code>.my-element</code> node</span>\n</p>\n<p>This method gives us a lot of flexibility but uses absolute positioning which requires the parent element to have relative positioning. This is because an element with position <code>absolute</code> is positioned relative to the first parent element found that has positioning explicitely set to <code>relative</code>.</p>\n<p>This works pretty well but can cause issues when other child elements have z-indexes applied or want to be positioned relative to an element further up in the DOM tree.</p>\n<p>We can avoid the positioning issue by using a border like this.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.my-element</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span> inset 0 0 0 1px #777<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> #777<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.my-element::before</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">padding-top</span><span class=\"token punctuation\">:</span> 2.5rem<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> -2.5rem<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border-bottom</span><span class=\"token punctuation\">:</span> 2px solid pink<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.pseudo-demo-border {\n  box-shadow: inset 0 0 0 1px rgba(var(--text), .2);\n  color: #777;\n}\n\n.pseudo-demo-border::before {\n  content: '';\n  display: block;\n  padding-top: 2.5rem;\n  margin-bottom: -2.5rem;\n  border-bottom: 2px solid pink;\n}\n</style>\n<p>The result:</p>\n<p class=\"pseudo-demo-border\" style=\"height:5rem;\">\n  <span style=\"display:block;line-height:5rem;text-align:center;\">The <code>.my-element</code> node</span>\n</p>\n<p>Still it feels a bit like a hack to create an element to draw a line and now we need to know the height of the parent element.</p>\n<h2 id=\"background-images\">Background images</h2>\n<p>We can use <code>linear-gradient</code>, <code>radial-gradient</code>, and <code>conic-gradient</code> to “generate” background images. Combined with <code>background-size</code>, <code>background-position</code>, and <code>background-repeat</code> we can use these gradients to “cheat” and draw a simple line.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.my-element</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>pink<span class=\"token punctuation\">,</span> pink<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> 100% 1px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 0 center<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.linear-gradient {\n  box-shadow: inset 0 0 0 1px rgba(var(--text), .2);\n  color: #777;\n  background-image: linear-gradient(pink, pink);\n  background-repeat: no-repeat;\n  background-size: 100% 2px;\n  background-position: 0 center;\n}\n</style>\n<p>The result:</p>\n<p class=\"linear-gradient\" style=\"height:5rem;\">\n  <span style=\"display:block;line-height:5rem;text-align:center;\">The <code>.my-element</code> node</span>\n</p>\n<p>This is a lot cleaner already, we can make this even better by creating a separate <code>decorative-line</code> class and defining a couple CSS properties.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my-element decorative-line<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Hello!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.decorative-line</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--line-color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--line-color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> 100% <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--line-height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 0 center<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.my-element</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">--line-color</span><span class=\"token punctuation\">:</span> pink<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">--line-height</span><span class=\"token punctuation\">:</span> 2px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Now we can apply the <code>decorative-line</code> class to an element and set the <code>--line-color</code> and <code>--line-height</code> properties to style it.</p>\n<p>We can now also fade-in and fade-out lines.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.my-element</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>\n        to right<span class=\"token punctuation\">,</span>\n        pink<span class=\"token punctuation\">,</span>\n        white 35%<span class=\"token punctuation\">,</span>\n        white 65%<span class=\"token punctuation\">,</span>\n        pink\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> 100% 2px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 0 center<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.linear-gradient-fade {\n  box-shadow: inset 0 0 0 1px rgba(var(--text), .2);\n  color: #777;\n  background-image: linear-gradient(to right,\n    pink,\n    white 35%,\n    white 65%, \n    pink\n  );\n  background-repeat: no-repeat;\n  background-size: 100% 2px;\n  background-position: 0 center;\n}\n</style>\n<p>The result:</p>\n<p class=\"linear-gradient-fade\" style=\"height:5rem;\">\n  <span style=\"display:block;line-height:5rem;text-align:center;\">The <code>.my-element</code> node</span>\n</p>\n<p>We can still set a background color and have multiple other background images on the target element.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.my-element</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> lavenderblush<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>pink<span class=\"token punctuation\">,</span> pink<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>palevioletred<span class=\"token punctuation\">,</span> palevioletred<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> 100% 2px<span class=\"token punctuation\">,</span> 2px 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-position</span><span class=\"token punctuation\">:</span> 0 center<span class=\"token punctuation\">,</span> 25% 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.linear-gradient-multiple {\n  box-shadow: inset 0 0 0 1px rgba(var(--text), .2);\n  color: #777;\n  background-color: lavenderblush;\n  background-image: linear-gradient(pink, pink), linear-gradient(palevioletred, palevioletred);\n  background-size: 100% 2px, 2px 100%;\n  background-position: 0 center, 25% 0;\n  background-repeat: no-repeat;\n}\n</style>\n<p>The result:</p>\n<p class=\"linear-gradient-multiple\" style=\"height:5rem;\">\n  <span style=\"display:block;line-height:5rem;text-align:center;\">The <code>.my-element</code> node</span>\n</p>\n<h2 id=\"svg-data-uris\">SVG data URIs</h2>\n<p>We can also set background images using SVGs but unfortunately we cannot use CSS variables inside the SVG data URI.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.my-element</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">'data:image/svg+xml,\\\n    &lt;svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100% 100%\">\\\n      &lt;rect x=\"0\" y=\"50%\" width=\"100%\" height=\"2px\" fill=\"pink\"/>\\\n    &lt;/svg>'</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.svg {\n  box-shadow: inset 0 0 0 1px rgba(var(--text), .2);\n  color: #777;\n  background-image: url('data:image/svg+xml,\\\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100% 100%\">\\\n      <rect x=\"0\" y=\"50%\" width=\"100%\" height=\"2px\" fill=\"pink\"/>\\\n    </svg>');\n}\n</style>\n<p>The result:</p>\n<p class=\"svg\" style=\"height:5rem;\">\n  <span style=\"display:block;line-height:5rem;text-align:center;\">The <code>.my-element</code> node</span>\n</p>\n<p>I haven’t tested this but I suspect using SVGs is slower than <code>linear-gradient</code> as it requires the browser to decode and draw the SVG. nonetheless SVG is very powerful so might be the way to go if you need to draw very exotic lines.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>There’s multiple ways we can draw decorative lines with CSS. We found pseudo elements give us a lot of flexibility but also require positioning that could introduce side effects.</p>\n<p>Using generated background images instead can be a nice work around and doesn’t introduce the positioning problems that pseudo-elements can cause.</p>\n<p>SVGs are also a nice alternative but can’t be styled with CSS Custom Properties and might be a bit slower than linear gradients.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/drawing-decorative-lines-with-css/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Pintura Image Editor Lifetime Hobby License Giveaway",
    "partialText": "<p>I want to start 2021 with a positive vibe so I’m joining Zell Liews JavaScript course giveaway. I’m giving away <strong>5 Lifetime Pintura Image Editor Hobby licenses</strong>. The usual price for the Hobby license subscription is $149 yearly.</p>\n<p>Not familiar with Pintura Image Editor? <a href=\"https://pqina.nl/pintura/?ref=pqina\">You can find a demo here</a></p>\n<p>Zell is giving away <a href=\"https://zellwk.com/blog/2021-giveaway/\">10 copies of his fantastic Learn JavaScript course</a>, this course normally costs $495.</p>\n<h2 id=\"how-to-join-the-pintura-image-editor-giveaway%3F\">How to join the Pintura Image Editor giveaway?</h2>\n<p>Subscribe to the PQINA newsletter below to enter the contest. I’ll randomly pick the 5 winners from the subscriber list on Wednesday, 13 January, 2021.</p>\n<p><em>The giveaway has ended.</em></p>\n<p>To be notified about giveaways and product updates please subscribe to the newsletter below and <a href=\"https://twitter.com/rikschennink/\">follow me on Twitter</a>.</p>\n<h2 id=\"how-to-join-the-learn-javascript-giveaway%3F\">How to join the Learn JavaScript giveaway?</h2>\n<p>Navigate to the <a href=\"https://zellwk.com/blog/2021-giveaway/\">giveaway announcement page</a> and subscribe to Zells newsletter.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/pintura-image-editor-lifetime-license-giveaway/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Applying Watermarks To Images With FilePond",
    "partialText": "<p>Watermarking photos can be a tedious task. In this quick tutorial we’ll use FilePond and the FilePond Image Transform Plugin to automatically add watermarks to images. FilePond is free and is compatible with most popular frameworks, you can use the result of this tutorial in your <a href=\"https://github.com/pqina/react-filepond\">React</a>, <a href=\"https://github.com/pqina/vue-filepond\">Vue</a>, <a href=\"https://github.com/pqina/svelte-filepond\">Svelte</a>, <a href=\"https://github.com/pqina/react-filepond\">Angular</a>, or <a href=\"https://github.com/pqina/react-filepond\">jQuery</a> projects.</p>\n<p><em>If you’re in a rush and want to skip to the result, you can <a href=\"https://codesandbox.io/s/filepond-watermark-16sl6\">play with the demo on Codesandbox</a>.</em></p>\n<p><img src=\"https://pqina.nl/media/watermark.png\" alt=\"\" /></p>\n<h2 id=\"installation\">Installation</h2>\n<p>Let’s get started by installing FilePond. We’ll go with NPM. If you want to use Yarn that’s fine as well. If you’re not familiar with NPM you can also <a href=\"https://pqina.nl/filepond/docs/patterns/installation/#manual-embedding-the-files\">manually download and reference the FilePond library files</a>.</p>\n<p>If you want to use NPM but you’re not familiar with NPM, you can find <a href=\"https://nodejs.org/en/knowledge/getting-started/npm/what-is-npm/\">more info on NPM here</a>.</p>\n<p>In this tutorial we’ll use the plain JavaScript version of FilePond. If you’re using a client-side framework you can find the required code on each FilePond framework adapter GitHub repository, the links can be found in the intro paragraph.</p>\n<p>In your project folder, run the following to install FilePond as a dependency.</p>\n<pre><code>npm i filepond --save\n</code></pre>\n<p>Since we’re also going to use the <a href=\"http://github.com/pqina/filepond-plugin-image-transform/\">Image Transform</a>, <a href=\"http://github.com/pqina/filepond-plugin-image-preview/\">Image Preview</a>, and <a href=\"http://github.com/pqina/filepond-plugin-file-metadata/\">File Metadata</a> plugins we’ll add those as well.</p>\n<pre><code>npm i filepond-plugin-image-transform filepond-plugin-image-preview filepond-plugin-file-metadata --save\n</code></pre>\n<h2 id=\"setting-up-filepond\">Setting up FilePond</h2>\n<p>Okay, our dependencies are ready, let’s set up FilePond.</p>\n<p>We add a file <code>input</code> element to the page and we set the <code>multiple</code> attribute so it can handle more than one file.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">multiple</span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>In your JavaScript file <code>import</code> the FilePond styles and scripts.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token string\">'filepond/dist/filepond.min.css'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> FilePond <span class=\"token keyword\">from</span> <span class=\"token string\">'filepond'</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Let’s turn the file <code>input</code> into a FilePond element. We can do this by calling the <code>create</code> method and supplying the <code>input</code> element.</p>\n<pre class=\"language-js\"><code class=\"language-js\">FilePond<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"file\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>FilePond is now ready. You should see a drop area similar to the one shown below.</p>\n<p>This is a live demo so you can add files to it.</p>\n<p><em>Please note that for privacy reasons demos on this page don’t upload anything.</em></p>\n<div class=\"demo\">\n    <input type=\"file\" id=\"demo-1\" multiple=\"\" />\n    <script>\n    window.addEventListener('load', function() {\n        FilePond.create(document.querySelector('#demo-1'), {\n          credits: false,\n          allowImagePreview: false\n        })\n    });\n    </script>\n</div>\n<p>It doesn’t yet show image previews or apply watermarks, that’s what we need the plugins for, let’s add them.</p>\n<h2 id=\"adding-plugins\">Adding plugins</h2>\n<p>Let’s get back to JavaScript.</p>\n<p>We can use the <code>registerPlugin</code> method to add plugins to FilePond.</p>\n<p>Our code snippet now looks like this:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Import FilePond and its styles</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'filepond/dist/filepond.min.css'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> FilePond <span class=\"token keyword\">from</span> <span class=\"token string\">'filepond'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Import the FilePond plugins</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">'filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.css'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> FilePondPluginImagePreview <span class=\"token keyword\">from</span> <span class=\"token string\">'filepond-plugin-image-preview'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> FilePondPluginImageTransform <span class=\"token keyword\">from</span> <span class=\"token string\">'filepond-plugin-image-transform'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> FilePondPluginFileMetadata <span class=\"token keyword\">from</span> <span class=\"token string\">'filepond-plugin-file-metadata'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Register the plugins with FilePond, so</span>\n<span class=\"token comment\">// FilePond knows they're available</span>\nFilePond<span class=\"token punctuation\">.</span><span class=\"token function\">registerPlugin</span><span class=\"token punctuation\">(</span>\n    FilePondPluginImagePreview<span class=\"token punctuation\">,</span>\n    FilePondPluginImageTransform<span class=\"token punctuation\">,</span>\n    FilePondPluginFileMetadata\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>The plugins are now loaded and registered.</p>\n<p>The Image Transform and File Metadata plugin won’t do anything yet. If we now add an image file to FilePond the preview plugin shows the image in the drop area.</p>\n<div class=\"demo\">\n    <input type=\"file\" multiple=\"\" id=\"demo-2\" />\n    <script>\n    window.addEventListener('load', function() {\n        FilePond.create(document.querySelector('#demo-2'), {\n          credits: false\n        })\n    });\n    </script>\n</div>\n<p>For the final step, let’s add the watermark.</p>\n<h2 id=\"setting-up-our-watermark\">Setting up our Watermark</h2>\n<p>The watermark is added to the image by the Image Transform plugin, the watermark instructions are supplied by the File Metadata plugin. The File Metadata plugin automatically adds additional information to files loaded by FilePond. This information can be used after uploading or can be used by other plugins.</p>\n<p>We can configure our watermark using <a href=\"https://pqina.nl/pintura/docs/v8/api/markup/shapes/?ref=pqina\">markup elements</a>. This markup is usually defined by <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura Image Editor</a> (an image editor plugin for FilePond) but FilePond can also render it.</p>\n<p>Since we only need to update the <code>FilePond.create</code> method, we’ll skip over the imports.</p>\n<pre class=\"language-js\"><code class=\"language-js\">FilePond<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"file\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// This property describes the metadata object that will be added to each file</span>\n    <span class=\"token literal-property property\">fileMetadataObject</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// The `markup` property is how we define our watermark</span>\n        <span class=\"token literal-property property\">markup</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token comment\">// We'll draw a 60ox rectangle aligned with</span>\n            <span class=\"token comment\">// the bottom of the image</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">'rect'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">left</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">right</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">bottom</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'60px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgba(0,0,0,.5)'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// Then we'll draw an image in the bottom right,</span>\n            <span class=\"token comment\">// in this case the FilePond logo</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">'image'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">right</span><span class=\"token operator\">:</span> <span class=\"token string\">'10px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">bottom</span><span class=\"token operator\">:</span> <span class=\"token string\">'10px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'128px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'34px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> <span class=\"token string\">'filepond-logo.svg'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">fit</span><span class=\"token operator\">:</span> <span class=\"token string\">'contain'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Let’s refresh our page, when dropping in image you can now see the watermark rendered on top of the image in the preview.</p>\n<div class=\"demo\">\n  <input type=\"file\" multiple=\"\" id=\"demo-3\" />\n  <script>\n  window.addEventListener('load', function() {\n      FilePond.create(document.querySelector('#demo-3'), {\n        credits: false,\n        fileMetadataObject: {\n          markup: [\n            [\n              \"rect\",\n              {\n                left: 0,\n                right: 0,\n                bottom: 0,\n                height: \"60px\",\n                backgroundColor: \"rgba(0,0,0,.5)\"\n              }\n            ],\n            [\n              \"image\",\n              {\n                right: \"10px\",\n                bottom: \"10px\",\n                width: \"128px\",\n                height: \"34px\",\n                src: \"/static/assets/logo-filepond-white.svg\",\n                fit: \"contain\"\n              }\n            ]\n          ]\n        }\n      })\n  });\n  </script>\n</div>\n<p>We’ll add the <code>onpreparefile</code> callback to get the output of the image transform action so we can see the actual resulting file.</p>\n<pre class=\"language-js\"><code class=\"language-js\">FilePond<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"file\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// onpreparefile is called when the image transform plugin</span>\n    <span class=\"token comment\">// has transformed an image, in this demo we use it to</span>\n    <span class=\"token comment\">// show the result of the file transformation</span>\n    <span class=\"token function-variable function\">onpreparefile</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">file<span class=\"token punctuation\">,</span> output</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        result<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// The `fileMetadataObject` property describes the metadata object</span>\n    <span class=\"token comment\">// that will be added to each file</span>\n    <span class=\"token literal-property property\">fileMetadataObject</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// The `markup` property is how we define our watermark</span>\n        <span class=\"token literal-property property\">markup</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token comment\">// We'll draw a 60ox rectangle aligned with</span>\n            <span class=\"token comment\">// the bottom of the image</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">'rect'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">left</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">right</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">bottom</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'60px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">backgroundColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'rgba(0,0,0,.5)'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// Then we'll draw an image in the bottom right,</span>\n            <span class=\"token comment\">// in this case the FilePond logo</span>\n            <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">'image'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">right</span><span class=\"token operator\">:</span> <span class=\"token string\">'10px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">bottom</span><span class=\"token operator\">:</span> <span class=\"token string\">'10px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token string\">'128px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token string\">'34px'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> <span class=\"token string\">'filepond-logo.svg'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">fit</span><span class=\"token operator\">:</span> <span class=\"token string\">'contain'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>When we add an image to FilePond, it will load the image, transform the image data with the watermark, and then add the resulting image to the page.</p>\n<p><a href=\"https://codesandbox.io/s/filepond-watermark-16sl6\">Play with the demo on Codesandbox</a></p>\n<div class=\"demo\">\n  <input type=\"file\" multiple=\"\" id=\"demo-4\" />\n  <script>\n  window.addEventListener('load', function() {\n    FilePond.create(document.querySelector('#demo-4'), {\n        credits: false,\n        onpreparefile: function(file, output) {\n            const result = new Image();\n            result.src = URL.createObjectURL(output);\n            document.querySelector('#demo-4').parentNode.appendChild(result);\n        },\n        fileMetadataObject: {\n            markup: [\n                [\n                    \"rect\",\n                    {\n                        left: 0,\n                        right: 0,\n                        bottom: 0,\n                        height: \"60px\",\n                        backgroundColor: \"rgba(0,0,0,.5)\"\n                    }\n                ],\n                [\n                    \"image\",\n                    {\n                        right: \"10px\",\n                        bottom: \"10px\",\n                        width: \"128px\",\n                        height: \"34px\",\n                        src: \"/static/assets/logo-filepond-white.svg\",\n                        fit: \"contain\"\n                    }\n                ]\n            ]\n        }\n    })\n  });\n  </script>\n</div>\n<p>In a real life project we probably want to upload our file somewhere.</p>\n<p>We can do this by setting the <a href=\"https://pqina.nl/filepond/docs/patterns/api/server/\"><code>server</code> property</a>. If we set it to a URL, FilePond will automatically try to <code>POST</code> the image data to the server located at the URL.</p>\n<pre class=\"language-js\"><code class=\"language-js\">FilePond<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"file\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// FilePond will POST files</span>\n    <span class=\"token comment\">// to https://website/my-server-location/</span>\n    <span class=\"token literal-property property\">server</span><span class=\"token operator\">:</span> <span class=\"token string\">'./my-server-location/'</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// Our other properties here</span>\n    <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>That’s it, we’re done!</p>\n<p>FilePond will now automatically push dropped files to our server.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We installed FilePond and set it up with the required plugins to render watermarks to images. We learned a tiny bit about using Pintura markup to define our watermarks and how to preview our resulting image in the browser. Finallly we quickly looked at how to upload images to our server.</p>\n<div>\n<style>\n.demo {\n    max-width: 24em;\n}\n\n.demo .filepond--root canvas {\n    max-width: none;\n    margin: 0;\n}\n</style>\n<link href=\"https://unpkg.com/filepond/dist/filepond.min.css\" rel=\"stylesheet\" />\n<script src=\"https://unpkg.com/filepond/dist/filepond.min.js\"></script>\n<link href=\"https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.css\" rel=\"stylesheet\" />\n<script src=\"https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.js\"></script>\n<script src=\"https://unpkg.com/filepond-plugin-image-transform/dist/filepond-plugin-image-transform.min.js\"></script>\n<script src=\"https://unpkg.com/filepond-plugin-file-metadata/dist/filepond-plugin-file-metadata.min.js\"></script>\n<script>\nFilePond.registerPlugin(\n  FilePondPluginImagePreview,\n  FilePondPluginImageTransform,\n  FilePondPluginFileMetadata\n);\n</script>\n</div>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/applying-watermarks-to-images-with-filepond/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Cross-Browser Alignment Of The Canvas FillText Draw Call",
    "partialText": "<p>If we use the HTML5 canvas <code>fillText</code> API and compare output from various browsers we see that the draw offset differs slightly. In this quick tutorial we’ll use a snippet to determine this offset and then correct the draw position.</p>\n<p><img src=\"https://pqina.nl/media/filltext.png\" alt=\"\" /></p>\n<h2 id=\"differences\">Differences</h2>\n<p>The article banner is just an impression, but reality is not far off. We can see the actual difference in draw offset below, it’s just a few pixels, but it’s there.</p>\n<p><img src=\"https://pqina.nl/media/filltext-real.png\" alt=\"\" /></p>\n<p>When drawing image data on the client, like for example with <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura Image Editor</a>, we want every browser to deliver the same output.</p>\n<h2 id=\"solution\">Solution</h2>\n<p>We can solve this issue by drawing an “F” character to a canvas element and then looking for the first horizontal pixel and the first vertical pixel where it was drawn.</p>\n<p>Let’s draw a big “F”. A size of <code>100px</code> should suffice. We want to align our text from the top, so we set <code>textBaseline</code> top <code>&quot;top&quot;</code>.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// create the canvas</span>\n<span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token number\">32</span><span class=\"token punctuation\">;</span>\ncanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">32</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// do the drawing</span>\n<span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nctx<span class=\"token punctuation\">.</span>font <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">100px sans-serif</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\nctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">'#fff'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// color of our F</span>\nctx<span class=\"token punctuation\">.</span>textBaseline <span class=\"token operator\">=</span> <span class=\"token string\">'top'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// alignment</span>\nctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'F'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// finally draw the F</span></code></pre>\n<p>This will draw the “F” in the top left corner. We don’t need to know everything about this “F”. We’re only interested in the top and left pixels, that’s why our canvas is so small. See below for the result.</p>\n<p><canvas class=\"drawn\" width=\"32\" height=\"32\" style=\"background:#000;\"></canvas></p>\n<script>\nvar offset;\n(function() {\n  const canvas = document.querySelector('canvas.drawn');\n  const ctx = canvas.getContext('2d');\n  ctx.font = `100px sans-serif`;\n  ctx.fillStyle = '#fff';\n  ctx.textBaseline = 'top';\n  ctx.fillText('F', 0, 0);\n}())\n</script>\n<p>Now we need to find out where it was drawn. We’ll use the canvas <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/getImageData\"><code>getImageData</code></a> method to get an array of pixel values to work with. Each index in the array represents a color value. A pixel consists of 4 colors, as our canvas is 32 pixels width, each “line” of the image consist of 4 * 32 indexes.</p>\n<p>We’ll traverse the image vertically along the right most edge, and horizontally along the bottom. That should result in us bumping into our “F”.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// get pixel data so we can find the white pixels</span>\n<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getImageData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// \"pixel\" position p in data</span>\n<span class=\"token keyword\">let</span> p<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// find x offset (bottom row of pixels)</span>\n<span class=\"token keyword\">let</span> from <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">32</span> <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// increase by 4 to step through the data per pixel instead of per color value</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> from<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> p <span class=\"token operator\">+=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// stop when we find a value other than 0</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span>p<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// calculate the x offset based on the current pixel</span>\n<span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">-</span> from<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// find y offset (right column of pixels)</span>\nfrom <span class=\"token operator\">=</span> <span class=\"token number\">31</span> <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> from<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> p <span class=\"token operator\">+=</span> <span class=\"token number\">32</span> <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span>p<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// calculate the y offset based on the current pixel</span>\n<span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>p <span class=\"token operator\">-</span> from<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span><span class=\"token number\">32</span> <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// log the position to the console (it's there, go take a look)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Now we have the browser offset based on a <code>100px</code> font size. We can convert this to another font size by multiplying our font size by <code>0.01</code> and then multiplying by our browser offset.</p>\n<p>We’ll further invert the browser offset to compensate for the discrepancy among browsers.</p>\n<p>Our compensated font offset for a <code>16px</code> font:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> xOffset <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>x <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> yOffset <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>y <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>If we use these offsets in our <code>fillText</code> function it’ll render the text at the correct position on each browser.</p>\n<p>To prevent text from being drawn too far to the left we can set a default offset. A value like <code>{ x: 8, y: 4 }</code> should be fine.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> xOffset <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>x <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> yOffset <span class=\"token operator\">=</span> <span class=\"token operator\">-</span>y <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">16</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span></code></pre>\n<p>The uncorrected output, this should (shouldn’t but that’s reality) be different for each browser:</p>\n<div style=\"margin: 2em 0\">\n<canvas class=\"uncorrected\" width=\"32\" height=\"32\" style=\"background:#000; margin-bottom: .5em;\"></canvas>\n<p class=\"fill-text-position\" style=\"color: #777; font-size: .875em; text-align:center; margin: 0;\"></p>\n</div>\n<script>\nvar offset;\n(function() {\n  const canvas = document.querySelector('canvas.uncorrected');\n  const ctx = canvas.getContext('2d');\n  ctx.font = `100px sans-serif`;\n  ctx.fillStyle = '#fff';\n  ctx.textBaseline = 'top';\n  ctx.fillText('F', 0, 0);\n  const data = ctx.getImageData(0, 0, 32, 32).data;\n  let p;\n  let from = data.length - (32 * 4);\n  for (p = from; p < data.length; p += 4) {\n      if (data[p]) break;\n  }\n  const x = (p - from) / 4;\n  from = 31 * 4;\n  for (p = from; p < data.length; p += 32 * 4) {\n      if (data[p]) break;\n  }\n  const y = (p - from) / (32 * 4);\n  document.querySelector('.fill-text-position').innerHTML = 'font offset: {x: ' + x + ', y: ' + y + '}';\n  offset = {\n    x: x,\n    y: y\n  }\n  console.log(x, y);\n}())\n</script>\n<p>With correction applied, the image below should the same on every browser:</p>\n<div style=\"margin: 2em 0\">\n<canvas class=\"corrected\" width=\"32\" height=\"32\" style=\"background:#000; margin-bottom: .5em;\"></canvas>\n<p class=\"fill-text-position-corrected\" style=\"color: #777; font-size: .875em; text-align:center; margin: 0;\"></p>\n</div>\n<script>\n(function() {\n  const canvas = document.querySelector('canvas.corrected');\n  const ctx = canvas.getContext('2d');\n  ctx.font = `100px sans-serif`;\n  ctx.fillStyle = '#fff';\n  ctx.textBaseline = 'top';\n  ctx.fillText('F', -offset.x + 8, -offset.y + 4);\n  document.querySelector('.fill-text-position-corrected').innerHTML = 'font offset: {x: ' + (-offset.x + 8) + ', y: ' + (-offset.y + 4) + '}';\n}())\n</script>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>By measuring the actual draw position of each browser we can determine a new position to draw to and align text positions accross multiple browsers. Note that so far this has been tested on Safari, Chrome, and Firefox, there are other browsers out there that might yield different results.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/cross-browser-alignment-of-the-canvas-filltext-draw-call/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Blocking Navigation Gestures On iOS Safari",
    "partialText": "<p>iOS Safari 13.4+ allows us to block back and forward navigation gestures. Super useful for media galleries and <a href=\"https://pqina.nl/pintura/?ref=pqina\">image croppers</a> where users interact with elements on the side of the viewport and most likely don’t want to navigate to another page. Let’s take a minute and look at the code snippet.</p>\n<p>The only thing we need to do is prevent the default action of the <code>&quot;touchstart&quot;</code> event. We can do this with the <code>preventDefault()</code> method.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">height</span><span class=\"token punctuation\">:</span>100px</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>Our element that prevents navigation<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    element<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'touchstart'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// prevent swipe to navigate gesture</span>\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Open this article on iOS 13.4+ and try it out with the element below.</p>\n<div class=\"block\" style=\"margin: 2rem 0 2rem -1rem; width: calc(100% + 2rem);background:#111; color:#eee; box-sizing: border-box;text-align:center; padding: 2em;\">This element prevents navigation, swipe from left to right from the edge of the screen, nothing will happen.</div>\n<script>\nconst element = document.querySelector('.block');\nelement.addEventListener('touchstart', (e) => {\n  // is not near edge of view, exit\n  if (e.pageX > 20 && e.pageX < window.innerWidth - 20) return;\n  // prevent swipe to navigate back gesture\n  e.preventDefault();\n});\n</script>\n<p>A demo on iOS</p>\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/ios-swipe.mp4\" type=\"video/mp4\" />\n</video>\n<p>We do need to check if the <code>&quot;touchstart&quot;</code> event originated near the edge of the viewport, if we don’t the user won’t be able to scroll the view, we can do this by checking if <code>pageX</code> is below or above a certain value.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">height</span><span class=\"token punctuation\">:</span>100px</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>Our element that prevents navigation<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    element<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'touchstart'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// is not near edge of view, exit</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>pageX <span class=\"token operator\">></span> <span class=\"token number\">20</span> <span class=\"token operator\">&amp;&amp;</span> e<span class=\"token punctuation\">.</span>pageX <span class=\"token operator\">&lt;</span> window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">-</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// prevent swipe to navigate back gesture</span>\n        e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>That’s it!</p>\n<p>We can now prevent users from accidentally navigating to another page. With great power comes great responsibility. We don’t want to frustrate users, so only use this where it makes sense, for example in a full width swipeable image gallery or when users interact with controls near the edge of the screen.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/blocking-navigation-gestures-on-ios-13-4/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Rename A File With JavaScript In The Browser",
    "partialText": "<p>A super concise tutorial on using JavaScript to rename files in the browser. We’ll quickly cover how to update a file object and read its contents. Let’s get started!</p>\n<p><img src=\"https://pqina.nl/media/rename.png\" alt=\"\" /></p>\n<h2 id=\"updating-the-file-object\">Updating the File Object</h2>\n<p>Let’s create a new file using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/File/File\"><code>File</code> constructor</a>, we’ll then rename this file in a couple seconds.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> myFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hello-world'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'my-file.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Time to rename our file…</p>\n<pre class=\"language-js\"><code class=\"language-js\">myFile<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'my-file-final-1-really.txt'</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>newFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Browser logs: File {name: \"my-file.txt\", …}</span></code></pre>\n<p>Nope, didn’t work. Turns out we can’t update the <code>name</code> property of a file.</p>\n<p>To rename a file we have to create a new file and pass our new name to the <code>File</code> constructor.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> myRenamedFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>myFile<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'my-file-final-1-really.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myRenamedFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Browser logs: File {name: \"my-file-final-1-really.txt\", …}</span></code></pre>\n<p>To check if the file contents is the same we can read our file using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileReader\">FileReader API</a>.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> myReader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyReader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsText</span><span class=\"token punctuation\">(</span>myRenamedFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmyReader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>myReader<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Browser logs: \"hello-world\"</span></code></pre>\n<p>Great, it has the same contents. ☀️</p>\n<p>Surprise, this doesn’t work on Internet Explorer 11. ⛈</p>\n<p>We can work around the age of IE11 by creating a <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob/Blob\"><code>Blob</code></a> instead of a file object. Let’s create a tiny helper function that safely does this for us.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createFile</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">bits<span class=\"token punctuation\">,</span> name</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If this call fails, we go for Blob</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>bits<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If we reach this point a new File could not be constructed</span>\n        <span class=\"token keyword\">var</span> myBlob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span>bits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        myBlob<span class=\"token punctuation\">.</span>lastModified <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        myBlob<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> myBlob<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Now we can safely create files like this:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> mySafeFile <span class=\"token operator\">=</span> <span class=\"token function\">createFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hello-world'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'my-file.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>mySafeFile<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Modern browser logs: File {name: \"my-file.txt\", …}</span>\n<span class=\"token comment\">// Internet Explorer logs: Blob {name: \"my-file.txt\", …}</span></code></pre>\n<p>Yay! 🎉</p>\n<p>Note that the <code>File</code> constructor also takes a third “options” argument, this can contain the <code>type</code> of the file and the <code>lastModified</code> date of the file.</p>\n<p>Let’s update our <code>createFile</code> function so it also supports the “options” argument.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createFile</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">bits<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If this fails, we go for Blob</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span>bits<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If we're here a new File could not be constructed</span>\n        <span class=\"token keyword\">var</span> myBlob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span>bits<span class=\"token punctuation\">,</span> options <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        myBlob<span class=\"token punctuation\">.</span>lastModified <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        myBlob<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> myBlob<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Now we can create an actual <code>plain/text</code> file.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> myTextFile <span class=\"token operator\">=</span> <span class=\"token function\">createFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hello-world'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'my-file.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'plain/text'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>A small caveat. Our files can now be of type <code>Blob</code> or <code>File</code>. When using the <code>instanceof</code> operator to test for types it’s best to test for <code>Blob</code>.</p>\n<p>The following will be <code>true</code> on modern browsers but <code>false</code> on browsers that don’t support the <code>File</code> constructor (like Internet Explorer 11).</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> testFile <span class=\"token operator\">=</span> <span class=\"token function\">createFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hello-world'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'my-test.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>testFile <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Modern browser logs: true</span>\n<span class=\"token comment\">// Internet Explorer logs: false</span></code></pre>\n<p>Testing for <code>Blob</code> instead of <code>File</code> will return the correct result on all browsers as <code>File</code> is a subclass of <code>Blob</code>.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> testFile <span class=\"token operator\">=</span> <span class=\"token function\">createFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hello-world'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'my-test.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>testFile <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Modern browser logs: true</span>\n<span class=\"token comment\">// Internet Explorer logs: true</span></code></pre>\n<p>That’s it!</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We learned that updating a file object is not possible but that we can easily copy the contents of a file to a new file and give our new file a name.</p>\n<p>To verify that the contents of the file was actually copied we took a quick look using the <code>FileReader</code> API.</p>\n<p>Finally to help with cross browser compatibility we created a tiny function that can create a “File” object on all relevant browsers, “relevant” being relative.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/rename-a-file-with-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Flipping Images Horizontally Or Vertically With CSS And JavaScript",
    "partialText": "<p>In this 3 minute article we’ll look at flipping images horizontally and vertically using CSS and JavaScript. We’ll explore how to flip an <code>img</code> element, a <code>background-image</code>, or flip the actual <code>ImageData</code> using a <code>canvas</code> element.</p>\n<p><img src=\"https://pqina.nl/media/flip.png\" alt=\"\" /></p>\n<h2 id=\"flipping-an-image-element\">Flipping an Image Element</h2>\n<p>We can flip the <code>img</code> element using the CSS <code>transform</code> property. We can do so using the <code>scaleX</code> and <code>scaleY</code> transforms.</p>\n<p>Our image:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/media/tulips.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>The CSS to flip it.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* flip horizontally */</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* flip vertically */</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleY</span><span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* flip both */</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scale</span><span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">,</span> -1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo demo-row demo-row-fit\" data-theme=\"drop-shadows round-corners\">\n    <div>\n        <img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" />\n        <span>original</span>\n    </div>\n    <div>\n        <img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" style=\"transform: scaleX(-1)\" />\n        <span>scaleX(-1)</span>\n    </div>\n    <div>\n        <img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" style=\"transform: scaleY(-1)\" />\n        <span>scaleY(-1)</span>\n    </div>\n    <div>\n        <img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" style=\"transform: scale(-1, -1)\" />\n        <span>scale(-1, -1)</span>\n    </div>\n</div>\n<p>Alternatively you can use <code>rotateX</code> and <code>rotateY</code></p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* flip horizontally */</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rotateY</span><span class=\"token punctuation\">(</span>180deg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* flip vertically */</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rotateX</span><span class=\"token punctuation\">(</span>180deg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* flip both */</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rotateX</span><span class=\"token punctuation\">(</span>180deg<span class=\"token punctuation\">)</span> <span class=\"token function\">rotateY</span><span class=\"token punctuation\">(</span>180deg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo demo-row demo-row-fit\" data-theme=\"drop-shadows round-corners\">\n    <div>\n        <img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" />\n        <span>original</span>\n    </div>\n    <div>\n        <img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" style=\"transform: rotateY(180deg)\" />\n        <span>rotateY(180deg)</span>\n    </div>\n    <div>\n        <img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" style=\"transform: rotateX(180deg)\" />\n        <span>rotateX(180deg)</span>\n    </div>\n    <div>\n        <img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" style=\"transform: rotateX(180deg) rotateY(180deg)\" />\n        <span>rotateX(180deg)<br />rotateY(180deg)</span>\n    </div>\n</div>\n<p>The rotation transform is also a nice choice for when you want to animate the flip.</p>\n<style>\n.flip {\n    animation-timing-function: ease-in-out;\n    animation-duration: 2s;\n    animation-direction: alternate;\n    animation-iteration-count: infinite;\n    max-width: 10em !important;\n}\n\n.flip-r {\n    animation-name: flip-r;\n}\n\n.flip-s {\n    animation-name: flip-s;\n}\n\n@keyframes flip-s {\n    0% { transform: perspective(400px) scaleX(1); }\n    100% { transform: perspective(400px) scaleX(-1); }\n}\n\n@keyframes flip-r {\n    0% { transform: perspective(400px) rotateY(0); }\n    100% { transform: perspective(400px) rotateY(180deg); }\n}\n</style>\n<div class=\"demo demo-row demo-row-fit\" data-theme=\"round-corners\">\n    <div>\n        <img class=\"flip flip-s\" src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" />\n        <span>scaleX</span>\n    </div>\n    <div>\n        <img class=\"flip flip-r\" src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" />\n        <span>rotateY</span>\n    </div>\n</div>\n<p>Note that I’ve added a slight perspective to the transform chain. Without the perspective transform the <code>rotateY</code> animation would be just as flat as the <code>scaleX</code> animation. I’ve added it to the scaleX animation as well to show that it doesn’t make a difference.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> flip-with-scale</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">0%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">perspective</span><span class=\"token punctuation\">(</span>400px<span class=\"token punctuation\">)</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token selector\">100%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">perspective</span><span class=\"token punctuation\">(</span>400px<span class=\"token punctuation\">)</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> flip-with-rotate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">0%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">perspective</span><span class=\"token punctuation\">(</span>400px<span class=\"token punctuation\">)</span> <span class=\"token function\">rotateY</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token selector\">100%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">perspective</span><span class=\"token punctuation\">(</span>400px<span class=\"token punctuation\">)</span> <span class=\"token function\">rotateY</span><span class=\"token punctuation\">(</span>180deg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"flipping-a-background-image\">Flipping a Background Image</h2>\n<p>The only way (at this point in time) (and as far as I can tell) to flip a <code>background-image</code> is to flip the element containing the background image. But that would flip its contents as well.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tulips<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    Tulips form a genus of spring-blooming perennial herbaceous bulbiferous\n    geophytes.\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.tulips</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>/media/tulips.jpg<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> contain<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">padding-left</span><span class=\"token punctuation\">:</span> 5em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.tulips-flipped</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.tulips {\n    max-width: 10em;\n    background-image: url(/media/tulips.jpg);\n    background-repeat: no-repeat;\n    background-size: contain;\n    padding-left: 5em;\n}\n\n.tulips-flipped {\n    transform: scaleX(-1);\n}\n</style>\n<div class=\"demo demo-row\">\n    <div>\n        <p class=\"tulips\">\n            Tulips form a genus of spring-blooming perennial herbaceous bulbiferous geophytes. \n        </p>\n        <span>original</span>\n    </div>\n    <div>\n        <p class=\"tulips tulips-flipped\">\n            Tulips form a genus of spring-blooming perennial herbaceous bulbiferous geophytes. \n        </p>\n        <span>scaleX(-1)</span>\n    </div>\n</div>\n<p>Not great 🤷‍♂️</p>\n<p>To work around this we can either move the background to a separate element or create a pseudo-element.</p>\n<p>Let’s go with the pseudo-element.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.tulips</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 15em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* create our pseudo element */</span>\n<span class=\"token selector\">.tulips-flipped::before</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>/media/tulips.jpg<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> cover<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">min-width</span><span class=\"token punctuation\">:</span> 5em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* flip our pseudo element */</span>\n<span class=\"token selector\">.tulips-flipped::before</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>-1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<style>\n.tulips-fixed {\n    display: flex;\n    width: 15em;\n}\n\n.tulips-fixed::before {\n    content: '';\n    background-image: url(/media/tulips.jpg);\n    background-repeat: no-repeat;\n    background-size: cover;\n    min-width: 5em;\n}\n\n.tulips-fixed-flipped::before {\n    transform: scaleX(-1);\n}\n\n</style>\n<div class=\"demo demo-row\">\n    <div>\n        <p class=\"tulips-fixed\">\n            Tulips form a genus of spring-blooming perennial herbaceous bulbiferous geophytes. \n        </p>\n        <span>original</span>\n    </div>\n    <div>\n        <p class=\"tulips-fixed tulips-fixed-flipped\">\n            Tulips form a genus of spring-blooming perennial herbaceous bulbiferous geophytes. \n        </p>\n        <span>scaleX(-1)</span>\n    </div>\n</div>\n<h2 id=\"flipping-an-image-with-javascript\">Flipping an Image with JavaScript</h2>\n<p>The CSS flipping techniques only alter the presentation of an image, not the actual pixel data. We can flip the pixel data using the <code>canvas</code> element. This might be useful if for example we want to flip an image before it’s uploaded to a server.</p>\n<div aria-hidden=\"true\" class=\"promoted-product-banner\">\n<p>Quick shoutout to some products I built that might be helpful to you.</p>\n<ul>\n<li class=\"product-item\">\n  <span class=\"logo-pintura\"></span>\n  <p class=\"implicit\">Pintura</p>\n  <p class=\"product-description\">\n    A JavaScript Image Editor that integrates with every stack.\n  </p>\n  <a href=\"https://pqina.nl/pintura/?ref=pqina-article\" target=\"_blank\">Get started with Pintura</a>\n</li>\n<li class=\"product-item\">\n  <span class=\"logo-filepond\"></span>\n  <p class=\"implicit\">FilePond</p>\n  <p class=\"product-description\">\n    A free JavaScript File Manager that uploads anything you throw at it.\n  </p>\n  <a href=\"https://pqina.nl/filepond/?ref=pqina-article\" target=\"_blank\">Get started with FilePond</a>\n</li>\n</ul>\n<p>Let's get back to our adventure!</p>\n</div>\n<p>We’ll use the image data in the image element below the code snippet, it’s simply an <code>img</code> tag with a class name set to <code>image-tulips</code>.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/media/tulips.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-tulips<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<p>Lets get a reference to the image. That allows us to load it to a <code>canvas</code> element for manipulation.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> inputImage <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.image-tulips'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// need to check if the image has already loaded</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">.</span>complete<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">flipImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// if not, we wait for the onload callback to fire</span>\n<span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    inputImage<span class=\"token punctuation\">.</span>onload <span class=\"token operator\">=</span> flipImage<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// this function will flip the imagedata</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">flipImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// create a canvas that will present the output image</span>\n    <span class=\"token keyword\">const</span> outputImage <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// set it to the same size as the image</span>\n    outputImage<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">;</span>\n    outputImage<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// get the drawing context, needed to draw the new image</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> outputImage<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// scale the drawing context negatively to the left (our image is 400 pixels wide)</span>\n    <span class=\"token comment\">// resulting change to context: 0 to 400 -> -400 to 0</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">scale</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// draw our image at position [-width, 0] on the canvas, we need</span>\n    <span class=\"token comment\">// a negative offset because of the negative scale transform</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>outputImage<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// insert the output image after the input image</span>\n    inputImage<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>\n        outputImage<span class=\"token punctuation\">,</span>\n        inputImage<span class=\"token punctuation\">.</span>nextElementSibling\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>The above code just ran, and you can view the result below. The first image is the <code>inputImage</code> and the second image is the <code>outputImage</code> canvas element.</p>\n<style>\n.demo-tulips {\n    margin: 2em 0 !important;\n}\n\n.demo-tulips img,\n.demo-tulips canvas {\n    max-width: 10em !important;\n}\n</style>\n<div class=\"demo demo-row demo-tulips\" data-theme=\"drop-shadows round-corners\">\n<img src=\"https://pqina.nl/media/tulips.jpg\" alt=\"\" class=\"image-tulips\" />\n<script>\nconst inputImage = document.querySelector('.image-tulips');\n\n// need to check if the image has already loaded\nif (inputImage.complete) {\n    flipImage();\n}\n// if not, we wait for the onload callback to fire\nelse {\n    inputImage.onload = flipImage;\n}\n\n// this function will flip the imagedata\nfunction flipImage() {\n    \n    // create a canvas that will present the output image\n    const outputImage = document.createElement('canvas');\n\n    // set it to the same size as the image\n    outputImage.width = inputImage.naturalWidth;\n    outputImage.height = inputImage.naturalHeight;\n    \n    // get the drawing context, needed to draw the new image\n    const ctx = outputImage.getContext('2d');\n\n    // flip the drawing context\n    ctx.scale(-1, 1);\n\n    // draw our image at position [-width, 0] on the canvas, we need \n    // a negative offset because of the negative scale transform\n    ctx.drawImage(inputImage, -outputImage.width, 0);\n    \n    // insert the output image after the input image\n    inputImage.parentNode.insertBefore(outputImage, inputImage.nextElementSibling);\n}\n</script>\n</div>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We learned three methods to flip images for various purposes. We can flip images using the CSS <code>transform</code> property. The <code>scaleX</code> and <code>scaleY</code> transforms work but the <code>rotateX</code> and <code>rotateY</code> transforms allow for nicer animation (if needed). We quickly explored flipping background images using pseudo elements and ended the article with manipulating the actual image data using JavaScript and a canvas element.</p>",
    "date": "2026-02-19T16:00:01.778Z",
    "url": "https://pqina.nl/blog/flipping-images-with-css-and-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Animating CSS Width And Height Without The Squish Effect",
    "partialText": "<p>Being able to animate the CSS <code>width</code> and <code>height</code> properties would be super useful. Unfortunately at the moment it’s a sure-fire way to get your browser to scream in agony. In this 5 minute tutorial we’ll explore using the <code>transform</code> property to simulate animating the width of an element.</p>\n<p><img src=\"https://pqina.nl/media/squish.png\" alt=\"\" /></p>\n<style>\n:root {\n    --fill: #222;\n}\n\n:root[data-theme='dark'] {\n    --fill: #eee;\n}\n\n.square {\n    width: 100px;\n    height: 100px;\n    background: var(--fill);\n    border-radius: 20px;\n    text-align: center;\n    line-height: 100px;\n    font-size: 30px;\n}\n\n.square-resized {\n    width: 50px;\n}\n\n.square-transformed {\n    transform: scaleX(.5);\n}\n\n.square-transformed.square-animated {\n    animation: square-transform-animate 1s ease infinite alternate;\n}\n\n@keyframes square-transform-animate {\n    0% {\n        transform: scaleX(.5);\n    }\n\n    100% {\n        transform: scaleX(1.5);\n    }\n}\n\n\n.square-slice {\n    position: relative;\n    height: 100px;\n}\n\n.square-slice-left,\n.square-slice-center,\n.square-slice-right {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    background: var(--fill);\n}\n\n.square-slice.square-colored .square-slice-left { background: #e26855; }\n.square-slice.square-colored .square-slice-center { background: #f5d45b; }\n.square-slice.square-colored .square-slice-right { background: #80a9f5; }\n\n\n\n.square-slice-left,\n.square-slice-right {\n    width: 20px;\n}\n\n.square-slice-left {\n    border-radius: 20px 0 0 20px;\n}\n\n.square-slice-right {\n    border-radius: 0 20px 20px 0;\n}\n\n.square-slice-center {\n    left: 20px;\n    width: 1px;\n    transform-origin: 0 0;\n    transform: scaleX(60);\n}\n\n.square-slice-right {\n    transform: translateX(80px);\n}\n\n\n\n.square-slice.square-animated .square-slice-center {\n    animation: square-slice-center-animate 1s ease infinite alternate;\n}\n\n.square-slice.square-animated .square-slice-right {\n    animation: square-slice-right-animate 1s ease infinite alternate;\n}\n\n.square-slice.square-animated-corrected .square-slice-center {\n    animation: square-slice-center-animate-corrected 1s ease infinite alternate;\n}\n\n@keyframes square-slice-right-animate {\n    0% {\n        transform: translateX(140px);\n    }\n\n    100% {\n        transform: translateX(20px);\n    }\n}\n\n@keyframes square-slice-center-animate {\n    0% {\n        transform: scaleX(120);\n    }\n\n    100% {\n        transform: scaleX(0);\n    }\n}\n\n@keyframes square-slice-center-animate-corrected {\n    0% {\n        transform: scaleX(121);\n    }\n\n    100% {\n        transform: scaleX(1);\n    }\n}\n\n\n\n.demo-9-slice {\n    display: grid;\n    grid-template-columns: 3em auto 3em;\n    grid-template-rows: 3em auto 3em;\n}\n\n.demo-9-slice div {\n    border: 2px solid rgb(var(--text));\n    color: var(--text);\n    text-align: center;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-weight:500;\n}\n\n.demo-9-slice div:nth-child(1),\n.demo-9-slice div:nth-child(2),\n.demo-9-slice div:nth-child(4),\n.demo-9-slice div:nth-child(5),\n.demo-9-slice div:nth-child(7),\n.demo-9-slice div:nth-child(8) {\n    border-right: 0;\n}\n\n.demo-9-slice div:nth-child(1),\n.demo-9-slice div:nth-child(2),\n.demo-9-slice div:nth-child(3),\n.demo-9-slice div:nth-child(4),\n.demo-9-slice div:nth-child(5),\n.demo-9-slice div:nth-child(6) {\n    border-bottom: 0;\n}\n\n.demo-9-slice div:nth-child(1) {\n    border-radius: 1.5em 0 0 0;\n}\n.demo-9-slice div:nth-child(3) {\n    border-radius: 0 1.5em 0 0;\n}\n.demo-9-slice div:nth-child(7) {\n    border-radius: 0 0 0 1.5em;\n}\n.demo-9-slice div:nth-child(9) {\n    border-radius: 0 0 1.5em 0;\n}\n\n\n.demo-3-slice {\n    display: grid;\n    grid-template-columns: 3em auto 3em;\n}\n\n.demo-3-slice div {\n    border: 2px solid rgb(var(--text));\n    color: var(--text);\n    text-align: center;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-weight:500;\n}\n\n.demo-3-slice div:nth-child(1),\n.demo-3-slice div:nth-child(2) {\n    border-right: 0;\n}\n\n.demo-3-slice div:nth-child(1) {\n    border-radius: 1.5em 0 0 1.5em;\n}\n.demo-3-slice div:nth-child(3) {\n    border-radius: 0 1.5em 1.5em 0;\n}\n</style>\n<h2 id=\"don%E2%80%99t-animate-the-width-and-height-properties\">Don’t Animate the Width and Height Properties</h2>\n<p>Browsers don’t like it when they have to calculate the positions and sizes of elements on the webpage. Most elements in some way impact the rendering of other elements, they push siblings to another position, or when their size is changed a parent element also changes size. Modifying the dimensions of one element can therefore have lots of unforeseen consequences.</p>\n<p>Changing the <code>width</code> and/or <code>height</code> of an element will trigger the browser to determine which other elements (children, siblings, or parents) are impacted by the change and how those elements should be updated. This process is called a <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Reflow\">reflow</a> and it will be followed by a repaint.</p>\n<p>These operations are very taxing on the CPU, so to keep a website fast we should avoid triggering them as much as possible.</p>\n<h2 id=\"using-transforms-instead\">Using Transforms Instead</h2>\n<p>To run performant animations we need to use the CSS <code>transform</code> or <code>opacity</code> properties. In this article we’ll focus on <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/transform\"><code>transform</code></a></p>\n<p>The transform property instructs the GPU to make some last minute updates to the texture of an element before drawing it to the screen. These updates can for instance be rotating, moving, and scaling of an element.</p>\n<p>You can compare the GPU texure of an element with a picture you took of the element with your mobile phone. This picture only consists of pixels, all other information about the element is gone.</p>\n<p>The GPU only has to deal with the pixels that present the element. Because GPUs are very good at dealing with pixels, the <code>transform</code> operations are super fast.</p>\n<p>This also has a downside. We can only manipulate the pixels, not the contents of the element. Remember we only have the picture of the element, all other information is gone.</p>\n<p>You can see below how this difference impacts the <code>border-radius</code> property. In the <code>transform</code> example the radius is not redrawn (like in the <code>width</code> example), it is simply scaled. Redrawing would require a repaint, the GPU cannot do that, it only deals with pixels.</p>\n<div class=\"demo demo-row\">\n    <div>\n        <div class=\"square\"></div>\n        <span>Original</span>\n    </div>\n    <div>\n        <div class=\"square square-resized\"></div>\n        <span>width: 100px</span>\n    </div>\n    <div>\n        <div class=\"square square-transformed\"></div>\n        <span>transform: scaleX(.5)</span>\n    </div>\n</div>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.square</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 200px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 200px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 40px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.square-resized</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.square-transformed</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>0.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Animating the <code>transform</code> property is a million times faster than animating <code>width</code>, <code>height</code>, or any of the other properties that impact layout and will <a href=\"https://csstriggers.com/\">trigger a reflow</a></p>\n<p>But if we animate it, the result will be that weirdly stretched shape. It might be fast, but it doesn’t look great. It always reminds me of those aliens in Duke Nukem 3D getting squished by a door.</p>\n<div class=\"demo demo-row\"> \n    <div>\n        <div class=\"square square-transformed square-animated\"></div>\n        <span>Stretched corners</span>\n    </div>\n</div>\n<h2 id=\"-slice-scaling-to-the-rescue\">9-Slice Scaling To The Rescue</h2>\n<p>Before <code>border-radius</code> was a thing we had to create an image for each corner and/or edge of an element to “fake” border radius. Depending on the design that could yield up to 8 images for a single element. These images would be layed out like this:</p>\n<div class=\"demo demo-9-slice\" style=\"width:50%; height: 8em;\">\n    <div>1</div>\n    <div>2</div>\n    <div>3</div>\n    <div>4</div>\n    <div>5</div>\n    <div>6</div>\n    <div>7</div>\n    <div>8</div>\n    <div>9</div>\n</div>\n<p>This is called the <a href=\"https://en.wikipedia.org/wiki/9-slice_scaling\">9-slice scaling method</a>. Tis method allows you to scale the element and stretch image 2, 4, 6, and 8, while linking 1, 3, 7, and 9 to their respective corners using absolute positioning.</p>\n<p>Now our corners aren’t stretched when scaled, see below:</p>\n<div class=\"demo demo-9-slice\" style=\"width:100%; height: 12em;\">\n    <div>1</div>\n    <div>2</div>\n    <div>3</div>\n    <div>4</div>\n    <div>5</div>\n    <div>6</div>\n    <div>7</div>\n    <div>8</div>\n    <div>9</div>\n</div>\n<p>Luckily we live in a day and age where browsers support <code>border-radius</code>, we no longer have to rely on this technique for drawing rounded corners.</p>\n<p>We can however use this technique to resize elements using the <code>transform</code> property. For the sake of brevity this example will only explore scaling the width of the element.</p>\n<p>We’ll start with a structure like this:</p>\n<div class=\"demo demo-3-slice\" style=\"width:50%; height: 8em;\">\n    <div>1</div>\n    <div>2</div>\n    <div>3</div>\n</div>\n<p>Let’s apply this to our square. We’ll need one container and three child elements to represent the square left (1), center (2), and right (3) parts.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>square<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>left<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>right<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Let’s look at the CSS</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* children will be positioned relativly to this element */</span>\n<span class=\"token selector\">.square</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.left,\n.center,\n.right</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">bottom</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.left</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> red<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\">.center</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> yellow<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\">.right</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> blue<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* we need room for a 20 pixel border radius (on one side) */</span>\n<span class=\"token selector\">.left,\n.right</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 20px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.left</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 20px 0 0 20px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\">.right</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 0 20px 20px 0<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* child layout definitions */</span>\n<span class=\"token selector\">.center</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* center needs to be 20 pixels from the left, \n    so it doesn't overlap with the .left element */</span>\n    <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 20px<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* needs a width of 1 pixel, this causes \n    scaleX(60) is equal to 60 pixels */</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 1px<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>60<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* we need to scale the texture from the left side \n    for it to align correctly, default is center */</span>\n    <span class=\"token property\">transform-origin</span><span class=\"token punctuation\">:</span> left<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.right</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* we need to move the right element to align with\n    the right side of the .center element \n    20px + 60px = 80px */</span>\n    <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">translateX</span><span class=\"token punctuation\">(</span>80px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>The result is a nicely colored square.</p>\n<div class=\"demo\">\n    <div class=\"square-slice square-colored\">\n        <div class=\"square-slice-left\"></div>\n        <div class=\"square-slice-center\"></div>\n        <div class=\"square-slice-right\"></div>\n    </div>\n</div>\n<p>I’ve colored to element parts to make them individually recognizeable.</p>\n<p>Now for our next trick, we can animate the <code>.center</code> and <code>.right</code> elements of the square.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.center</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> center-animate 1s ease infinite alternate<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.right</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> right-animate 1s ease infinite alternate<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> right-animate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">0%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">translateX</span><span class=\"token punctuation\">(</span>140px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">100%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">translateX</span><span class=\"token punctuation\">(</span>20px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> center-animate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">0%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>120<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">100%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo\">\n    <div class=\"square-slice square-animated square-colored\">\n        <div class=\"square-slice-left\"></div>\n        <div class=\"square-slice-center\"></div>\n        <div class=\"square-slice-right\"></div>\n    </div>\n</div>\n<p>Looks good to me, let’s set the background color back to black.</p>\n<div class=\"demo\">\n    <div class=\"square-slice square-animated\">\n        <div class=\"square-slice-left\"></div>\n        <div class=\"square-slice-center\"></div>\n        <div class=\"square-slice-right\"></div>\n    </div>\n</div>\n<p>If you’re on Firefox, this should look great. If you’re using Safari or Chrome you might notice a slight flickering between the center and right part.</p>\n<p>I’m not sure why this happens. It might be a problem with alpha blending OR rounding of pixels. Anyway. By slightly overlapping the center element with the right element we can resolve this render issue. We’ll make sure the element is at least <code>1</code> pixel wide and scales to <code>121</code> pixels.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> center-animate</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">0%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>121<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token selector\">100%</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">scaleX</span><span class=\"token punctuation\">(</span>1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<div class=\"demo\">\n    <div class=\"square-slice square-animated square-animated-corrected\">\n        <div class=\"square-slice-left\"></div>\n        <div class=\"square-slice-center\"></div>\n        <div class=\"square-slice-right\"></div>\n    </div>\n</div>\n<p>Huray! We got ourselves an animatable non-squishy square!</p>\n<p>We could take this further and make it more flexible by moving the animation to JavaScript, creating a web component, or by using CSS variables, but for the purpose of this article this example should suffice.</p>\n<p><a href=\"https://codepen.io/rikschennink/pen/eYmoZLY?editors=1100\">View a demo of end result on CodePen</a></p>\n<h2 id=\"hold-your-horses\">Hold Your Horses</h2>\n<p>Before you run of and start using this technique everywhere, please note that:</p>\n<ul>\n<li>We’re still scaling the center square over the X axis so background images applied to the square will be stretched.</li>\n<li>A <code>box-shadow</code> can be done but is a bit tricky to pull off.</li>\n<li>The square cannot cut off other elements, as in, <code>overflow: hidden</code> won’t work.</li>\n</ul>\n<p>Still, with a bit of trickery, you can use this to create some awesome effects. The file items and the drop area of the <a href=\"https://pqina.nl/filepond/?ref=pqina\">FilePond file upload library</a> all use this technique to smoothly animate their height.</p>\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/filepond-drag.mp4\" type=\"video/mp4\" />\n</video>\n<p><a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura Image Editor</a> used this technique on both the x and y axis to render and animate the white crop rectangle on top of the image. This has since been partly replaced with WebGL.</p>\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/crop-jelly.mp4\" type=\"video/mp4\" />\n</video>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>The default <code>width</code> and <code>height</code> CSS properties are (along with most other properties) not suitable for animation. They impact render performance too much because updating them triggers the browser to re-evaluate related element positions and sizes.</p>\n<p>If we use the <code>transform</code> property instead we can performantly animate our square on the GPU. While super fast this also introduces some limitations because the GPU only deals with pixels.</p>\n<p>By applying the 9-slice technique we can work around some of these limitations and create an element that we can animate in a performant way.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/animating-width-and-height-without-the-squish-effect/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Presenting Images In A Specific Aspect Ratio With CSS",
    "partialText": "<p>In this 2 minute tutorial we’ll learn how to use CSS to present images in a predefined aspect ratio. Useful for when you want to show images with various dimensions in (for example) a square box without skewing them.</p>\n<style>\n\n/* Demo #1 */\n.aspect-ratio-img {\n    object-fit: cover;\n}\n\n/* Demo #2 */\n.aspect-ratio-box {\n    position: relative;\n    max-width: 50%;\n}\n\n.aspect-ratio-box * {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n}\n\n.aspect-ratio-box::after {\n    display: block;\n    content: '';\n    padding-bottom: 56.25%;\n}\n</style>\n<p>If you want to actually modify the image data, for example when you need to make sure images uploaded by visitors all adhere to a square aspect ratio, you can visit this tutorial on <a href=\"https://pqina.nl/blog/cropping-images-to-an-aspect-ratio-with-javascript/\">cropping images to an aspect ratio with JavaScript</a>.</p>\n<h2 id=\"fixed-size-images\">Fixed Size Images</h2>\n<p>If we need to show an image in a fixed size we can set the size using the <code>width</code> and <code>height</code> attributes. Now if we don’t know the dimensions and the aspect ratio of the image that will be shown here we can use <code>object-fit</code> to make sure that the image is never “skewed”.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>200<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/path/to/image.jpeg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">object-fit</span><span class=\"token punctuation\">:</span> cover<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>See the resulting image below. Note that the source image used is in landscape format and doesn’t get skewed but is “cropped” in the center.</p>\n<div class=\"demo\" data-theme=\"drop-shadows round-corners\">\n<img class=\"aspect-ratio-img\" width=\"200\" height=\"200\" src=\"https://pqina.nl/media/desk.jpg\" alt=\"\" />\n</div>\n<p>The <code>object-fit</code> property accepts <code>fill</code>, <code>contain</code>, <code>cover</code>, <code>none</code>, and <code>scale-down</code>, the <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit\">Object fit properties are described perfectly on MDN</a>.</p>\n<h2 id=\"flexible-size-images\">Flexible Size Images</h2>\n<p>To forces images that scale with their parent containers to a specific aspect ratio we have to create an element around the image. The image wrapper makes sure it always fits a certain aspect ratio, we’ll then tell the image element to fit the size of the wrapper element.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>aspect-ratio-box<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/media/desk.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* Position child elements relative to this element */</span>\n<span class=\"token selector\">.aspect-ratio-box</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Create a pseudo element that uses padding-bottom to take up space */</span>\n<span class=\"token selector\">.aspect-ratio-box::after</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/* 16:9 aspect ratio */</span>\n    <span class=\"token property\">padding-bottom</span><span class=\"token punctuation\">:</span> 56.25%<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Image is positioned absolutely relative to the parent element */</span>\n<span class=\"token selector\">.aspect-ratio-box img</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Image should match parent box size */</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>The result, a flexible box that adheres to a 16:9 aspect ratio.</p>\n<div class=\"demo\" data-theme=\"drop-shadows round-corners\">\n<div class=\"aspect-ratio-box\">\n    <img src=\"https://pqina.nl/media/desk.jpg\" alt=\"\" />\n</div>\n</div>\n<p>The <code>padding-bottom</code> value is a percentage of the width of the container. If the container is 400 pixels wide, the resulting height will be <code>56.25%</code> of <code>400</code> equals <code>225</code>.</p>\n<p>To know what <code>padding-bottom</code> value to use for each aspect ratio we can divide the <code>height</code> by the <code>width</code>.</p>\n<p>Let’s look at the <code>16:9</code> aspect ratio.</p>\n<pre><code>9 / 16 = .5625\n</code></pre>\n<p>We need a percentage, so we multiply by 100</p>\n<pre><code>.5625 * 100 = 56.25\n</code></pre>\n<p>That’s it!</p>\n<h3 id=\"future\">Future</h3>\n<p>In the near future it’ll be possible to use the CSS <code>aspect-ratio</code> property instead of the <code>padding-bottom</code> trick. At the moment <a href=\"https://caniuse.com/#feat=mdn-css_properties_aspect-ratio\">browser support is still lacking</a>.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We’ve learned how to present images in different aspect ratios without skewing them. Having tools to work with fixed and flexible containers should cover most use-cases you’ll encounter.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/presenting-images-in-an-aspect-ratio-with-css/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Cropping Images To A Specific Aspect Ratio With JavaScript",
    "partialText": "<p>In this 3 minute tutorial we’ll write a tiny JavaScript function that helps us crop images to various aspect ratios. Super useful for cropping photos before posting to social media timelines or uploading profile pictures as these are often required to be of a certain aspect ratio.</p>\n<p>In this tutorial we’ll by modifying image data. For example, when a user is about to upload a an image we crop it to a certain aspect ratio. If we just want to present images in a certain aspect ratio <a href=\"https://pqina.nl/blog/presenting-images-in-an-aspect-ratio-with-css/\">we can use a CSS only solution</a>.</p>\n<p><img src=\"https://pqina.nl/media/crop-aspect-ratio.png\" alt=\"\" /></p>\n<h2 id=\"loading-the-image-data\">Loading the Image Data</h2>\n<p>To get started we’ll need a source image. Let’s use a generic image URL as our source.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> imageURL <span class=\"token operator\">=</span> <span class=\"token string\">'path/to/our/image.jpeg'</span><span class=\"token punctuation\">;</span></code></pre>\n<p>To crop an image we need to access the actual image data. We can get to this data by loading the URL to an <code>&lt;img&gt;</code> element.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> inputImage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ninputImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> imageURL<span class=\"token punctuation\">;</span></code></pre>\n<p>Our next step is drawing the image to a <code>&lt;canvas&gt;</code>, the canvas will allow us to modify the image data. We’ll add the <code>onload</code> callback right before setting the <code>src</code> so we can capture the moment the image has loaded.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// this image will hold our source image data</span>\n<span class=\"token keyword\">const</span> inputImage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// we want to wait for our image to load</span>\ninputImage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// create a canvas that will present the output image</span>\n    <span class=\"token keyword\">const</span> outputImage <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// set it to the same size as the image</span>\n    outputImage<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">;</span>\n    outputImage<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// draw our image at position 0, 0 on the canvas</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> outputImage<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// show both the image and the canvas</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>outputImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// start loading our image</span>\ninputImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> imageURL<span class=\"token punctuation\">;</span></code></pre>\n<p>Running this code results in a <code>&lt;canvas&gt;</code> that is presenting the same image as the image located at our <code>imageURL</code>.</p>\n<h2 id=\"cropping-the-image-to-a-square-aspect-ratio\">Cropping The Image to a Square Aspect Ratio</h2>\n<p>Now that we have gained access to the image data we can start manipulating it.</p>\n<p>Let’s start with a square crop. A square crop has an aspect ratio of 1:1. This means each side of the output image has the same length. We can represent this numerically as an aspect ratio of <code>1</code>. The aspect ratio of a 200x200 image is <code>1</code>, the aspect ratio of a 400x300 image can be calculated by dividing the width and height, which equals <code>1.333</code> (400/300).</p>\n<p>Let’s edit our code and view the results.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// the desired aspect ratio of our output image (width / height)</span>\n<span class=\"token keyword\">const</span> outputImageAspectRatio <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// this image will hold our source image data</span>\n<span class=\"token keyword\">const</span> inputImage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// we want to wait for our image to load</span>\ninputImage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// let's store the width and height of our image</span>\n    <span class=\"token keyword\">const</span> inputWidth <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> inputHeight <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// get the aspect ratio of the input image</span>\n    <span class=\"token keyword\">const</span> inputImageAspectRatio <span class=\"token operator\">=</span> inputWidth <span class=\"token operator\">/</span> inputHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// if it's bigger than our target aspect ratio</span>\n    <span class=\"token keyword\">let</span> outputWidth <span class=\"token operator\">=</span> inputWidth<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> outputHeight <span class=\"token operator\">=</span> inputHeight<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inputImageAspectRatio <span class=\"token operator\">></span> outputImageAspectRatio<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        outputWidth <span class=\"token operator\">=</span> inputHeight <span class=\"token operator\">*</span> outputImageAspectRatio<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inputImageAspectRatio <span class=\"token operator\">&lt;</span> outputImageAspectRatio<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        outputHeight <span class=\"token operator\">=</span> inputWidth <span class=\"token operator\">/</span> outputImageAspectRatio<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// create a canvas that will present the output image</span>\n    <span class=\"token keyword\">const</span> outputImage <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// set it to the same size as the image</span>\n    outputImage<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> outputWidth<span class=\"token punctuation\">;</span>\n    outputImage<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> outputHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// draw our image at position 0, 0 on the canvas</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> outputImage<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// show both the image and the canvas</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>outputImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// start loading our image</span>\ninputImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> imageURL<span class=\"token punctuation\">;</span></code></pre>\n<p>The result is a square image, great! But let’s take a closer look. It seems our crop is not positioned in the center of the input image. This is because we have not update the <code>drawImage</code> call. The <code>drawImage</code> call takes 3 (or more) arguments, the <code>inputImage</code>, and the <code>x</code> and <code>y</code> position to draw the image at.</p>\n<p>Our input image is still drawn at location <code>0</code>, <code>0</code> we need to adjust this so we get a center crop instead of a top left crop.</p>\n<p>To do this we need to move the image slightly to the left. Suppose our input image is <code>400</code> pixels wide and our output image is <code>300</code> pixels wide, to center it we’d need to move the input image <code>50</code> pixels to the left (negative 50 pixels). <code>-50</code> pixels is <code>300</code> minus <code>400</code> divided by <code>2</code>. This results in the following code snippet.</p>\n<p><code>const outputX = (outputWidth - inputWidth) * .5</code></p>\n<p>Let’s update the code snippet, we can use the same code for both the <code>x</code> and the <code>y</code> offset.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// the desired aspect ratio of our output image (width / height)</span>\n<span class=\"token keyword\">const</span> outputImageAspectRatio <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// this image will hold our source image data</span>\n<span class=\"token keyword\">const</span> inputImage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// we want to wait for our image to load</span>\ninputImage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// let's store the width and height of our image</span>\n    <span class=\"token keyword\">const</span> inputWidth <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> inputHeight <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// get the aspect ratio of the input image</span>\n    <span class=\"token keyword\">const</span> inputImageAspectRatio <span class=\"token operator\">=</span> inputWidth <span class=\"token operator\">/</span> inputHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// if it's bigger than our target aspect ratio</span>\n    <span class=\"token keyword\">let</span> outputWidth <span class=\"token operator\">=</span> inputWidth<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> outputHeight <span class=\"token operator\">=</span> inputHeight<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inputImageAspectRatio <span class=\"token operator\">></span> outputImageAspectRatio<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        outputWidth <span class=\"token operator\">=</span> inputHeight <span class=\"token operator\">*</span> outputImageAspectRatio<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inputImageAspectRatio <span class=\"token operator\">&lt;</span> outputImageAspectRatio<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        outputHeight <span class=\"token operator\">=</span> inputWidth <span class=\"token operator\">/</span> outputImageAspectRatio<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// calculate the position to draw the image at</span>\n    <span class=\"token keyword\">const</span> outputX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>outputWidth <span class=\"token operator\">-</span> inputWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> outputY <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>outputHeight <span class=\"token operator\">-</span> inputHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// create a canvas that will present the output image</span>\n    <span class=\"token keyword\">const</span> outputImage <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// set it to the same size as the image</span>\n    outputImage<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> outputWidth<span class=\"token punctuation\">;</span>\n    outputImage<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> outputHeight<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// draw our image at position 0, 0 on the canvas</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> outputImage<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">,</span> outputX<span class=\"token punctuation\">,</span> outputY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// show both the image and the canvas</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>outputImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// start loading our image</span>\ninputImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> imageURL<span class=\"token punctuation\">;</span></code></pre>\n<p>With this update our crop is now centered on the input image.</p>\n<h2 id=\"creating-a-reusable-javascript-crop-function\">Creating a Reusable JavaScript Crop Function</h2>\n<p>As a final step let’s turn our code into a reusable function so we can quickly crop images with various crop aspect ratios. Our JavaScript snippet is already suitable to be used for any aspect ratio, not just squares.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/**\n * @param {string} url - The source image\n * @param {number} aspectRatio - The aspect ratio\n * @return {Promise&lt;HTMLCanvasElement>} A Promise that resolves with the resulting image as a canvas element\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">crop</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> aspectRatio</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// we return a Promise that gets resolved with our canvas element</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// this image will hold our source image data</span>\n        <span class=\"token keyword\">const</span> inputImage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// we want to wait for our image to load</span>\n        inputImage<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// let's store the width and height of our image</span>\n            <span class=\"token keyword\">const</span> inputWidth <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalWidth<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> inputHeight <span class=\"token operator\">=</span> inputImage<span class=\"token punctuation\">.</span>naturalHeight<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// get the aspect ratio of the input image</span>\n            <span class=\"token keyword\">const</span> inputImageAspectRatio <span class=\"token operator\">=</span> inputWidth <span class=\"token operator\">/</span> inputHeight<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// if it's bigger than our target aspect ratio</span>\n            <span class=\"token keyword\">let</span> outputWidth <span class=\"token operator\">=</span> inputWidth<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> outputHeight <span class=\"token operator\">=</span> inputHeight<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inputImageAspectRatio <span class=\"token operator\">></span> aspectRatio<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                outputWidth <span class=\"token operator\">=</span> inputHeight <span class=\"token operator\">*</span> aspectRatio<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inputImageAspectRatio <span class=\"token operator\">&lt;</span> aspectRatio<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                outputHeight <span class=\"token operator\">=</span> inputWidth <span class=\"token operator\">/</span> aspectRatio<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token comment\">// calculate the position to draw the image at</span>\n            <span class=\"token keyword\">const</span> outputX <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>outputWidth <span class=\"token operator\">-</span> inputWidth<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">const</span> outputY <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>outputHeight <span class=\"token operator\">-</span> inputHeight<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// create a canvas that will present the output image</span>\n            <span class=\"token keyword\">const</span> outputImage <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// set it to the same size as the image</span>\n            outputImage<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> outputWidth<span class=\"token punctuation\">;</span>\n            outputImage<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> outputHeight<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// draw our image at position 0, 0 on the canvas</span>\n            <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> outputImage<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>inputImage<span class=\"token punctuation\">,</span> outputX<span class=\"token punctuation\">,</span> outputY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>outputImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// start loading our image</span>\n        inputImage<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> url<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Our new and shiny <code>crop</code> function can be called like so:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">crop</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path/to/our/image.jpeg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Or, to get a “16:9” crop:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">crop</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path/to/our/image.jpeg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token operator\">/</span> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>As the function returns a <code>Promise</code> we can get the results like this:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">crop</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path/to/our/image.jpeg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token operator\">/</span> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">canvas</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// `canvas` is the resulting image</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Or, using async/await:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">crop</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path/to/our/image.jpeg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span> <span class=\"token operator\">/</span> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><a href=\"https://codepen.io/rikschennink/pen/rNNYWNb\">View a demo of the end result on CodePen</a></p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>By using the HTML canvas API and some basic math we build a tiny crop helper function that makes it easy to quickly crop images in various aspect ratios. This helps us prepare images for social media posts, profile pictures, familiar document sizes, or other popular media formats.</p>\n<p>To keep the article concise our current solution does not cover these edge cases:</p>\n<ul>\n<li>Browsers being confused by mobile photos EXIF orientation header.</li>\n<li>Canvas memory overflowing on mobile devices for very big images.</li>\n<li>Poor image quality when downscaling images.</li>\n</ul>\n<p>If you need a solution for these issues you could explore <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura Image Editor</a>, an easy to use image editor that solves these edge cases and features a wide range of additional functionality.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/cropping-images-to-an-aspect-ratio-with-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "The Trouble With Editing And Uploading Files In The Browser",
    "partialText": "<p>With the introduction of the File API we gained the ability to edit files in the browser. We could finally resize images, unzip files, and generate new files based on interactions in the browser. One caveat though, you couldn’t upload these files.</p>\n<p>Well you could, but you had to resort to either <code>XMLHttpRequest</code> or <code>fetch</code>, see, it’s not possible to set the value of a file input element. This means you can’t submit a custom file along with a classic form submit, you have to asynchronously upload the file. This really put the brakes on any progressive enhancement solutions to file editing. If you decide to modify a file on the client, then you also have to make sure you make changes on the server so you can receive the modified file.</p>\n<p>As a product developer building <a href=\"https://pqina.nl/pintura/?ref=pqina\">image editing products</a> this really grinds my gears. I’d love to offer my products as client-side only solutions. But that’s impossible because asynchronous file uploads require server-side modifications. <a href=\"https://wordpress.org/\">WordPress</a>, <a href=\"https://www.netlify.com/\">Netlify</a>, <a href=\"https://www.shopify.com/\">Shopify</a>, <a href=\"https://bubble.io/\">Bubble.io</a>, they all offer default file input elements, but there’s no straightforward way to support them without writing a client-side and server-side plugin. In the case of WordPress this means offering a plugin for each and every form builder out there. Not very realistic.</p>\n<p>But a couple months ago something changed.</p>\n<h2 id=\"setting-a-custom-file-to-a-file-input\">Setting a custom file to a file input</h2>\n<p>It’s really quite logical that we can’t set the <code>value</code> of the file input element. Doing so would allow us to point it at files on the visitors file system.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token string\">'some/file/i/want/to/have'</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Obviously this would be a huge security risk.</p>\n<p>Setting the file input <code>value</code> property is off the table.</p>\n<p>What about the file input <code>files</code> property? If we could somehow update the files property or update the files in it, that would solve the issue.</p>\n<p>The <code>files</code> property holds a reference to a <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileList\"><code>FileList</code></a>. Great! Let’s create a <code>new FileList()</code> and overwrite the one on the file input. Unfortunately there’s no <code>FileList</code> constructor. There is also no <em>“add a file”</em> method exposed on the <code>FileList</code> instance. On top of that the <code>File</code> object doesn’t have a method to update the file data in place, so we can’t update the individual file objects in the <code>files</code> list.</p>\n<p>Well that’s it then.</p>\n<p>And it was untill a couple months a go <a href=\"https://hiddedevries.nl/en\">Hidde de Vries</a> pointed me to <a href=\"https://github.com/whatwg/html/issues/3269\">this issue on the WHATWG</a>, Turns out there’s a different API we can use to achieve our goal.</p>\n<p>Firefox, Chrome, and Safari have recently added support for the <code>DataTransfer</code> constructor. The <code>DataTransfer</code> Class is most commonly used when dragging and dropping files from the user device to the webpage.</p>\n<p>It has a <code>files</code> property of type <code>FileList</code> 🎉</p>\n<p>It also has an <code>items.add</code> method for adding items to this list 🎉</p>\n<p>Oh la la!</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Create a DataTransfer instance and add a newly created file</span>\n    <span class=\"token keyword\">const</span> dataTransfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DataTransfer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    dataTransfer<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'hello world'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'This_Works.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Assign the DataTransfer files list to the file input</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>files <span class=\"token operator\">=</span> dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>If you’re browser can run the code above the file input below will show “This_Works.txt” as the input value. Starting from version 14.1 Safari also supports setting the <code>files</code> property in this manner but it won’t update the label next to the input.</p>\n<div class=\"demo\">\n  <input type=\"file\" />\n  <script>\n  try {\n    // Create a DataTransfer instance and add a newly created file\n    const dataTransfer = new DataTransfer();\n    dataTransfer.items.add(new File([\"hello world\"], \"This_Works.txt\"));\n\n    // Assign the DataTransfer files list to the file input\n    document.querySelector(\"input\").files = dataTransfer.files;\n\n    // Log files to console\n    console.log(document.querySelector(\"input\").files);\n  }\n  catch(err) {\n    console.log(err);\n  }\n  </script>\n</div>\n<p>It just works. Fantastic! We now have a method to send files created on the client to the server without having to make any changes to the server-side API.</p>\n<p>This doesn’t work on IE, non Chromium Edge, and Safari versions before 14.1.</p>\n<h2 id=\"alternatives-for-other-browsers\">Alternatives for other browsers</h2>\n<p>If we want to submit our file data along with the form post, what can we offer users on these other browsers? There are currently two alternate solutions I can think of. One requires changes on the server, the other might be buggy depending on your use case.</p>\n<p>Let’s take alook.</p>\n<ul>\n<li><a href=\"https://pqina.nl/blog/the-trouble-with-editing-and-uploading-files-in-the-browser/#encode-the-file-data\">Encode the file data</a></li>\n<li><a href=\"https://pqina.nl/blog/the-trouble-with-editing-and-uploading-files-in-the-browser/#capture-the-form-submit\">Capture the form submit</a></li>\n</ul>\n<h3 id=\"encode-the-file-data\">Encode the file data</h3>\n<p>We can encode the file data as a base64 string or dataURL, store the resulting string in a hidden input element and then send it on its way when the form is submitted. This will require changes to the server, the server will have to be aware an encoded file might be submitted as well. The server will also have to decode the dataURL and turn it back into a File object.</p>\n<p>We can use the <code>FileReader</code> API to turn a <code>File</code> into a <code>dataURL</code>.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"file\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onchange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onloadend</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"hidden\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span>\n                reader<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>A couple of issues my clients reported when using this method.</p>\n<ul>\n<li>Security related scripts running on the server that monitor traffic might flag the form post as suspicious as it contains a lot of string based data.</li>\n<li>When submitting large files, that means files above 1MB, it’s highly likely the browser will crash with a “ran out of memory” error. This differs per browser, but I’ve seen it happen on both mobile and desktop browsers.</li>\n<li>You don’t see a change in the file input. So it’s a good idea to reset, disable, or hide it when submitting the form.</li>\n</ul>\n<p>Encoding files is a fine solution if you’re dealing with small images, anything bigger than 1MB and I’d steer clear.</p>\n<h3 id=\"capture-the-form-submit\">Capture the form submit</h3>\n<p>We <strong>can</strong> add custom files when submitting a form asynchronously. So another solution is capturing the entire form submit and asynchronously submitting the form to the same end point (<code>action</code> attribute) using <code>XMLHttpRequest</code> or <code>fetch</code>.</p>\n<p>This is what I’ve tried to do with <a href=\"https://github.com/rikschennink/poost/\">Poost</a> (this is very much a prototype, also I’m bad at naming things on the spot). Poost captures the form submit, and then posts the form asynchronously instead. This allows us to build a custom <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FormData\"><code>FormData</code></a> object, adding our custom file (stored in the <code>_value</code> property) instead of the files in the <code>files</code> property.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token comment\">// Create a new File object</span>\n    <span class=\"token keyword\">const</span> myFile <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">File</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'myFile.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'text/plain'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">lastModified</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Assign File to _value property</span>\n    <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[type=\"file\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    target<span class=\"token punctuation\">.</span>_value <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>myFile<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>This actually works quite well. We post the same data to the same end point. Things start to get tricky when you realise that the returned page also needs to be rendered to the screen (normally the browser navigates to it). Where are we going to render it, what to do with the navigator history, how to deal with script tags on the page, what about IE (no surprise there).</p>\n<ul>\n<li>Again, when setting <code>_value</code> you don’t see a change in the file input. So it’s a good idea to reset, disable, or hide it when submitting the form.</li>\n<li>We’re taking over a lot of default browser behavior, that is always a recipe for disaster.</li>\n</ul>\n<p>Still, for very basic forms this works nicely. You don’t have to modify the server and it could even be loaded conditionally as a fallback for when a browser doesn’t support <code>new DataTransfer()</code>.</p>\n<h2 id=\"the-state-of-things\">The state of things</h2>\n<p>So our file upload situation, while it has improved, is still all but fantastic.</p>\n<p>We’re still stuck with these bandaid solutions because of IE, Edge, and Safari. If you have the luxury it’s probably easier to make changes on the server to facilitate async transfers. If you’re in a situation where that’s impossible I hope the solutions offered above might just fit your situation perfectly and help you out.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/the-trouble-with-editing-and-uploading-files-in-the-browser/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "How To Upload Images To The WordPress Media Library",
    "partialText": "<p>This quick guide shows you how to set up a form to upload images to your media library using the free WordPress plugin Snippy.</p>\n<h2 id=\"creating-a-file-upload-handler\">Creating a File Upload Handler</h2>\n<p>First step, let’s open your themes <code>functions.php</code> file, and add the code snippet below. This will create a location for us to send our files to.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">handle_my_file_upload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// will return the attachment id of the image in the media library</span>\n    <span class=\"token variable\">$attachment_id</span> <span class=\"token operator\">=</span> <span class=\"token function\">media_handle_upload</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'my_file_field'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// test if upload succeeded</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">is_wp_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$attachment_id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">http_response_code</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Failed to upload file.'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">http_response_code</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token variable\">$attachment_id</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// done!</span>\n    <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// allow uploads from users that are logged in</span>\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'wp_ajax_my_file_upload'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'handle_my_file_upload'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// allow uploads from guests</span>\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'wp_ajax_nopriv_my_file_upload'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'handle_my_file_upload'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>There are a couple things to take note of:</p>\n<ul>\n<li><code>handle_my_file_upload</code> is the name of the function that will deal with the upload, both <code>add_action</code> calls reference it.</li>\n<li><code>wp_ajax_</code> and <code>wp_ajax_noprive_</code> are default hooks, we add <code>my_file_upload</code> to them to allow communication with our form which we’ll set up next.</li>\n<li>Comment out the <code>nopriv</code> call to prevent file uploads from guests.</li>\n</ul>\n<h2 id=\"creating-the-form\">Creating the Form</h2>\n<p>Alright now we need to add a <code>&lt;form&gt;</code> to give the user a location to select the images they want to upload.</p>\n<p>We’ll use the <a href=\"http://wordpress.org/plugins/snippy\">free WordPress plugin Snippy</a> to create a shortcode that we can use everywhere on our WordPress website.</p>\n<p>With Snippy installed we’ll start by creating an HTML bit. Click on the “Snippy/Add Bit” menu item. Name your HTML bit “file-form”. Set type to “HTML”. And paste the code below in the textfield.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span>\n    <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{admin_url}}<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">enctype</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>multipart/form-data<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>action<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my_file_upload<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Select file:<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my_file_field<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">accept</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image/*<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Upload<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<ul>\n<li><code>my_file_upload</code> corresponds to the value used in the <code>add_action</code> calls.</li>\n<li><code>my_file_field</code> corresponds to the value used in the <code>media_handle_upload</code> call.</li>\n</ul>\n<p>Now we’ll create our custom shortcode.</p>\n<p>Click “Snippy/Add Shortcode” and use “file-upload” as the name. In the “Available bits” list we select our “file-form”. Click Save.</p>\n<p>That’s it! We now have a form shortcode at our disposal.</p>\n<pre><code>[file-upload/]\n</code></pre>\n<p>Add it to a page (using the page editor), refresh the page, your file upload form should now appear.</p>\n<h2 id=\"bonus%3A-editing-the-image\">Bonus: Editing the Image</h2>\n<p>Let’s upgrade our form to allow our users to edit dropped images using <a href=\"https://pqina.nl/pintura/?ref=pqina\">Pintura</a></p>\n<p>We can use Snippy to add the Pintura files to the page.</p>\n<ol>\n<li>Create a new local resource bit and select the Pintura CSS file (pintura.css).</li>\n<li>Create another local resource bit and select the Pintura JavaScript file (pintura-iife.js).</li>\n<li>Create a JavaScript bit and add the following code.</li>\n</ol>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Store reference to the field to make later code easier to read</span>\n    <span class=\"token keyword\">const</span> field <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Only intercept fields of type file that accept images and contain a file</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n        field<span class=\"token punctuation\">.</span>type <span class=\"token operator\">!==</span> <span class=\"token string\">'file'</span> <span class=\"token operator\">||</span>\n        <span class=\"token operator\">!</span>field<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span>\n        <span class=\"token operator\">!</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">image\\/*</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">.</span>accept<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get reference to parent form</span>\n    <span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> field<span class=\"token punctuation\">.</span>form<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Edit dropped image with Pintura</span>\n    <span class=\"token keyword\">const</span> editor <span class=\"token operator\">=</span> pintura<span class=\"token punctuation\">.</span><span class=\"token function\">openDefaultEditor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// The image to load</span>\n        <span class=\"token literal-property property\">src</span><span class=\"token operator\">:</span> field<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n        <span class=\"token comment\">// Set up custom file upload</span>\n        <span class=\"token literal-property property\">imageWriter</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">store</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// Where to post to</span>\n                <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> form<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'action'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n                <span class=\"token comment\">// Which fields to post</span>\n                <span class=\"token function-variable function\">dataset</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token comment\">// Copy file field name and set value to output image</span>\n                    <span class=\"token punctuation\">[</span>field<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">.</span>dest<span class=\"token punctuation\">,</span> state<span class=\"token punctuation\">.</span>dest<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n                    <span class=\"token comment\">// Copy action field value</span>\n                    <span class=\"token punctuation\">[</span><span class=\"token string\">'action'</span><span class=\"token punctuation\">,</span> form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[name=\"action\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Now we can link these newly created bits to our “file-upload” shortcode by clicking the “Snippy/Shortcodes” menu item and editing our “file-upload” shortcode. Select the bits we just created and click “Save”.</p>\n<p>Refresh the page and select an image, Pintura should open the image and when clicking done the edited image should appear in the WordPress Media Library. Please note that the animation below shows version 6 of the editor.</p>\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/pintura-wordpress.mp4\" type=\"video/mp4\" />\n</video>\n<h2 id=\"security\">Security</h2>\n<p>To make this solution a little bit more secure we can add a <a href=\"https://codex.wordpress.org/Function_Reference/wp_nonce_field\">WordPress nonce field</a>.</p>\n<p>Edit the HTML form like this:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span>\n    <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{admin_url}}<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">enctype</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>multipart/form-data<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">></span></span>\n    {{nonce_field:my_file_upload, my_nonce_field}}\n\n    <span class=\"token comment\">&lt;!-- ...This part of the form remains untouched --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>And add the following if statements to the <code>functions.php</code> file so it checks if the form post is valid and came from your own site.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">handle_my_file_upload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">http_response_code</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Nothing data received.'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">wp_verify_nonce</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'my_nonce_field'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'my_file_upload'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">http_response_code</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">echo</span> <span class=\"token string single-quoted-string\">'Unknown error.'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">/* The rest of the function stays the same */</span>\n\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>That’s it! We’re done. These code snippets should give you a good idea of what is required for uploading files with WordPress and how to build uppon it. If you were not familiar with Snippy this should’ve been a nice introduction on how it can help you manage small parts of your WordPress site.</p>\n<p>That said. This is still a bare bone solution that can be further build uppon with redirects, upload progress indicators, sending additional form data, and more. I’ll leave that for a future article.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/uploading-files-to-wordpress-media-library/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "CSS Smooth Scrolling",
    "partialText": "<p>Last year, while building the <a href=\"https://pqina.nl/filepond/?ref=pqina\">FilePond product page</a> I stumbled upon the scrollIntoView API. It’s a handy method to instruct the browser to scroll an element into the viewport.</p>\n<p>The <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView\"><code>scrollIntoView</code></a> API can be instructed to animate the scrolling part by adding the <code>behavior</code> property on the <code>scrollIntoViewOption</code> object.</p>\n<pre class=\"language-js\"><code class=\"language-js\">element<span class=\"token punctuation\">.</span><span class=\"token function\">scrollIntoView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">behavior</span><span class=\"token operator\">:</span> <span class=\"token string\">'smooth'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>I quickly jumped on my JavaScript horse and wrote a tiny script to automatically detect clicks on anchors so the browser would animate the jump towards the anchor target. This jump can be really disorienting, so animating this process would improve the user experience quite a bit.</p>\n<p><a href=\"https://caniuse.com/#feat=css-scroll-behavior\">scrollIntoViewOption currently only works on Firefox and Chrome</a>.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Everytime someone clicks on something</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> href <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// no href attribute, no need to continue then</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>href<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> id <span class=\"token operator\">=</span> href<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// no target to scroll to, bail out</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>target<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// prevent the default quick jump to the target</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// set hash to window location so history is kept correctly</span>\n    history<span class=\"token punctuation\">.</span><span class=\"token function\">pushState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span> href<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// smooooooth scroll to the target!</span>\n    target<span class=\"token punctuation\">.</span><span class=\"token function\">scrollIntoView</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">behavior</span><span class=\"token operator\">:</span> <span class=\"token string\">'smooth'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">block</span><span class=\"token operator\">:</span> <span class=\"token string\">'start'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><a href=\"https://codepen.io/rikschennink/details/ZjBGda\">Live demo</a></p>\n<p>This works wonderfully.</p>\n<p>I <a href=\"https://twitter.com/rikschennink/status/1019960938194259976\">posted it on Twitter</a> and called it a day.</p>\n<p>Then, <a href=\"https://twitter.com/hans_/status/1020081742277902336\">Hans Spieß points out that this can also be done with CSS</a>, WHAT!?</p>\n<p>Turns out there’s a <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/scroll-behavior\"><code>scroll-behavior</code></a> CSS property that we can set to <code>smooth</code>, it’s literally that literal. It’s almost like <code>awesome: yes-please</code>. We can set the <code>scroll-behavior</code> property to the container we want to exhibit smooth scroll behavior and we’re done.</p>\n<p>I created a new <a href=\"https://codepen.io/rikschennink/details/NBBZWO\">demo on CodePen</a> using only CSS.</p>\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/scroll-smooth-diff.mp4\" type=\"video/mp4\" />\n</video>\n<p>Before we go nuts and apply this to all our sites, there are a couple of things to keep in mind.</p>\n<h3 id=\"scroll-distance-matters\">Scroll distance matters</h3>\n<p>If there is a lot of content to scroll, Firefox will skip content to keep the scroll time-limited, while Chrome has a max velocity and will just take its time to get to the target.</p>\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/scroll-long-distance.mp4\" type=\"video/mp4\" />\n</video>\n<p><a href=\"https://codepen.io/rikschennink/details/QBZByx\">Live Demo on CodePend</a></p>\n<p>We could use <a href=\"https://pqina.nl/blog/applying-styles-based-on-the-user-scroll-position-with-smart-css/\">Smart CSS</a> to detect long pages and conditionally apply the smooth scroll style.</p>\n<h3 id=\"accessibility\">Accessibility</h3>\n<p>People might get motion sickness when watching the animation. To circumvent this you can wrap the CSS property in a <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion\"><code>prefers-reduced-motion</code></a> media query. Unfortunately, Chrome does not support this. Safari supports it, but Safari doesn’t support smooth scrolling.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.my-smooth-container</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">scroll-behavior</span><span class=\"token punctuation\">:</span> smooth<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@media</span> <span class=\"token punctuation\">(</span><span class=\"token property\">prefers-reduced-motion</span><span class=\"token punctuation\">:</span> reduce<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token selector\">.my-smooth-container</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">scroll-behavior</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>When deciding on a new functionality we shouldn’t reach out to JavaScript immediately. We should do a quick search first to find out if it can be done with CSS as well. The <code>scroll-behavior</code> property can be a nice UX improvement, do make sure you disable it on very long pages and offer an option to disable it to keep your pages accessible.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/css-smooth-scrolling/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Using Smart CSS To Time Your Newsletter Popup",
    "partialText": "<p>In the <a href=\"https://pqina.nl/blog/applying-styles-based-on-the-user-scroll-position-with-smart-css/\">previous article on Smart CSS</a> we used the user’s scroll position to trigger a floating navigation header.</p>\n<p>Let’s take it a step further and see if we can use this technique to determine if a user is interested in subscribing to our newsletter. Imagine this is a newsletter on a website that presents the user with an article like the one you’re reading now. The goal is to trigger the user into subscribing so we can send a notification if a new article is published in the future.</p>\n<p>We’ll assume the marketing department has us at gunpoint and orders us to show a popup with a subscription form.</p>\n<h2 id=\"how-to-determine-the-best-moment-to-show-this-popup%3F\">How to determine the best moment to show this popup?</h2>\n<p>Imagine you’re shopping in real life, you wander into a random shop, you haven’t even crossed the doorstep and the shop keeper jumps in your face and asks you if you want to receive their monthly newsletter. This would be weird, right?</p>\n<p><strong>On the internet, the above behavior is somehow the norm.</strong></p>\n<p>Maybe it would be a good start to gauge the user’s interest in our newsletter before we ask. How do we determine this potential interest? Let’s go back to our random shop.</p>\n<p>Suppose the following:</p>\n<ul>\n<li>I’ve visited the shop before</li>\n<li>I’ve spent some time wandering the shop</li>\n<li>I’ve actually purchased something</li>\n<li>I’ve had a positive interaction with the shop keeper</li>\n</ul>\n<p>If a couple of these had a green light, I would still not welcome the shop keeper jumping in front of me, but I certainly would not mind them asking me at the counter, and if that would happen, I might even subscribe.</p>\n<p>Are there equivalents to this in our online environment? I can think of a couple of data points, but do let me know in the comments if you have any other suggestions.</p>\n<ul>\n<li>The user spent some time on the site</li>\n<li>The user has been reading the page</li>\n<li>The user has spent some time on the current page</li>\n<li>The user has made a purchase</li>\n</ul>\n<h2 id=\"translating-these-data-points-to-variables\">Translating these data points to variables</h2>\n<p>To determine if the user has visited the site before we can store the time she spent on our site in a session variable using <code>localStorage</code>. By calculating the time spent on each page and storing it at a certain interval we can know how long the user has been browsing the site. And thus, we can determine how familiar the user is with our platform, are we a random shopkeeper? Or have we met before?</p>\n<p>By measuring how far the user has scrolled down on the page we can determine if he is interacting with the site. If the page presents an article this might give us some information on how far along the article the user has read. Combine this with the time user has spent on the page and we could guestimate the user has read the article or is nearly done reading it. If the user has taken the time to read the article, then that might mean he’s interested in our content, he’s “purchased” our content so to speak. Of course, if you run a webshop you could keep track of actual purchases as well.</p>\n<p>The techniques used in the demo below are mostly the same as in the earlier article. I’ve introduced a function that serves as an updater for the data attributes. And another addition is the <code>stack</code> function.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">stack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value<span class=\"token punctuation\">,</span> step</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// round the value to the nearest value divisible by step</span>\n    <span class=\"token comment\">// if value is 37 and step is 10 the result is 30</span>\n    value <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">/</span> step<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> step<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 30 will be our first value</span>\n    <span class=\"token keyword\">const</span> parts <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// now we subtract 10 each iteration till we reach 0</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        value <span class=\"token operator\">-=</span> step<span class=\"token punctuation\">;</span>\n        parts<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// reverse the array so it goes from 0 to 30 insted of 30 to 0</span>\n    <span class=\"token keyword\">return</span> parts<span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>This function receives a <code>value</code> and a <code>step</code> parameter. Suppose the <code>value</code> is set to <code>50</code> and the <code>step</code> is set to <code>10</code>, the function will return this array: <code>[0, 10, 20, 30, 40, 50]</code>. We use this array to store multiple values in our data attributes.</p>\n<p>For example, suppose the user has scrolled 50% of the page. The <code>data-vertical-scroll-progress</code> attribute is then set to <code>&quot;0 10 20 30 40 50&quot;</code>. This allows us to use <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors\">CSS attribute selectors</a> to determine if the user has scrolled at least 30 percent of the page. The <code>~=</code> comparison checks if the set value contains in a white space separated list of items.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">data-vertical-scroll-progress</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>0 10 20 30 40 50<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- Your website here --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">html[data-vertical-scroll-progress~='30']</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* user has scrolled down 30% */</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Let’s combine all our tests and make this a reality. The below demo will show the popup when you’ve scrolled down 50% and have been on the page for 30 seconds.</p>\n<p><a href=\"https://codepen.io/rikschennink/pen/vbKjmJ\">Live Demo on CodePen</a></p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/using-smart-css-to-time-your-wonderful-newsletter-popup/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Applying Styles Based On The User Scroll Position With Smart CSS",
    "partialText": "<p>By mapping the current scroll offset to an attribute on the <code>html</code> element we can style elements on the page based on the current scroll position. We can use this to build, for example, a floating navigation component.</p>\n<p>This is the HTML we’ll work with, a nice <code>&lt;header&gt;</code> component that we want to float on top of the content when we scroll down.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>header</span><span class=\"token punctuation\">></span></span>I'm the page header<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>header</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Lot's of content here...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>More beautiful content...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Content...<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>As a start, we’ll listen for the <code>'scroll'</code> event on the <code>document</code> and we’ll request the current <code>scrollY</code> position each time the user scrolls.</p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>scroll <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>scrollY<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>We have the scroll position stored in a data attribute on the <code>html</code> element. If you view the DOM using your dev tools it would look like this <code>&lt;html data-scroll=&quot;0&quot;&gt;</code>.</p>\n<p>Now we can use this attribute to style elements on the page.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* Make sure the header is always at least 3em high */</span>\n<span class=\"token selector\">header</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">min-height</span><span class=\"token punctuation\">:</span> 3em<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> 100%<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> #fff<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Reserve the same height at the top of the page as the header min-height */</span>\n<span class=\"token selector\">html:not([data-scroll='0']) body</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">padding-top</span><span class=\"token punctuation\">:</span> 3em<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Switch to fixed positioning, and stick the header to the top of the page */</span>\n<span class=\"token selector\">html:not([data-scroll='0']) header</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> fixed<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* This box-shadow will help sell the floating effect */</span>\n    <span class=\"token property\">box-shadow</span><span class=\"token punctuation\">:</span> 0 0 0.5em <span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span>0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>This is basically it, the header will now automatically detach from the page and float on top of the content when scrolling down. The JavaScript code doesn’t care about this, it’s task is simply putting the scroll offset in the data attribute. This is nice as there is no tight coupling between the JavaScript and the CSS.</p>\n<p>There are still some improvements to make, mostly in the performance area.</p>\n<p>But first, we have to fix our script for situations where the scroll position is not at the top when the page loads. In those situations, the header will render incorrectly.</p>\n<p>When the page loads we’ll have to quickly get the current scroll offset. This ensures we’re always in sync with the current state of affairs.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Reads out the scroll position and stores it in the data attribute</span>\n<span class=\"token comment\">// so we can use it in our stylesheets</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">storeScroll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>scroll <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>scrollY<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Listen for new scroll events</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> storeScroll<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Update scroll position for first time</span>\n<span class=\"token function\">storeScroll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Next we’re going to look at some performance improvements. If we request the <code>scrollY</code> position the browser will have to calculate the positions of each and every element on the page to make sure it returns the correct position. It’s best if we not force it to do this each and every scroll interaction.</p>\n<p>To do this, we’ll need a debounce method, this method will queue our request till the browser is ready to paint the next frame, at that point it has already calculate the positions of all the elements on the page so it won’t do it again.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// The debounce function receives our function as a parameter</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">debounce</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// This holds the requestAnimationFrame reference, so we can cancel it if we wish</span>\n    <span class=\"token keyword\">let</span> frame<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// The debounce function returns a new function that can receive a variable number of arguments</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>params</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// If the frame variable has been defined, clear it now, and queue for next frame</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">cancelAnimationFrame</span><span class=\"token punctuation\">(</span>frame<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// Queue our function call for the next frame</span>\n        frame <span class=\"token operator\">=</span> <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Call our function and pass any params we received</span>\n            <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Reads out the scroll position and stores it in the data attribute</span>\n<span class=\"token comment\">// so we can use it in our stylesheets</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">storeScroll</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>scroll <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>scrollY<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Listen for new scroll events, here we debounce our `storeScroll` function</span>\ndocument<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">debounce</span><span class=\"token punctuation\">(</span>storeScroll<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Update scroll position for first time</span>\n<span class=\"token function\">storeScroll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>By marking the event as <code>passive</code> we can tell the browser that our scroll event is not going to be canceled by a touch interaction (for instance when interacting with a plugin like Google Maps). This allows the browser to scroll the page immediately as it now knows that the event won’t be canceled.</p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'scroll'</span><span class=\"token punctuation\">,</span> <span class=\"token function\">debounce</span><span class=\"token punctuation\">(</span>storeScroll<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">passive</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>With the performance issues resolved we now have a stable way to feed data obtained with JavaScript to our CSS and can use this to start styling elements on the page.</p>\n<p><a href=\"https://codepen.io/rikschennink/pen/yZYbwQ\">Live Demo on CodePen</a></p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/applying-styles-based-on-the-user-scroll-position-with-smart-css/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Async Form Posts With A Couple Lines Of Vanilla JavaScript",
    "partialText": "<p>In this tutorial we’ll write a tiny JavaScript event handler that will post our HTML forms using <code>fetch</code> instead of the classic synchronous form post. We’re building a solution based on the Progressive Enhancement strategy, if JavaScript fails to load, users will still be able to submit our form.</p>\n<p>With this approach, when JavaScript is available, the form submit will be a lot smoother. While building this solution we’ll explore JavaScript DOM APIs, handy HTML structures, and accessibility related topics.</p>\n<p>Let’s get started and set up our form.</p>\n<h2 id=\"setting-up-the-html\">Setting up the HTML</h2>\n<p>Our goal is to build a newsletter subscription form.</p>\n<p>The form will have an optional <strong>name</strong> field and an <strong>email</strong> field that we’ll mark as required. We assign the <code>required</code> attribute to our email field so the form can’t be posted if this field is empty. Also, we set the field type to <code>email</code> which triggers email validation and shows a nice email keyboard layout on mobile devices.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>subscribe.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    Name\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n    Email\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span> <span class=\"token punctuation\">/></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Submit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Our form will post to a <code>subscribe.php</code> page, which in our situation is nothing more than a page with a paragraph that confirms to the user that she has subscribed to the newsletter.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Successfully subscribed!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Successfully subscribed!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Let’s quickly move back to our <code>&lt;form&gt;</code> tag to make some tiny improvements.</p>\n<p>If our stylesheet somehow fails to load it currently renders like this:</p>\n<div class=\"demo\">\n<form action=\"https://pqina.nl/blog/async-form-posts-with-a-couple-lines-of-vanilla-javascript/subscribe.php\" method=\"POST\">Name <input type=\"text\" name=\"name\" /> Email <input type=\"email\" name=\"email\" required=\"\" /> <button type=\"submit\">Submit</button></form>\n</div>\n<p>This isn’t horribly bad for our tiny form, but imagine this being a bigger form, and it’ll be quite messy as every field will be on the same line. Let’s wrap each label and field combo in a <code>&lt;div&gt;</code>.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>subscribe.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        Name\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        Email\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Submit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Now each field is rendered on a new line.</p>\n<div class=\"demo\">\n<form action=\"https://pqina.nl/blog/async-form-posts-with-a-couple-lines-of-vanilla-javascript/subscribe.php\" method=\"POST\">\n  <div>\n    Name\n    <input type=\"text\" name=\"name\" />\n  </div>\n  <div>\n    Email\n    <input type=\"email\" name=\"email\" required=\"\" />\n  </div>\n<p><button type=\"submit\">Submit</button></p>\n</form>\n</div>\n<p>Another improvement would be to wrap the field names in a <code>&lt;label&gt;</code> element so we can explicitly link each label to its sibling input field. This allows users to click on the label to focus the field but also triggers assistive technology like screen readers to read out the label of the field when the field receives focus.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>subscribe.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Email<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Submit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>A tiny effort resulting in big UX and accessibility gains. Wonderful!</p>\n<div class=\"demo\">\n<form action=\"https://pqina.nl/blog/async-form-posts-with-a-couple-lines-of-vanilla-javascript/subscribe.php\" method=\"POST\">\n  <div>\n    <label for=\"name\">Name</label>\n    <input type=\"text\" name=\"name\" id=\"name\" />\n  </div>\n  <div>\n    <label for=\"email\">Email</label>\n    <input type=\"email\" name=\"email\" id=\"email\" required=\"\" />\n  </div>\n<p><button type=\"submit\">Submit</button></p>\n</form>\n</div>\n<p>With our form finished, let’s write some JavaScript.</p>\n<h2 id=\"writing-the-form-submit-handler\">Writing the Form Submit Handler</h2>\n<p>We’ll write a script that turns all forms on the page into asynchronous forms.</p>\n<p>We don’t need access to all forms on the page to set this up, we can simply listen to the <code>'submit'</code> event on the <code>document</code> and handle all form posts in a single event handler. The event target will always be the form that was submitted so we can access the form element using <code>e.target</code></p>\n<p>To prevent the classic form submit from happening we can use the <code>preventDefault</code> method on the <code>event</code> object, this will prevent default actions performed by the browser.</p>\n<p><em>If you only want to handle a single form, you can do so by attaching the event listener to that specific form element.</em></p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'submit'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Store reference to form to make later code easier to read</span>\n    <span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Prevent the default form submit</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Okay, we’re now ready to send our form data.</p>\n<p>This action is two-part, the sending part and the data part.</p>\n<p>For sending the data we can use the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API\"><code>fetch</code></a> API, for gathering the form data we can use a super handy API called <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FormData\"><code>FormData</code></a>.</p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'submit'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Store reference to form to make later code easier to read</span>\n    <span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Post data using the Fetch API</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> form<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Prevent the default form submit</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><strong>Yes, I kid you not, it’s this straightforward.</strong></p>\n<p>The first argument to <code>fetch</code> is a URL, so we pass the <code>form.action</code> property, which contains <code>subscribe.php</code>. Then we pass a configuration object, which contains the <code>method</code> to use, which we get from the <code>form.method</code> property (<code>POST</code>). Lastly, we need to pass the data in the <code>body</code> property. We can blatantly pass the <code>form</code> element as a parameter to the <code>FormData</code> constructor and it’ll create an object for us that resembles the classic form post and is posted as <code>multipart/form-data</code>.</p>\n<p><a href=\"https://dev.to/justmarkup\">Michael Scharnagl</a> suggested moving the <code>preventDefault()</code> call to the end, this makes sure the classic submit is only prevented if all our JavaScript runs.</p>\n<p><strong>We’re done! To the pub!</strong></p>\n<video loop=\"\" autoplay=\"\" muted=\"\" playsinline=\"\">\n    <source src=\"https://pqina.nl/media/pub.mp4\" type=\"video/mp4\" />\n</video>\n<p>Of course, there are a couple of things we forgot, this basically was the extremely happy flow, so hold those horses and put down that pint. How do we handle connection errors? What about notifying the user of a successful subscription? And what happens while the subscribe page is being requested?</p>\n<h2 id=\"the-edge-cases\">The Edge Cases</h2>\n<p>Let’s first handle notifying the user of a successful newsletter subscription.</p>\n<h3 id=\"showing-the-success-state\">Showing the Success State</h3>\n<p>We can do this by pulling in the message on the subscribe.php page and showing that instead of the form element. Let’s continue right after the <code>fetch</code> statement and handle the resolve case of the <code>fetch</code> call.</p>\n<p>First, we need to turn the response into a <code>text</code> based response. Then we can turn this text-based response in an actual HTML document using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/DOMParser\"><code>DOMParser</code></a> API, we tell it to parse our text and regard it as <code>text/html</code>, we return this result so it’s available in the next <code>then</code></p>\n<p>Now we have an HTML document to work with (<code>doc</code>) we can finally replace our form with the success status. We’ll copy the <code>body.innerHTML</code> to our <code>result.innerHTML</code>, then we replace our form with the newly created result element. Last but not least we move focus to the result element so it’s read to screen reader users and keyboard users can resume navigation from that point in the page.</p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'submit'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Store reference to form to make later code easier to read</span>\n    <span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Post data using the Fetch API</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> form<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// We turn the response into text as we expect HTML</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Let's turn it into an HTML document</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseFromString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Now we have a document to work with let's replace the &lt;form></span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Create result message container and copy HTML from doc</span>\n            <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            result<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Allow focussing this element with JavaScript</span>\n            result<span class=\"token punctuation\">.</span>tabIndex <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// And replace the form with the response children</span>\n            form<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Move focus to the status message</span>\n            result<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Prevent the default form submit</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<h3 id=\"connection-troubles\">Connection Troubles</h3>\n<p>If our connection fails the <code>fetch</code> call will be rejected which we can handle with a <code>catch</code></p>\n<p>First, we extend our HTML form with a message to show when the connection fails, let’s place it above the submit button so it’s clearly visible when things go wrong.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>subscribe.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Email<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>alert<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">hidden</span><span class=\"token punctuation\">></span></span>Connection failure, please try again.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Submit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>By using the <code>hidden</code> attribute, we’ve hidden the <code>&lt;p&gt;</code> from everyone. We’ve added a <code>role=&quot;alert&quot;</code> to the paragraph, this triggers screen readers to read out loud the contents of the paragraph once it becomes visible.</p>\n<p>Now let’s handle the JavaScript side of things.</p>\n<p>The code we put in the <code>fetch</code> rejection handler (<code>catch</code>) will select our alert paragraph and show it to the user.</p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'submit'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Store reference to form to make later code easier to read</span>\n    <span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Post data using the Fetch API</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> form<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// We turn the response into text as we expect HTML</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Let's turn it into an HTML document</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseFromString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Now we have a document to work with let's replace the &lt;form></span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Create result message container and copy HTML from doc</span>\n            <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            result<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Allow focussing this element with JavaScript</span>\n            result<span class=\"token punctuation\">.</span>tabIndex <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// And replace the form with the response children</span>\n            form<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Move focus to the status message</span>\n            result<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Some form of connection failure</span>\n            form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=alert]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Make sure connection failure message is hidden</span>\n    form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=alert]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Prevent the default form submit</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>We select our alert paragraph with the CSS attribute selector <code>[role=alert]</code>. No need for a class name. Not saying we might not need one in the future, but sometimes selecting by attribute is fine.</p>\n<p>I think we got our edge cases covered, let’s polish this up a bit.</p>\n<h2 id=\"locking-fields-while-loading\">Locking Fields While Loading</h2>\n<p>It would be nice if the form locked all input fields while it’s being sent to the server. This prevents the user from clicking the submit button multiple times, and also from editing the fields while waiting for the process to finish.</p>\n<p>We can use the <code>form.elements</code> property to select all form fields and then disable each field.</p>\n<p><em>If you have a <code>&lt;fieldset&gt;</code> in your form, you can disable the fieldset and that will disable all fields inside it</em></p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'submit'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Store reference to form to make later code easier to read</span>\n    <span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Post data using the Fetch API</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> form<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// We turn the response into text as we expect HTML</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Let's turn it into an HTML document</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseFromString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Now we have a document to work with let's replace the &lt;form></span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Create result message container and copy HTML from doc</span>\n            <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            result<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Allow focussing this element with JavaScript</span>\n            result<span class=\"token punctuation\">.</span>tabIndex <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// And replace the form with the response children</span>\n            form<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Move focus to the status message</span>\n            result<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Show error message</span>\n            form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=alert]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Disable all form elements to prevent further input</span>\n    Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">field</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Make sure connection failure message is hidden</span>\n    form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=alert]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Prevent the default form submit</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><code>form.elements</code> needs to be turned into an array using <code>Array.from</code> for us to loop over it with <code>forEach</code> and set the <code>disable</code> attribute on <code>true</code> for each field.</p>\n<p>Now we got ourselves into a sticky situation because if <code>fetch</code> fails and we end up in our <code>catch</code> all form fields are disabled and we can no longer use our form. Let’s resolve that by adding the same statement to the <code>catch</code> handler but instead of disabling the fields we’ll enable the fields.</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// Unlock form elements</span>\n  Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">field</span> <span class=\"token operator\">=></span> field<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Show error message</span>\n  form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=alert]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Believe it or not, we’re still not out of the woods. Because we’ve disabled all elements the browser has moved focus to the <code>&lt;body&gt;</code> element. If the <code>fetch</code> fails we end up in the <code>catch</code> handler, enable our form elements, but the user has already lost her location on the page (this is especially useful for users navigating with a keyboard, or, again, users that have to rely on a screen reader).</p>\n<p>We can store the current focussed element <code>document.activeElement</code> and then restore the focus with <code>element.focus()</code> later on when we enable all the fields in the <code>catch</code> handler. While we wait for a response we’ll move focus to the form element itself.</p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'submit'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Store reference to form to make later code easier to read</span>\n    <span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Post data using the Fetch API</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> form<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// We turn the response into text as we expect HTML</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Let's turn it into an HTML document</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseFromString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Now we have a document to work with let's replace the &lt;form></span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Create result message container and copy HTML from doc</span>\n            <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            result<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Allow focussing this element with JavaScript</span>\n            result<span class=\"token punctuation\">.</span>tabIndex <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// And replace the form with the response children</span>\n            form<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Move focus to the status message</span>\n            result<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Unlock form elements</span>\n            Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>\n                <span class=\"token punctuation\">(</span><span class=\"token parameter\">field</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Return focus to active element</span>\n            lastActive<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Show error message</span>\n            form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=alert]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Before we disable all the fields, remember the last active field</span>\n    <span class=\"token keyword\">const</span> lastActive <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>activeElement<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Move focus to form while we wait for a response from the server</span>\n    form<span class=\"token punctuation\">.</span>tabIndex <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    form<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Disable all form elements to prevent further input</span>\n    Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">field</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Make sure connection failure message is hidden</span>\n    form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[role=alert]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Prevent the default form submit</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>I admit it’s not a few lines of JavaScript, but honestly, there are a lot of comments in there.</p>\n<h3 id=\"showing-a-busy-state\">Showing a Busy State</h3>\n<p>To finish up it would be nice to show a busy state so the user knows something is going on.</p>\n<p><em>Please note that while <code>fetch</code> is fancy, it currently doesn’t support setting a timeout and it also doesn’t support progress events, so for busy states that might take a while there would be no shame in using <code>XMLHttpRequest</code>, it would be a good idea even.</em></p>\n<p>With that said the time has come to add a class to that alert message of ours (DAMN YOU PAST ME!). We’ll name it <code>status-failure</code> and add our busy paragraph right next to it.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>subscribe.php<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>POST<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Name<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>name<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Email<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>email<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">required</span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>alert<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>status-failure<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">hidden</span><span class=\"token punctuation\">></span></span>\n        Connection failure, please try again.\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>alert<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>status-busy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">hidden</span><span class=\"token punctuation\">></span></span>\n        Busy sending data, please wait.\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Submit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>We’ll reveal the busy state once the form is submitted, and hide it whenever we end up in <code>catch</code>. When data is submitted correctly the entire form is replaced, so no need to hide it again in the success flow.</p>\n<p>When the busy state is revealed, instead of moving focus to the form, we move it to the busy state. This triggers the screen reader to read it out loud so the user knows the form is busy.</p>\n<p><em>We’ve stored references to the two status messages at the start of the event handler, this makes the code later on a bit easier to read.</em></p>\n<pre class=\"language-js\"><code class=\"language-js\">document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'submit'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Store reference to form to make later code easier to read</span>\n    <span class=\"token keyword\">const</span> form <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// get status message references</span>\n    <span class=\"token keyword\">const</span> statusBusy <span class=\"token operator\">=</span> form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.status-busy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> statusFailure <span class=\"token operator\">=</span> form<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.status-failure'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Post data using the Fetch API</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>action<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span> form<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FormData</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// We turn the response into text as we expect HTML</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Let's turn it into an HTML document</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseFromString</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\">// Now we have a document to work with let's replace the &lt;form></span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">doc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Create result message container and copy HTML from doc</span>\n            <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            result<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>innerHTML<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Allow focussing this element with JavaScript</span>\n            result<span class=\"token punctuation\">.</span>tabIndex <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// And replace the form with the response children</span>\n            form<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">replaceChild</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Move focus to the status message</span>\n            result<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Unlock form elements</span>\n            Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>\n                <span class=\"token punctuation\">(</span><span class=\"token parameter\">field</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Return focus to active element</span>\n            lastActive<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Hide the busy state</span>\n            statusBusy<span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Show error message</span>\n            statusFailure<span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Before we disable all the fields, remember the last active field</span>\n    <span class=\"token keyword\">const</span> lastActive <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>activeElement<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Show busy state and move focus to it</span>\n    statusBusy<span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    statusBusy<span class=\"token punctuation\">.</span>tabIndex <span class=\"token operator\">=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    statusBusy<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Disable all form elements to prevent further input</span>\n    Array<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>form<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">field</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">.</span>disabled <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Make sure connection failure message is hidden</span>\n    statusFailure<span class=\"token punctuation\">.</span>hidden <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Prevent the default form submit</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><strong>That’s it!</strong></p>\n<p>We skipped over the CSS part of front-end development, you can either use a CSS framework or apply your own custom styles. The example as it is should give an excellent starting point for further customization.</p>\n<p>One final thing. <a href=\"http://www.outlinenone.com/\">Don’t remove the focus outline</a>.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>We’ve written a semantic HTML structure for our form and then built from there to deliver an asynchronous upload experience using plain JavaScript. We’ve made sure our form is accessible to users with keyboards and users who rely on assistive technology like screen readers. And because we’ve followed a Progressive Enhancement strategy the form will still work even if our JavaScript fails.</p>\n<p>I hope we’ve touched upon a couple new APIs and methodologies for you to use, let me know if you have any questions!</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/async-form-posts-with-a-couple-lines-of-vanilla-javascript/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "FilePond.js Launch Day Post-mortem",
    "partialText": "<p>Last Thursday I decided to finally launch FilePond.js, a JavaScript file upload library I’d been working on for six months. This is a summary of how I prepared for launch day and why having only a single sale did not make me a sad panda.</p>\n<p><img src=\"https://cdn.dribbble.com/users/28315/screenshots/4287522/dribbble-launch.gif\" alt=\"\" /></p>\n<p>I like to endlessly work on a polished user experience. It’s both a strength as a weakness, as you can keep polishing it forever, things will never be as shiny as you want them to be. So two weeks back, I stopped all polishing activities and started working towards an official release.</p>\n<p>I decided that FilePond was as feature complete as it was going to be in the next couple of months. Any additional features would simply delay the launch too much. It still did not have manual editing of images, chunk uploading, or a React wrapper. While those features would make it stand out from the competition, they would also push the release months into the future. Releasing those features independently would allow me to create renewed attention after the main release, which would be valuable as well.</p>\n<p>Before I could launch I had restructure the promotion page to be a proper product page.</p>\n<h2 id=\"finishing-the-product-page\">Finishing the Product Page</h2>\n<p>I started work on the <a href=\"https://pqina.nl/filepond\">product page</a> and tried to follow these <a href=\"https://www.julian.com/learn/growth/landing-pages#landing-page-copy\">Landing Page tips by Julian Shapiro</a> as close as possible. All the while I shared my progress on <a href=\"https://twitter.com/rikschennink\">Twitter</a>, <a href=\"https://dribbble.com/rikschennink\">Dribbble</a>, and <a href=\"https://wip.chat/@rikschennink\">WIP.chat</a> to validate I was heading in the right direction.</p>\n<p>A couple days before launch <a href=\"https://www.indiehackers.com/forum/mvp-feedback-built-a-javascript-file-upload-library-looking-for-feedback-on-landing-page-8c20a73736\">I opened a topic on Indie Hackers</a> to get final feedback. The 28th of February, the day before launch, I was still tweaking the title and tagline.</p>\n<h2 id=\"launch-plan\">Launch Plan</h2>\n<p>The day before launch, I set up a launch plan. The launch plan would remind me of all the activities I should be doing during launch day. I was going to need this as I knew that if things would heat up, my adrenaline would start racing and I would forget stuff.</p>\n<p>The plan contained a timeline with info on when to post what to which network. I also added popular Twitter accounts to the list and determined when it would be best to contact them using personal messages ( check at what time of day they are mostly active on Twitter ).</p>\n<p>The day started with posting <a href=\"http://producthunt.com/posts/filepond-js\">FilePond on Product Hunt</a>. It’s best to post at the start of the day, as that allows you to collect as many upvotes as possible. Luckily midnight at Product Hunt HQ is a comfortable 9 AM in The Netherlands ☀️ I already prepared a description, animated icon and first comment so I could post quickly. Then it’s fingers crossed 🤞🏻</p>\n<p>I developed FilePond in the open on <a href=\"https://wip.chat/products/191\">WIP.chat</a>, so I marked FilePond as launched and shared with everyone that FilePond was also live on Product Hunt.</p>\n<p>Then a couple hours later I posted FilePond on <a href=\"https://www.reddit.com/r/web_design/comments/814j2w/for_the_past_year_ive_worked_on_filepondjs_a/\">Reddit</a>, <a href=\"https://www.indiehackers.com/forum/show-ih-just-launched-filepond-js-a-javascript-library-that-can-handle-any-file-you-throw-at-it-1f3f66bb36\">IndieHackers</a>, <a href=\"https://www.designernews.co/stories/92306-ive-built-a-beautifully-animated-and-flexible-javascript-file-upload-library\">Designer News</a> and <a href=\"https://news.ycombinator.com/item?id=16491804\">Hacker News</a>. It received a lot of attention on Reddit and IndieHackers. It quickly dropped off the page on Designer News and Hacker News, oh well 🙂</p>\n<p>I spent the day replying to comments on all these networks and answering peoples questions as honest and detailed as possible. It was intense but so rewarding.</p>\n<p>FilePond climbed to spot #2 on the Product Hunt homepage and at the end of the day finished at spot #5. Quite happy with that!</p>\n<p><img src=\"https://pqina.nl/media/filepond-ai-gorilla-in-the-way.png\" alt=\"\" /></p>\n<p><img src=\"https://pqina.nl/media/filepond-product-hunt.jpeg\" alt=\"\" /></p>\n<p>The Indie Hackers post was upvoted quite a bit so received a lot of attention as well ( around 1000 views ). The post on r/webdesign held the top position the entire day and got around 5300 views.</p>\n<p>User sessions during launch day.\n<img src=\"https://pqina.nl/media/filepond-traffic.png\" alt=\"\" /></p>\n<h2 id=\"a-single-sale\">A Single Sale</h2>\n<p>I had set up a purchase code to offer potential clients a 15% discount if they purchased FilePond during launch day. Having high hopes I initially was taken aback by the fact that no sales were happening.</p>\n<p>Then it hit me. It should’ve hit me a lot earlier, but better late than never.</p>\n<p>FilePond is not a product that solves an immediate problem in everyone’s developer lives. It’s a product that solves a problem for a certain part of a project. A lot of comments would be phrased like this “Amazing product, can’t wait to use it” or “Will use this in my next project for sure”.</p>\n<p><strong>The chance that during launch day someone was working on a project that needed a file upload library right then and there was slim.</strong></p>\n<p>My main goal should’ve been to get FilePond under the eyes of as many developers as possible. So from that moment on I shifted my focus to getting the <a href=\"https://github.com/pqina/filepond\">FilePond GitHub repository</a> in the <a href=\"https://github.com/trending/javascript\">trending JavaScript repositories</a> overview.</p>\n<p>At the end of Friday, it was holding steady at position #2.</p>\n<p><img src=\"https://pqina.nl/media/filepond-github-trending.jpeg\" alt=\"\" /></p>\n<p>It’s currently still on the list at position #7. It’s gone from 15 GitHub stars at launch to 1110 at the time of this writing.</p>\n<p>Around 6 PM during dinner I made my first sale. 🎉</p>\n<h2 id=\"what%E2%80%99s-next\">What’s Next</h2>\n<p>I’ve decided to first write this post-mortem and then take a step back and refocus my efforts.</p>\n<p>The plan right now is to start work on the quick wins first. It would be nice to have jQuery and React wrappers available so people can more easily integrate FilePond in their projects. The next step would be to offer manual image editing capabilities.</p>\n<p>I’m really enjoying the attention FilePond is getting and hope to eventually see sales rise as awareness of its existence increases. I’m content with it not making a gazillion sales during launch day as I’m in it for the long haul.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/filepond-launch-day-post-mortem/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Use JavaScript Plugins With WordPress",
    "partialText": "<p>You’ve found that perfect plugin for your site, but dang, it’s not available for WordPress, it’s a jQuery plugin. Fear not, the following guide will help you set up any jQuery or JavaScript plugin on WordPress.</p>\n<p>For this tutorial we’ll look into how to setup <a href=\"https://pqina.nl/flip\">Flip</a>, a JavaScript Countdown plugin, for use with WordPress using <a href=\"https://wordpress.org/plugins/snippy/\">Snippy a free WordPress plugin</a>.</p>\n<p>If you’d rather watch a video of this tutorial, then follow step one below and then open the <a href=\"https://www.youtube.com/watch?v=S7JjNq6feK0\">Snippy tutorial on YouTube</a>.</p>\n<h2 id=\"step-download-and-install-wordpress-plugin-snippy\">Step 1. Download and install WordPress plugin Snippy</h2>\n<p>Snippy is open source and <a href=\"https://github.com/pqina/snippy\">available on GitHub</a>, you can <a href=\"https://wordpress.org/plugins/snippy/\">download Snippy from the WordPress plugin page</a>.</p>\n<p>With Snippy you can build your own shortcodes and define which resources (bits) are required when the shortcode is used on a page.</p>\n<p>A bit can be a Stylesheet, a JavaScript file or a snippet of HTML, CSS or inline JavaScript.</p>\n<p>You are probably familiar with shortcodes already. Shortcodes can embed files or create objects that would normally require lots of complicated, ugly code in just one line. Snippy allows you to create your own custom shortcodes. A custom Snippy shortcode consists of one or more bits.</p>\n<h2 id=\"step-adding-bits\">Step 2. Adding Bits</h2>\n<p>We start by adding our Stylesheet, JavaScript and HTML bits. Without bits, no shortcode.</p>\n<p>Click the Snippy menu item. Then click on “Add bit”.</p>\n<ol>\n<li>We’ll call our JavaScript bit “Tick JavaScript”, so it’s easy to find it later.</li>\n<li>Set type to “Resource”, as we want to upload a file.</li>\n<li>Click on the file upload control and select the “tick.js” file.</li>\n<li>Click Save!</li>\n</ol>\n<p>When we return to the overview we can now see our bit is listed.</p>\n<p>Follow the same same steps for our Stylesheet. Name the bit “Tick Stylesheet” and this time pick the “tick.css” file. Save!</p>\n<p>Okay, we’ve added two bits to our bit list. We can now add the final bit, the HTML snippet required for Tick to work. Again click on “Add bit”.</p>\n<ol>\n<li>Name the bit “Tick Countdown Preset” and set type to “HTML”.</li>\n<li>Open the countdown preset in your favorite text editor and copy past the preset snippet to the value field.</li>\n<li>We can now add a placeholder value. Replace the <code>Tick.count.down()</code> part with <code>Tick.count.down('{{due}}')</code>. The <code>due</code> value is now automatically turned into a placeholder and we can use it later in our shortcode.</li>\n<li>Click Save to finalize this bit.</li>\n</ol>\n<p>Okay, we’ve setup all our bits. Ready to move on to the shortcode.</p>\n<h2 id=\"step-our-very-own-shortcode\">Step 3. Our very own Shortcode</h2>\n<p>Click “Add shortcode” to open the Shortcode editor.</p>\n<p>We’ll name our shortcode “countdown”, all lowercase letters.</p>\n<p>Below the name field we can see a list of all available bits. Let’s select all the bits we’ve just created. When done, click Save.</p>\n<p>We’ve now created a custom shortcode. Let’s move to the text editor to add it to a page.</p>\n<h2 id=\"step-adding-the-shortcode-to-a-page\">Step 4. Adding the Shortcode to a page</h2>\n<p>Edit one of your pages, best to make sure it’s a wide page so the counter has enough room.</p>\n<p>Okay, you found one. Open the text editor, make sure the view tab is selected and click on a location in the view where you want to shortcode to be placed.</p>\n<ol>\n<li>Now, click on the little Snippy icon. It’ll show a list of available custom shortcodes.</li>\n<li>Select our “countdown” short code. It will now unfold at the location you had selected showing the available attributes. In this case “due”.</li>\n<li>Enter a value for the due date of the counter. Flip dates are defined in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO8601 format</a> so a value like “2018-07-01T12:00:00” would count down to 12 o’clock on July the first of 2018.</li>\n</ol>\n<p>Let’s hit the update button and refresh the page. The Flip counter should now be visible on the page. It’s possible that it requires some style adjustments based on the font size and space of your theme. <a href=\"https://youtu.be/S7JjNq6feK0?t=2m\">Change the set font sizes in the preset to make it fit perfectly</a>.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/using-javascript-plugins-with-wordpress/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Upload Multiple Files With Slim Image Cropper",
    "partialText": "<p>Slim Image Cropper is a nifty way to let users upload cropped images to your server. but it doesn’t offer an out of the box solution to upload multiple images at once. In this article we’ll setup a script that works together with Slim to setup basic multiple file upload.</p>\n<p>If you’re not familiar with Slim you can read more about it on the <a href=\"https://pqina.nl/slim\">Slim Image Cropper Product Page</a>.</p>\n<p>Alright, let’s get started.</p>\n<p>First things first, we’ll need a place to drop multiple images. We’ll create a simple <code>&lt;div&gt;</code> element for that. Inside the div we will add a text so the user knows where to drop the images. For this text we can use a <code>&lt;label&gt;</code> element. If we then bind this label element to a <code>&lt;input&gt;</code> of type file (using the <code>for</code> attribute with the input <code>id</code> as value), we’re good to go! Oh, if you add the <code>multiple</code> attribute to the input the user can select multiple files.</p>\n<p>This label / input combo will help us out in a couple of situations. The first advantage is this, if our JavaScript fails, we’ll still have our classic file upload.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file-drop-area<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Drop your files here<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files[]<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>files<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>file<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">multiple</span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Alright, with the HTML setup we can now move on to add a some style. We style the label to look like the drop area. We also give it a cursor that looks like a pointer, when the user hovers over the label the browser reveals that it’s clickable.</p>\n<p>Now for the second advantage of our label / input combo. Because we’ve bound or <code>&lt;label&gt;</code> to our <code>&lt;input&gt;</code> our eventual solution will work both when the user drops images on the drop area and when the user clicks the label.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.file-drop-area label</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> block<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 2em<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> #eee<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">text-align</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n    <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>On to JavaScript!</p>\n<ol>\n<li>We’ll have to handle the file <code>drag</code> and <code>drop</code> events. <code>drag</code> needs to be defaultPrevented (I don’t know if that’s even a word) for <code>drop</code> to work. Also, we’ll bind the <code>change</code> event on the file input so manual file selection also works.</li>\n<li>For each dropped or selected item we’ll have figure out if it’s an actual file and if it matches our expectations.</li>\n<li>Create an Image Cropper for each of the dropped files that met our expectations.</li>\n<li>If all our script ran successfully we can hide the file input element.</li>\n</ol>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 1. Handling the various events</span>\n<span class=\"token comment\">// - get references to different elements we need</span>\n<span class=\"token comment\">// - listen to drag, drop and change events</span>\n<span class=\"token comment\">// - handle dropped and selected files</span>\n\n<span class=\"token comment\">// get a reference to the file drop area and the file input</span>\n<span class=\"token keyword\">var</span> fileDropArea <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.file-drop-area'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> fileInput <span class=\"token operator\">=</span> fileDropArea<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> fileInputName <span class=\"token operator\">=</span> fileInput<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// listen to events for dragging and dropping</span>\nfileDropArea<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dragover'</span><span class=\"token punctuation\">,</span> handleDragOver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfileDropArea<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'drop'</span><span class=\"token punctuation\">,</span> handleDrop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfileInput<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> handleFileSelect<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// need to block dragover to allow drop</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleDragOver</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// deal with dropped items,</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleDrop</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">handleFileItems</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>dataTransfer<span class=\"token punctuation\">.</span>items <span class=\"token operator\">||</span> e<span class=\"token punctuation\">.</span>dataTransfer<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// handle manual selection of files using the file input</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleFileSelect</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleFileItems</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 2. Handle the dropped items</span>\n<span class=\"token comment\">// - test if the item is a File or a DataTransferItem</span>\n<span class=\"token comment\">// - do some expectation matching</span>\n\n<span class=\"token comment\">// loops over a list of items and passes</span>\n<span class=\"token comment\">// them to the next function for handling</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleFileItems</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">items</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> l <span class=\"token operator\">=</span> items<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> l<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">handleItem</span><span class=\"token punctuation\">(</span>items<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// handles the dropped item, could be a DataTransferItem</span>\n<span class=\"token comment\">// so we turn all items into files for easier handling</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleItem</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// get file from item</span>\n    <span class=\"token keyword\">var</span> file <span class=\"token operator\">=</span> item<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>getAsFile <span class=\"token operator\">&amp;&amp;</span> item<span class=\"token punctuation\">.</span>kind <span class=\"token operator\">==</span> <span class=\"token string\">'file'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        file <span class=\"token operator\">=</span> item<span class=\"token punctuation\">.</span><span class=\"token function\">getAsFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">handleFile</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// now we're sure each item is a file</span>\n<span class=\"token comment\">// the function below can test if the files match</span>\n<span class=\"token comment\">// our expectations</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">handleFile</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/*\n  // you can check if the file fits all requirements here\n  // for example:\n  // if file is bigger then 1 MB don't load\n  if (file.size > 1000000) {\n    return;\n  }\n  */</span>\n\n    <span class=\"token comment\">// if it does, create a cropper</span>\n    <span class=\"token function\">createCropper</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 3. Create the Image Cropper</span>\n<span class=\"token comment\">// - create an element for the cropper to bind to</span>\n<span class=\"token comment\">// - add the element after the drop area</span>\n<span class=\"token comment\">// - creat the cropper and bind the remove button so it</span>\n<span class=\"token comment\">//   removes the entire cropper when clicked.</span>\n\n<span class=\"token comment\">// create an Image Cropper for each passed file</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createCropper</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// create container element for cropper</span>\n    <span class=\"token keyword\">var</span> cropper <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// insert this element after the file drop area</span>\n    fileDropArea<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>cropper<span class=\"token punctuation\">,</span> fileDropArea<span class=\"token punctuation\">.</span>nextSibling<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// create a Slim Cropper</span>\n    Slim<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>cropper<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">ratio</span><span class=\"token operator\">:</span> <span class=\"token string\">'16:9'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">defaultInputName</span><span class=\"token operator\">:</span> fileInputName<span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">didInit</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// load the file to our slim cropper</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">didRemove</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// detach from DOM</span>\n            cropper<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>cropper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// destroy the slim cropper</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">destroy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 4. Disable the file input element</span>\n\n<span class=\"token comment\">// hide file input, we can now upload with JavaScript</span>\nfileInput<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'none'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// remove file input name so it's value is</span>\n<span class=\"token comment\">// not posted to the server</span>\nfileInput<span class=\"token punctuation\">.</span><span class=\"token function\">removeAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>To run the script either:</p>\n<ul>\n<li>Paste the script after the file drop area or just before the closing body tag;</li>\n<li>Run the script in a DOMContentLoaded callback;</li>\n<li>Run the script in a jQuery <code>ready()</code> handler;</li>\n</ul>\n<p>For the above script to function you’ll have to embed <a href=\"https://pqina.nl/slim\">Slim Image Cropper</a> on your web page. Of course with some tweaks to the <code>createCropper</code> function the above script can be used with other croppers as well.</p>\n<p>In this example I use the global version of the script, but the <code>createCropper</code> function can easily be rewritten to work with jQuery as you can see below.</p>\n<p>Literally replace <code>Slim.create(cropper,</code> with <code>$(cropper).slim(</code> and you’re good to go.</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/multiple-file-upload-with-slim/"
  },
  {
    "publisherId": "pqina",
    "publisherName": "Rik Schennink",
    "specTitle": "JS 라이브러리",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://pqina.nl/feed.xml",
    "title": "Create Thumbnails With PHP",
    "partialText": "<p>If you’ve got photo galleries on your website or need to generate avatars from uploaded profile pictures you’ll most likely want to create thumbnails. In this article we’ll look at a function that handles various image types and resizes them to a set width and height.</p>\n<p>Want to get the code and get back to your project? <a href=\"https://gist.github.com/pqina/7a42bf0833d988dd81d3c9438009da21\">Download the script here</a>.</p>\n<p>For this article I’ll assume you’ve got some images uploaded on your PHP server. The tutorial will not discuss uploading files to the server. Alright. Images ready? Launch your editor and let’s do some coding!</p>\n<p>PHP has a <a href=\"http://php.net/manual/en/ref.image.php\">long list of functions that can load images</a>. It has one function for each image type. As it’s really cumbersome to have a thumbnail function per image type our mission is to write one function to handle all the usual image types.</p>\n<p><img src=\"https://pqina.nl/media/thumbnail-file-formats.png\" alt=\"Photography, cat pictures, charts\" /></p>\n<p>We’ll go with JPEGs, PNGs and Cats. I mean GIFs. For those we’ll need the following PHP methods:</p>\n<ul>\n<li><code>imagecreatefromjpeg</code> &amp; <code>imagejpeg</code></li>\n<li><code>imagecreatefrompng</code> &amp; <code>imagepng</code></li>\n<li><code>imagecreatefromgif</code> &amp; <code>imagegif</code></li>\n</ul>\n<p>Our steps:</p>\n<ol>\n<li>Load the image (using the correct PHP function)</li>\n<li>Create a thumbnail by duplicating the image and resizing it</li>\n<li>Save the thumbnail to disk (using the correct PHP function)</li>\n</ol>\n<p>This gives us the following script. It’s well documented so each sub-step is explained.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Link image type to correct image loader and saver</span>\n<span class=\"token comment\">// - makes it easier to add additional types later on</span>\n<span class=\"token comment\">// - makes the function easier to read</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">IMAGE_HANDLERS</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token constant\">IMAGETYPE_JPEG</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string single-quoted-string\">'load'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'imagecreatefromjpeg'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'save'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'imagejpeg'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'quality'</span> <span class=\"token operator\">=></span> <span class=\"token number\">100</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">IMAGETYPE_PNG</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string single-quoted-string\">'load'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'imagecreatefrompng'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'save'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'imagepng'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'quality'</span> <span class=\"token operator\">=></span> <span class=\"token number\">0</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">IMAGETYPE_GIF</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string single-quoted-string\">'load'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'imagecreatefromgif'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'save'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'imagegif'</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * @param $src - a valid file location\n * @param $dest - a valid file target\n * @param $targetWidth - desired output width\n * @param $targetHeight - desired output height or null\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">createThumbnail</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$src</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$dest</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$targetWidth</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$targetHeight</span> <span class=\"token operator\">=</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// 1. Load the image from the given $src</span>\n    <span class=\"token comment\">// - see if the file actually exists</span>\n    <span class=\"token comment\">// - check if it's of a valid image type</span>\n    <span class=\"token comment\">// - load the image resource</span>\n\n    <span class=\"token comment\">// get the type of the image</span>\n    <span class=\"token comment\">// we need the type to determine the correct loader</span>\n    <span class=\"token variable\">$type</span> <span class=\"token operator\">=</span> <span class=\"token function\">exif_imagetype</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$src</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// if no valid type or no handler found -> exit</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$type</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span><span class=\"token constant\">IMAGE_HANDLERS</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$type</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// load the image with the correct loader</span>\n    <span class=\"token variable\">$image</span> <span class=\"token operator\">=</span> <span class=\"token function\">call_user_func</span><span class=\"token punctuation\">(</span><span class=\"token constant\">IMAGE_HANDLERS</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$type</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'load'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$src</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// no image found at supplied location -> exit</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token variable\">$image</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n\n    <span class=\"token comment\">// 2. Create a thumbnail and resize the loaded $image</span>\n    <span class=\"token comment\">// - get the image dimensions</span>\n    <span class=\"token comment\">// - define the output size appropriately</span>\n    <span class=\"token comment\">// - create a thumbnail based on that size</span>\n    <span class=\"token comment\">// - set alpha transparency for GIFs and PNGs</span>\n    <span class=\"token comment\">// - draw the final thumbnail</span>\n\n    <span class=\"token comment\">// get original image width and height</span>\n    <span class=\"token variable\">$width</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagesx</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$height</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagesy</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$image</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// maintain aspect ratio when no height set</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$targetHeight</span> <span class=\"token operator\">==</span> <span class=\"token constant\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">// get width to height ratio</span>\n        <span class=\"token variable\">$ratio</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$width</span> <span class=\"token operator\">/</span> <span class=\"token variable\">$height</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// if is portrait</span>\n        <span class=\"token comment\">// use ratio to scale height to fit in square</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$width</span> <span class=\"token operator\">></span> <span class=\"token variable\">$height</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$targetHeight</span> <span class=\"token operator\">=</span> <span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$targetWidth</span> <span class=\"token operator\">/</span> <span class=\"token variable\">$ratio</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// if is landscape</span>\n        <span class=\"token comment\">// use ratio to scale width to fit in square</span>\n        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$targetHeight</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$targetWidth</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$targetWidth</span> <span class=\"token operator\">=</span> <span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$targetWidth</span> <span class=\"token operator\">*</span> <span class=\"token variable\">$ratio</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// create duplicate image based on calculated target size</span>\n    <span class=\"token variable\">$thumbnail</span> <span class=\"token operator\">=</span> <span class=\"token function\">imagecreatetruecolor</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$targetWidth</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$targetHeight</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// set transparency options for GIFs and PNGs</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$type</span> <span class=\"token operator\">==</span> <span class=\"token class-name\">IMAGETYPE_GIF</span> <span class=\"token operator\">||</span> <span class=\"token variable\">$type</span> <span class=\"token operator\">==</span> <span class=\"token constant\">IMAGETYPE_PNG</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token comment\">// make image transparent</span>\n        <span class=\"token function\">imagecolortransparent</span><span class=\"token punctuation\">(</span>\n            <span class=\"token variable\">$thumbnail</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function\">imagecolorallocate</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$thumbnail</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// additional settings for PNGs</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$type</span> <span class=\"token operator\">==</span> <span class=\"token constant\">IMAGETYPE_PNG</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">imagealphablending</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$thumbnail</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token function\">imagesavealpha</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$thumbnail</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// copy entire source image to duplicate image and resize</span>\n    <span class=\"token function\">imagecopyresampled</span><span class=\"token punctuation\">(</span>\n        <span class=\"token variable\">$thumbnail</span><span class=\"token punctuation\">,</span>\n        <span class=\"token variable\">$image</span><span class=\"token punctuation\">,</span>\n        <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token variable\">$targetWidth</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$targetHeight</span><span class=\"token punctuation\">,</span>\n        <span class=\"token variable\">$width</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$height</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token comment\">// 3. Save the $thumbnail to disk</span>\n    <span class=\"token comment\">// - call the correct save method</span>\n    <span class=\"token comment\">// - set the correct quality level</span>\n\n    <span class=\"token comment\">// save the duplicate version of the image to disk</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">call_user_func</span><span class=\"token punctuation\">(</span>\n        <span class=\"token constant\">IMAGE_HANDLERS</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$type</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'save'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token variable\">$thumbnail</span><span class=\"token punctuation\">,</span>\n        <span class=\"token variable\">$dest</span><span class=\"token punctuation\">,</span>\n        <span class=\"token constant\">IMAGE_HANDLERS</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$type</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'quality'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Using this script you can now for example generate square <code>160</code> by <code>160</code> pixel thumbnails with the following command.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">createThumbnail</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'profile.jpg'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'profile_thumb.jpg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">160</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"https://pqina.nl/media/thumbnail-resize-ratio.png\" alt=\"Visualisation of photo resizing while maintaining aspect ratio\" /></p>\n<p>If you don’t mind your image being skewed you can also supply the fourth argument (which is the output height). The script will then force the output size to the given given width &amp; height values. See the example below.</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">createThumbnail</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'sunset.jpg'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'sunset_thumb.jpg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">160</span><span class=\"token punctuation\">,</span> <span class=\"token number\">160</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"https://pqina.nl/media/thumbnail-resize-force.png\" alt=\"Visualisation of photo resizing while ignoring aspect ratio\" /></p>\n<p>That’s it!</p>",
    "date": "2026-02-19T16:00:01.779Z",
    "url": "https://pqina.nl/blog/creating-thumbnails-with-php/"
  }
]