[
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Delete Git Branches That Have Been Merged",
    "partialText": "<p>Got a lot of old git branches hanging around? Here’s a little script\nthat will delete the branches that have been marged.</p>\n\n<p>It’ll print out the branches to be deleted, and then prompt for whether\nyou want to delete them.</p>\n\n<p>If your top-level branch isn’t called “main”, customize the <code>MAIN</code>\nvariable to match.</p>\n\n<h2 id=\"script-delete-old-git-branches\">Script: Delete old git branches</h2>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"bash\"><code><span style=\"color: #6E778C\">#!/bin/bash</span>\n\n<span style=\"color: #6E778C\"># Change this to match the name of your top level branch</span>\n<span style=\"color: #C9CDD7\">MAIN=main</span>\n\n<span style=\"color: #AFF19F\">echo</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"These branches have been merged into </span><span style=\"color: #D1D5DE\">$MAIN</span><span style=\"color: #F5D66B\"> and will be deleted:\"</span>\n<span style=\"color: #AFF19F\">echo</span>\n<span style=\"color: #C9CDD7\">git branch --merged </span><span style=\"color: #D1D5DE\">$MAIN</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> grep -v </span><span style=\"color: #F5D66B\">\"^\\* </span><span style=\"color: #D1D5DE\">$MAIN</span><span style=\"color: #F5D66B\">\"</span>\n<span style=\"color: #AFF19F\">echo</span>\n\n<span style=\"color: #AFF19F\">read</span><span style=\"color: #C9CDD7\"> -p </span><span style=\"color: #F5D66B\">\"Continue? [y/N] \"</span><span style=\"color: #C9CDD7\"> -n 1 -r</span>\n<span style=\"color: #AFF19F\">echo</span>\n<span style=\"color: #FF8383\">if</span><span style=\"color: #C9CDD7\"> [[ </span><span style=\"color: #FF8383\">!</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">$REPLY</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">=~</span><span style=\"color: #C9CDD7\"> ^[Yy]$ ]]</span>\n<span style=\"color: #FF8383\">then</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">exit</span><span style=\"color: #C9CDD7\"> 1</span>\n<span style=\"color: #FF8383\">fi</span>\n\n<span style=\"color: #C9CDD7\">git branch --merged </span><span style=\"color: #D1D5DE\">$MAIN</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> grep -v </span><span style=\"color: #F5D66B\">\"^\\* </span><span style=\"color: #D1D5DE\">$MAIN</span><span style=\"color: #F5D66B\">\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> xargs -n 1 -r git branch -d</span></code></pre>\n</div>\n<p>Copy/paste this into a file in your repo or elsewhere (like\n<code>git-cleanup.sh</code>) and make it executable with <code>chmod +x git-cleanup.sh</code></p>\n\n<p>Bonus: if you want this file to be ignored, but you don’t want to\nclutter up the shared <code>.gitignore</code> file with your own local scripts, you\ncan edit <code>.git/info/exclude</code> and list this file there. That file works\nas a local gitignore.</p>\n\n    <p><a href=\"https://daveceddia.com/clean-up-merged-git-branches/\">Delete Git Branches That Have Been Merged</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on August 04, 2022.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2022-08-04T15:05:07.000Z",
    "url": "https://daveceddia.com/clean-up-merged-git-branches/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "How to Run SketchUp Make 2017 on an M1 Mac with macOS Monterey",
    "partialText": "<p>I tried to run the old standalone version of SketchUp Make 2017 on my modern M1 Mac running macOS Monterey 12.4 recently. At first it went pretty badly, crashing on startup with the error “SketchUp quit unexpectedly.”</p>\n\n<p><img src=\"https://daveceddia.com/images/sketchup-quit-unexpectedly.png\" srcset=\"https://daveceddia.com/images/sketchup-quit-unexpectedly@2x.png 2x\" alt=\"SketchUp quit unexpectedly.\" /></p>\n\n<p>But I got it working!</p>\n\n<p>Here’s how to get it running by removing the code signature.</p>\n\n<p>The main clue came when I tried running it from the Terminal, to see if it\nwould show a more useful error. I got the same popup error, but also this:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">rosetta error: /var/db/blahblah/SketchUp.aot: attachment of code signature supplement failed: 1\nzsh: trace trap  /Applications/SketchUp\\ 2017/SketchUp.app/Contents/MacOS/SketchUp\n</span></code></pre>\n</div>\n<p>“attachment of code signature supplement failed”, eh?</p>\n\n<p>We’ll just remove that code signature, then… from absolutely everything inside the app.</p>\n\n<p>To do this, launch the Terminal app (from under Applications &gt; Utilities), copy all of this text, paste it into the terminal window, and press Enter.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">codesign --remove-signature --deep /Applications/SketchUp\\ 2017/SketchUp.app\ncodesign --remove-signature --deep /Applications/SketchUp\\ 2017/SketchUp.app/Contents/Frameworks/*.framework\ncodesign --remove-signature --deep /Applications/SketchUp\\ 2017/SketchUp.app/Contents/Frameworks/*.dylib\ncodesign --remove-signature --deep /Applications/SketchUp\\ 2017/SketchUp.app/Contents/PlugIns/*.plugin\n</span></code></pre>\n</div>\n<p>(if SketchUp is installed in a different folder on your machine, you’ll have to change these paths to match)</p>\n\n<p>With all that done, I was able to launch SketchUp under Rosetta!</p>\n\n<p>My guess is that the code signing certificate format changed in one of the newer macOS versions. I’m not sure — but I’m glad to have SketchUp working again!</p>\n\n<p>One (maybe?) important detail is that I have System Integrity Protection (SIP) disabled on my machine. I’m not sure if this matters. (I didn’t test SketchUp with SIP enabled). You can google for how to disable SIP if removing the code signature isn’t enough to get it working.</p>\n\n\n    <p><a href=\"https://daveceddia.com/sketchup-make-2017-on-m1-mac-monterey/\">How to Run SketchUp Make 2017 on an M1 Mac with macOS Monterey</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on July 14, 2022.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2022-07-14T00:22:58.000Z",
    "url": "https://daveceddia.com/sketchup-make-2017-on-m1-mac-monterey/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Installing a Code Signing Cert from Sectigo (to sign an Electron app on Windows)",
    "partialText": "<p>So, you bought a code signing certificate for your Electron app. One step closer to being able to release your app on Windows. Congrats!</p>\n\n<p>Finally, 3 weeks later, after a few phone calls, Sectigo issued the certificate. Woohoo! The email went to spam and you didn’t see it for 3 days, but hey, we’re making progress.</p>\n\n<p>In their email, they say in big red letters that you must use Internet Explorer to download it (or an ancient version of Firefox).</p>\n\n<p>And then you try that, and it fails. Because when you ordered the cert, you didn’t use the on-page tool that required using an ancient web browser. You used OpenSSL to create your certificate signing request (CSR) and private key.</p>\n\n<p>So you call them, and they tell you to call your reseller. Wait – SectigoStore is not actually owned by Sectigo? Haha nope, different company.</p>\n\n<p>But no matter – their lovely live chat people point you at this <a href=\"https://help.sectigostore.com/support/solutions/articles/22000266875-converting-code-signing-to-pfx\">page of instructions</a> for converting the code signing cert to a PFX, involving some sort of tool that may or may not be linked from that page.</p>\n\n<p>So now you’re stuck. Well, I was stuck here too. Here’s what to do to download the code signing certificate to a PFX file that can actually be used to sign some code.</p>\n\n<ol>\n  <li>Download the certificate using the link in your email, but <em>don’t</em> use Internet Explorer. Use Chrome or Edge instead. You’ll get a <code>user.crt</code> file.</li>\n</ol>\n\n<blockquote>\n  <p>IE (and presumably, ancient Firefox, I didn’t try) will try to install the certificate into your system using a private key that’s already installed. But you didn’t use IE in the first place, so you don’t have a private key installed, which is why that failed.</p>\n</blockquote>\n\n<ol>\n  <li>\n    <p>Convert the <code>user.crt</code> from the binary DER format that it came with, into a PEM format that OpenSSL can work with.</p>\n\n    <p>openssl x509 -inform der -in user.crt -out user.pem</p>\n  </li>\n</ol>\n\n<p>If your user.crt file is already in PEM format, you can skip this step. PEM format is plain text and starts with <code>------ BEGIN BLAH BLAH ------</code>.</p>\n\n<ol>\n  <li>\n    <p>Combine the <strong>PEM certificate</strong> with the <strong>private key</strong> and the <strong>Sectigo root/intermediate CA cert</strong> into one big PFX file. Get the Sectigo CA cert at the <a href=\"https://help.sectigostore.com/support/solutions/articles/22000266875-converting-code-signing-to-pfx\">very bottom of this page</a> that the helpful SectigoStore chat person gave you.</p>\n\n    <p>openssl pkcs12 -export -in user.pem -certfile SectigoRSACodeSigningCA.crt -inkey privatekey.key -out code-signing-cert.pfx</p>\n  </li>\n</ol>\n\n<p>It’ll ask you for a password. Make sure to save that somewhere. You’ll need it to do the actual code signing.</p>\n\n<p>If OpenSSL hangs for you (like it did for me, using a Git Bash shell on Windows 10), prepend the commands with <code>winpty</code>.</p>\n\n<p>And now, if you haven’t forgotten your private key password, you should be all set! The <code>code-signing-cert.pfx</code></p>\n\n<p>From here, since I’m using electron-builder, I made a <code>.env</code> file in the root of the project with 2 keys:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">CSC_LINK=file:///Users/You/Projects/your-app/code-signing-cert.pfx\nCSC_KEY_PASSWORD=the-password-you-hopefully-remember-from-2-paragraphs-ago\n</span></code></pre>\n</div>\n<p>Run the build, and hopefully code signing will work! Awesome. Time to get back to real work.</p>\n\n    <p><a href=\"https://daveceddia.com/code-signing-windows-electron-sectigo/\">Installing a Code Signing Cert from Sectigo (to sign an Electron app on Windows)</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on March 11, 2022.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2022-03-11T21:28:11.000Z",
    "url": "https://daveceddia.com/code-signing-windows-electron-sectigo/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Implementing A Svelte Store In Rust",
    "partialText": "<p>We’re going to build a Svelte store, written in Rust, and run it in an Electron app.</p>\n\n<p>This spun out of a <a href=\"https://getrecut.com\">video editor</a> which I originally built in Swift. It turns out people on Windows want to edit videos too, so now I’m rewriting it with Rust, Electron, and Svelte with an eye for performance.</p>\n\n<p><a href=\"https://www.rust-lang.org/\">Rust</a> is a systems programming language, akin to C or C++, but safer. It’s known for being super fast.</p>\n\n<p><a href=\"https://www.electronjs.org/\">Electron</a> is a framework for building cross-platform desktop apps with HTML, CSS, and JavaScript. It’s known for being kinda slow and bloaty. But there’s an ace up its sleeve: Electron apps can be extended with compiled native code, and if you do the heavy stuff in native code you can a nice speed boost.</p>\n\n<p><a href=\"https://svelte.dev\">Svelte</a> is a JavaScript UI framework – an alternative to React, Vue, Angular, or one of the other 7500 frameworks. Svelte uses a compiler to generate small, fast, reactive code.</p>\n\n<p>I figured by combining them, and doing most of the heavy lifting in Rust, I’d end up with an app that feels snappy.</p>\n\n<p>The <a href=\"https://github.com/dceddia/electron-napi-svelte-store\">full, completed project is on GitHub</a> and it has instructions on how to run it, along with my rollercoaster of a commit history while I was trying to get it working.</p>\n\n<p>Here’s what it looks like:</p>\n\n<video autoplay=\"\" loop=\"\" muted=\"\" playsinline=\"\" alt=\"Demo of a Svelte store written in Rust running in Electron\" class=\"rounded-sm shadow-sm\">\n  <source src=\"https://daveceddia.com/images/svelte-store-rust.mp4\" type=\"video/mp4\" />\n</video>\n\n<h2 id=\"how-svelte-stores-work\">How Svelte Stores Work</h2>\n\n<p>One of the things I love about Svelte is its reactivity model, and in particular, its concept of stores. A <strong>store</strong> is a reactive variable that holds a single value.</p>\n\n<p>Any part of the app can <em>subscribe</em> to the store, and every subscriber will be (synchronously!) notified when the store’s value is changed.</p>\n\n<p>Here’s a simple example (<a href=\"https://svelte.dev/repl/635abee58d8a4a53b1122a0eacb3e887?version=3.46.4\">live version here</a>):</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"html\"><code><span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">script</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">onDestroy</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;svelte&apos;</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">writable</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;svelte/store&apos;</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Make a store</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">count</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">writable</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D570F3\">0</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Subscribe to it, and update the displayed value</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">let</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">visibleCount</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">0</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">unsubscribe</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">count</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">subscribe</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">value</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #D1D5DE\">visibleCount</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">value</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">increment</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Replace the store&apos;s value with (value + 1)</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">count</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">update</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">n</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">n</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">+</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">1</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Tidy up when this component is unmounted</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">onDestroy</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">unsubscribe</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">&lt;/</span><span style=\"color: #FF8383\">script</span><span style=\"color: #C9CDD7\">&gt;</span>\n\n<span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">on:click</span><span style=\"color: #C9CDD7\">=</span><span style=\"color: #F5D66B\">{increment}</span><span style=\"color: #C9CDD7\">&gt;Increment&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">p</span><span style=\"color: #C9CDD7\">&gt;Current value: {visibleCount}&lt;/</span><span style=\"color: #FF8383\">p</span><span style=\"color: #C9CDD7\">&gt;</span></code></pre>\n</div>\n<p>You click the button, it updates. Nothing too mindblowing. But this is just the “low-level” API.</p>\n\n<p>It looks a lot nicer when you introduce Svelte’s special reactive store syntax with the <code>$</code> (try the <a href=\"https://svelte.dev/repl/4605bda160634cfca1ab76d527e00842?version=3.46.4\">live example</a>):</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"html\"><code><span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">script</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">onDestroy</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;svelte&apos;</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">writable</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;svelte/store&apos;</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Make a store</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">count</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">writable</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D570F3\">0</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">increment</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #D1D5DE\">$count</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">+=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">1</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span>\n<span style=\"color: #C9CDD7\">&lt;/</span><span style=\"color: #FF8383\">script</span><span style=\"color: #C9CDD7\">&gt;</span>\n\n<span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">on:click</span><span style=\"color: #C9CDD7\">=</span><span style=\"color: #F5D66B\">{increment}</span><span style=\"color: #C9CDD7\">&gt;Increment&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">p</span><span style=\"color: #C9CDD7\">&gt;Current value: {$count}&lt;/</span><span style=\"color: #FF8383\">p</span><span style=\"color: #C9CDD7\">&gt;</span></code></pre>\n</div>\n<p>It does the exact same thing, just with less code.</p>\n\n<p>The special <code>$count</code> syntax inside the <code>&lt;p&gt;</code> is setting up a subscription behind the scenes, and updating that specific DOM element when the value changes. And it handles the <code>unsubscribe</code> cleanup automatically.</p>\n\n<p>There’s also the <code>$count += 1</code> (which can also be written <code>$count = $count + 1</code>). It reads like plain old JavaScript, but after the value is changed, this store will notify all of its subscribers – in this case that’s just the <code>$count</code> in the HTML below.</p>\n\n<p>The Svelte docs have a great <a href=\"https://svelte.dev/tutorial/writable-stores\">interactive tutorial on stores</a> if you want to learn more.</p>\n\n<h3 id=\"the-important-thing-is-the-contract\">The Important Thing is the Contract</h3>\n\n<p>It’s easy to look at code like this and assume it’s all magic, especially when there’s fancy syntax like <code>$store</code>.</p>\n\n<p>There’s a chunk of data-intensive code that I wrote in JS instead of Rust because I had this mindset of, “I want the reactivity so it has to be in JavaScript”.</p>\n\n<p>But if you take a step back and look at the underpinnings of how the magic <em>actually works</em>, sometimes you can find new and interesting ways to extend it!</p>\n\n<p>Svelte stores were designed well to allow this: they follow <a href=\"https://svelte.dev/docs#component-format-script-4-prefix-stores-with-$-to-access-their-values-store-contract\">a contract</a>.</p>\n\n<p>The short version is that in order to be a “Svelte store,” an object needs:</p>\n\n<ul>\n  <li>A <code>subscribe</code> method that returns an <code>unsubscribe</code> function</li>\n  <li>A <code>set</code> method if you want to make it writable</li>\n  <li>It must call the subscribers synchronously (a) at subscribe time and (b) any time the value changes.</li>\n</ul>\n\n<p>If any JS object follows these rules, it’s a Svelte store. And if it’s a Svelte store, it can be used with the fancy <code>$store</code> syntax and everything!</p>\n\n<h2 id=\"calling-rust-from-javascript\">Calling Rust From JavaScript</h2>\n\n<p>The next piece of this puzzle is to write some Rust code that can be exposed as an object in JavaScript.</p>\n\n<p>For this, we’re using <a href=\"https://github.com/napi-rs/napi-rs\">napi-rs</a>, an awesome framework for connecting Rust and JavaScript together. The creator, <a href=\"https://twitter.com/Brooooook_lyn\">LongYinan aka Broooooklyn</a> is doing amazing work on it, and the latest updates (in v2) have made the Rust code very nice to write. Here’s a taste, the “hello world” of Rust functions:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #C9CDD7\">#[macro_use]</span>\n<span style=\"color: #FF8383\">extern</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">crate</span><span style=\"color: #C9CDD7\"> napi;</span>\n\n<span style=\"color: #6E778C\">/// import the preludes</span>\n<span style=\"color: #FF8383\">use</span><span style=\"color: #C9CDD7\"> napi</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">bindgen_prelude</span><span style=\"color: #93DDFD\">::*</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #6E778C\">/// annotating a function with #[napi] makes it available to JS,</span>\n<span style=\"color: #6E778C\">/// kinda like `export { sum };`</span>\n<span style=\"color: #C9CDD7\">#[napi]</span>\n<span style=\"color: #FF8383\">pub</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">sum</span><span style=\"color: #C9CDD7\">(a: </span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\">, b: </span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\">) -&gt; </span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">  a </span><span style=\"color: #93DDFD\">+</span><span style=\"color: #C9CDD7\"> b</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>Then in JavaScript, we can do this:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #6E778C\">// Hand-wavy pseudocode for now...</span>\n<span style=\"color: #6E778C\">// The native module has its own folder and</span>\n<span style=\"color: #6E778C\">// build setup, which we&apos;ll look at below.</span>\n<span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">sum</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;./bindings&apos;</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #AFF19F\">sum</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D570F3\">2</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">2</span><span style=\"color: #9CA5B7\">))</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #6E778C\">// gives correct answer</span></code></pre>\n</div>\n<h2 id=\"a-boilerplate-project-with-electron-rust-and-svelte\">A Boilerplate Project with Electron, Rust, and Svelte</h2>\n\n<p>We’ve got the big pieces in mind: Electron, Svelte stores, Rust that can be called from JS.</p>\n\n<p>Now we just need to… actually wire up a project with 3 different build systems. Hoorayyyyy. I hope you can hear the excitement in my voice.</p>\n\n<p>So, for this prototype, I took the lazy way out.</p>\n\n<p>It’s a <a href=\"https://github.com/electron/electron-quick-start\">barebones Electron app</a> with the <a href=\"https://github.com/sveltejs/template\">Svelte template</a> cloned into one subfolder, and the native Rust module in another (generated by the NAPI-RS CLI).</p>\n\n<p>The dev experience (DX) is old-school: quit the whole app, rebuild, and restart. Sure, some sort of auto-building, auto-reloading <a href=\"https://en.wikipedia.org/wiki/Rube_Goldberg_machine\">Rube Goldberg-esque</a> tangle of scripts and configuration would’ve been neat, but I didn’t wanna.</p>\n\n<p>So it has this mile-long <code>start</code> script that just <code>cd</code>’s into each subfolder and builds it. It’s not pretty, but it gets the job done!</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">  </span><span style=\"color: #F5D66B\">\"scripts\"</span><span style=\"color: #C9CDD7\">: {</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"start\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"cd bindings &amp;&amp; npm run build &amp;&amp; cd .. &amp;&amp; cd ui &amp;&amp; npm run build &amp;&amp; cd .. &amp;&amp; electron .\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"start:debug\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"cd bindings &amp;&amp; npm run build:debug &amp;&amp; cd .. &amp;&amp; cd ui &amp;&amp; npm run build &amp;&amp; cd .. &amp;&amp; electron .\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"start:clean\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"npm run clean &amp;&amp; npm run start:debug\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"clean\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"cd bindings &amp;&amp; rm -rf target\"</span>\n<span style=\"color: #C9CDD7\">  },</span></code></pre>\n</div>\n<p>We’re not going for awesome DX here. This is a prototype. Awesome DX is Future Work™.</p>\n\n<h2 id=\"beginning-to-end-how-it-works\">Beginning To End: How It Works</h2>\n\n<p>Personally I really like to trace the execution from the very first entry point. I think it helps me understand how all the pieces fit together. So here’s the chain of events that leads to this thing working, with the relevant bits of code:</p>\n\n<p><span>1.</span> You run <code>npm start</code>. It builds everything, and then runs <code>electron .</code></p>\n\n<div class=\"code-filename\">package.json</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #F5D66B\">\"start\"</span><span style=\"color: #C9CDD7\">: </span><span style=\"color: #F5D66B\">\"cd bindings &amp;&amp; npm run build &amp;&amp; cd .. &amp;&amp; cd ui &amp;&amp; npm run build &amp;&amp; cd .. &amp;&amp; electron .\"</span><span style=\"color: #C9CDD7\">,</span></code></pre>\n</div>\n<p><span class=\"run-step\">2.</span> Electron finds and executes <code>main.js</code> because <code>package.json</code> tells it to (via the <code>main</code> key)</p>\n\n<div class=\"code-filename\">package.json</div>\n\n<div class=\"codeblock\"><pre class=\"shiki has-focus\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"name\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"electron-quick-start\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"version\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"1.0.0\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"description\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"A minimal Electron application\"</span><span style=\"color: #D1D5DE\">,</span>\n<span class=\"foc\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"main\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"main.js\"</span><span style=\"color: #D1D5DE\">,</span>\n</span><span style=\"color: #C9CDD7\">  </span><span style=\"color: #F8F8F0\">...</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p><span class=\"run-step\">3.</span> <code>main.js</code> spawns a BrowserWindow, and loads up <code>index.html</code></p>\n\n<div class=\"code-filename\">main.js</div>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">createWindow</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Create the browser window.</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">mainWindow</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">new</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">BrowserWindow</span><span style=\"color: #9CA5B7\">({</span>\n<span style=\"color: #C9CDD7\">    width</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">800</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    height</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">600</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    webPreferences</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">      contextIsolation</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">true</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #6E778C\">// Preload will make the native module available</span>\n<span style=\"color: #C9CDD7\">      preload</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">path</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">join</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">__dirname,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;preload.js&apos;</span><span style=\"color: #9CA5B7\">)</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #9CA5B7\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">})</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Load the index.html of the app.</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #93DDFD\">mainWindow</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">loadFile</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;index.html&apos;</span><span style=\"color: #9CA5B7\">)</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p><span class=\"run-step\">4.</span> <code>main.js</code> <em>also</em> specifies a <code>preload.js</code>, where you’re allowed to expose native modules. This is where the Rust module is imported and exposed as <code>window.Napi</code>. (See <strong>Security</strong> below)</p>\n\n<div class=\"code-filename\">preload.js</div>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #6E778C\">// Make native bindings available to the renderer process</span>\n<span style=\"color: #93DDFD\">window</span><span style=\"color: #D1D5DE\">.Napi</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">require</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;./bindings&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p><span class=\"run-step\">5.</span> <code>index.html</code> loads the Svelte app’s JavaScript that was built in Step 1</p>\n\n<div class=\"code-filename\">index.html</div>\n\n<div class=\"codeblock\"><pre class=\"shiki has-focus\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"html\"><code><span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">html</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">  ...</span>\n<span style=\"color: #C9CDD7\">  &lt;</span><span style=\"color: #FF8383\">body</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">&lt;!-- You can also require other files to run in this process --&gt;</span>\n<span class=\"foc\"><span style=\"color: #C9CDD7\">    &lt;</span><span style=\"color: #FF8383\">script</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">src</span><span style=\"color: #C9CDD7\">=</span><span style=\"color: #F5D66B\">\"./ui/public/build/bundle.js\"</span><span style=\"color: #C9CDD7\">&gt;&lt;/</span><span style=\"color: #FF8383\">script</span><span style=\"color: #C9CDD7\">&gt;</span>\n</span><span style=\"color: #C9CDD7\">  &lt;/</span><span style=\"color: #FF8383\">body</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">&lt;/</span><span style=\"color: #FF8383\">html</span><span style=\"color: #C9CDD7\">&gt;</span></code></pre>\n</div>\n<p><span class=\"run-step\">6.</span> Svelte has its own <code>ui/main.js</code>, which imports and creates the <code>App</code> component, and mounts it at <code>document.body</code>.</p>\n\n<div class=\"code-filename\">ui/main.js</div>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">App</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;./App.svelte&apos;</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">app</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">new</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">App</span><span style=\"color: #9CA5B7\">({</span>\n<span style=\"color: #C9CDD7\">  target</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">document</span><span style=\"color: #D1D5DE\">.body,</span>\n<span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #FF8383\">export</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">default</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">app</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p><span class=\"run-step\">7.</span> <code>App.svelte</code> instantiates our Rust store with an initial value, which calls the constructor in Rust.</p>\n\n<div class=\"code-filename\">ui/App.svelte</div>\n<div class=\"codeblock\"><pre class=\"shiki has-focus\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"html\"><code><span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">script</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">Counter</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"./Counter.svelte\"</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">let</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">showCounter</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">true</span><span style=\"color: #C9CDD7\">;</span>\n<span class=\"foc\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">let</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">counter</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">new</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">Napi</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">Counter</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D570F3\">42</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span style=\"color: #C9CDD7\">&lt;/</span><span style=\"color: #FF8383\">script</span><span style=\"color: #C9CDD7\">&gt;</span></code></pre>\n</div>\n<p><span class=\"run-step\">8.</span> Since Svelte needs to render the counter, it immediately calls <code>.subscribe</code> with a callback, which calls <code>subscribe</code> in Rust.</p>\n\n<div class=\"code-filename\">ui/public/build/bundle.js [compiled by Svelte]</div>\n\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">instance</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">$$self</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FDAC45\">$$props</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FDAC45\">$$invalidate</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">let</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">$counter</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">let</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">showCounter</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">true</span><span style=\"color: #C9CDD7\">;</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">let</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">counter</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">new</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">Napi</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">Counter</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D570F3\">42</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">component_subscribe</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">$$self,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">counter,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FDAC45\">value</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">$$invalidate</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D570F3\">1</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">$counter</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">value</span><span style=\"color: #9CA5B7\">))</span><span style=\"color: #C9CDD7\">;</span>\n</span><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">click_handler</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">$$invalidate</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D570F3\">0</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">showCounter</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">!</span><span style=\"color: #D1D5DE\">showCounter</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">click_handler_1</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">set_store_value</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">counter,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">$counter</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">Math</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">floor</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #76DCE8\">Math</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">random</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">*</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">1234</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">$counter</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">[showCounter,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">$counter,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">counter,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">click_handler,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">click_handler_1]</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p><span class=\"run-step\">9.</span> The <code>subscribe</code> function, according to the contract, needs to immediately call the provided callback with the current value, so it does that, and then saves the callback for later use. It also returns an <code>unsubscribe</code> function that Svelte will call when the component is unmounted.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #C9CDD7\">#[napi]</span>\n<span style=\"color: #76DCE8\">impl</span><span style=\"color: #C9CDD7\"> Counter {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// ...</span>\n\n<span style=\"color: #C9CDD7\">  #[napi]</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">pub</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">subscribe</span><span style=\"color: #C9CDD7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">&amp;</span><span style=\"color: #FF8383\">mut</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">, env: Env, callback: JsFunction</span>\n<span style=\"color: #C9CDD7\">  ) -&gt; </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">&lt;JsFunction&gt; {</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Create a threadsafe wrapper.</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// (to ensure the callback doesn&apos;t </span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// immediately get garbage collected)</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> tsfn: ThreadsafeFunction</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\">, ErrorStrategy</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">Fatal</span><span style=\"color: #93DDFD\">&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> callback</span>\n<span style=\"color: #C9CDD7\">      .</span><span style=\"color: #AFF19F\">create_threadsafe_function</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #D570F3\">0</span><span style=\"color: #C9CDD7\">, </span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\">ctx</span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">        ctx.env.</span><span style=\"color: #AFF19F\">create_uint32</span><span style=\"color: #C9CDD7\">(ctx.value).</span><span style=\"color: #AFF19F\">map</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\">v</span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">vec!</span><span style=\"color: #C9CDD7\">[v])</span>\n<span style=\"color: #C9CDD7\">      })?;</span>\n\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Call once with the initial value</span>\n<span style=\"color: #C9CDD7\">    tsfn.</span><span style=\"color: #AFF19F\">call</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.value, ThreadsafeFunctionCallMode</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">Blocking);</span>\n\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Save the callback so that we can call it later</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> key </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.next_subscriber;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.next_subscriber </span><span style=\"color: #93DDFD\">+=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">1</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.subscribers.</span><span style=\"color: #AFF19F\">borrow_mut</span><span style=\"color: #C9CDD7\">().</span><span style=\"color: #AFF19F\">insert</span><span style=\"color: #C9CDD7\">(key, tsfn);</span>\n\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Pass back an unsubscribe callback that</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// will remove the subscription when called</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> subscribers </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.subscribers.</span><span style=\"color: #AFF19F\">clone</span><span style=\"color: #C9CDD7\">();</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> unsubscribe </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">move</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\">ctx: CallContext</span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">-&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #C9CDD7\">JsUndefined</span><span style=\"color: #93DDFD\">&gt;</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">      subscribers.</span><span style=\"color: #AFF19F\">borrow_mut</span><span style=\"color: #C9CDD7\">().</span><span style=\"color: #AFF19F\">remove</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #93DDFD\">&amp;</span><span style=\"color: #C9CDD7\">key);</span>\n<span style=\"color: #C9CDD7\">      ctx.env.</span><span style=\"color: #AFF19F\">get_undefined</span><span style=\"color: #C9CDD7\">()</span>\n<span style=\"color: #C9CDD7\">    };</span>\n\n<span style=\"color: #C9CDD7\">    env.</span><span style=\"color: #AFF19F\">create_function_from_closure</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #F5D66B\">\"unsubscribe\"</span><span style=\"color: #C9CDD7\">, unsubscribe)</span>\n<span style=\"color: #C9CDD7\">  }</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<h3 id=\"security-electron-and-contextisolation\">Security: Electron and <code>contextIsolation</code></h3>\n\n<p>Electron is split into 2 processes: the “main” one (which runs Node, and is running <code>main.js</code> in our case) and the “renderer”, which is where your UI code runs. Between the two sits the <code>preload.js</code>. Electron’s official docs explain the <a href=\"https://www.electronjs.org/docs/latest/tutorial/process-model\">process model</a> in more detail.</p>\n\n<p>There are a few layers of security in place to prevent random scripts from gaining unfettered access to your entire computer (because that would be bad).</p>\n\n<p>The first is the <code>nodeIntegration</code> flag, defaulted to <code>false</code>. This makes it so that you can’t use Node’s <code>require()</code> inside the renderer process. It’s a little annoying, but the upside is that if your Electron app happens to open (or is coerced into opening) a sketchy script from somewhere, that script won’t be able to import Node modules and wreak havoc.</p>\n\n<p>The second is the <code>contextIsolation</code> flag, which defaults to <code>true</code>. This makes the <code>preload</code> script, which runs inside the renderer, can’t access <code>window</code> and therefore can’t expose any sensitive APIs directly. You have to use the <a href=\"https://www.electronjs.org/docs/latest/api/context-bridge\">contextBridge</a> to expose an API that the renderer can use.</p>\n\n<p>Why am I telling you all this? Well, if you look at the <code>preload.js</code> example above, you’ll see that it sets <code>window.Napi</code> directly. It’s not using <code>contextBridge</code>, and <code>contextIsolation</code> is disabled in this project. I tried turning it on, but evidently <a href=\"https://www.electronjs.org/docs/latest/api/context-bridge#api-functions\">constructors can’t be passed through</a> the bridge. There might be an alternative way to solve this – if you know of one please let me know!</p>\n\n<p>If your app doesn’t load external resources, and only loads files from disk, my understanding is that leaving <code>contextIsolation</code> disabled is ok.</p>\n\n<p>I’m writing this as a proof of concept <strong>WITH THE CAVEAT</strong> that this is less secure than it could be (if you have ideas for improvement, let me know <a href=\"https://twitter.com/dceddia\">on Twitter</a>).</p>\n\n<h2 id=\"how-the-rust-works\">How the Rust Works</h2>\n\n<p>The short answer is: it follows the Svelte store contract :) Let’s see how.</p>\n\n<p>It all happens in one file, <code>bindings/src/lib.rs</code>.</p>\n\n<p>First, there’s a <code>struct</code> to hold the current value of the counter, along with its subscribers.</p>\n\n<p>I don’t think the <code>ThreadsafeFunction</code>s can be compared for equality, so I put them in a map instead of a vector, and used the <code>next_subscriber</code> to hold an incrementing key to store the subscribers.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #C9CDD7\">#[napi]</span>\n<span style=\"color: #FF8383\">pub</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">struct</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">Counter</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">  value: </span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\">,</span>\n<span style=\"color: #C9CDD7\">  subscribers: Rc</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #C9CDD7\">RefCell</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #C9CDD7\">HashMap</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #76DCE8\">u64</span><span style=\"color: #C9CDD7\">, ThreadsafeFunction</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\">, ErrorStrategy</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">Fatal</span><span style=\"color: #93DDFD\">&gt;&gt;&gt;&gt;</span><span style=\"color: #C9CDD7\">,</span>\n<span style=\"color: #C9CDD7\">  next_subscriber: </span><span style=\"color: #76DCE8\">u64</span><span style=\"color: #C9CDD7\">,</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>Then there are a few functions implemented on this struct. There’s the constructor, which initializes a <code>Counter</code> with no subscribers:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #C9CDD7\">#[napi]</span>\n<span style=\"color: #76DCE8\">impl</span><span style=\"color: #C9CDD7\"> Counter {</span>\n<span style=\"color: #C9CDD7\">  #[napi(constructor)]</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">pub</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">new</span><span style=\"color: #C9CDD7\">(value: </span><span style=\"color: #76DCE8\">Option</span><span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\">&gt;) -&gt; Counter {</span>\n<span style=\"color: #C9CDD7\">    Counter {</span>\n<span style=\"color: #C9CDD7\">      value: value.</span><span style=\"color: #AFF19F\">unwrap_or</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #D570F3\">0</span><span style=\"color: #C9CDD7\">),</span>\n<span style=\"color: #C9CDD7\">      subscribers: Rc</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #AFF19F\">new</span><span style=\"color: #C9CDD7\">(RefCell</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #AFF19F\">new</span><span style=\"color: #C9CDD7\">(HashMap</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #AFF19F\">new</span><span style=\"color: #C9CDD7\">())),</span>\n<span style=\"color: #C9CDD7\">      next_subscriber: </span><span style=\"color: #D570F3\">0</span><span style=\"color: #C9CDD7\">,</span>\n<span style=\"color: #C9CDD7\">    }</span>\n<span style=\"color: #C9CDD7\">  }</span></code></pre>\n</div>\n<p>And there are <code>increment</code> and <code>set</code> functions that do nearly the same thing. Of the two, <code>set</code> is special in that it’s the one that makes this store “writable” in the eyes of Svelte. When we write <code>$count = 7</code> in JS, that will ultimately call into <code>set</code> here.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #C9CDD7\">#[napi]</span>\n<span style=\"color: #FF8383\">pub</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">increment</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #93DDFD\">&amp;</span><span style=\"color: #FF8383\">mut</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">) -&gt; </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">&lt;()&gt; {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.value </span><span style=\"color: #93DDFD\">+=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">1</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.</span><span style=\"color: #AFF19F\">notify_subscribers</span><span style=\"color: #C9CDD7\">()</span>\n<span style=\"color: #C9CDD7\">}</span>\n\n<span style=\"color: #C9CDD7\">#[napi]</span>\n<span style=\"color: #FF8383\">pub</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">set</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #93DDFD\">&amp;</span><span style=\"color: #FF8383\">mut</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">, value: </span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\">) -&gt; </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">&lt;()&gt; {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.value </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> value;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.</span><span style=\"color: #AFF19F\">notify_subscribers</span><span style=\"color: #C9CDD7\">()</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>After modifying the value, those functions call <code>notify_subscribers</code>. This one doesn’t have the <code>#[napi]</code> annotation, which means it won’t be callable from JS. This iterates over the subscribers and calls each one with the current value.</p>\n\n<p>Because <code>self.subscribers</code> is an <code>Rc&lt;RefCell&lt;...&gt;&gt;</code> we need to explicitly <code>borrow()</code> it before iterating. This borrow happens at runtime, as opposed to the usual compile-time borrow-checking done by Rust. If something else has this borrowed when we try to borrow it here, the program will panic (aka crash).</p>\n\n<p>I’m reasoning this is panic-free because both the <code>notify_subscribers</code> and the <code>subscribe</code> (the other place that borrows this variable) are running in the single JS main thread, so it shouldn’t be possible for them to step on each others’ access.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">notify_subscribers</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #93DDFD\">&amp;</span><span style=\"color: #FF8383\">mut</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">) -&gt; </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">&lt;()&gt; {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">for</span><span style=\"color: #C9CDD7\"> (_, cbref) </span><span style=\"color: #FF8383\">in</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.subscribers.</span><span style=\"color: #AFF19F\">borrow</span><span style=\"color: #C9CDD7\">().</span><span style=\"color: #AFF19F\">iter</span><span style=\"color: #C9CDD7\">() {</span>\n<span style=\"color: #C9CDD7\">    cbref.</span><span style=\"color: #AFF19F\">call</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.value, ThreadsafeFunctionCallMode</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">Blocking);</span>\n<span style=\"color: #C9CDD7\">  }</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">Ok</span><span style=\"color: #C9CDD7\">(())</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>Most of the real work happens inside <code>subscribe</code>. There are some comments, but also some subtleties that took me some time to figure out.</p>\n\n<p>First, it wraps the callback with a <code>ThreadsafeFunction</code>. I think the reason this works is that <code>ThreadsafeFunction</code> internally sets up a reference counter around the callback. I tried without this at first, and it turned out that the callback was getting garbage-collected immediately after subscribing. Despite storing the <code>callback</code> (and making Rust happy about its ownership), attempting to actually call it was failing.</p>\n\n<p>The <code>ErrorStrategy::Fatal</code> might look alarming, but the alternative, <code>ErrorStrategy::CalleeHandled</code>, doesn’t work at all here. The <code>CalleeHandled</code> style uses Node’s callback calling convention, where it passes the error as the first argument (or null). That doesn’t match Svelte’s store contract, which only expects a single argument. The <code>Fatal</code> strategy passes the argument straight through.</p>\n\n<p>The <code>create_threadsafe_function</code> call itself has a lot going on. The closure being passed in <code>|ctx| { ... }</code> will get called whenever we run <code>.call()</code> on the threadsafe function. The closure’s job is to take the value you pass in and transform it into an array of JavaScript values. So this closure takes the <code>u32</code> value, wraps it in a JsNumber with <code>create_uint32</code>, and then puts <em>that</em> in a vector. That vector, in turn, gets spread into the arguments to the JS callback.</p>\n\n<p>Saving the callback is important so we can call it later, so <code>self.subscribers.borrow_mut().insert(key, tsfn);</code> does that. We need the <code>borrow_mut</code> because we’re doing runtime borrow checking here.</p>\n\n<p>I initially went with borrow checking at compile time, but the <code>unsubscribe</code> closure threw a wrench in the works. See, we need to <em>add</em> something to the hashmap at subscribe time, and we need to <em>remove</em> something from the <em>same</em> hashmap at unsubscribe time. In JS this is a piece of cake. In Rust, because of the way ownership works, only one thing can “own” <code>self.subscribers</code> at a time. If we moved it out of self and into the <code>unsubscribe</code> closure, then we couldn’t add any more subscribers, or notify them.</p>\n\n<p>The solution I found was to wrap the <code>HashMap</code> with <code>Rc&lt;RefCell&lt;...&gt;&gt;</code>. The <code>Rc</code> part means that the innards can be shared between multiple owners by calling <code>.clone()</code>. The <code>RefCell</code> part means we can mutate the internals without having to pass the borrow checker’s strict rules about mutation. The tradeoff is that it’s up to us to make sure we never have overlapping calls to <code>.borrow()</code> and <code>.borrow_mut()</code>, or the program will panic.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #C9CDD7\">#[napi]</span>\n<span style=\"color: #76DCE8\">impl</span><span style=\"color: #C9CDD7\"> Counter {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// ...</span>\n\n<span style=\"color: #C9CDD7\">  #[napi]</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">pub</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">subscribe</span><span style=\"color: #C9CDD7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">&amp;</span><span style=\"color: #FF8383\">mut</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">, env: Env, callback: JsFunction</span>\n<span style=\"color: #C9CDD7\">  ) -&gt; </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">&lt;JsFunction&gt; {</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Create a threadsafe wrapper.</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// (to ensure the callback doesn&apos;t </span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// immediately get garbage collected)</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> tsfn: ThreadsafeFunction</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #76DCE8\">u32</span><span style=\"color: #C9CDD7\">, ErrorStrategy</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">Fatal</span><span style=\"color: #93DDFD\">&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> callback</span>\n<span style=\"color: #C9CDD7\">      .</span><span style=\"color: #AFF19F\">create_threadsafe_function</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #D570F3\">0</span><span style=\"color: #C9CDD7\">, </span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\">ctx</span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">        ctx.env.</span><span style=\"color: #AFF19F\">create_uint32</span><span style=\"color: #C9CDD7\">(ctx.value).</span><span style=\"color: #AFF19F\">map</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\">v</span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">vec!</span><span style=\"color: #C9CDD7\">[v])</span>\n<span style=\"color: #C9CDD7\">      })?;</span>\n\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Call once with the initial value</span>\n<span style=\"color: #C9CDD7\">    tsfn.</span><span style=\"color: #AFF19F\">call</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.value, ThreadsafeFunctionCallMode</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">Blocking);</span>\n\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Save the callback so that we can call it later</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> key </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.next_subscriber;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.next_subscriber </span><span style=\"color: #93DDFD\">+=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">1</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.subscribers.</span><span style=\"color: #AFF19F\">borrow_mut</span><span style=\"color: #C9CDD7\">().</span><span style=\"color: #AFF19F\">insert</span><span style=\"color: #C9CDD7\">(key, tsfn);</span>\n\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// Pass back an unsubscribe callback that</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// will remove the subscription when called</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> subscribers </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">self</span><span style=\"color: #C9CDD7\">.subscribers.</span><span style=\"color: #AFF19F\">clone</span><span style=\"color: #C9CDD7\">();</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> unsubscribe </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">move</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\">ctx: CallContext</span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">-&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #C9CDD7\">JsUndefined</span><span style=\"color: #93DDFD\">&gt;</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">      subscribers.</span><span style=\"color: #AFF19F\">borrow_mut</span><span style=\"color: #C9CDD7\">().</span><span style=\"color: #AFF19F\">remove</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #93DDFD\">&amp;</span><span style=\"color: #C9CDD7\">key);</span>\n<span style=\"color: #C9CDD7\">      ctx.env.</span><span style=\"color: #AFF19F\">get_undefined</span><span style=\"color: #C9CDD7\">()</span>\n<span style=\"color: #C9CDD7\">    };</span>\n\n<span style=\"color: #C9CDD7\">    env.</span><span style=\"color: #AFF19F\">create_function_from_closure</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #F5D66B\">\"unsubscribe\"</span><span style=\"color: #C9CDD7\">, unsubscribe)</span>\n<span style=\"color: #C9CDD7\">  }</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>That about wraps this up!</p>\n\n<p>I hope I conveyed that this took a good chunk of time fiddling around and running into dead ends, and I’m not sure if I did this the “right” way or if I just happened to stumble into something that works. So please let me know if you have any ideas for improvements. <a href=\"https://github.com/dceddia/electron-napi-svelte-store\">Pull requests welcome</a> :)</p>\n\n<style>\n  .run-step {\n    display: inline-block;\n    margin-top: 7rem;\n  }\n</style>\n\n\n    <p><a href=\"https://daveceddia.com/svelte-store-in-rust/\">Implementing A Svelte Store In Rust</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on February 13, 2022.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2022-02-13T14:58:10.000Z",
    "url": "https://daveceddia.com/svelte-store-in-rust/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Interview Questions to Ask Your Interviewer",
    "partialText": "<p>On Twitter, <a href=\"https://twitter.com/kyleshevlin\">Kyle Shevlin</a> was talking about how at the end of a software engineering interview, they’ll often offer a painfully-small amount of time to ask some of your own questions.</p>\n\n<blockquote>\n  <p>The worst part is, I often just blank in the 5 minute question time. I’ll come up with something because I’m good on my feet, but deep down it feels ineffectual. I’m not getting what I need in that time period, so let me just use the bathroom before the next interview.</p>\n\n  <p>— <a href=\"https://twitter.com/kyleshevlin/status/1490899645857660929\">@kyleshevlin</a></p>\n</blockquote>\n\n<p>I mentioned that I had a go-to list of questions that I literally printed and brought with me, and would bring out during this 5-minute lightning round. I definitely felt like a <em>huge nerd</em> pulling a set of <em>printed questions</em> out of a binder.</p>\n\n<p>But it turned out to be really helpful, and at a couple of these interviews, my interviewer actually said, “Wow! That’s a lot of questions!” (it was 2 full pages) and offered that if there were any we didn’t get to, that I could send them over email.</p>\n\n<p>This was years ago by the way, long before COVID, when pretty much every interview was in-person. The shock factor of pulling out 2 pages of questions wouldn’t translate so well to Zoom, haha. But still: if time runs out, you can mention that you still have a bunch of questions, and could please email them afterward.</p>\n\n<h2 id=\"interview-questions-for-your-interviewer\">Interview Questions for Your Interviewer</h2>\n\n<p>Here in its raw unedited form are the questions I used.</p>\n\n<p>They’re short on purpose, because I wanted to be able to skim the list quickly under pressure.</p>\n\n<p>I suggest, if you decide to use these, to read them over and make sure you have an idea of how you’d form them into actual human sentences… or, if you think that might trip you up, then expand them on the page before you head into <strike>battle</strike> the interview.</p>\n\n<p>And hopefully, by the time you get to these questions, you’ll already have answers to some of them. (Another benefit of them being short: you can scan past those ones quickly)</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">How big is the company?\n\nWhy did you choose to work here?\n\nDo you enjoy this particular project?\n\nIs there flexibility within the org to move around to different projects?\n\nWhat&apos;s a typical day like?\n\n\nSoftware dev process? (agile/tdd/pairing?)\n\nBug tracking system?\n\nVersion control system?\n\nDev. desktop vs server OS? Developer machine hardware?\n\n\nIs the product live in production? If not, what&apos;s the schedule for developing it?\n\nHow often are releases done?\n\nWho supports the product once it&apos;s released? Pager duty? Monitoring email?\n\nWhere do feature + bugfix requests come from?\n\nWho does the \"design\" of the product? Internal designers, devs, both?\n\nWould my work be full-stack, or focused on backend/frontend?\n\nHow big is the code base? Lots of ties to external/legacy projects?\n\n\nTypical working hours? Flexibility? Crunch times?\n\nWorking from home? Regularly vs. Snow days?\n\n\nDo you have a favorite part of the job? Least favorite?\n\nDo you have a time tracking system?\n\nCentralized IT dept?\n\nGov’t contractor? Clearance required? Potential for clearance?\n\nRegulatory compliance? PCI, SOX, etc. Annual training?\n\n\nDo people hang out outside work? Company outings? Lunch?\n\nBudget for conferences?\n\nInternal lightning talks/brown bag lunches?\n\nDress code?\n\n\nDoes the company seem stable? Profitable? Any plans to sell?\n\nBonus structure?\n\nManagement style/structure? Frequent catch-ups aka one-on-ones? Something else?\n\nRoom for advancement?\n\nLearning opportunities?\n</span></code></pre>\n</div>\n<p>I hope this helps you prepare for your interview – and not just to pass <em>their</em> interview, but to make sure you get to interview <em>them</em> a bit, too. You’ll have to work with these people, after all! It’d be good to try to figure out if you’ll enjoy it.</p>\n\n<h2 id=\"more-resources\">More Resources</h2>\n\n<p>Mark Erikson (<a href=\"https://twitter.com/acemarke\">@acemarke</a>) has his own <a href=\"https://gist.github.com/markerikson/bc9e16de24e46712ff80bb658766185a\">list of questions here</a>.</p>\n\n<p>Charity Majors (<a href=\"https://twitter.com/mipsytipsy\">@mipsytipsy</a>) has this great post titled <a href=\"https://charity.wtf/2022/01/29/how-can-you-tell-if-the-company-youre-interviewing-with-is-rotten-on-the-inside/\">How can you tell if the company you’re interviewing with is rotten on the inside?</a></p>\n\n<p>If you have a list of your own somewhere, let me know and I’ll add a link here!</p>\n\n<style>\npre.shiki {\n  white-space: pre-line;\n}\n</style>\n\n\n    <p><a href=\"https://daveceddia.com/interview-questions-to-ask-company/\">Interview Questions to Ask Your Interviewer</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on February 08, 2022.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2022-02-08T04:23:55.000Z",
    "url": "https://daveceddia.com/interview-questions-to-ask-company/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Attach VSCode Debugger to native Rust in an Electron app",
    "partialText": "<p>I’ve been working on a <a href=\"https://getrecut.com\">video editor</a> built on top of Electron and Rust, where Rust does the heavy lifting, and Electron (paired with Svelte) takes care of the UI.</p>\n\n<p>Debugging the JS is easy enough: pop open Electron’s devtools, set some breakpoints, and you’re off to the races.</p>\n\n<p>Debugging the Rust is a little harder. But it’s possible!</p>\n\n<p>Here’s my setup for attaching VSCode’s debugger to the native Rust code, which is running within Electron’s renderer process.</p>\n\n<h2 id=\"set-up-launchjson\">Set up <code>launch.json</code></h2>\n\n<p>VSCode’s debugger relies on a config file called <code>launch.json</code>. I think it can reside in a few different places; mine is in the <code>.vscode</code> directory in the root of my project, and it looks like this:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Use IntelliSense to learn about possible attributes.</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Hover to view descriptions of existing attributes.</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// For more information, visit:</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// https://go.microsoft.com/fwlink/?linkid=830387</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"version\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"0.2.0\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"configurations\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> [</span>\n<span style=\"color: #C9CDD7\">    {</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"type\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"lldb\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"request\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"launch\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"name\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"Debug\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"program\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"${workspaceFolder}/backend/target/debug/recut\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"args\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> []</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"cwd\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"${workspaceFolder}\"</span>\n<span style=\"color: #C9CDD7\">    }</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    {</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"type\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"lldb\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"request\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"attach\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"pid\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"${command:pickProcess}\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"name\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"Debug Electron Renderer\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    }</span>\n<span style=\"color: #C9CDD7\">  ]</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>I have 2 configurations here:</p>\n\n<ul>\n  <li>the first is for launching the Rust executable on its own, so I can debug the Rust in isolation.</li>\n  <li>the second is for attaching to a running process</li>\n</ul>\n\n<p>It’s the second one that we’ll focus on. That’s the one that matters for attaching to the running Electron process.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">    {</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"type\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"lldb\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"request\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"attach\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"pid\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"${command:pickProcess}\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"name\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"Debug Electron Renderer\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    }</span></code></pre>\n</div>\n<p>I’m using a Mac, so <code>type</code> is <code>lldb</code>. This might need to be different for Windows.</p>\n\n<p>The <code>request</code> is <code>attach</code>, meaning that VSCode will try to attach to an already-running process, instead of launching the app itself.</p>\n\n<p>The <code>pid</code> is the special <code>${command:pickProcess}</code> which will pop up a picker window within VSCode that’ll let you choose the process to attach to (more on that in a second).</p>\n\n<p>The <code>name</code> is whatever descriptive name you want to use.</p>\n\n<h3 id=\"pid-vs-processid-vs-processname\"><code>pid</code> vs <code>processId</code> vs <code>processName</code></h3>\n\n<p>There are a few different properties VSCode supports to let you choose which process to attach to.</p>\n\n<p>I found this config from a <a href=\"https://stackoverflow.com/questions/60440765/how-can-i-attach-to-a-specific-process-in-visual-studio-code\">StackOverflow question</a> about attaching VSCode to a .NET Core app, and in the question, they used <code>processId</code> and <code>processName</code> instead of <code>pid</code>.</p>\n\n<p>I’m not sure if this difference is a Mac vs. Windows thing, or if VSCode changed the names of these properties, but in my setup, <code>processId</code> did not work.</p>\n\n<p>VSCode originally complained that it needed a “pid” so I used switched from <code>processId</code> to <code>pid</code> to get it working.</p>\n\n<p>If you’re on Windows, you might need to swap out <code>pid</code> for something else.</p>\n\n<h2 id=\"connect-the-debugger-to-electrons-renderer-process\">Connect the Debugger to Electron’s Renderer Process</h2>\n\n<p>Before you can connect the debugger, the app needs to be running, so start it up however you normally do (<code>npm run dev</code> or whatever).</p>\n\n<p>One important detail: make sure the native Rust module has been built with <strong>debug symbols included</strong>! Cargo’s <code>--release</code> flag will strip those out by default and you <em>probably</em> won’t be able to set breakpoints, so use <code>cargo build</code> instead of <code>cargo build --release</code>. You might need to modify your build scripts to make this change, if they inherently build in release mode.</p>\n\n<p>In VSCode, select the Debugger from the sidebar and choose the configuration from the dropdown at the top, then click the <code>|&gt;</code> Play button to launch it.</p>\n\n<p><img src=\"https://daveceddia.com/images/vscode-attach-debugger-to-rust-electron.png\" srcset=\"https://daveceddia.com/images/vscode-attach-debugger-to-rust-electron@2x.png 2x\" alt=\"Launch the VSCode debugger and then attach it to Rust inside Electron\" /></p>\n\n<h3 id=\"finding-the-right-process\">Finding the Right Process</h3>\n\n<p>VSCode will prompt you to select a process to attach to, and you can type to filter the list.</p>\n\n<p><img src=\"https://daveceddia.com/images/vscode-attach-debugger-to-process-pid.png\" srcset=\"https://daveceddia.com/images/vscode-attach-debugger-to-process-pid@2x.png 2x\" alt=\"Select a process to attach VSCode's debugger to\" /></p>\n\n<p>You can try typing “electron”, or the name of your project directory or executable to narrow it down.</p>\n\n<p>This <em>might</em> not be terribly helpful, though. At least for me, VSCode’s dialog isn’t wide enough to show the full path, I couldn’t find a way to resize it, and hovering the rows doesn’t show the full text either.</p>\n\n<p>And anyway, even if I <em>could</em> see the full path, they’re probably all the same.</p>\n\n<p>Not a huge help.</p>\n\n<h3 id=\"use-activity-monitor--task-manager\">Use Activity Monitor / Task Manager</h3>\n\n<p>To get a better view of the tasks, open up your OS’s task viewer. On Mac that’s Activity Monitor, under /Applications/Utilities. On Windows that’s the Task Manager.</p>\n\n<p>Filter the list to just your app (“Electron” if you haven’t set the name yet, like I haven’t)</p>\n\n<p><img src=\"https://daveceddia.com/images/find-process-to-attach-to.png\" srcset=\"https://daveceddia.com/images/find-process-to-attach-to@2x.png 2x\" alt=\"Find which PID to attach to using Activity Monitor or Task Manager\" /></p>\n\n<p>Look at the PID column for the one you want to attach to, and type that number into VSCode’s PID-picker popup.</p>\n\n<p>As for which one to pick: connect to the Electron process which is <strong>running your native code</strong>.</p>\n\n<ul>\n  <li>If that’s the Main process, look for the process named just “Electron” or “YourApp”</li>\n  <li>If that’s the Renderer process, look for “Electron Helper (Renderer)” or “YourApp Helper (Renderer)”</li>\n</ul>\n\n<p>If your code is in the Renderer process, and you have multiple windows open (e.g. Devtools), you’ll see multiple Renderer processes, which makes this harder.</p>\n\n<p>I suggest closing the DevTools window if you have it popped out, and any other windows that are not the one you want to debug.</p>\n\n<h2 id=\"set-breakpoints-in-vscode\">Set Breakpoints in VSCode</h2>\n\n<p>Once you’re connected, you should be able to set breakpoints within VSCode, inspect variables, and step in/out/continue/etc as usual.</p>\n\n\n    <p><a href=\"https://daveceddia.com/debug-electron-native-rust-with-vscode/\">Attach VSCode Debugger to native Rust in an Electron app</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on September 23, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-09-23T17:57:00.000Z",
    "url": "https://daveceddia.com/debug-electron-native-rust-with-vscode/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Example of Using napi-rs with Electron",
    "partialText": "<p>You can improve the performance of your Electron apps quite a bit by offloading intensive tasks to Rust.</p>\n\n<p>There are 2 main libraries out there to help you do this: <a href=\"https://neon-bindings.com/\">Neon</a> and <a href=\"https://napi.rs/\">napi-rs</a>. As it stands today, Neon is more popular, with over 5700 stars on Github, whereas napi-rs has only a little over 800.</p>\n\n<p>That said, stars aren’t everything! For my use case (and as of this writing) napi-rs supports an important feature that Neon doesn’t have yet: the ability for Rust to call back to a JS callback function multiple times.</p>\n\n<p>I went in search of a minimal starter project to get going with Electron + napi-rs, but couldn’t find anything. Hence this post :)</p>\n\n<p><strong>TL;DR:</strong> If you just want to clone the project you can find <a href=\"https://github.com/dceddia/electron-napi-rs\">electron-napi-rs</a> on Github.</p>\n\n<p>The rest of this post explains how the pieces fit together.</p>\n\n<p>(btw if you want to use Neon instead of napi-rs, check out Mike Barber’s <a href=\"https://github.com/mike-barber/electron-neon-rust\">electron-neon-rust</a>, which is basically the Neon version of what I’m doing here)</p>\n\n<h2 id=\"a-minimal-project-with-electron-and-napi-rs\">A Minimal Project with Electron and napi-rs</h2>\n\n<p>I started with the official Electron starter from <a href=\"https://github.com/electron/electron-quick-start\">electron-quick-start</a>. That’ll get an Electron app on the screen.</p>\n\n<p>Then I added the Rust module. This is more or less a copy-paste from napi-rs’s <a href=\"https://github.com/napi-rs/napi-rs/tree/main/napi-derive-example\">napi-derive-example</a>, with a few relative paths changed.</p>\n\n<p>I’m putting the Rust module in a directory called <code>hi-rust</code> inside the Electron project. We only need to add 4 files:</p>\n\n<h4 id=\"cargotoml\">Cargo.toml</h4>\n\n<div class=\"code-filename\">hi-rust/Cargo.toml</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"toml\"><code><span style=\"color: #C9CDD7\">[</span><span style=\"color: #AFF19F\">package</span><span style=\"color: #C9CDD7\">]</span>\n<span style=\"color: #FF8383\">authors</span><span style=\"color: #C9CDD7\"> = [</span><span style=\"color: #F5D66B\">\"LongYinan &lt;lynweklm@gmail.com&gt;\"</span><span style=\"color: #C9CDD7\">]</span>\n<span style=\"color: #FF8383\">edition</span><span style=\"color: #C9CDD7\"> = </span><span style=\"color: #F5D66B\">\"2018\"</span>\n<span style=\"color: #FF8383\">name</span><span style=\"color: #C9CDD7\"> = </span><span style=\"color: #F5D66B\">\"hi-rust\"</span>\n<span style=\"color: #FF8383\">version</span><span style=\"color: #C9CDD7\"> = </span><span style=\"color: #F5D66B\">\"0.1.0\"</span>\n\n<span style=\"color: #C9CDD7\">[</span><span style=\"color: #AFF19F\">lib</span><span style=\"color: #C9CDD7\">]</span>\n<span style=\"color: #FF8383\">crate-type</span><span style=\"color: #C9CDD7\"> = [</span><span style=\"color: #F5D66B\">\"cdylib\"</span><span style=\"color: #C9CDD7\">]</span>\n\n<span style=\"color: #C9CDD7\">[</span><span style=\"color: #AFF19F\">dependencies</span><span style=\"color: #C9CDD7\">]</span>\n<span style=\"color: #FF8383\">napi</span><span style=\"color: #C9CDD7\"> = </span><span style=\"color: #F5D66B\">\"1.7.5\"</span>\n<span style=\"color: #FF8383\">napi-derive</span><span style=\"color: #C9CDD7\"> = </span><span style=\"color: #F5D66B\">\"1.1.0\"</span>\n\n<span style=\"color: #C9CDD7\">[</span><span style=\"color: #AFF19F\">build-dependencies</span><span style=\"color: #C9CDD7\">]</span>\n<span style=\"color: #FF8383\">napi-build</span><span style=\"color: #C9CDD7\"> = </span><span style=\"color: #F5D66B\">\"1.1.0\"</span></code></pre>\n</div>\n<p>(modified to use version numbers instead of relative paths for the <code>[dependencies]</code> and <code>[build-dependencies]</code>)</p>\n\n<h4 id=\"buildrs\">build.rs</h4>\n\n<div class=\"code-filename\">hi-rust/build.rs</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #FF8383\">extern</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">crate</span><span style=\"color: #C9CDD7\"> napi_build;</span>\n\n<span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">main</span><span style=\"color: #C9CDD7\">() {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">use</span><span style=\"color: #C9CDD7\"> napi_build</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">setup;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">setup</span><span style=\"color: #C9CDD7\">();</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>(straight out of napi-derive-example)</p>\n\n<p>This <code>build.rs</code> file is special to Rust. You can read more in <a href=\"https://doc.rust-lang.org/cargo/reference/build-scripts.html\">the Build Scripts section of the Cargo book</a>, but basically Rust will look for a <code>build.rs</code> file and run it before the build, if it’s present.</p>\n\n<h4 id=\"srclibrs\">src/lib.rs</h4>\n\n<p>Then there’s the code itself, under the <code>src</code> folder:</p>\n\n<div class=\"code-filename\">hi-rust/src/lib.rs</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"rust\"><code><span style=\"color: #C9CDD7\">#[macro_use]</span>\n<span style=\"color: #FF8383\">extern</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">crate</span><span style=\"color: #C9CDD7\"> napi_derive;</span>\n\n<span style=\"color: #FF8383\">use</span><span style=\"color: #C9CDD7\"> napi</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">{CallContext, Error, JsNumber, JsObject, JsUnknown, </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">, Status};</span>\n<span style=\"color: #FF8383\">use</span><span style=\"color: #C9CDD7\"> std</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">convert</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">TryInto;</span>\n\n<span style=\"color: #C9CDD7\">#[module_exports]</span>\n<span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">init</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #FF8383\">mut</span><span style=\"color: #C9CDD7\"> exports: JsObject) -&gt; </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">&lt;()&gt; {</span>\n<span style=\"color: #C9CDD7\">  exports.</span><span style=\"color: #AFF19F\">create_named_method</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #F5D66B\">\"testThrow\"</span><span style=\"color: #C9CDD7\">, test_throw)?;</span>\n<span style=\"color: #C9CDD7\">  exports.</span><span style=\"color: #AFF19F\">create_named_method</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #F5D66B\">\"fibonacci\"</span><span style=\"color: #C9CDD7\">, fibonacci)?;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">Ok</span><span style=\"color: #C9CDD7\">(())</span>\n<span style=\"color: #C9CDD7\">}</span>\n\n<span style=\"color: #C9CDD7\">#[js_function]</span>\n<span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">test_throw</span><span style=\"color: #C9CDD7\">(_ctx: CallContext) -&gt; </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">&lt;JsUnknown&gt; {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">Err</span><span style=\"color: #C9CDD7\">(Error</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #AFF19F\">from_status</span><span style=\"color: #C9CDD7\">(Status</span><span style=\"color: #93DDFD\">::</span><span style=\"color: #C9CDD7\">GenericFailure))</span>\n<span style=\"color: #C9CDD7\">}</span>\n\n<span style=\"color: #C9CDD7\">#[js_function(1)]</span>\n<span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">fibonacci</span><span style=\"color: #C9CDD7\">(ctx: CallContext) -&gt; </span><span style=\"color: #76DCE8\">Result</span><span style=\"color: #C9CDD7\">&lt;JsNumber&gt; {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">let</span><span style=\"color: #C9CDD7\"> n </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> ctx.get</span><span style=\"color: #93DDFD\">::&lt;</span><span style=\"color: #C9CDD7\">JsNumber</span><span style=\"color: #93DDFD\">&gt;</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #D570F3\">0</span><span style=\"color: #C9CDD7\">)?.</span><span style=\"color: #AFF19F\">try_into</span><span style=\"color: #C9CDD7\">()?;</span>\n<span style=\"color: #C9CDD7\">  ctx.env.</span><span style=\"color: #AFF19F\">create_int64</span><span style=\"color: #C9CDD7\">(</span><span style=\"color: #AFF19F\">fibonacci_native</span><span style=\"color: #C9CDD7\">(n))</span>\n<span style=\"color: #C9CDD7\">}</span>\n\n<span style=\"color: #C9CDD7\">#[inline]</span>\n<span style=\"color: #FF8383\">fn</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">fibonacci_native</span><span style=\"color: #C9CDD7\">(n: </span><span style=\"color: #76DCE8\">i64</span><span style=\"color: #C9CDD7\">) -&gt; </span><span style=\"color: #76DCE8\">i64</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">match</span><span style=\"color: #C9CDD7\"> n {</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #D570F3\">1</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">|</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">2</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">1</span><span style=\"color: #C9CDD7\">,</span>\n<span style=\"color: #C9CDD7\">    _ </span><span style=\"color: #93DDFD\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">fibonacci_native</span><span style=\"color: #C9CDD7\">(n </span><span style=\"color: #93DDFD\">-</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">1</span><span style=\"color: #C9CDD7\">) </span><span style=\"color: #93DDFD\">+</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">fibonacci_native</span><span style=\"color: #C9CDD7\">(n </span><span style=\"color: #93DDFD\">-</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">2</span><span style=\"color: #C9CDD7\">),</span>\n<span style=\"color: #C9CDD7\">  }</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>(also straight out of the napi-rs repo)</p>\n\n<p>It exposes 2 Rust functions to JavaScript: <code>test_throw</code> and <code>fibonacci</code> are exposed as <code>testThrow</code> and <code>fibonacci</code>, respectively.</p>\n\n<p>The <code>init</code> is effectively the “entry point” for the JS &lt;-&gt; Rust binding, and this file could call out to whatever Rust code you want.</p>\n\n<h4 id=\"packagejson\">package.json</h4>\n\n<p>Run <code>npm init -y</code> to initialize a default package.json, then add “build” and “install” scripts.</p>\n\n<p>The build script depends on a package for copying out the built Rust binary, so install that with <code>npm install -D cargo-cp-artifact</code>.</p>\n\n<div class=\"code-filename\">hi-rust/package.json</div>\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"name\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"hi-rust\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"version\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"1.0.0\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"description\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"main\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"index.node\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"scripts\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> {</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"install\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"npm run build\"</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"build\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"cargo-cp-artifact -nc index.node -- cargo build --message-format=json-render-diagnostics\"</span>\n</span><span style=\"color: #C9CDD7\">  }</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"keywords\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> []</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"author\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"\"</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"license\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"ISC\"</span><span style=\"color: #D1D5DE\">,</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"devDependencies\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> {</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"cargo-cp-artifact\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"^0.1.4\"</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  }</span>\n</span><span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>The <code>build</code> script effectively does 2 things:</p>\n\n<ul>\n  <li><code>cargo build</code> compiles the Rust module and saves the compiled file in <code>target/debug</code></li>\n  <li><code>cargo-cp-artifact</code> copies that output into the root of the project as <code>index.node</code></li>\n</ul>\n\n<p>The <code>install</code> script just makes it easier to run. (You can <code>npm i</code> instead of <code>npm run build</code>)</p>\n\n<h4 id=\"release-build\">Release Build</h4>\n\n<p>Cargo will compile a Debug build by default, which is slower and larger, but contains debugging symbols.</p>\n\n<p>Make sure to compile a Release build if you want it to be faster and smaller! Append the <code>--release</code> flag to the end of the <code>cargo build</code> command if/when you want to do that.</p>\n\n<p>I did this right away because my app was much slower in Debug mode.</p>\n\n<h4 id=\"aside-indexjs-vs-indexnode\">Aside: index.js vs index.node?</h4>\n\n<p>An interesting thing happened when I was setting this up!</p>\n\n<p>At first I didn’t change “main” at all, and left its value as the default <code>index.js</code>. Which… worked perfectly fine, even though there was only an index.node file present (no index.js).</p>\n\n<p>I guess Node knows to look for <code>index.node</code> if it can’t find <code>index.js</code>?</p>\n\n<p>Anyway, that was a little unnerving, so I changed the “main” key to point directly to <code>index.node</code>, and that worked fine too. I figure it’s better to point it at a file that actually exists 🤷 At the very least it’ll shave a couple cycles off the import, eh?</p>\n\n<h3 id=\"build-indexnode\">Build index.node</h3>\n\n<p>Running <code>npm install</code> inside the <code>hi-rust</code> directory will download the required packages and build the <code>index.node</code> file, which is our native Rust code, packaged up so that Node can <code>require()</code> it.</p>\n\n<h3 id=\"add-the-rust-module-as-a-dependency\">Add the Rust module as a dependency</h3>\n\n<p>Back in the top-level Electron project, add the Rust module as a dependency to package.json:</p>\n\n<div class=\"code-filename\">package.json</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #F8F8F0\">...</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"dependencies\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"hi-rust\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"./hi-rust\"</span>\n<span style=\"color: #C9CDD7\">  }</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>Then run <code>npm install</code> and it’ll make a link to the project.</p>\n\n<p>From here on, you can modify and rebuild the Rust project (inside <code>hi-rust</code>) without having to re-run <code>npm install</code>.</p>\n\n<h3 id=\"expose-the-rust-module-with-preloadjs\">Expose the Rust module with preload.js</h3>\n\n<p>We have native code, it’s packaged and built as a module that Node can import. Now we need to import it inside the Electron app.</p>\n\n<p>There’s 2 ways to do this: the insecure way, and the better way.</p>\n\n<p>The insecure way is to set <code>nodeIntegration: true</code> so that we can <code>require()</code> node modules directly from our Electron renderer process. It makes for easier code, but the main downside is the massive security hole it opens up.</p>\n\n<h4 id=\"why-not-to-set-nodeintegration-true-in-electron\">Why not to set <code>nodeIntegration: true</code> in Electron</h4>\n\n<p>With the insecure setup, any JS run by the renderer has full access to the user’s system. That means File APIs, Network APIs, Process APIs, etc, etc.</p>\n\n<p>It can do anything the user can do. Like download and run some malicious program, or ransomware their home directory.</p>\n\n<p>Writing the code with <code>nodeIntegration: true</code> makes for <em>slightly</em> less hassle at the expense of a gaping security hole.</p>\n\n<p><a href=\"https://www.electronjs.org/docs/tutorial/security#2-do-not-enable-nodejs-integration-for-remote-content\">Read more about the security behind this in the Electron docs</a>.</p>\n\n<h4 id=\"the-better-way\">The better way</h4>\n\n<p>The better way is to use Electron’s <code>preload</code> file to selectively expose functionality to the renderer process a.k.a. the “main world”, which is what we’ll do here.</p>\n\n<p>In <code>main.js</code>, the Electron starter project sets up <code>preload.js</code> as the designated preload file. The preloader has access to both Node APIs <em>and</em> browser APIs, but the crucial difference is that it’s isolated: the renderer can’t reach in and call stuff from preload, unless preload has explicitly exposed it.</p>\n\n<p>So we expose our Rust module from <code>preload.js</code> like so:</p>\n\n<div class=\"code-filename\">preload.js</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #6E778C\">// Import the Rust library and expose it globally as `rustLib`</span>\n<span style=\"color: #6E778C\">// in the renderer (also accessible as `window.rustLib`)</span>\n<span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">rustLib</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">require</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;hi-rust&apos;</span><span style=\"color: #9CA5B7\">)</span>\n<span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> { </span><span style=\"color: #93DDFD\">contextBridge</span><span style=\"color: #C9CDD7\"> } </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">require</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;electron&apos;</span><span style=\"color: #9CA5B7\">)</span>\n<span style=\"color: #93DDFD\">contextBridge</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">exposeInMainWorld</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;rustLib&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">rustLib</span><span style=\"color: #9CA5B7\">)</span></code></pre>\n</div>\n<p>Note this exposes the whole library! You’ll want to pause and reflect for a second whether this is a good idea from a security standpoint. If malicious code could call any of your library’s functions, what could happen?</p>\n\n<p>As a potentially safer alternative, you can expose individual functions…</p>\n\n<div class=\"code-filename\">preload.js</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #93DDFD\">contextBridge</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">exposeInMainWorld</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;rustLib&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  fibonacci</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">rustLib</span><span style=\"color: #D1D5DE\">.fibonacci</span>\n<span style=\"color: #9CA5B7\">})</span></code></pre>\n</div>\n<p>Or wrap the calls in a function, to ensure only certain arguments are allowed through, or do other checks:</p>\n\n<div class=\"code-filename\">preload.js</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #93DDFD\">contextBridge</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">exposeInMainWorld</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;rustLib&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">fibonacci</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">num</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">if</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">num</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D570F3\">42</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">rustLib</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">fibonacci</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">num</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span>\n<span style=\"color: #9CA5B7\">})</span></code></pre>\n</div>\n<p>You can also use Electron’s <a href=\"https://www.electronjs.org/docs/api/ipc-main\">IPC system</a> to send requests back and forth between main and renderer processes.</p>\n\n<h3 id=\"call-the-rust-code-from-electron-in-rendererjs\">Call the Rust code from Electron in renderer.js</h3>\n\n<p>Now we can finally call the Rust function from the renderer!</p>\n\n<p>Once the DOM is ready, we call <code>rustLib.fibonacci</code>, referencing the exposed global <code>rustLib</code> that came from the preload script, and store the result in an element (that we still need to create).</p>\n\n<div class=\"code-filename\">renderer.js</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #93DDFD\">window</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">addEventListener</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;DOMContentLoaded&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">result</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">rustLib</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">fibonacci</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D570F3\">8</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">content</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">document</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">querySelector</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;#rust-content&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #93DDFD\">content</span><span style=\"color: #D1D5DE\">.innerHTML</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">`This number came from Rust! &lt;strong&gt;</span><span style=\"color: #C678DD\">${</span><span style=\"color: #D1D5DE\">result</span><span style=\"color: #C678DD\">}</span><span style=\"color: #F5D66B\">&lt;/strong&gt;`</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p>If you run this now you’ll probably get an error like “Cannot access property innerHTML of null”, because the element doesn’t exist yet.</p>\n\n<p>Let’s add a div with <code>id=&quot;rust-content&quot;</code> to contain the result:</p>\n\n<div class=\"code-filename\">index.html</div>\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"html\"><code><span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">html</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">&lt;!-- snip --&gt;</span>\n<span style=\"color: #C9CDD7\">  &lt;</span><span style=\"color: #FF8383\">body</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">&lt;!-- snip --&gt;</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">    &lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #D1D5DE\">=</span><span style=\"color: #F5D66B\">\"rust-content\"</span><span style=\"color: #C9CDD7\">&gt;&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #C9CDD7\">&gt;</span>\n</span><span style=\"color: #C9CDD7\">  &lt;/</span><span style=\"color: #FF8383\">body</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">&lt;/</span><span style=\"color: #FF8383\">html</span><span style=\"color: #C9CDD7\">&gt;</span></code></pre>\n</div>\n<h2 id=\"it-works\">It works!</h2>\n\n<p>At this point you should be able to run <code>npm start</code> from the top-level (Electron) directory, and the app should pop up with a number computed by Rust :)</p>\n\n<h3 id=\"synchronously\">…synchronously!</h3>\n\n<p>One thing to note that this is a <strong>synchronous</strong> call to Rust. If the fibonacci function is super slow, or we were to call some other function that blocked, our app would freeze up.</p>\n\n<p>You can try this yourself: try passing a big number like <code>1234</code> to fibonacci, instead of <code>8</code>.</p>\n\n<h2 id=\"help-errors\">Help! Errors!</h2>\n\n<p>Here are a couple errors I hit along the way and how I fixed them. If you’re following along, you <em>probably</em> won’t hit these, but I’m listing them here just in case.</p>\n\n<h3 id=\"a-missing-packagejson\">A missing <code>package.json</code></h3>\n\n<p>I got this error when I forgot to create a <code>package.json</code> inside the Rust library’s directory:</p>\n\n<pre class=\"console-error\">\nInternal Error: Cannot find module '/Users/dceddia/Projects/electron-napi-rs/hi-rust/package.json'\nRequire stack:\n- /usr/local/lib/node_modules/@napi-rs/cli/scripts/index.js\nRequire stack:\n- /usr/local/lib/node_modules/@napi-rs/cli/scripts/index.js\n    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:933:15)\n    at Function.Module._load (node:internal/modules/cjs/loader:778:27)\n    at Module.require (node:internal/modules/cjs/loader:1005:19)\n    at require (node:internal/modules/cjs/helpers:94:18)\n    at getNapiConfig (/usr/local/lib/node_modules/@napi-rs/cli/scripts/index.js:23450:19)\n    at BuildCommand.&lt;lt;anonymous&gt; (/usr/local/lib/node_modules/@napi-rs/cli/scripts/index.js:23579:30)\n    at Generator.next (&lt;lt;anonymous&gt;)\n    at /usr/local/lib/node_modules/@napi-rs/cli/scripts/index.js:65:61\n    at new Promise (&lt;lt;anonymous&gt;)\n    at __async (/usr/local/lib/node_modules/@napi-rs/cli/scripts/index.js:49:10)\n</pre>\n\n<p>The fix ended up being pretty simple: <code>npm init -y</code> created a <code>package.json</code> file and solved the error.</p>\n\n<h3 id=\"exporting-incorrectly-from-electrons-preloadjs\">Exporting incorrectly from Electron’s <code>preload.js</code></h3>\n\n<p>My first attempt to expose the Rust library to Electron’s renderer process was something like:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">rustLib</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">require</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;hi-rust&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #93DDFD\">window</span><span style=\"color: #D1D5DE\">.rustLib</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">rustLib</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p>I was able to start Electron just fine, but it logged an error in the browser console, indicating that <code>window.rustLib</code> was undefined… which meant my line was being ignored.</p>\n\n<pre class=\"console-error\">\nUncaught TypeError: Cannot read property 'fibonacci' of undefined\n</pre>\n\n<p>I think it’s because <code>contextIsolation</code> is ON by default, so anything added to the <code>window</code> object won’t be visible.</p>\n\n<p>The fix was to use Electron’s <code>contextBridge</code> module, specifically the <code>exposeInMainWorld</code> function:</p>\n\n<div class=\"code-filename\">preload.js</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">rustLib</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">require</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;hi-rust&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> { </span><span style=\"color: #93DDFD\">contextBridge</span><span style=\"color: #C9CDD7\"> } </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">require</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;electron&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #93DDFD\">contextBridge</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">exposeInMainWorld</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;rustLib&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">rustLib</span><span style=\"color: #9CA5B7\">)</span></code></pre>\n</div>\n\n    <p><a href=\"https://daveceddia.com/napi-rs-electron-example/\">Example of Using napi-rs with Electron</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on August 21, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-08-21T16:35:58.000Z",
    "url": "https://daveceddia.com/napi-rs-electron-example/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Escape Liquid in ConvertKit (so you can use double braces)",
    "partialText": "<p>Need to use double braces in your ConvertKit email? Maybe you’re trying to write some code, and the braces are getting stripped out along with everything inside.</p>\n\n<p>Here’s the easy fix:</p>\n\n<p>Before the opening double braces, add <code>{% raw %}</code>.</p>\n\n<p>After the closing braces, add <code>{% endraw %}</code>.</p>\n\n<h2 id=\"example-of-escaping-double-braces-in-convertkit-liquid\">Example of Escaping Double Braces in ConvertKit Liquid</h2>\n\n<p>I had this problem myself – some of my email content was getting stripped out, ending up like this:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #93DDFD\">CustomButton</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">green</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #76DCE8\">true</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">width</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D570F3\">64</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">options</span><span style=\"color: #93DDFD\">=</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">onClick</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">doStuffFunc</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #8AD2F0\">/&gt;</span></code></pre>\n</div>\n<p>And here’s what it was <em>supposed</em> to be, with more text on the <code>options=</code> line:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #93DDFD\">CustomButton</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">green</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #76DCE8\">true</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">width</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D570F3\">64</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">options</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> awesome</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"yes\"</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> disabled</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"no\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">onClick</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">doStuffFunc</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #8AD2F0\">/&gt;</span></code></pre>\n</div>\n<p>To get that result, I changed the text of the email to wrap the double braces in a raw/endraw block:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #93DDFD\">CustomButton</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">green</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #76DCE8\">true</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">width</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D570F3\">64</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">options</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">%</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">raw</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">%</span><span style=\"color: #FFE78F\">}{</span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> awesome</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"yes\"</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> disabled</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"no\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #FFE78F\">}{</span><span style=\"color: #93DDFD\">%</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">endraw</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">%</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">onClick</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">doStuffFunc</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #8AD2F0\">/&gt;</span></code></pre>\n</div>\n<p>And now it works great :)</p>\n\n<h2 id=\"bonus-how-to-write--raw--if-you-really-really-have-to\">Bonus: How to Write <code>{% raw %}</code> if you really really have to</h2>\n\n<p>If you need to write <em>almost</em> any other Liquid in your emails, and want it to appear as-is in the actual email, wrapping it in <code>{% raw %}</code> + <code>{% endraw %}</code> will do it.</p>\n\n<p>But what if you want to literally include the text <code>{% raw %}</code> in an email?</p>\n\n<p>(I had to figure this out in order to write this post, because my blog <em>also</em> uses Liquid for templating!)</p>\n\n<p>Fair warning, this will probably hurt your eyes and brain. It hurt mine. Here’s how it do it:</p>\n\n<p><code>{{ &quot;{% raw&quot; }} %}</code></p>\n\n<p>and</p>\n\n<p><code>{{ &quot;{% endraw&quot; }} %}</code></p>\n\n<p>Here’s why this works:</p>\n\n<p><code style=\"background: white; font-size: 26px;\"><span style=\"background: #fff700\">{{ <span style=\"background: #ffd000\">\"{% raw\"</span> }}</span> %}</code></p>\n\n<ul>\n  <li>The double braces are actually a Liquid expression (the whole <span style=\"background: #fff700\">yellow</span> part)</li>\n  <li>Inside the double braces is a string surrounded by double quotes (in <span style=\"background: #ffd000\">orange</span>). The quotes get removed before the text is inserted into the page.</li>\n  <li>The final closing <code>%}</code> is plain old text, since it’s outside of the double braces. It doesn’t mean anything special to Liquid.</li>\n</ul>\n\n<p>Liquid-ception.</p>\n\n    <p><a href=\"https://daveceddia.com/escape-liquid-braces-in-convertkit/\">Escape Liquid in ConvertKit (so you can use double braces)</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on August 13, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-08-13T14:02:56.000Z",
    "url": "https://daveceddia.com/escape-liquid-braces-in-convertkit/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "How to Manually Symbolicate a Crash Log from a macOS App",
    "partialText": "<p>Is one of your Mac apps crashing? If you got a crash report from your users, or an unsymbolicated crash log from Sentry, I’ll walk you through how to decode it into something you can use to debug the crash.</p>\n\n<p>For my own app <a href=\"https://getrecut.com\">Recut</a>, I’ve added the Sentry library to capture crash reports. For whatever reason, Sentry does not symbolicate my crash reports. I’ve uploaded the dSYMs and it just seems to ignore them. So: I’ll just symbolicate them myself!</p>\n\n<p>Here’s how to do it manually. I also put together a <a href=\"https://gist.github.com/dceddia/4c2cd2b32a1c9a6029fbc996a05f4a97\">Ruby script to symbolicate the whole crash report</a> too.</p>\n\n<h3 id=\"1-download-the-unsymbolicated-crash-report-from-sentry\">1. Download the unsymbolicated crash report from Sentry.</h3>\n\n<p>On the error report, select <code>Raw</code> and <code>Unsymbolicated</code> and click Download. The Download button won’t appear until you select Raw. Don’t leave it as the default <code>Symbolicated</code> or else the downloaded log will have a bunch of <code>&lt;redacted&gt;</code> where the memory addresses should be.</p>\n\n<p><img src=\"https://daveceddia.com/images/sentry-symbolication-options.png\" srcset=\"https://daveceddia.com/images/sentry-symbolication-options@2x.png 2x\" alt=\"Symbolication options in Sentry\" /></p>\n\n<h3 id=\"2-make-a-new-empty-folder\">2. Make a new empty folder</h3>\n\n<p>Then open a Terminal, and <code>cd</code> to your new folder. We’ll be copying the necessary files here, because they all need to be in one place to symbolicate properly.</p>\n\n<h3 id=\"3-open-xcode-and-the-organizer\">3. Open Xcode and the Organizer</h3>\n\n<p>In Xcode, under the Window menu, click Organizer to open it up.</p>\n\n<p>This contains all of the archived builds of your app.</p>\n\n<h3 id=\"4-find-the-correct-release\">4. Find the correct release</h3>\n\n<p>Match up the info from the crash log (or the info in Sentry) with your list of releases in Xcode’s Organizer, and pick the one that matches.</p>\n\n<p>Symbolication won’t work right (or maybe at all?) unless all the versions match up.</p>\n\n<p>In my example I’m using release 2.0.1, build 552.</p>\n\n<p><img src=\"https://daveceddia.com/images/xcode-organizer.png\" srcset=\"https://daveceddia.com/images/xcode-organizer@2x.png 2x\" alt=\"Xcode Organizer window showing available releases\" /></p>\n\n<h3 id=\"5-copy-files-out-of-the-release\">5. Copy files out of the release</h3>\n\n<p>Right-click the release, and choose Show in Finder.</p>\n\n<p>That’ll open a Finder window with a single <code>.xcarchive</code> file in it.</p>\n\n<p>Right-click that xcarchive, and choose Show Package Contents.</p>\n\n<p>You should see a bunch of folders like this:</p>\n\n<p><img src=\"https://daveceddia.com/images/recut-xcarchive-folder.png\" srcset=\"https://daveceddia.com/images/recut-xcarchive-folder@2x.png 2x\" alt=\"An example of a .xcarchive folder\" /></p>\n\n<p>The files we need are in 2 places:</p>\n\n<ul>\n  <li>from <code>dSYMs</code>: copy everything into the folder you created.</li>\n  <li>from <code>Products/Applications</code>: copy your app into the same folder.</li>\n</ul>\n\n<p>Make sure that you <strong>copy</strong> these files! Do not <em>move</em> them.</p>\n\n<p>This xcarchive is your key to the kingdom… if you lose these files, you won’t be able to symbolicate crash reports anymore. So leave the original files alone, just make copies.</p>\n\n<h3 id=\"6-run-the-symbolicator-tool\">6. Run the symbolicator tool</h3>\n\n<p>You should have a preinstalled command line tool called <code>atos</code>. From its <code>man</code> page, its job is to “convert numeric addresses to symbols of binary images or processes”.</p>\n\n<p>Now in your folder you should have at least these 3 things:</p>\n\n<ul>\n  <li>the crash report file (a text file)</li>\n  <li>YourApp.app.dSYM</li>\n  <li>YourApp.app</li>\n</ul>\n\n<p>You can manually symbolicate a single line by plugging a couple memory addresses into <code>atos</code>. For example, here are the first few lines of a crash in my app:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">Thread 0 Crashed:\n0   Recut                           0x204302872         0x204296000 + 444530\n1   Recut                           0x204308b5c         0x204296000 + 469852\n2   Recut                           0x204308afe         0x204296000 + 469758\n</span></code></pre>\n</div>\n<p>To look up the function and file where this crash occurred, I’ll take the first 2 memory addresses and run <code>atos</code>;</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">atos -o Recut.app/Contents/MacOS/Recut -arch x86_64 -l 0x204296000 0x204302872\n</span></code></pre>\n</div>\n<p>That prints out the location of the crash and I can go look it up.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">closure #1 in WaveDataManager.samplesForResolution(_:) (in Recut) (WaveDataManager.swift:150)\n</span></code></pre>\n</div>\n<h3 id=\"7-run-a-script-to-automatically-symbolicate-everything\">7. Run a script to automatically symbolicate everything</h3>\n\n<p>I wrote a Ruby script to run the <code>atos</code> command on every relevant line and symbolicate the whole crash report in one go. It’s <a href=\"https://gist.github.com/dceddia/4c2cd2b32a1c9a6029fbc996a05f4a97\">in this GitHub gist</a>.</p>\n\n<p>To use:</p>\n\n<ol>\n  <li>Download it</li>\n  <li>Make it executable <code>chmod +x ./symbolicate.rb</code></li>\n  <li>Run it on your files:</li>\n</ol>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">symbolicate.rb 53c91214f29a42f1a0d19f86b7236e70.crash x86_64 Recut.app Recut.app.dSYM\n</span></code></pre>\n</div>\n<p>This will print out the crash report, but with your own app’s calls symbolicated:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">Thread 0 Crashed:\n0   Recut                           0x204302872         closure #1 in WaveDataManager.samplesForResolution(_:) (in Recut) (WaveDataManager.swift:150)\n1   Recut                           0x204308b5c         thunk for @callee_guaranteed () -&gt; () (in Recut) (&lt;compiler-generated&gt;:0)\n2   Recut                           0x204308afe         thunk for @escaping @callee_guaranteed () -&gt; () (in Recut) (&lt;compiler-generated&gt;:0)\n...\n</span></code></pre>\n</div>\n<p>You can pass the <code>-g</code> to colorize the output, to highlight the lines that correspond to your app’s code.</p>\n\n<p>By default it hides threads that don’t include any calls into your app code. It also hides the big list of binaries at the end of the crash report. You can turn those off with flags.</p>\n\n<p>Here’s the full usage info:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">Usage: symbolicate -g -b -t [crash_log] [arch] [app_bundle] [dsym]\n\nThe crash log, app, and dSYM should all be in the current working directory.\n\n  In Xcode: Window &gt; Organizer\n  right-click the release, Show in Finder\n  right-click the xcarchive, Show Package Contents\n  copy files from `dSYMs` and `Products/Applications` into a new empty folder\n  copy the crash log to the same folder\n\n-g          Colorize the output to highlight this app&apos;s lines\n-b          Show the &apos;Binary Images&apos; section (by default this is omitted for brevity)\n-t          Show all threads, including ones that have no calls to your app\ncrash_log   text file from Sentry\narch        x86_64 or arm64 (get this from Sentry)\napp_bundle  TheApp.app (in current directory)\ndsym        TheApp.app.dSYM (in current directory)\n</span></code></pre>\n</div>\n<h2 id=\"now-go-debug\">Now Go Debug!</h2>\n\n<p>I hope this helps you with your own app debugging journey!</p>\n\n    <p><a href=\"https://daveceddia.com/manually-symbolicate-crash-log-macos-app/\">How to Manually Symbolicate a Crash Log from a macOS App</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on June 26, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-06-26T23:37:56.000Z",
    "url": "https://daveceddia.com/manually-symbolicate-crash-log-macos-app/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Using Forms in React",
    "partialText": "<p>No matter what kind of app you’re writing, there’s a good chance you need at least one form.</p>\n\n<p>Forms in React are often a pain, filled with verbose and boilerplate-y code.</p>\n\n<p>Let’s look at how to make forms in React with less pain.</p>\n\n<p>In this article we’ll be focusing on using plain React, with no libraries. You’ll learn how forms really work, so you can confidently build them yourself. And if later you choose to add a form library, you’ll know how they work under the hood.</p>\n\n<p>We’re going to cover:</p>\n\n<ul>\n  <li>How to create React forms without installing any libraries</li>\n  <li>The two styles of inputs in React forms</li>\n  <li>When to use Controlled vs. Uncontrolled inputs</li>\n  <li>An easy way to get values out of uncontrolled inputs</li>\n</ul>\n\n<h2 id=\"how-to-create-forms-with-plain-react\">How to Create Forms with Plain React</h2>\n\n<p><a name=\"plain-form\"></a></p>\n\n<p>Let’s dive right in. We’re going to build a simple contact form. Here’s the first iteration, a standalone component called <code>ContactForm</code> that renders a form:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">ContactForm</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">form</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Name</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"text\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"message\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Message</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">textarea</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"message\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"submit\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Submit</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">form</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>You don’t need to install a library to do any of this. React has built-in support for forms, because HTML and the DOM have built-in support for forms. At the end of the day, React is rendering DOM nodes.</p>\n\n<p>In fact, for small forms, you probably don’t need a form library at all. Something like Formik or react-hook-form is overkill if all you need is a simple form.</p>\n\n<p>There’s no <a href=\"/usestate-hook-examples/\">state</a> in here yet, and we’re not responding to form submission, but this component will already render a form you can interact with. (If you submit it, the page will reload, because submission is still being handled in the default way by the browser)</p>\n\n<h2 id=\"react-forms-vs-html-forms\">React Forms vs. HTML Forms</h2>\n\n<p>If you’ve worked with forms in plain HTML, a lot of this will probably seem familiar.</p>\n\n<p>There’s a <code>form</code> tag, and <code>label</code>s for the <code>input</code>s, same as you’d write in HTML.</p>\n\n<p>Each label has an <code>htmlFor</code> prop that matches the <code>id</code> on its corresponding input. (That’s one difference: in HTML, the label attribute would be <code>for</code>. React uses <code>htmlFor</code> instead.)</p>\n\n<p>If you <em>haven’t</em> done much with plain HTML, just know that React didn’t make this stuff up! The <a href=\"/what-react-does/\">things React does</a> are pretty limited, and the way forms work is borrowed from HTML and the DOM.</p>\n\n<h2 id=\"two-kinds-of-inputs-controlled-vs-uncontrolled\">Two Kinds of Inputs: Controlled vs. Uncontrolled</h2>\n\n<p>Inputs in React can be one of two types: <strong>controlled</strong> or <strong>uncontrolled</strong>.</p>\n\n<p>An <strong>uncontrolled</strong> input is the simpler of the two. It’s the closest to a plain HTML input. React puts it on the page, and the browser keeps track of the rest. When you need to access the input’s value, React provides a way to do that. Uncontrolled inputs require less code, but make it harder to do certain things.</p>\n\n<p>With a <strong>controlled</strong> input, YOU explicitly control the value that the input displays. You have to write code to respond to keypresses, store the current value somewhere, and pass that value back to the input to be displayed. It’s a feedback loop with your code in the middle. It’s more manual work to wire these up, but they offer the most control.</p>\n\n<p>Let’s look at these two styles in practice, applied to our contact form.</p>\n\n<h3 id=\"controlled-inputs\">Controlled Inputs</h3>\n\n<p>With a controlled input, you write the code to manage the value explicitly.</p>\n\n<p>You’ll need to create state to hold it, update that state when the value changes, and explicitly tell the input what value to display.</p>\n\n<p>To update our contact form to use controlled inputs, we’ll need to add a few things, highlighted here:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">ContactForm</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">name</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setName</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">email</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setEmail</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">message</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setMessage</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\">\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">handleSubmit</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">event</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">event</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">preventDefault</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;name:&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">name</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;email:&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">email</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;message:&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">message</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span>\n</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">form</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">onSubmit</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">handleSubmit</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n</span><span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Name</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"text\"</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">value</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">name</span><span style=\"color: #FFE78F\">}</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">onChange</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">e</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">setName</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">target</span><span style=\"color: #D1D5DE\">.value</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #FFE78F\">}</span>\n</span><span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">value</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">email</span><span style=\"color: #FFE78F\">}</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">onChange</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">e</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">setEmail</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">target</span><span style=\"color: #D1D5DE\">.value</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #FFE78F\">}</span>\n</span><span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"message\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Message</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">textarea</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"message\"</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">value</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">message</span><span style=\"color: #FFE78F\">}</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">onChange</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">e</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">setMessage</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">target</span><span style=\"color: #D1D5DE\">.value</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #FFE78F\">}</span>\n</span><span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"submit\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Submit</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">form</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>We’ve added 3 calls to <a href=\"/usestate-hook-examples/\">useState</a> to create 3 variables to hold the inputs’ values. They’re initially empty, <code>&#39;&#39;</code>.</p>\n\n<p>Each <code>input</code> has gained a couple new props, too.</p>\n\n<ul>\n  <li><code>value</code> tells the input what to display. Here, we’re passing the value from the corresponding state variable.</li>\n  <li><code>onChange</code> is a function, and gets called when the user changes the input. It receives the event (commonly called <code>e</code> or <code>event</code>, but you can name it anything), and we take the input’s current value (<code>e.target.value</code>) and save it into state.</li>\n</ul>\n\n<p>Notice how <em>manual</em> this is. With every keypress, our <code>onChange</code> gets called, and we explicitly <code>setWhatever</code>, which re-renders the whole ContactForm with the new value.</p>\n\n<p>This means that with every keypress, the component will re-render the whole form.</p>\n\n<p>For small forms this is fine. Really, it’s fine. Renders are fast. Rendering 3 or 5 or 10 inputs with every keypress is not going to perceptibly slow down the app.</p>\n\n<p>If you have a form with tons of inputs though, this re-rendering might start to matter, especially on slower devices. At this point you might need to look into optimizations, in order to limit the re-renders to <em>only</em> the inputs that changed.</p>\n\n<p>Or, consider how you could streamline the form so there are fewer inputs shown at once. If React isn’t happy about re-rendering 100 inputs on every keypress, I’d imagine your users aren’t very happy with seeing 100 inputs on a page either 😂</p>\n\n<p>Alternatively…</p>\n\n<h3 id=\"uncontrolled-inputs\">Uncontrolled Inputs</h3>\n\n<p>If you do nothing beyond dropping an <code>&lt;input&gt;</code> in your render function, that input will be <em>uncontrolled</em>. You tell React to render the input, and the browser does the rest.</p>\n\n<p>Uncontrolled inputs manage their own value. Just like with a plain HTML form, the value is kept in the input’s DOM node. No need to manually track it.</p>\n\n<p>In the first code sample on this page, all the inputs were uncontrolled, because we weren’t passing the <code>value</code> prop that would tell them what value to display.</p>\n\n<p>But if we’re not actively tracking the value… how can we tell what the value is?</p>\n\n<p>Here’s where “refs” come in.</p>\n\n<h3 id=\"what-is-a-ref\">What is a “ref”?</h3>\n\n<p>React takes your JSX and constructs the actual DOM, which the browser displays. Refs tie these two representations together, letting your React component get access to the DOM nodes that represent it.</p>\n\n<p>A <strong>ref</strong> holds a <strong>ref</strong>erence to a DOM node.</p>\n\n<p>Here’s why that matters: The JSX you write is merely a description of the page you want to create. What you really need is the underlying DOM <code>input</code>, so that you can pull out the value.</p>\n\n<p>So, to get the value from an uncontrolled input, you need a reference to it, which we get by assigning a <code>ref</code> prop. Then you can read out the value when the form is submitted (or really, whenever you want!).</p>\n\n<p>Let’s add refs to our contact form inputs, building upon the <a href=\"#plain-form\">“bare form”</a> example from earlier:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">ContactForm</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">nameRef</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useRef</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">emailRef</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useRef</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">messageRef</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useRef</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">form</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Name</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"text\"</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">ref</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">nameRef</span><span style=\"color: #FFE78F\">}</span>\n</span><span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">ref</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">emailRef</span><span style=\"color: #FFE78F\">}</span>\n</span><span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"message\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Message</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">textarea</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"message\"</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">ref</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">messageRef</span><span style=\"color: #FFE78F\">}</span>\n</span><span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"submit\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Submit</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">form</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>We did a couple things here:</p>\n\n<ul>\n  <li>created 3 refs with the <code>useRef</code> hook</li>\n  <li>bound the refs to the inputs with the <code>ref</code> prop</li>\n</ul>\n\n<p>When the component is first rendered, React will set up the refs. <code>nameRef.current</code> will then <a href=\"/javascript-references/\">refer to</a> the <code>name</code> input’s DOM node, <code>emailRef.current</code> will refer to the email input, and so on.</p>\n\n<p>These refs hold the same values as the ones you’d get if you ran a <code>document.querySelector(&#39;input[id=name]&#39;)</code> in your browser console. It’s the browser’s raw input node; React is just passing it back to you.</p>\n\n<p>The last piece of the puzzle is how to get the values out of the inputs.</p>\n\n<p>Uncontrolled inputs are the best choice when you only need to do something with the value at a specific time, such as when the form is submitted. (If you need to inspect/validate/transform the value on every keypress, use a <a href=\"#controlled-inputs\">controlled input</a>)</p>\n\n<p>We can create a function to handle form submission, and print out the values:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">ContactForm</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">nameRef</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useRef</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">emailRef</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useRef</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">messageRef</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">useRef</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">handleSubmit</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">event</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">event</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">preventDefault</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;name:&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">nameRef</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">current</span><span style=\"color: #D1D5DE\">.value</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;email:&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">emailRef</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">current</span><span style=\"color: #D1D5DE\">.value</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;message:&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">messageRef</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">current</span><span style=\"color: #D1D5DE\">.value</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span>\n</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">form</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">onSubmit</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">handleSubmit</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n</span><span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Name</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"text\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">ref</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">nameRef</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">ref</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">emailRef</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"message\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Message</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">textarea</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"message\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">ref</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">messageRef</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"submit\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Submit</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">form</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>Your <code>handleSubmit</code> function can then do whatever you need with those values: validate them, asynchronously POST them to a server, etc.</p>\n\n<p>Notice we’re calling <code>event.preventDefault()</code> at the top. Without this, submitting the form would refresh the page.</p>\n\n<h2 id=\"controlled-vs-uncontrolled-which-to-use\">Controlled vs. Uncontrolled: Which to Use?</h2>\n\n<p>Let’t go over some pros and cons of each style of input so you can decide which you want to use.</p>\n\n<p>(You might’ve heard that controlled inputs are a “best practice” which of course would imply uncontrolled inputs are NOT! 😱 I’ll address this near the end.)</p>\n\n<h2 id=\"when-and-why-to-use-controlled-inputs\">When and Why to Use Controlled Inputs</h2>\n\n<p>Of the two styles, controlled inputs are the more “React-y way” of doing things, where UI reflects state. By changing the state, you change the UI. If you don’t change the state, the UI stays the same. You don’t meddle with the underlying input in an imperative, mutable way.</p>\n\n<p>This makes controlled inputs perfect for things like:</p>\n\n<ul>\n  <li>Instantly validating the form on every keypress: useful if you want to keep the Submit button disabled until everything is valid, for instance.</li>\n  <li>Handling formatted input, like a credit card number field, or preventing certain characters from being typed.</li>\n  <li>Keeping multiple inputs in sync with each other when they’re based on the same data</li>\n</ul>\n\n<p>The buck stops with you, dear developer. Want to ignore some weird character the user typed? Easy, just strip it out.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">EmailField</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">email</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setEmail</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">handleChange</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FDAC45\">e</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #6E778C\">// no exclamations allowed!</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #AFF19F\">setEmail</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">target</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">value</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">replace</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">/!/</span><span style=\"color: #FF8383\">g</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;&apos;</span><span style=\"color: #9CA5B7\">))</span><span style=\"color: #C9CDD7\">;</span>\n</span><span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email address</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #AFF19F\">value</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">email</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #AFF19F\">onChange</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">handleChange</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>There are plenty of use cases where you <em>want</em> to react to every keypress and handle it somehow. Controlled inputs are good for that.</p>\n\n<p>But there are some downsides.</p>\n\n<h2 id=\"controlled-inputs-are-more-complex\">Controlled Inputs are More Complex</h2>\n\n<p>As we’ve already seen, you have to manually manage the value of the input, which means you need (a) state to hold it and (b) a change handler function, and you need those for every input.</p>\n\n<p>You can work around part of this problem by combining the inputs into one state object:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">MultipleInputs</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">values</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setValues</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">({</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    email</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;&apos;</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    name</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;&apos;</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span>\n</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">handleChange</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FDAC45\">e</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #AFF19F\">setValues</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">oldValues</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">({</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      </span><span style=\"color: #93DDFD\">...</span><span style=\"color: #D1D5DE\">oldValues,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      </span><span style=\"color: #D1D5DE\">[</span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">target</span><span style=\"color: #D1D5DE\">.name]:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">target</span><span style=\"color: #D1D5DE\">.value</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #9CA5B7\">}))</span><span style=\"color: #C9CDD7\">;</span>\n</span><span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email address</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">value</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">values</span><span style=\"color: #D1D5DE\">.email</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">onChange</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">handleChange</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Full Name</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">value</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">values</span><span style=\"color: #D1D5DE\">.name</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">onChange</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">handleChange</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>It’s nicer, but it’s still code you need to write.</p>\n\n<p>Boilerplate like this is one of the reasons React form libraries are so popular – but again, if you have 2 or 3 inputs on a page, I would argue that saving a few lines of tedium is not worth adding a form library.</p>\n\n<h2 id=\"controlled-inputs-re-render-on-every-keypress\">Controlled Inputs Re-render on Every Keypress</h2>\n\n<p>Every time you press a key, React calls the function in the<code>onChange</code> prop, which sets the state. Setting the state causes the component <em>and its children</em> to re-render (unless they’re already optimized with <code>React.memo</code> or <code>PureComponent</code>).</p>\n\n<p>This is mostly fine. Renders are fast. For small-to-medium forms you probably won’t even notice. And it’s not that rendering a piddly little <code>input</code> is slow… but it can be a problem in aggregate.</p>\n\n<p>As the number of inputs grows – or if your form has child components that are expensive to render – keypresses might start to feel perceptibly laggy. This threshold is even lower on mobile devices.</p>\n\n<p>It can become a problem of death-by-a-thousand-cuts.</p>\n\n<p>If you start to suspect this problem in your app, fire up the Profiler in the <a href=\"https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi\">React Developer Tools</a> and take a measurement while you bash on some keys. It’ll tell you which components are slowing things down.</p>\n\n<h2 id=\"uncontrolled-inputs-dont-re-render\">Uncontrolled Inputs Don’t Re-render</h2>\n\n<p>A big point in favor of using uncontrolled inputs is that the browser takes care of the whole thing.</p>\n\n<p>You don’t need to update state, which means you don’t need to re-render. Every keypress bypasses React and goes straight to the browser.</p>\n\n<p>Typing the letter <code>&#39;a&#39;</code> into a form with 300 inputs will re-render exactly zero times, which means React can pretty much sit back and do nothing. Doing nothing is very performant.</p>\n\n<h2 id=\"uncontrolled-inputs-can-have-even-less-boilerplate\">Uncontrolled Inputs Can Have Even Less Boilerplate!</h2>\n\n<p>Earlier we looked at how to create references to inputs using <code>useRef</code> and pass them as the <code>ref</code> prop.</p>\n\n<p>You can actually go a step further and remove the refs entirely, by taking advantage of the fact that a <code>form</code> knows about its own inputs.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">NoRefsForm</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">handleSubmit</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FDAC45\">e</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">preventDefault</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.target</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;email&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #D1D5DE\">.email,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">elements</span><span style=\"color: #D1D5DE\">.email</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;name&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #D1D5DE\">.name,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">elements</span><span style=\"color: #D1D5DE\">.name</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">form</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">onSubmit</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">handleSubmit</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email address</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Full Name</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"name\"</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"submit\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Submit</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">form</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>The inputs are properties on the <code>form</code> itself, named by their <code>id</code> AND their <code>name</code>. Yep, both.</p>\n\n<p>They’re also available at <code>form.elements</code>. Check it out:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">App</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">handleSubmit</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">e</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">preventDefault</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">e</span><span style=\"color: #D1D5DE\">.target</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #93DDFD\">console</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">log</span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #D1D5DE\">.email,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">elements</span><span style=\"color: #D1D5DE\">.email,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #D1D5DE\">.userEmail,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #93DDFD\">form</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">elements</span><span style=\"color: #D1D5DE\">.userEmail</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">form</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">onSubmit</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">handleSubmit</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"userEmail\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email address</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"userEmail\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"submit\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Submit</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">form</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>This prints the same input 4 times:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">&lt;input id=\"userEmail\" name=\"email\"&gt;&lt;/input&gt;\n&lt;input id=\"userEmail\" name=\"email\"&gt;&lt;/input&gt;\n&lt;input id=\"userEmail\" name=\"email\"&gt;&lt;/input&gt;\n&lt;input id=\"userEmail\" name=\"email\"&gt;&lt;/input&gt;\n</span></code></pre>\n</div>\n<p>So we can leave off the redundant <code>name</code> prop from the input, if we don’t need it for anything else.</p>\n\n<p>(we need to keep the <code>id</code> because the label’s <code>htmlFor</code> refers to that)</p>\n\n<p>The <code>form.elements</code> array is useful if you need to loop over every input, like if you have a bunch of dynamically-generated ones or something.</p>\n\n<h2 id=\"accessible-form-labels\">Accessible Form Labels</h2>\n\n<p>Every input should have a label. Label-less inputs make trouble for screenreaders, which makes trouble for humans… and placeholder text unfortunately doesn’t cut it.</p>\n\n<p>The two ways to do labels are:</p>\n\n<h3 id=\"label-next-to-input-2-sibling-elements\">Label Next To Input (2 sibling elements)</h3>\n\n<p>Give the input an <code>id</code> and the label an <code>htmlFor</code> that matches, and put the elements side-by-side. Order doesn’t matter, as long as the identifiers match up.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"wat\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email address</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"wat\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #8AD2F0\">/&gt;</span></code></pre>\n</div><h3 id=\"input-inside-label\">Input Inside Label</h3>\n\n<p>If you wrap the <code>input</code> in a <code>label</code>, you don’t need the <code>id</code> and the <code>htmlFor</code>. You’ll want a way to refer to the input though, so give it an <code>id</code> or a <code>name</code>.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  Email Address</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">type</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span></code></pre>\n</div><p>If you need more control over the style of the text, you can wrap it in a <code>span</code>.</p>\n\n<h3 id=\"visually-hidden-but-still-accessible\">Visually Hidden, But Still Accessible</h3>\n\n<p>You can hide the label with CSS if you need to.</p>\n\n<p>Most of the big CSS frameworks have a screenreader-only class, often <code>sr-only</code>, that will hide the label in a way that screenreaders will still be able to read it. Here’s a <a href=\"https://gist.github.com/ffoodd/000b59f431e3e64e4ce1a24d5bb36034\">generic sr-only implementation</a>.</p>\n\n<p>One nice thing about labels is, once you have them associated correctly, the browser will translate clicks on the label as clicks on the input. This is most noticeable with radio buttons – when the label is set up right, clicking the text will select the radio, but otherwise, it’ll frustratingly ignore you.</p>\n\n<p>For more specifics see Lindsey’s post <a href=\"https://www.a11ywithlindsey.com/blog/introduction-accessible-labeling\">An Introduction to Accessible Labeling</a></p>\n\n<h2 id=\"reduce-form-boilerplate-with-small-components\">Reduce Form Boilerplate With Small Components</h2>\n\n<p>So you’ve added your labels, but these inputs are getting longer and more repetitive…</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Email Address</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"email\"</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span></code></pre>\n</div>\n<p>You can easily move this to a component, though!</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">Input</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #C9CDD7\">{ </span><span style=\"color: #FDAC45\">name</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FDAC45\">label</span><span style=\"color: #C9CDD7\"> }</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">label</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">htmlFor</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">name</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">label</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">label</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">input</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">name</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">name</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">id</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">name</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  );</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>Now every input is simple again.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">&lt;Input name=\"email\" label=\"Email Address\"/&gt;\n</span></code></pre>\n</div>\n<p>And if you’re using uncontrolled inputs, you can still use the trick of reading the values off the form, no refs or state required.</p>\n\n<h3 id=\"is-it-a-best-practice-to-use-controlled-inputs\">Is It a Best Practice to Use Controlled Inputs?</h3>\n\n<p>As of this writing, the React <a href=\"https://reactjs.org/docs/uncontrolled-components.html\">docs</a> have a recommendation about inputs:</p>\n\n<blockquote>\n  <p>In most cases, we recommend using controlled components to implement forms. In a controlled component, form data is handled by a React component. The alternative is uncontrolled components, where form data is handled by the DOM itself.</p>\n</blockquote>\n\n<p>They go on to say that uncontrolled inputs are the easy way out:</p>\n\n<blockquote>\n  <p>It can also be slightly less code if you want to be quick and dirty. Otherwise, you should usually use controlled components.</p>\n</blockquote>\n\n<p>The docs don’t exactly explain their reasoning, but my hunch is their recommendation stems from the fact that controlled inputs closely follow the state-driven approach, which is React’s whole reason for existing. Uncontrolled inputs are then treated as an “escape hatch” for when the state-driven approach won’t work for whatever reason.</p>\n\n<p>I agreed with this line of thinking for a while, but I’m starting to have second thoughts.</p>\n\n<p>I’m coming around to the idea that uncontrolled inputs might actually be the better default.</p>\n\n<p>So this might get me some flak, but I’m going to say it anyway:</p>\n\n<p>If uncontrolled inputs work for your case, use ‘em! They’re easier, and faster.</p>\n\n<p>I don’t think I’m alone in this. The popular <a href=\"https://react-hook-form.com\">react-hook-form</a> library uses uncontrolled inputs under the hood to make things fast. And I’ve seen some React thought leaders questioning why we don’t use uncontrolled inputs more often, too. Maybe it’s time to give it some thought!</p>\n\n<h3 id=\"are-uncontrolled-inputs-an-antipattern\">Are Uncontrolled Inputs an Antipattern?</h3>\n\n<p>Uncontrolled inputs are a feature like any other, and they come with some tradeoffs (which we covered above), but they’re not an antipattern.</p>\n\n<p>I tend to reserve the word “antipattern” for techniques that will come back to bite you later on. React has antipatterns like</p>\n\n<ul>\n  <li>mutating state instead of <a href=\"/react-redux-immutability-guide/\">using immutability</a></li>\n  <li>duplicating values from props into state, and trying to keep them in sync</li>\n  <li>performing side effects in the body of a component function, instead of in a <a href=\"/useeffect-hook-examples/\">useEffect hook</a></li>\n</ul>\n\n<p>These are things that <em>sometimes</em> appear to work just fine, but are ultimately the wrong way to do it, and will cause bugs down the road.</p>\n\n<p>Uncontrolled inputs are a bit unconventional today, but using them is not “doing it wrong”. It’s a matter of picking the right tool for the job. If you go in knowing their limitations, and knowing your use case, then you can be pretty confident in your choice.</p>\n\n<h2 id=\"go-make-forms\">Go Make Forms!</h2>\n\n<p>I hope this overview of forms in React was helpful! There’s lots more I could cover but honestly this was too long already 😅 If you want to see more on forms, let me know in the comments.</p>\n\n\n    <p><a href=\"https://daveceddia.com/react-forms/\">Using Forms in React</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on May 12, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-05-12T17:05:03.000Z",
    "url": "https://daveceddia.com/react-forms/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "ESLint + VSCode: How to Format Your Code Using .eslintrc",
    "partialText": "<p>I’ve gotten very used to having VSCode autoformat my file when I save. Usually, I use Prettier. But I joined a project that uses ESLint to manage its code style, and I wanted to match the team’s formatting.</p>\n\n<p>I wanted that sweet auto-formatting on save, but using the <code>eslintrc.json</code> file in the project’s root dir instead of Prettier.</p>\n\n<p>Most blog posts wanted to make an entire tutorial out of this… how to set up eslint, how to create the .eslintrc file, etc etc… but I didn’t need that. I have an existing project, I just want to configure VSCode to use ESLint instead of Prettier.</p>\n\n<p>This turned out to only need 4 lines of settings config and a plugin.</p>\n\n<p>Here’s how to do it:</p>\n\n<h2 id=\"1-install-vscode-eslint-plugin\">1. Install VSCode ESLint Plugin</h2>\n\n<p>In VSCode, open the extension browser with the button on the left. On the Mac, the keyboard shortcut Cmd+Shift+X should do the same.</p>\n\n<p>Search for <code>eslint</code></p>\n\n<p>Install the top result, called “ESLint”. (It’s <a href=\"https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint\">this one</a> with over 10 million downloads)</p>\n\n<h2 id=\"2-configure-vscode-settings-to-use-eslint-for-formatting\">2. Configure VSCode Settings to use ESLint for Formatting</h2>\n\n<p>Open up VSCode’s settings. On a Mac, press <code>Cmd+,</code> or get there through the menus: Code &gt; Preferences &gt; Settings.</p>\n\n<p>It’ll open the fancy settings editor, but we need the raw JSON settings file instead.</p>\n\n<p>Click that tiny icon in the top-right that looks like a piece of paper with a little arrow.</p>\n\n<p><img class=\"rounded-sm shadow-sm\" src=\"https://daveceddia.com/images/vscode-eslint-settings.png\" srcset=\"https://daveceddia.com/images/vscode-eslint-settings@2x.png 2x\" alt=\"Open the Raw Settings in VSCode\" /></p>\n\n<p>Add these 4 new lines inside the top-level settings object:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// ...</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"eslint.format.enable\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">true</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"editor.codeActionsOnSave\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> {</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"source.fixAll.eslint\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">true</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  }</span>\n</span><span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<p>The first one turns on ESLint for formatting, and the next 3 make it do the formatting when you hit save.</p>\n\n<p>That should do it! Save the settings file and close it, we’re done.</p>\n\n<p>Try making some changes to a file that violate some ESLint rule – maybe leaving off a semicolon if they’re required? – and pressing Save. It should auto-format.</p>\n\n<h2 id=\"is-the-formatting-still-using-prettier\">Is the formatting still using Prettier?</h2>\n\n<p>I ran into a problem recently where Prettier settings were overriding the eslint settings. I’m honestly not sure how these got in there… maybe I put them in and forgot.</p>\n\n<p>In any case, if you want ESLint to indent your files, make sure Prettier isn’t overriding it. Look for any lines like this, that say the <code>defaultFormatter</code> should be Prettier (Cmd+F or Ctrl+F for “prettier” because there might be a few!), and comment them out:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// \"[javascriptreact]\": {</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">//   \"editor.defaultFormatter\": \"esbenp.prettier-vscode\"</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// },</span></code></pre>\n</div>\n<p>You might need to undo this if you switch back to a project that doesn’t use ES Lint.</p>\n\n<p>You can also <a href=\"https://dev.to/jsjoeio/how-to-create-code-profiles-in-vscode-3ofo\">create multiple VSCode profiles</a> if you often work in projects with different requirements.</p>\n\n    <p><a href=\"https://daveceddia.com/vscode-use-eslintrc/\">ESLint + VSCode: How to Format Your Code Using .eslintrc</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on April 07, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-04-07T14:30:31.000Z",
    "url": "https://daveceddia.com/vscode-use-eslintrc/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "How to Read React Errors (fix 'Cannot read property of undefined'!)",
    "partialText": "<p>Got an error like this in your React component?</p>\n\n<blockquote>\n  <p>Cannot read property `map` of undefined</p>\n</blockquote>\n\n<p>In this post we’ll talk about how to fix this one specifically, and along the way you’ll learn how to approach fixing errors in general.</p>\n\n<p>We’ll cover how to read a stack trace, how to interpret the text of the error, and ultimately how to fix it.</p>\n\n<h2 id=\"the-quick-fix\">The Quick Fix</h2>\n\n<p>This error usually means you’re trying to use <code>.map</code> on an array, but that array isn’t defined yet.</p>\n\n<p>That’s often because the array is a piece of <a href=\"/watch-out-for-undefined-state/\">undefined state</a> or an undefined prop.</p>\n\n<p>Make sure to initialize the state properly. That means if it will <em>eventually</em> be an array, use <code>useState([])</code> instead of something like <code>useState()</code> or <code>useState(null)</code>.</p>\n\n<p>Let’s look at how we can interpret an error message and track down where it happened and why.</p>\n\n<h2 id=\"how-to-find-the-error\">How to Find the Error</h2>\n\n<p>First order of business is to figure out <em>where</em> the error is.</p>\n\n<p>If you’re using Create React App, it probably threw up a screen like this:</p>\n\n<div style=\"position: relative; display: inline-flex; flex-direction: column; height: 100%; width: 1024px; max-width: 100%; overflow: hidden auto; padding: 0.5rem; box-sizing: border-box; text-align: left; font-family: Consolas, Menlo, monospace; font-size: 11px; white-space: pre-wrap; word-break: break-word; line-height: 1.5; color: rgb(41, 50, 56);border: 1px solid #e8b7b7; border-radius: 3px; box-shadow: 0 1px 3px #86030352; margin-bottom: 2.5rem;\">\n<div style=\"font-size: 2em; font-family: Roboto, sans-serif; color: rgb(206, 17, 38); white-space: pre-wrap; margin: 0px 2rem 0.5rem 0px; flex: 0 0 auto; max-height: 50%; overflow: auto; font-weight: 400;\">TypeError</div>\n<div style=\"font-size: 1.5em; font-family: Consolas, Menlo, monospace; color: black; white-space: pre-wrap; margin: 0px; flex: 0 0 auto; max-height: 50%; overflow: auto; font-weight: 300; padding-bottom: 1rem; border-bottom: 1px solid rgb(221, 221, 221);\">Cannot read property 'map' of undefined</div>\n<div><div style=\"\">App</div><div style=\"font-size: 0.9em; margin-bottom: 0.9em;\"><a style=\"text-decoration: none; color: rgb(135, 142, 145); cursor: pointer;\" tabindex=\"0\">/src/App.js:9:13</a></div><pre style=\"display: block; padding: 0.5em; margin-top: 0.5em; margin-bottom: 0.5em; overflow-x: auto; white-space: pre-wrap; border-radius: 0.25rem; background-color: rgba(206, 17, 38, 0.05); cursor: pointer;\"><code style=\"font-family: Consolas, Menlo, monospace;\"><span data-ansi-line=\"true\"><span></span><span> </span><span style=\"color: #333333;\">  6 | </span><span></span><span style=\"color: #c80000;\">return</span><span> (</span></span><br /><span data-ansi-line=\"true\"><span> </span><span style=\"color: #333333;\">  7 | </span><span>  </span><span style=\"color: #881280;\">&lt;</span><span></span><span style=\"color: #881280;\">div</span><span> className</span><span style=\"color: #881280;\">=</span><span></span><span style=\"color: #1155cc;\">\"App\"</span><span></span><span style=\"color: #881280;\">&gt;</span><span></span></span><br /><span data-ansi-line=\"true\"><span> </span><span style=\"color: #333333;\">  8 | </span><span>    </span><span style=\"color: #881280;\">&lt;</span><span></span><span style=\"color: #881280;\">h1</span><span></span><span style=\"color: #881280;\">&gt;</span><span></span><span style=\"color: #881280;\">List</span><span> of </span><span style=\"color: #881280;\">Items</span><span></span><span style=\"color: #881280;\">&lt;</span><span></span><span style=\"color: #881280;\">/</span><span></span><span style=\"color: #881280;\">h1</span><span></span><span style=\"color: #881280;\">&gt;</span><span></span></span><br /><span data-ansi-line=\"true\" style=\"background-color: rgb(252, 207, 207);\"><span></span><span style=\"color: #881280;\"></span><span style=\"color: #881280;\">&gt;</span><span style=\"color: #881280;\"></span><span></span><span style=\"color: #333333;\">  9 | </span><span>    {items</span><span style=\"color: #881280;\">.</span><span>map((item) </span><span style=\"color: #881280;\">=&gt;</span><span> (</span></span><br /><span data-ansi-line=\"true\"><span> </span><span style=\"color: #333333;\">    | </span><span>          </span><span style=\"color: #881280;\"></span><span style=\"color: #881280;\">^</span><span style=\"color: #881280;\"></span><span></span></span><br /><span data-ansi-line=\"true\"><span> </span><span style=\"color: #333333;\"> 10 | </span><span>      </span><span style=\"color: #881280;\">&lt;</span><span></span><span style=\"color: #881280;\">div</span><span> key</span><span style=\"color: #881280;\">=</span><span>{item</span><span style=\"color: #881280;\">.</span><span>id}</span><span style=\"color: #881280;\">&gt;</span><span></span></span><br /><span data-ansi-line=\"true\"><span> </span><span style=\"color: #333333;\"> 11 | </span><span>        {item</span><span style=\"color: #881280;\">.</span><span>name}</span></span><br /><span data-ansi-line=\"true\"><span> </span><span style=\"color: #333333;\"> 12 | </span><span>      </span><span style=\"color: #881280;\">&lt;</span><span></span><span style=\"color: #881280;\">/</span><span></span><span style=\"color: #881280;\">div</span><span></span><span style=\"color: #881280;\">&gt;</span><span></span><span></span></span></code></pre></div>\n</div>\n\n<p>Look for the <strong>file</strong> and the <strong>line number</strong> first.</p>\n\n<p>Here, that’s <strong>/src/App.js</strong> and line <strong>9</strong>, taken from the light gray text above the code block.</p>\n\n<p>btw, when you see something like <code>/src/App.js:9:13</code>, the way to decode that is <strong>filename</strong>:<strong>lineNumber</strong>:<strong>columnNumber</strong>.</p>\n\n<h2 id=\"how-to-read-the-stack-trace\">How to Read the Stack Trace</h2>\n\n<p>If you’re looking at the browser console instead, you’ll need to read the stack trace to figure out where the error was.</p>\n\n<p>These always look long and intimidating, but the trick is that usually you can ignore most of it!</p>\n\n<p>The lines are in order of execution, with the most recent first.</p>\n\n<p>Here’s the stack trace for this error, with the only important lines highlighted:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki added\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"console\"><code><span class=\"add\"><span style=\"color: #C9CDD7\">TypeError: Cannot </span><span style=\"color: #AFF19F\">read</span><span style=\"color: #C9CDD7\"> property </span><span style=\"color: #F5D66B\">&apos;map&apos;</span><span style=\"color: #C9CDD7\"> of undefined</span>\n</span><span class=\"add\"><span style=\"color: #C9CDD7\">    at App (App.js:9)</span>\n</span><span style=\"color: #C9CDD7\">    at renderWithHooks (react-dom.development.js:10021)</span>\n<span style=\"color: #C9CDD7\">    at mountIndeterminateComponent (react-dom.development.js:12143)</span>\n<span style=\"color: #C9CDD7\">    at beginWork (react-dom.development.js:12942)</span>\n<span style=\"color: #C9CDD7\">    at HTMLUnknownElement.callCallback (react-dom.development.js:2746)</span>\n<span style=\"color: #C9CDD7\">    at Object.invokeGuardedCallbackDev (react-dom.development.js:2770)</span>\n<span style=\"color: #C9CDD7\">    at invokeGuardedCallback (react-dom.development.js:2804)</span>\n<span style=\"color: #C9CDD7\">    at beginWork</span><span style=\"color: #D1D5DE\">$1</span><span style=\"color: #C9CDD7\"> (react-dom.development.js:16114)</span>\n<span style=\"color: #C9CDD7\">    at performUnitOfWork (react-dom.development.js:15339)</span>\n<span style=\"color: #C9CDD7\">    at workLoopSync (react-dom.development.js:15293)</span>\n<span style=\"color: #C9CDD7\">    at renderRootSync (react-dom.development.js:15268)</span>\n<span style=\"color: #C9CDD7\">    at performSyncWorkOnRoot (react-dom.development.js:15008)</span>\n<span style=\"color: #C9CDD7\">    at scheduleUpdateOnFiber (react-dom.development.js:14770)</span>\n<span style=\"color: #C9CDD7\">    at updateContainer (react-dom.development.js:17211)</span>\n<span style=\"color: #C9CDD7\">    at </span><span style=\"color: #AFF19F\">eval</span><span style=\"color: #C9CDD7\"> (react-dom.development.js:17610)</span>\n<span style=\"color: #C9CDD7\">    at unbatchedUpdates (react-dom.development.js:15104)</span>\n<span style=\"color: #C9CDD7\">    at legacyRenderSubtreeIntoContainer (react-dom.development.js:17609)</span>\n<span style=\"color: #C9CDD7\">    at Object.render (react-dom.development.js:17672)</span>\n<span style=\"color: #C9CDD7\">    at evaluate (index.js:7)</span>\n<span style=\"color: #C9CDD7\">    at z (eval.js:42)</span>\n<span style=\"color: #C9CDD7\">    at G.evaluate (transpiled-module.js:692)</span>\n<span style=\"color: #C9CDD7\">    at be.evaluateTranspiledModule (manager.js:286)</span>\n<span style=\"color: #C9CDD7\">    at be.evaluateModule (manager.js:257)</span>\n<span style=\"color: #C9CDD7\">    at compile.ts:717</span>\n<span style=\"color: #C9CDD7\">    at l (runtime.js:45)</span>\n<span style=\"color: #C9CDD7\">    at Generator._invoke (runtime.js:274)</span>\n<span style=\"color: #C9CDD7\">    at Generator.forEach.e.</span><span style=\"color: #93DDFD\">&lt;</span><span style=\"color: #C9CDD7\">computed</span><span style=\"color: #93DDFD\">&gt;</span><span style=\"color: #C9CDD7\"> [as next] (runtime.js:97)</span>\n<span style=\"color: #C9CDD7\">    at t (asyncToGenerator.js:3)</span>\n<span style=\"color: #C9CDD7\">    at i (asyncToGenerator.js:25)</span></code></pre>\n</div>\n<p>I wasn’t kidding when I said you could ignore most of it! The first 2 lines are all we care about here.</p>\n\n<p>The first line is the error message, and every line after that spells out the unwound stack of function calls that led to it.</p>\n\n<p>Let’s decode a couple of these lines:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">at App (App.js:9)\n</span></code></pre>\n</div>\n<p>Here we have:</p>\n\n<ul>\n  <li><code>App</code> is the name of our component function</li>\n  <li><code>App.js</code> is the file where it appears</li>\n  <li><code>9</code> is the line of that file where the error occurred</li>\n</ul>\n\n<p>Let’s look at another one:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">at performSyncWorkOnRoot (react-dom.development.js:15008)\n</span></code></pre>\n</div>\n<ul>\n  <li><code>performSyncWorkOnRoot</code> is the name of the function where this happened</li>\n  <li><code>react-dom.development.js</code> is the file</li>\n  <li><code>15008</code> is the line number (it’s a big file!)</li>\n</ul>\n\n<h2 id=\"ignore-files-that-arent-yours\">Ignore Files That Aren’t Yours</h2>\n\n<p>I already mentioned this but I wanted to state it explictly: when you’re looking at a stack trace, you can <em>almost always</em> ignore any lines that refer to files that are outside your codebase, like ones from a library.</p>\n\n<p>Usually, that means you’ll pay attention to only the first few lines.</p>\n\n<p>Scan down the list until it starts to veer into file names you don’t recognize.</p>\n\n<p>There are some cases where you <em>do</em> care about the full stack, but they’re few and far between, in my experience. Things like… if you suspect a bug in the library you’re using, or if you think some erroneous input is making its way into library code and blowing up.</p>\n\n<p>The vast majority of the time, though, the bug will be in your own code ;)</p>\n\n<h2 id=\"follow-the-clues-how-to-diagnose-the-error\">Follow the Clues: How to Diagnose the Error</h2>\n\n<p>So the stack trace told us where to look: line <strong>9</strong> of <strong>App.js</strong>. Let’s open that up.</p>\n\n<p>Here’s the full text of that file:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"./styles.css\"</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #FF8383\">export</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">default</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">App</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">let</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">items</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">className</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"App\"</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">h1</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">List of Items</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">h1</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">items</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">map</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">item</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">key</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">item</span><span style=\"color: #D1D5DE\">.id</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">item</span><span style=\"color: #D1D5DE\">.name</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #9CA5B7\">))</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>Line 9 is this one:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">      {items.map(item =&gt; (\n</span></code></pre>\n</div>\n<p>And just for reference, here’s that error message again:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"undefined\"><code><span style=\"color: undefined\">TypeError: Cannot read property &apos;map&apos; of undefined\n</span></code></pre>\n</div>\n<p>Let’s break this down!</p>\n\n<ul>\n  <li><code>TypeError</code> is the kind of error</li>\n</ul>\n\n<p>There are a <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error\">handful of built-in error types</a>. MDN says TypeError “represents an error that occurs when a variable or parameter is not of a valid type.” (this part is, IMO, the least useful part of the error message)</p>\n\n<ul>\n  <li><code>Cannot read property</code> means the code was <em>trying to read a property</em>.</li>\n</ul>\n\n<p>This is a good clue! There are only a few ways to read properties in JavaScript.</p>\n\n<p>The most common is probably the <code>.</code> operator.</p>\n\n<p>As in <code>user.name</code>, to access the <code>name</code> property of the <code>user</code> object.</p>\n\n<p>Or <code>items.map</code>, to access the <code>map</code> property of the <code>items</code> object.</p>\n\n<p>There’s also brackets (aka square brackets, <code>[]</code>) for accessing items in an array, like <code>items[5]</code> or <code>items[&#39;map&#39;]</code>.</p>\n\n<p>You might wonder why the error isn’t more specific, like “Cannot read <em>function</em> `map` of undefined” – but remember, the JS interpreter has no idea what we meant that type to be. It doesn’t know it was supposed to be an array, or that <code>map</code> is a function. It didn’t get that far, because <code>items</code> is undefined.</p>\n\n<ul>\n  <li><code>&#39;map&#39;</code> is the property the code was trying to read</li>\n</ul>\n\n<p>This one is another great clue. Combined with the previous bit, you can be pretty sure you should be looking for <code>.map</code> somewhere on this line.</p>\n\n<ul>\n  <li><code>of undefined</code> is a clue about the value of the variable</li>\n</ul>\n\n<p>It would be way more useful if the error could say “Cannot read property `map` of items”. Sadly it doesn’t say that. It tells you the <em>value</em> of that variable instead.</p>\n\n<p>So now you can piece this all together:</p>\n\n<ul>\n  <li>find the line that the error occurred on (line 9, here)</li>\n  <li>scan that line looking for <code>.map</code></li>\n  <li>look at the variable/expression/whatever immediately before the <code>.map</code> and be very suspicious of it.</li>\n</ul>\n\n<p>Once you know <em>which variable</em> to look at, you can read through the function looking for where it comes from, and whether it’s initialized.</p>\n\n<p>In our little example, the only other occurrence of <code>items</code> is line 4:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">let</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">items</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p>This <em>defines</em> the variable but it doesn’t set it to anything, which means its value is <code>undefined</code>. There’s the problem. Fix that, and you fix the error!</p>\n\n<h2 id=\"fixing-this-in-the-real-world\">Fixing This in the Real World</h2>\n\n<p>Of course this example is tiny and contrived, with a simple mistake, and it’s colocated very close to the site of the error. These ones are the easiest to fix!</p>\n\n<p>There are a ton of potential causes for an error like this, though.</p>\n\n<p>Maybe <code>items</code> is a prop passed in from the parent component – and you forgot to pass it down.</p>\n\n<p>Or maybe you <em>did</em> pass that prop, but the value being passed in is actually undefined or null.</p>\n\n<p>If it’s a local state variable, maybe you’re initializing the state as undefined – <code>useState()</code>, written like that with no arguments, will do exactly this!</p>\n\n<p>If it’s a prop coming from Redux, maybe your <code>mapStateToProps</code> is missing the value, or has a typo.</p>\n\n<p>Whatever the case, though, the process is the same: start where the error is and work backwards, verifying your assumptions at each point the variable is used. Throw in some <code>console.log</code>s or use the debugger to inspect the intermediate values and figure out why it’s undefined.</p>\n\n<p>You’ll get it fixed! Good luck :)</p>\n\n\n    <p><a href=\"https://daveceddia.com/fix-react-errors/\">How to Read React Errors (fix 'Cannot read property of undefined'!)</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on April 01, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-04-01T05:02:15.000Z",
    "url": "https://daveceddia.com/fix-react-errors/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "React State Management Libraries and How to Choose",
    "partialText": "<p>The idea of <em>state</em> is one of the trickier things to nail down when you’re starting with React, and as your app grows, so do your state management needs.</p>\n\n<p>In this post I’ll give you the Grand Tour of state management options in React and help you decide which one to use in your project.</p>\n\n<h2 id=\"what-is-state\">What is State?</h2>\n\n<p>Just so we’re on the same page, let’s talk about <strong>state</strong> for a second.</p>\n\n<p>Every interactive app involves responding to events, like when the user clicks a button, and a sidebar closes. Or someone sends a message, and it appears in a chat window.</p>\n\n<p>As these events happen, and the app is updated to reflect them, we say the <em>state of the app</em> has changed. The app looks different than it did before, or it’s in a new mode behind the scenes.</p>\n\n<p>Things like, “whether the sidebar is open or closed” and “the messages in the chat box” are <em>pieces of state</em>. In programming terms, you’d probably have an <code>isSidebarOpen</code> variable somewhere in the app set to <code>true</code>, and a <code>chatMessages</code> array with the messages you’ve received.</p>\n\n<p>At any given moment, broadly speaking, the “state of your app” is determined by all of that data. All those individual variables, whether they’re stored in local component state or some third-party state management store – that’s your app’s state.</p>\n\n<p>This is the high-level concept of “app state”. We aren’t talking about React-specific stuff like <code>useState</code> or Context or Redux or anything yet.</p>\n\n<h2 id=\"what-is-state-management\">What is State Management?</h2>\n\n<p>All of those variables that decide what state your app is in have to be stored somewhere. So state management is a broad term that combines <em>how you store the state</em> and <em>how you change it</em>.</p>\n\n<p>React and its ecosystem offer lots of different ways to store and manage that state. And when I say lots I mean LOTS.</p>\n\n<h3 id=\"storing-the-data\">Storing the Data</h3>\n\n<p>For storage, you can…</p>\n\n<ul>\n  <li>keep those variables in local component state – whether that’s with hooks (<code>useState</code> or <code>useReducer</code>) or in classes (<code>this.state</code> and <code>this.setState</code>)</li>\n  <li>keep the data in a store, using a third-party library like Redux, MobX, Recoil, or Zustand</li>\n  <li>you can even keep them on the <code>window</code> object globally</li>\n</ul>\n\n<p>React doesn’t care an ounce where you put the data, but…</p>\n\n<h3 id=\"updating-the-data-and-re-rendering\">Updating the Data and Re-rendering</h3>\n\n<p>To make your app interactive, you need a way for React to know that something changed, and that it should re-render some (or all) components on the page.</p>\n\n<p>Because React, despite its name, is not “reactive” in the way some other frameworks are.</p>\n\n<p>Some frameworks “watch” for things, and update accordingly. Angular, Svelte, and Vue do this, among others.</p>\n\n<p>React doesn’t, though. It does not “watch for changes” and magically re-render. You (or something) needs to tell it to do that.</p>\n\n<ul>\n  <li>with <code>useState</code>, <code>useReducer</code>, or <code>this.setState</code> (classes), React will re-render when you call one of the setter functions</li>\n  <li>if you keep the data in Redux, MobX, Recoil, or some other store, then that store will tell React when something has changed, and trigger the re-render for you</li>\n  <li>if you opt to keep the data globally on <code>window</code>, you need to tell React to update after you change that data.</li>\n</ul>\n\n<p>Oh, and to be totally clear, I do not recommend keeping your state globally on <code>window</code>, for all the usual reasons that global data is to be avoided. Messy code, hard to reason about, etc etc. I only mention it to say that it’s possible, to make the point that React truly couldn’t care less where its data comes from :)</p>\n\n<h2 id=\"when-is-usestate-not-enough\">When is useState not enough?</h2>\n\n<p>The <a href=\"/usestate-hook-examples/\">useState hook</a> is perfect for small amounts of llocal component state. Each <code>useState</code> call can hold a single value, and while you <em>can</em> make that one value an object that contains a bunch of other values, it’s a better idea to split them up.</p>\n\n<p>Once you get past 3-5 <code>useState</code> calls in a single component, things are probably going to get hard to keep track of. <em>Especially</em> if those bits of state depend on each other. With complex interdependencies, a proper <a href=\"/react-confirmation-modal-state-machine/\">state machine</a> could be a better way to go.</p>\n\n<h2 id=\"next-up-usereducer\">Next up, useReducer</h2>\n\n<p>The next step “up” from useState is <code>useReducer</code>. The reducer function gives you one centralized place to intercept “actions” and update the state accordingly. A <code>useReducer</code> call, like <code>useState</code>, can only hold one value, but with a reducer it’s much more common for that single value to be an <em>object</em> containing multiple values. The <a href=\"/usereducer-hook-examples/\">useReducer hook</a> makes it easier to manage that object.</p>\n\n<h2 id=\"avoiding-prop-drilling-with-context\">Avoiding Prop Drilling with Context</h2>\n\n<p>Beyond <code>useState</code> and <code>useReducer</code>, the next pain point you’re likely to feel is <strong>prop drilling</strong>. This is when you have a component that holds some state, and then a child component 5 levels down needs access to it, and you have to drill that prop down through each level manually.</p>\n\n<p>The easiest solution here is the Context API. It’s built into React.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #6E778C\">// Step 1: create a context. do this outside of any components,</span>\n<span style=\"color: #6E778C\">// at the top level of a file, and export it.</span>\n<span style=\"color: #FF8383\">export</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">MyDataContext</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">React</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">createContext</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #6E778C\">// Step 2: In the component that holds the data, import that</span>\n<span style=\"color: #6E778C\">// context and use the Provider to pass the data down</span>\n<span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">TheComponentWithState</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">state</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setState</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;whatever&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #93DDFD\">MyDataContext.Provider</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">value</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">state</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      component&apos;s content goes here</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #93DDFD\">ComponentThatNeedsData</span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #93DDFD\">MyDataContext.Provider</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span>\n<span style=\"color: #9CA5B7\">}</span>\n\n<span style=\"color: #6E778C\">// Step 3: Anywhere in the subtree under the Provider, pull out</span>\n<span style=\"color: #6E778C\">// the `value` you passed in by using useContext</span>\n<span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">ComponentThatNeedsData</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">data</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useContext</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">MyDataContext</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// use it</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>Despite its simplicity, Context has one important downside though, and that’s performance, unless you’re very careful about how you use it.</p>\n\n<p>The reason is that every component that calls <code>useContext</code> will re-render when the Provider’s <code>value</code> prop changes. Seems fine so far, right? Components re-render when data changes? Sounds great!</p>\n\n<p>But now envision what would happen if that value was an object containing 50 different bits of state that were used all over the app. And they change frequently, and independently. Every time <em>one</em> of those values changes, every component that uses <em>any</em> of them would re-render.</p>\n\n<p>To avoid that pitfall, store small chunks of related data in each Context, and split up data across multiple Contexts (you can have as many as you want). Or, look into using a third-party library.</p>\n\n<p>The other performance gotcha to avoid is passing a brand new object into the <code>value</code> of the Provider every time. It looks innocuous and it’s easy to miss. Here’s an example:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code>\n<span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">TheComponentWithState</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">state</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setState</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;whatever&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #93DDFD\">MyDataContext.Provider</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">value</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #D1D5DE\">state,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #D1D5DE\">setState</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      component&apos;s content goes here</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #93DDFD\">ComponentThatNeedsData</span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #93DDFD\">MyDataContext.Provider</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>Here we’re passing an <em>object</em> containing the <code>state</code> and its setter, <code>setState</code>. Those two values are fine. <code>setState</code> will never change, and <code>state</code> only changes when you tell it to. The problem is the object wrapped around them, which will be created anew every time <code>TheComponentWithState</code> is rendered.</p>\n\n<p>You might notice that the stuff we’re talking about here isn’t really about state <em>management</em> as much as it just <em>passing variables around</em>. This is Context’s main purpose. The state itself is kept elsewhere, and Context just passes it around. I recommend reading this post on <a href=\"https://blog.isquaredsoftware.com/2021/01/context-redux-differences/\">how Context differs from Redux</a> for more detail.</p>\n\n<p>Also, check out the linked references below for more on how to fix the “fresh object” problem with <code>useCallback</code>.</p>\n\n<h3 id=\"learn-more\">Learn More</h3>\n\n<ul>\n  <li><a href=\"https://reactjs.org/docs/context.html\">Official docs</a></li>\n  <li>My egghead course on <a href=\"https://egghead.io/courses/react-context-for-state-management\">React Context for State Management</a></li>\n</ul>\n\n<h2 id=\"third-party-state-management-libraries\">Third-Party State Management Libraries</h2>\n\n<p>Let’s go over the most widely-used important state management tools to know about. I’ve provided links to learn more about each one.</p>\n\n<h3 id=\"redux\">Redux</h3>\n\n<p>Redux has been around the longest of all of the libraries mentioned here. It follows a functional (as in functional programming) style, with a heavy reliance on <a href=\"/react-redux-immutability-guide/\">immutability</a>.</p>\n\n<p>You’ll create a single global store to hold all of the app’s state. A <strong>reducer</strong> function will receive <strong>actions</strong> that you <strong>dispatch</strong> from your components, and respond by returning a new copy of state.</p>\n\n<p>Because changes only occur through actions, it’s possible to save and replay those actions and arrive at the same state. You can also take advantage of this to debug errors in production, and services like <a href=\"https://logrocket.com/\">LogRocket</a> exist to make this easy by recording actions on the server.</p>\n\n<h4 id=\"benefits\">Benefits</h4>\n\n<ul>\n  <li>Battle tested since 2015</li>\n  <li>The official <a href=\"https://redux-toolkit.js.org/\">Redux Toolkit</a> library cuts down on the boilerplate code</li>\n  <li>Great devtools make debugging simple</li>\n  <li>Time travel debugging</li>\n  <li>Small bundle size (redux + react-redux is around 3kb)</li>\n  <li>Functional style means very little is hidden behind the scenes</li>\n  <li>Has its own ecosystem of libraries for doing things like syncing to localStorage, managing API requests, and lots more</li>\n</ul>\n\n<h4 id=\"drawbacks\">Drawbacks</h4>\n\n<ul>\n  <li>The mental model will take some time to understand, especially if you’re not familiar with functional programming</li>\n  <li>Heavy reliance on immutability can make it cumbersome to write reducers (this is mitigated by adding the <a href=\"https://github.com/immerjs/immer\">Immer</a> library, or using <a href=\"https://redux-toolkit.js.org/\">Redux Toolkit</a> which incldues Immer)</li>\n  <li>Requires you to be explicit about everything (this could be a pro or con, depending on what you prefer)</li>\n</ul>\n\n<h4 id=\"learn-more-1\">Learn More</h4>\n\n<ul>\n  <li><a href=\"https://redux.js.org/\">Redux Docs</a></li>\n  <li>My free <a href=\"https://daveceddia.com/redux-tutorial/\">Redux Tutorial</a></li>\n</ul>\n\n<h3 id=\"mobx\">MobX</h3>\n\n<p>MobX is probably the most popular alternative to Redux outside of the built-in Context API. Where Redux is all about being explicit and functional, MobX takes the opposite approach.</p>\n\n<p>MobX is based on the observer/observable pattern. You’ll create an observable data model, mark your components as “observers” of that data, and MobX will automatically track which data they access and re-render them when it changes.</p>\n\n<p>It leaves you free to define the data model however you see fit, and gives you tools to watch that model for changes and react to those changes.</p>\n\n<p>MobX uses ES6 Proxies behind the scenes to detect changes, so updating observable data is as easy as using the plain old <code>=</code> assignment operator.</p>\n\n<h4 id=\"benefits-1\">Benefits</h4>\n\n<ul>\n  <li>Manages state in a truly “reactive” way, so that when you modify a value, any components that use that value will automatically re-render</li>\n  <li>No actions or reducers to wire up, just modify your state and the app will reflect it.</li>\n  <li>Magical reactivity means less code to write.</li>\n  <li>You can write regular mutable code. No special setter functions or immutability required.</li>\n</ul>\n\n<h4 id=\"drawbacks-1\">Drawbacks</h4>\n\n<ul>\n  <li>Not as widely used as Redux, so there’s less community support (tutorials, etc.), but much-loved among its users</li>\n  <li>Magical reactivity means less explicit code. (this could be a pro or a con, depending on how you feel about auto-update “magic”)</li>\n  <li>Requirement for ES6 Proxies means no support for IE11 and below. (If supporting IE is a requirement for your app, older versions of MobX can work without proxies)</li>\n</ul>\n\n<h4 id=\"learn-more-2\">Learn More</h4>\n\n<ul>\n  <li>Official <a href=\"https://mobx.js.org/getting-started.html\">Intro to MobX and React</a></li>\n  <li><a href=\"https://github.com/mobxjs/mobx\">Mobx on Github</a></li>\n  <li>Free <a href=\"https://egghead.io/courses/manage-complex-state-in-react-apps-with-mobx\">MobX video course on egghead</a> by its creator Michel Weststrate</li>\n</ul>\n\n<h3 id=\"mobx-state-tree\">MobX State Tree</h3>\n\n<p>MobX State Tree (or MST) is a layer on top of MobX that gives you a reactive <strong>state tree</strong>. You’ll create a typed model using MST’s type system. The model can have views (computed properties) and actions (setter functions). All modifications go through actions, so MST can keep track of what’s happening.</p>\n\n<p>Here’s an example model:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">TodoStore</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">types</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">model</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;TodoStore&apos;</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    loaded</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">types</span><span style=\"color: #D1D5DE\">.boolean,</span>\n<span style=\"color: #C9CDD7\">    todos</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">types</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">array</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">Todo</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    selectedTodo</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">types</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">reference</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">Todo</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">})</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">views</span><span style=\"color: #9CA5B7\">((</span><span style=\"color: #FDAC45\">self</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">get</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">completedTodos</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">self</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">todos</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">filter</span><span style=\"color: #9CA5B7\">((</span><span style=\"color: #FDAC45\">t</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">t</span><span style=\"color: #D1D5DE\">.done</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #AFF19F\">findTodosByUser</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">user</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">self</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">todos</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">filter</span><span style=\"color: #9CA5B7\">((</span><span style=\"color: #FDAC45\">t</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">t</span><span style=\"color: #D1D5DE\">.assignee</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">===</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">user</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">})</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">actions</span><span style=\"color: #9CA5B7\">((</span><span style=\"color: #FDAC45\">self</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #AFF19F\">addTodo</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">title</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #93DDFD\">self</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">todos</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">push</span><span style=\"color: #9CA5B7\">({</span>\n<span style=\"color: #C9CDD7\">          id</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">Math</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">random</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">          </span><span style=\"color: #D1D5DE\">title,</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p>The models are observable, which means that if a component is marked as a MobX observer, it will automatically re-render when the model changes. You can combine MST with MobX to write reactive components without much code.</p>\n\n<p>A good use case for MST is to store domain model data. It can represent relationships between objects (e.g. TodoList has many Todos, TodoList belongs to a User) and enforce these relationships at runtime.</p>\n\n<p>Changes are created as a stream of patches, and you can save &amp; reload snapshots of the entire state tree or sections of it. A couple use cases: persisting state to localStorage between page reloads, or syncing state to the server.</p>\n\n<h4 id=\"benefits-2\">Benefits</h4>\n\n<ul>\n  <li>The type system guarantees your data will be in a consistent shape</li>\n  <li>Automatic tracking of dependences means MST can be smart about only re-rendering the components that need to</li>\n  <li>Changes are created as a stream of granular patches</li>\n  <li>Simple to take serializable JSON snapshots of the entire state or a portion of it</li>\n</ul>\n\n<h4 id=\"drawbacks-2\">Drawbacks</h4>\n\n<ul>\n  <li>You need to learn MST’s type system</li>\n  <li>The tradeoff of magic vs. explicitness</li>\n  <li>Some performance overhead to patches, snapshots, and actions. If you’re changing data very rapidly, MST might not be the best fit.</li>\n</ul>\n\n<h4 id=\"learn-more-3\">Learn More</h4>\n\n<ul>\n  <li><a href=\"https://github.com/mobxjs/mobx-state-tree\">mobx-state-tree on Github</a></li>\n  <li>Official <a href=\"https://mobx-state-tree.js.org/intro/getting-started\">Getting Started Tutorial</a></li>\n  <li>Free <a href=\"https://egghead.io/courses/manage-application-state-with-mobx-state-tree\">MobX State Tree course on egghead</a> by the creator</li>\n</ul>\n\n<h2 id=\"recoil\">Recoil</h2>\n\n<p>Recoil is the newest library in this list, and was created by Facebook. It lets you organize your data into a graph structure. It’s a bit similar to MobX State Tree, but without defining a typed model up front. Its API is like a combination of React’s useState and Context APIs, so it feels very similar to React.</p>\n\n<p>To use it, you wrap your component tree in a <code>RecoilRoot</code> (similar to how you would with your own Context Provider). Then create “atoms” of state at the top level, each with a unique key.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">currentLanguage</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">atom</span><span style=\"color: #9CA5B7\">({</span>\n<span style=\"color: #C9CDD7\">  key</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;currentLanguage&apos;</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  default</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;en&apos;</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p>Components can then access this state with the <code>useRecoilState</code> hook, which works very similarly to <code>useState</code>:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">LanguageSelector</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">language</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setLanguage</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useRecoilState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">currentLanguage</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #C9CDD7\">Languauge is </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">language</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">button</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">onClick</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">setLanguage</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;es&apos;</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      Switch to Español</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">button</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>There’s also the concept of “selectors” that let you create a view of an atom: think <em>derived</em> state like “the list of TODOs filtered down to just the completed ones”.</p>\n\n<p>By keeping track of calls to <code>useRecoilState</code>, Recoil keeps track of which components use which atoms. This way it can re-render <em>only</em> the components that “subscribe” to a piece of data when that data changes, so the approach should scale well in terms of performance.</p>\n\n<h4 id=\"benefits-3\">Benefits</h4>\n\n<ul>\n  <li>Simple API that’s very similar to React</li>\n  <li>It’s used by Facebook in some of their internal tools</li>\n  <li>Designed for performance</li>\n  <li>Works with or without React Suspense (which is still experimental as of this writing)</li>\n</ul>\n\n<h4 id=\"drawbacks-3\">Drawbacks</h4>\n\n<ul>\n  <li>The library is only a few months old, so community resources and best practices aren’t as robust as other libraries yet.</li>\n</ul>\n\n<h4 id=\"learn-more-4\">Learn More</h4>\n\n<ul>\n  <li><a href=\"https://recoiljs.org/\">Official docs</a></li>\n  <li>The conference talk where <a href=\"https://youtu.be/_ISAA_Jt9kI\">Recoil’s Creator Explains Recoil</a></li>\n</ul>\n\n<h2 id=\"react-query\">react-query</h2>\n\n<p>React-Query stands apart from the others on the list becasue it’s a data-fetching library more than a state management library.</p>\n\n<p>I’m including it here because often, a good chunk of the state management in an app revolves around loading data, caching it, showing/clearing errors, clearing the cache at the right time (or hitting bugs when it’s not cleared), etc… and react-query solves all of this nicely.</p>\n\n<h4 id=\"benefits-4\">Benefits</h4>\n\n<ul>\n  <li>Retains data in a cache that every component can access</li>\n  <li>Can re-fetch automatically (stale-while-revalidate, Window Refocus, Polling/Realtime)</li>\n  <li>Support for fetching paginated data</li>\n  <li>Support for “load more” and infinite-scrolled data, including scroll position recovery</li>\n  <li>you can use any HTTP library (fetch, axios, etc.) or backend (REST, GraphQL)</li>\n  <li>supports React Suspense, but does not require it</li>\n  <li>Parallel + Dependent Queries</li>\n  <li>Mutations + reactive re-fetching (“after I update this item, re-fetch the whole list”)</li>\n  <li>Supports cancelling requests</li>\n  <li>Nice debugging with its own React Query Devtools</li>\n  <li>Small bundle size (6.5k minified + gzipped)</li>\n</ul>\n\n<h4 id=\"drawbacks-4\">Drawbacks</h4>\n\n<ul>\n  <li>Could be overkill if your requirements are simple</li>\n</ul>\n\n<h4 id=\"learn-more-5\">Learn More</h4>\n\n<ul>\n  <li><a href=\"https://github.com/tannerlinsley/react-query\">react-query on Github</a></li>\n  <li>This <a href=\"https://youtu.be/seU46c6Jz7E\">conference talk by the creator</a></li>\n  <li>Plenty of <a href=\"https://github.com/tannerlinsley/react-query#examples\">examples in the docs</a></li>\n</ul>\n\n<h2 id=\"xstate\">XState</h2>\n\n<p>This last one is also not really a state management library in the same sense as the others on this list, but it’s very useful!</p>\n\n<p>XState implements <strong>state machines</strong> and statecharts in JavaScript (and React, but it can be used with any framework). State machines are a “well known” idea (in the sense of academic literature) that have been around for decades, and they do a very good job of solving tricky stateful problems.</p>\n\n<p>When it’s hard to reason through all the different combinations and states a system can take on, state machines are a great solution.</p>\n\n<p>As an example, imagine a complex custom input like one of those fancy credit card number inputs from Stripe – the ones that know exactly when to insert spaces between numbers and where to put the cursor.</p>\n\n<p>Now think: What should you do when the user hits the Right Arrow key? Well, it depends on where the cursor is. And it depends on what text is in the box (is the cursor near a space we need to skip over? no?). And maybe they were holding Shift and you need to adjust the selected region… There are a lot of variables in play. You can see how this would get complicated.</p>\n\n<p>Managing this kind of thing by hand is tricky and error-prone, so with state machines you can lay out all the possible states the system can be in, and the transitions between them. XState will help you do that.</p>\n\n<h4 id=\"benefits-5\">Benefits</h4>\n\n<ul>\n  <li>Simple object-based API to represent states and their transitions</li>\n  <li>Can handle complex situations like parallel states</li>\n  <li>The <a href=\"https://xstate.js.org/viz/\">XState Visualizer</a> is really nice for debugging and stepping through a state machine</li>\n  <li>State machines can drastically simplify complex problems</li>\n</ul>\n\n<h4 id=\"drawbacks-5\">Drawbacks</h4>\n\n<ul>\n  <li>“Thinking in state machines” takes some getting used to</li>\n  <li>The state machine description objects can get pretty verbose (but then, imagine writing it by hand)</li>\n</ul>\n\n<h4 id=\"learn-more-6\">Learn More</h4>\n\n<ul>\n  <li><a href=\"https://xstate.js.org/\">Official docs</a></li>\n  <li>free <a href=\"https://egghead.io/courses/introduction-to-state-machines-using-xstate\">video course on egghead</a></li>\n</ul>\n\n<h2 id=\"what-about-x\">“What About X?”</h2>\n\n<p>There are plenty more libraries I didn’t have space to cover here, like <a href=\"https://github.com/pmndrs/zustand\">Zustand</a>, <a href=\"https://github.com/ctrlplusb/easy-peasy\">easy-peasy</a>, and others. Check those out though, they’re nice too :)</p>\n\n<h2 id=\"tips-on-learning-state-management\">Tips on Learning State Management</h2>\n\n<p>Small examples are good for learning, but often make a library look like overkill. (“Who needs Redux for a TODO list?!” “Why did you use an entire state machine for a <a href=\"/react-confirmation-modal-state-machine/\">modal dialog</a>?!”)</p>\n\n<p>Large examples are good for seeing how to put a thing into practice, but are often overwhelming as an introduction. (“Wow, these state machine things looks WAAAY too complicated”)</p>\n\n<p>Personally, when I’m brand new to a thing, I’ll start with the small “silly” examples first, even when my real goal is something bigger. I find it’s easy to get lost in the weeds with real-world examples.</p>\n\n<p>Good luck on your own state management journey :)</p>\n\n\n    <p><a href=\"https://daveceddia.com/react-state-management/\">React State Management Libraries and How to Choose</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on March 17, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-03-17T02:53:19.000Z",
    "url": "https://daveceddia.com/react-state-management/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "State of the React Ecosystem in 2021",
    "partialText": "<p>What’s the best way to build React apps in 2021? What has changed since 2016? What libraries is everyone using these days?</p>\n\n<p>This post is inspired by a now-deleted Reddit <a href=\"https://old.reddit.com/r/reactjs/comments/jb1vo8/my_react_skills_are_out_of_date_how_do_i_remain/\">post</a> from someone who had learned React in 2016, and was concerned about how to get back into it and refresh their skills.</p>\n\n<p>I started using and teaching React in 2016 myself. Over the last few years, there have been some big changes in React itself, and the ecosystem has evolved quite a bit too.</p>\n\n<p>Here’s where things stand in 2021.</p>\n\n<h2 id=\"thinking-in-react-pretty-much-the-same\">Thinking in React: Pretty much the same</h2>\n\n<p>The core skill of “thinking in React” hasn’t changed much at all over the years. It’s still all about one-way data flow, props, state, and JSX. Things like being able to break a design into components are still crucial, as is deciding which components should “own” data and which should merely display it.</p>\n\n<p>I still advocate for learning pure “vanilla” React before adding on a bunch of libraries.</p>\n\n<h2 id=\"hooks-vs-classes-most-new-react-components-use-hooks\">Hooks vs Classes: Most new React components use hooks</h2>\n\n<p>In recent years, the biggest shift in React is from classes to <a href=\"https://daveceddia.com/react-hooks/\">hooks</a>. Hooks were added in React 16.8 (Feb 2019), and have pretty quickly become the standard way that people write React components. You can check out the <a href=\"https://daveceddia.com/intro-to-hooks/\">hooks intro</a> I wrote back when they were first announced — they work the same now as they did then.</p>\n\n<p>Initially, hooks look weird, especially if you’ve been programming a while. Variables that seemingly maintain state between function calls seem pretty magical. It’s more about <a href=\"https://daveceddia.com/intro-to-hooks/#the-magic-of-hooks\">arrays than magic</a>, though.</p>\n\n<p>Once you settle in with how hooks work, and get a feel for <a href=\"https://daveceddia.com/usestate-hook-examples/\">useState</a>, the next big hurdle to overcome is the <a href=\"https://daveceddia.com/useeffect-hook-examples/\">useEffect hook</a>.</p>\n\n<p>useEffect is the answer to how to do lifecycle methods in function components. Except it doesn’t really work the way lifecycles do, at all. It’s crucial to grasp the <a href=\"https://useeffectoverlunch.com/\">mental model of useEffect</a>. Once you have that down, solving problems will get easier and easier.</p>\n\n<h2 id=\"the-best-react-libraries-in-2021\">The Best React Libraries in 2021</h2>\n\n<p>On the library front, community favorites have changed over the years, and continue to evolve.</p>\n\n<h3 id=\"routing\">Routing</h3>\n\n<p><strong><a href=\"https://reactrouter.com/\">React Router</a></strong> is still the dominant router (and despite the name, not actually part of React itself). It is currently up to v5 (almost v6) and the API has changed a bit since earlier versions. Less “declare your routes at the top” and more “routes are components; render them whereever”. The <a href=\"https://reactrouter.com/web/guides/quick-start\">docs cover v5</a>, and v6 has <a href=\"https://reacttraining.com/blog/react-router-v6-pre/\">this preview blog</a>. The v6 API is actually closer to v3, and having used it a bit, I think it will be a nice API.</p>\n\n<h3 id=\"state-management\">State Management</h3>\n\n<p><strong><a href=\"https://redux.js.org/\">Redux</a></strong> is still used in a lot of apps, hovering around 30-50% last I saw. The new official <a href=\"https://redux-toolkit.js.org/\">Redux Toolkit</a> is excellent, too. It helps cut down boilerplate quite a bit, in combo with Redux’s hook. If you are going to use Redux, be sure to check those out.</p>\n\n<p>Redux is less of the de-facto standard than it once was, though. More people are realizing that React’s built-in state management is enough for a lot of use cases, especially for simple ones.</p>\n\n<p>There are also some newer purpose-built libraries for things that you might’ve used Redux for before. I’ll mention a couple below.</p>\n\n<p><strong><a href=\"https://mobx.js.org/README.html\">MobX</a></strong> is probably the most popular alternative to Redux outside of the built-in Context API. Where Redux is all about being explicit and functional, MobX takes the opposite approach. It uses ES6 Proxies behind the scenes to detect changes, so updating observable data is as easy as using the plain old <code>=</code> assignment operator.</p>\n\n<p>I’ve used <a href=\"https://mobx-state-tree.js.org/intro/welcome\">MobX State Tree</a> on a project, and enjoyed working with it. It’s good if you have a lot of state to manage and want to create structure around it with models.</p>\n\n<p><strong><a href=\"https://recoiljs.org/\">Recoil</a></strong> and <strong><a href=\"https://github.com/pmndrs/zustand\">Zustand</a></strong> are a couple other lightweight state management options.</p>\n\n<p>There are, as ever, lots of choices in the realm of state management.</p>\n\n<h3 id=\"context-api\">Context API</h3>\n\n<p>If your global state consists of a couple things that rarely change (current user, current theme, current language, etc), you don’t need a library to pass that stuff around.</p>\n\n<p>The Context API + <a href=\"https://daveceddia.com/usecontext-hook/\">useContext</a> are good for passing around simple global state managed by <a href=\"/usereducer-hook-examples/\">useReducer</a>.</p>\n\n<p>The Context API was re-done in React 16.3. The old <code>contextType</code> thing is out, and the old guidance about avoiding Context unless you’re a library maintainer has been gone for a while. The <a href=\"https://daveceddia.com/usecontext-hook/\">useContext hook</a> makes it really nice to use.</p>\n\n<p>There’s some long-standing confusion about whether to use Context or Redux, and what the differences are. Check out Mark Erikson’s blog post about <a href=\"https://blog.isquaredsoftware.com/2021/01/blogged-answers-why-react-context-is-not-a-state-management-tool-and-why-it-doesnt-replace-redux/\">Context vs. Redux</a> for an in-depth comparison.</p>\n\n<h3 id=\"data-fetching\">Data Fetching</h3>\n\n<p>On the data-fetching front, the strategy of putting everything in Redux or a global store is getting less common.</p>\n\n<p><strong><a href=\"https://react-query.tanstack.com/overview\">react-query</a></strong> does a good job at fetching data and managing loading/success/error states. It takes care of maintaining that global data cache across component boundaries without you really having to think about it. IMO it gets the abstraction right. Definitely worth a look.</p>\n\n<h3 id=\"why-react-query\">Why react-query?</h3>\n\n<p>It’s less about the specific library and more about the pattern. (<a href=\"https://github.com/vercel/swr\">swr</a> is another good option)</p>\n\n<p>Take a common scenario like a ListPage / DetailPage for a set of items. You open the ListPage, it fetches all the widgets or whatever. Good so far.</p>\n\n<p>Normally you’d probably keep that data around in Redux or something, so that when you click in to one of the DetailPages, that item has probably already been loaded. (oh! but what if the user loads a DetailPage route directly? welp, gotta fetch that item as a one-off)</p>\n\n<p>And then the user clicks Back, and they’re back at ListPage again, but you already have the data so you can just display it.</p>\n\n<p>It all works fine, but there are edge cases. What if an item went stale between the time the user loads ListPage and they click into a DetailPage? What if, while they were perusing the DetailPage, some new items were added to the list?</p>\n\n<p>When should you re-fetch that data? And how do you deal with merging those two kinds of things – a list response that could maybe replace the whole list, and a single item response that should replace only one item? In Redux, the reducer handles that, but you’ve gotta write that stuff manually for the most part.</p>\n\n<p>It all gets even more complex once you start thinking about pagination, and whether you want to cache pages, or refetch all the pages, or whatever.</p>\n\n<p>All of this stuff, I think, falls under the “client data management” umbrella, and we’ve been using generic state management libraries for that for a long time now. And we have to solve these problems over and over again, or we ignore them and hope they don’t happen, or patch them as they crop up.</p>\n\n<p>Libraries like react-query slice the problem up differently.</p>\n\n<p>It knows you’re going to fetch data, and it knows you’re going to want to cache that data globally under some key (maybe <code>items</code> or a nested <code>items[id]</code>). It also knows that you’re going to want to update that data sometimes – based on a timer, or when the user tabs away from the app and back again, etc.</p>\n\n<p>Because this stuff is stored in a globally accessible cache, every component that needs access can call <code>useQuery(&#39;items&#39;, fetchItems)</code> to grab that data, and it’ll automatically be fetched if it’s not already available. And it deals with idle/loading/error/success states too.</p>\n\n<p>It takes any Promise-returning function, so it works with <code>fetch</code> or <code>axios</code> or whatever data fetcher you want to use.</p>\n\n<p>This is what I meant when I said that I think it gets the abstraction right - we can use whatever we were already using to make the HTTP call, but react-query steps in to handle the oft-repeated heavy lifting that’s common to most data fetching use cases.</p>\n\n<h3 id=\"state-machines-are-awesome\">State Machines are Awesome</h3>\n\n<p><strong><a href=\"https://github.com/davidkpiano/xstate\">XState</a></strong> is a library for building state machines, which are excellent for representing complex logic. Actually, they’re pretty great for not-so-complex logic, too. Next time you find yourself juggling a bunch of boolean values or trying to update a bunch of variables in the right places, check out XState. egghead.io has a nice <a href=\"https://egghead.io/courses/introduction-to-state-machines-using-xstate\">course on XState</a> by Kyle Shevlin.</p>\n\n<p>There’s an alternative called <strong><a href=\"https://thisrobot.life\">Robot</a></strong> and I wrote a tutorial using it to build a <a href=\"/react-confirmation-modal-state-machine/\">confirmation modal flow</a>, if you want to get a feel for how state machines can be useful.</p>\n\n<h3 id=\"bundlers\">Bundlers</h3>\n\n<p><strong><a href=\"https://webpack.js.org/\">Webpack</a></strong> is still everywhere. It’s up to version 5 now. The config syntax changed a lot somewhere around v2 or v3.</p>\n\n<p>Most people use <strong><a href=\"https://github.com/facebook/create-react-app\">Create React App</a></strong> to start new apps nowadays, which is great, and shields you from Webpack unless you really need to customize it. The defaults are pretty solid. If you need to customize things, check out <a href=\"https://github.com/gsoft-inc/craco\">craco</a>.</p>\n\n<p>For throwing together a quick demo, CodeSandbox is great, and they even have this handy <a href=\"https://react.new\">https://react.new</a> URL that’ll drop you right into a new project.</p>\n\n<h3 id=\"forms\">Forms</h3>\n\n<p>The story around forms has continued to evolve. I remember using redux-form years ago, and how the app would freeze every time I pressed a key 😂 Looking back, “keep every ounce of state in Redux” was never really a good idea.</p>\n\n<p><strong><a href=\"https://formik.org/\">Formik</a></strong> and <strong><a href=\"https://react-hook-form.com/\">react-hook-form</a></strong> seem to be the favorites right now, with hook-form gaining steam.</p>\n\n<h3 id=\"suspense\">Suspense</h3>\n\n<p>React’s long-awaited Suspense feature is… still awaited. It’s in React right now, and you can try it out, but it’s in experimental mode and it’s not advisable to build production code with it. The API can still change.</p>\n\n<h3 id=\"server-components\">Server Components</h3>\n\n<p>The latest advancement is components that render on the server, coupled with a server-side framework around React. These are still experimental too. Very cool though, and I suspect will change the ecosystem quite a bit. Check out the official <a href=\"https://reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html\">announcement and demo video</a> from the React team to learn more.</p>\n\n<h2 id=\"now-go-build-something\">Now Go Build Something!</h2>\n\n<p>That about wraps this up. I’m sure I missed some things though. Feel free to chime in with your favorites in the comments!</p>\n\n    <p><a href=\"https://daveceddia.com/react-ecosystem-overview/\">State of the React Ecosystem in 2021</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on January 20, 2021.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2021-01-20T18:30:28.000Z",
    "url": "https://daveceddia.com/react-ecosystem-overview/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Using the image tag in React",
    "partialText": "<p>In React, image tags are a bit weird. This isn’t really <em>React’s</em> fault, but more a problem of where the images will reside on the server after the app is built.</p>\n\n<p>I’m talking about the plain old <code>&lt;img src=&quot;&quot;/&gt;</code> tag here. The same one you’d use in HTML.</p>\n\n<p>When you <code>img</code> in a React component, the the <code>src</code> prop needs to be point at something that the server can serve.</p>\n\n<h2 id=\"dont-use-a-file-path-from-your-computer\">Don’t Use a File Path From Your Computer</h2>\n\n<p>A common mistake for beginners is to set the <code>src</code> to a file path on their computer, like <code>/Users/yourname/Projects/this-react-app/src/image.png</code>. That won’t work.</p>\n\n<p>Browsers are mostly sandboxed these days and won’t let you access files by their path on disk. If you did get that to work (maybe with <code>file://</code>), it’d break as soon as you deployed the app, because a web server won’t have that file in the same place! (And no, the solution is not to put it in the same place on the server :)</p>\n\n<h2 id=\"two-ways-to-include-an-image-in-a-react-component\">Two Ways to Include an Image in a React Component</h2>\n\n<p>With React, since there’s a build step, you need a way to include the image. There are 2 main ways to do that.</p>\n\n<p>I’m going to assume a Create React App project here, where everything in the <code>public</code> directory gets copied to the server and everything under <code>src</code> is fair game for importing into JS files.</p>\n\n<h3 id=\"option-1-import-the-image-into-the-component\">Option 1: <code>import</code> the image into the component</h3>\n\n<p>Put the image file somewhere under the <code>src</code> folder. This alone will not automatically make it available, so you have to import the image into the React component where you’re using it.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">companyLogo</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">&apos;./path/to/logo.jpg&apos;</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p>Then you can reference it by that variable name. The name can be anything you want, it doesn’t have to match the image or anything.</p>\n\n<p>Wherever you want to display the image, render your <code>img</code> tag and pass that variable as the <code>src</code>:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">Home</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">img</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">src</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">companyLogo</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">alt</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"BigCo Inc. logo\"</span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>Note I’m using <code>src={companyLogo}</code> and not <code>src=&quot;companyLogo&quot;</code>! If you use the quoted string <code>&quot;companyLogo&quot;</code> it will try to fetch a file at <code>/companyLogo</code> and that will fail. Make sure to use curly braces if you’re using an imported image. Curly braces are the way to pass JS variables as props.</p>\n\n<h3 id=\"option-2-put-the-image-in-the-public-directory\">Option 2: Put the image in the <code>public</code> directory</h3>\n\n<p>You can put the image file in the <code>public</code> folder (or if this is not Create React App… then any folder that will be copied to the server).</p>\n\n<p>Then, assuming your server is treating the public folder as the “root” directory (<code>/</code>), then your images will be available relative to that – just like with plain HTML.</p>\n\n<p>So if you had an image at <code>public/images/thing.jpg</code>, you could display that image this way:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">Home</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">img</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">src</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"images/logo.jpg\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">alt</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #F5D66B\">\"BigCo Inc. logo\"</span><span style=\"color: #8AD2F0\">/&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<p>Because this method makes the image available as a regular file on the web server, and you can test it by opening <code>http://localhost:3000/images/logo.jpg</code> in the browser (or, you know, your actual domain name, once it’s deployed!)</p>\n\n<h2 id=\"how-imported-images-work-in-react\">How Imported Images Work in React</h2>\n\n<p>First, know that <code>import</code>s are not handled by React at all – they’re handled by your bundler, which is probably Webpack. (if you’re using Create React App, it is definitely Webpack)</p>\n\n<p>Webpack, Rollup, Parcel, and other bundlers all work conceptually the same way: when you <code>import</code> a static file, like an image or a CSS file, the bundler doesn’t literally <em>paste that file in</em> at the <code>import</code> location. Instead, it makes a note that this particular JS file depends on this particular image/CSS file/whatever.</p>\n\n<p>Then the bundler will copy the image to the output directory with a generated unique name (like <code>a5c8d3f89cad.jpg</code>) and, behind the scenes, it will replace <code>&lt;img src={yourName}/&gt;</code> with <code>&lt;img src=&quot;a5c8d3f89cad.jpg&quot;/&gt;</code>.</p>\n\n<p>If the image is especially small, Webpack might even decide to inline it into the JS bundle, as an optimization.</p>\n\n<p>This all happens without you having to worry about it.</p>\n\n<h2 id=\"the-best-way-to-use-the-img-tag-in-react\">The Best Way to Use the <code>img</code> tag in React?</h2>\n\n<p>For one-off images that are related to the component at hand, I like to import them. Imported images have the side benefit that, if the file is missing, the build will fail, and you’ll find out quick! For that reason, I lean toward importing an image if I’m going to use it.</p>\n\n<p>For generic site-wide images, or where it would be annoying to manually import them, I’ll put them in public. This is especially useful when the React app is only a small slice of your overall site, and the same image should be used by both React and other non-React pages. In this case I’d rather avoid duplicating images (with the potential that the copies get out of sync).</p>\n\n    <p><a href=\"https://daveceddia.com/react-image-tag/\">Using the image tag in React</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on November 17, 2020.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2020-11-17T19:42:09.000Z",
    "url": "https://daveceddia.com/react-image-tag/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Remove XML Tag Blocks from the command line with sed",
    "partialText": "<p>I had an xml file that looked something like this, and I wanted to remove all the <code>&lt;meta&gt;</code> tags from it:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"xml\"><code><span style=\"color: #C9CDD7\">&lt;</span><span style=\"color: #FF8383\">xml</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">  &lt;</span><span style=\"color: #FF8383\">note</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">    &lt;</span><span style=\"color: #FF8383\">to</span><span style=\"color: #C9CDD7\">&gt;A&lt;/</span><span style=\"color: #FF8383\">to</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">    &lt;</span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\">&gt;B&lt;/</span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">    &lt;</span><span style=\"color: #FF8383\">meta</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">      junk</span>\n<span style=\"color: #C9CDD7\">    &lt;/</span><span style=\"color: #FF8383\">meta</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">    &lt;</span><span style=\"color: #FF8383\">meta</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">      more junk</span>\n<span style=\"color: #C9CDD7\">    &lt;/</span><span style=\"color: #FF8383\">meta</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">    &lt;</span><span style=\"color: #FF8383\">body</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">      keep this</span>\n<span style=\"color: #C9CDD7\">    &lt;/</span><span style=\"color: #FF8383\">body</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">  &lt;/</span><span style=\"color: #FF8383\">note</span><span style=\"color: #C9CDD7\">&gt;</span>\n<span style=\"color: #C9CDD7\">  ...</span>\n<span style=\"color: #C9CDD7\">&lt;/</span><span style=\"color: #FF8383\">xml</span><span style=\"color: #C9CDD7\">&gt;</span></code></pre>\n</div>\n<p>The <code>sed</code> utility made quick work of it.</p>\n\n<p>Some caveats: The file was already well-formatted, and these <code>meta</code> tags spanned multiple lines.</p>\n\n<p>If your file is a jumbled mess, you might want to <a href=\"https://github.com/prettier/plugin-xml\">format it with prettier</a> first.</p>\n\n<p>Manipulating XML or HTML with tools like sed is not generally a great idea. For a general-purpose solution that can deal with all valid XML syntax you’d need a proper XML parser. But if your file is in the right shape, sed can be a quick and dirty way to get the job done.</p>\n\n<p>Here’s the command I ran:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"shell\"><code><span style=\"color: #C9CDD7\">sed -i </span><span style=\"color: #F5D66B\">&apos;&apos;</span><span style=\"color: #C9CDD7\"> -e </span><span style=\"color: #F5D66B\">&apos;/&lt;meta&gt;/,/&lt;\\/meta&gt;/d&apos;</span><span style=\"color: #C9CDD7\"> my-file.xml</span></code></pre>\n</div>\n<p>The <code>-i</code> means “in-place”. It will change the file on disk. The <code>&#39;&#39;</code> is the name of the backup file – none, in this case. The Mac version of <code>sed</code> requires this name, though. If you’re on another system you might not need this.</p>\n\n<p>The <code>-e</code> says to execute the regular expression that follows.</p>\n\n<p>Let’s break down the expression: <code>/&lt;meta&gt;/,/&lt;\\/meta&gt;/d</code></p>\n\n<p>The comma in the middle tells sed to look for a <em>range</em> of lines, and on either side of the comma is a regex. The <code>d</code> at the end means “delete this range”. Read about <a href=\"https://www.gnu.org/software/sed/manual/html_node/Range-Addresses.html\">ranges in sed</a> for more stuff you can do with them.</p>\n\n<p>So we’re looking for lines starting with <code>&lt;meta&gt;</code> and ending with <code>&lt;/meta&gt;</code>, and the slash needs to be escaped in the second regex, so we have <code>/&lt;\\/meta&gt;/</code>.</p>\n\n    <p><a href=\"https://daveceddia.com/remove-xml-tags-with-sed/\">Remove XML Tag Blocks from the command line with sed</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on November 11, 2020.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2020-11-11T17:25:29.000Z",
    "url": "https://daveceddia.com/remove-xml-tags-with-sed/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Run Code in React Before Render",
    "partialText": "<p>Want to run some code <em>before</em> your React component renders? There are a few ways to make this work, and we’ll talk about them here.</p>\n\n<p>But, I have to warn you: Running code <strong>before</strong> render is usually a sign that you’re going against the grain of how React works.</p>\n\n<h2 id=\"tldr--there-is-no-before-render-only-after\">TL;DR – There is no Before Render, only After</h2>\n\n<p>It makes perfect sense to think “I want to fetch data before my component renders”. Logical! But not how React works.</p>\n\n<p>Here’s the thing:</p>\n\n<p><strong>React does not <em>wait</em> to render. Ever.</strong></p>\n\n<p>React will gladly kick off an asynchronous data fetch in the background, but then it will immediately proceed with rendering – whether the data has loaded or not. (and you can be almost certain that it will not have loaded yet)</p>\n\n<p>There is no way to make it wait.</p>\n\n<p>All is not lost, though. There’s an easy fix.</p>\n\n<p>Components that render async data need to <strong>be prepared to render an empty state</strong>, at least once.</p>\n\n<p>Think about what your app should look like before the data is ready. Maybe it’s empty, or maybe it’s a loading spinner, or some fancy skeleton state.</p>\n\n<p>To embrace the way React works, kick off your data fetch <em>after</em> the first render, inside <a href=\"/useeffect-hook-examples/\">a useEffect block</a>.</p>\n\n<p>Just make sure to initialize the state to something that’s the same type as what it’ll eventually be!</p>\n\n<h2 id=\"initialize-state-before-render\">Initialize State Before Render</h2>\n\n<p>Initializing state actually <em>does</em> run before the first render, and leaving it uninitialized is a common source of problems.</p>\n\n<p>This leads to errors like <code>Cannot read property &#39;map&#39; of undefined&#39;</code> when the component tries to render before the data is ready.</p>\n\n<p>If you have a call like <code>useState()</code> with nothing between the parens, that’s uninitialized (it’ll be <code>undefined</code>).</p>\n\n<p>The rule of thumb is to initialize like-with-like: if the state will hold a string, initialize with a string. If it’s a number, init with a number. And so on.</p>\n\n<h3 id=\"initialize-arrays\">Initialize Arrays</h3>\n\n<p>If you’re expecting an array from the server, initialize with an empty array.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">items</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setItems</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">[]</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<h3 id=\"initialize-objects\">Initialize Objects</h3>\n\n<p>If you’re expecting an object, init with an object, or maybe null.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">user</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setUser</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #76DCE8\">null</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<h3 id=\"initialize-state-lazily\">Initialize State Lazily</h3>\n\n<p>If your init code has to do some heavy work, like mapping/filtering/reducing an array, you can wrap that initialization in a function and it will only run once:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">products</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setProducts</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">(()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">hugeListOfProducts</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">filter</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">isOnSale</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">})</span></code></pre>\n</div>\n<p>This is <em>not</em> a good place to fetch data or do anything asynchronous, though. Put <a href=\"/useeffect-hook-examples/\">async actions in a useEffect</a>.</p>\n\n<h2 id=\"what-will-happen-before-the-data-is-ready\">What Will Happen Before the Data is Ready?</h2>\n\n<p>Look through your code and make sure it won’t blow up if the data isn’t ready (if the value is null). Be especially careful if the data is initialized to or can become <code>null</code> or <code>undefined</code>!</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">user</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">&amp;&amp;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">user</span><span style=\"color: #D1D5DE\">.name</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">?</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">user</span><span style=\"color: #D1D5DE\">.name</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"Not loaded yet\"</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #9CA5B7\">)</span></code></pre>\n</div>\n<p>There are two new operators in ES2020 that can make this code simpler: optional chaining (<code>?.</code>) and nullish coalescing (<code>??</code>).</p>\n\n<p>The optional chaining operator (<code>?.</code>) lets you safely access properties of an object that could be null.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">user</span><span style=\"color: #D1D5DE\">?.name</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">||</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"Not loaded yet\"</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #9CA5B7\">)</span></code></pre>\n</div>\n<p>The nullish coalescing operator (<code>??</code>) returns the right-hand side when the left side is <code>null</code> or <code>undefined</code>. It’s useful in cases where you might normally use <code>||</code>, like this:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">user</span><span style=\"color: #D1D5DE\">?.commentCount</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">||</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"Not loaded yet\"</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #9CA5B7\">)</span></code></pre>\n</div>\n<p>This example has a bug – it will show “Not loaded yet” when <code>commentCount</code> is 0. Using the <code>??</code> operator instead of <code>||</code>, it’ll work correctly:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">user</span><span style=\"color: #D1D5DE\">?.commentCount</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">??</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"Not loaded yet\"</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #9CA5B7\">)</span></code></pre>\n</div>\n<p><code>??</code> works like the OR <code>||</code> operator, except that it doesn’t consider <code>0</code>, <code>&#39;&#39;</code> or <code>false</code> to be falsy.</p>\n\n<h2 id=\"fetch-data-before-render-in-the-parent\">Fetch Data Before Render in the Parent</h2>\n\n<p>If you absolutely need to run some code before a component renders, then the solution is to avoid rendering that component at all, until you’re ready.</p>\n\n<p>That means conditionally rendering it in the parent, which would look something like this. More detail in the comments:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"jsx\"><code><span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">Child</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #C9CDD7\">{ </span><span style=\"color: #FDAC45\">items</span><span style=\"color: #C9CDD7\"> }</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Problem:</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// This will error if `items` is null/undefined</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">items</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">map</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">item</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">        </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">li</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">key</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">item</span><span style=\"color: #D1D5DE\">.id</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&gt;</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #93DDFD\">item</span><span style=\"color: #D1D5DE\">.name</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">li</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #9CA5B7\">))</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span>\n\n<span style=\"color: #76DCE8\">function</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">Parent</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Uninitialized state will cause Child to error out</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #93DDFD\">items</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">setItems</span><span style=\"color: #C9CDD7\">] </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">useState</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Data does&apos;t start loading</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// until *after* Parent is mounted</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">useEffect</span><span style=\"color: #9CA5B7\">(()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #AFF19F\">fetch</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">&apos;/data&apos;</span><span style=\"color: #9CA5B7\">)</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">then</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">res</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">res</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">json</span><span style=\"color: #9CA5B7\">())</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">then</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #FDAC45\">data</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">setItems</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">data</span><span style=\"color: #9CA5B7\">))</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">[]</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// Solution:</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #6E778C\">// don&apos;t render Child until `items` is ready!</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #FF8383\">return</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">(</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">      </span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">items</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">&amp;&amp;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #8AD2F0\">&lt;</span><span style=\"color: #93DDFD\">Child</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">items</span><span style=\"color: #93DDFD\">=</span><span style=\"color: #FFE78F\">{</span><span style=\"color: #D1D5DE\">items</span><span style=\"color: #FFE78F\">}</span><span style=\"color: #8AD2F0\">/&gt;</span><span style=\"color: #FFE78F\">}</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #8AD2F0\">&lt;/</span><span style=\"color: #FF8383\">div</span><span style=\"color: #8AD2F0\">&gt;</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">}</span></code></pre>\n</div>\n<h2 id=\"thats-it\">That’s It!</h2>\n\n<p>I hope that helps clear up some confusion around how to do things <em>before</em> mounting a React component. Just remember: There is no before, only after.</p>\n\n<p>For a great deep dive into how React renders and re-renders, check out Mark Erikson’s <a href=\"https://blog.isquaredsoftware.com/2020/05/blogged-answers-a-mostly-complete-guide-to-react-rendering-behavior/\">guide to React rendering behavior</a>.</p>\n\n    <p><a href=\"https://daveceddia.com/react-before-render/\">Run Code in React Before Render</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on October 27, 2020.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2020-10-27T15:24:05.000Z",
    "url": "https://daveceddia.com/react-before-render/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Directly Open The Inspector Stylesheet in Chrome",
    "partialText": "<p>So you’ve added some styles to your page with Chrome’s dev tools. Awesome.</p>\n\n<p>But when you click away from the element you’ve styled, the styles disappear from the sidebar! What if you were styling something that changes state, or left the DOM temporarily? How can you add on to those existing styles?</p>\n\n<p>Turns out that styles you add in the Elements tab are automatically added to the <code>inspector-stylesheet</code>, and there are a couple ways to bring it up.</p>\n\n<h2 id=\"click-the-inspector-stylesheet-link-beside-the-style\">Click the <code>inspector-stylesheet</code> link beside the style</h2>\n\n<p>This method works great if you can see the style in the Elements sidebar.</p>\n\n<p>Click the gray <code>inspector-stylesheet</code> link next to the style that you’ve added.</p>\n\n<p><img src=\"https://daveceddia.com/images/inspector-stylesheet-link.png\" srcset=\"https://daveceddia.com/images/inspector-stylesheet-link@2x.png 2x\" alt=\"Pointing out the inspector-stylesheet link in the sidebar\" /></p>\n\n<p>You can also create a new style (click the <code>+</code>) <em>just</em> for the sole purpose of getting the inspector-stylesheet link to appear, and then click the link.</p>\n\n<p>In fact, this was the main way I got to the inspector stylesheet until I got fed up with that and decided to figure out where it is for real.</p>\n\n<h2 id=\"inspector-stylesheet-is-in-the-sources-tab\">Inspector Stylesheet is in the Sources tab</h2>\n\n<p>The true home of the stylesheet is under the Sources tab. Open that up:</p>\n\n<p><img src=\"https://daveceddia.com/images/chrome-sources-tab.png\" srcset=\"https://daveceddia.com/images/chrome-sources-tab@2x.png 2x\" alt=\"Pointing out the location of the Sources tab\" /></p>\n\n<p>From here, look for the current page’s domain name in the list on the left.</p>\n\n<p>If you’re doing local development, this will probably be <code>localhost</code>.</p>\n\n<p>When I do this for my published site, I see the site’s domain twice. The first one is the original content that came from the server, and the second contains the <code>inspector-stylesheet</code>. You might have to hunt around a bit.</p>\n\n<p><img src=\"https://daveceddia.com/images/inspector-stylesheet-direct-access.png\" srcset=\"https://daveceddia.com/images/inspector-stylesheet-direct-access@2x.png 2x\" alt=\"Where to find the inspector-stylesheet file\" /></p>\n\n<p>I’m <em>guessing</em> that if you added styles inside an iframe, the inspector-stylesheet would be under that iframe’s domain. I haven’t verified this though.</p>\n\n<p>Have fun inspecting styles!</p>\n\n\n    <p><a href=\"https://daveceddia.com/inspector-stylesheet-chrome/\">Directly Open The Inspector Stylesheet in Chrome</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on October 23, 2020.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2020-10-23T16:34:27.000Z",
    "url": "https://daveceddia.com/inspector-stylesheet-chrome/"
  },
  {
    "publisherId": "daveceddia",
    "publisherName": "Dave Ceddia",
    "specTitle": "React",
    "categories": [
      "frontend"
    ],
    "specUrl": "https://daveceddia.com/feed.xml",
    "title": "Svelte with TypeScript and Jest (Starter Project)",
    "partialText": "<p>In the summer of 2020, Svelte added TypeScript support. Turning it on is as simple as running a single script! But the default starter project doesn’t have Jest testing set up.</p>\n\n<p>I took the default Svelte starter with TypeScript and added Jest to it, along with a couple sample tests. The final project is <a href=\"https://github.com/dceddia/svelte-typescript-jest\">here</a>.</p>\n\n<p>This was pieced together from info at the <a href=\"https://testing-library.com/docs/svelte-testing-library/intro\">Svelte testing library docs</a>, the Svelte Society repo’s <a href=\"https://github.com/svelte-society/recipes-mvp/blob/master/testing.md\">testing recipes</a> section, and the README for <a href=\"https://github.com/mihar-22/svelte-jester\">svelte-jester</a>.</p>\n\n<h2 id=\"diy-or-use-my-starter\">DIY or Use My Starter</h2>\n\n<p>If you want to apply the steps to an existing project of yours, or just to learn how it works, feel free to follow the steps below.</p>\n\n<p>Or if you’re starting a fresh project and you just want to get going, you can clone my starter project that has all of this set up already:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"shell\"><code><span style=\"color: #C9CDD7\">npx degit </span><span style=\"color: #F5D66B\">&apos;dceddia/svelte-typescript-jest#main&apos;</span><span style=\"color: #C9CDD7\"> your-svelte-project</span>\n<span style=\"color: #AFF19F\">cd</span><span style=\"color: #C9CDD7\"> your-svelte-project</span>\n<span style=\"color: #C9CDD7\">npm install</span>\n<span style=\"color: #C9CDD7\">npm </span><span style=\"color: #AFF19F\">test</span></code></pre>\n</div>\n<p>(Don’t forget the quotes around the repo + branch name if you’re using Zsh)</p>\n\n<p>You should see 2 passing tests, and be all ready to go!</p>\n\n<p>Read on for the changes I made to get it working.</p>\n\n<h2 id=\"1-clone-the-standard-svelte-starter\">1. Clone the standard Svelte starter</h2>\n\n<p>The defacto standard way to start a new Svelte project is to use the <code>degit</code> tool to clone the repo while removing extra Git folders:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"shell\"><code><span style=\"color: #C9CDD7\">$ npx degit sveltejs/template svelte-typescript-jest</span></code></pre>\n</div>\n<h2 id=\"2-setup-svelte--typescript\">2. Setup Svelte + TypeScript</h2>\n\n<p>The official starter project can work in two modes: plain JavaScript (the default) or TypeScript.</p>\n\n<p>To convert it to TypeScript, we can run the provided <code>setupTypeScript.js</code> to modify a few files and set up the build.</p>\n\n<p>Switch into the project directory and run the script, then install all the packages.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"shell\"><code><span style=\"color: #AFF19F\">cd</span><span style=\"color: #C9CDD7\"> svelte-typescript-jest</span>\n<span style=\"color: #C9CDD7\">node scripts/setupTypeScript.js</span>\n<span style=\"color: #C9CDD7\">npm install</span></code></pre>\n</div>\n<h2 id=\"3-add-jest-support-testing-library-and-svelte-jester\">3. Add Jest support, Testing Library, and svelte-jester</h2>\n\n<p>Here we’re installing a bunch of stuff:</p>\n\n<ul>\n  <li><strong>jest</strong> to run the tests</li>\n  <li><strong>ts-jest</strong> to let you write your tests in TypeScript</li>\n  <li><strong>@testing-library/svelte</strong> for some useful functions to test your Svelte components with</li>\n  <li><strong>@testing-library/jest-dom</strong> for handy DOM matcher functions like <code>toBeInTheDocument</code></li>\n  <li><strong>svelte-jester</strong> to compile Svelte components for Jest, so that Jest can use them</li>\n  <li><strong>@types/jest</strong> to get TS to stop complaining about Jest’s globals like <code>expect</code></li>\n  <li><strong>babel-jest</strong> – <em>optional</em> – to let you write your tests in JavaScript</li>\n  <li><strong>@babel/preset-env</strong> to go with <code>babel-jest</code>, also optional</li>\n</ul>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"shell\"><code><span style=\"color: #C9CDD7\">npm install --save-dev \\</span>\n<span style=\"color: #C9CDD7\">    jest ts-jest \\</span>\n<span style=\"color: #C9CDD7\">    @testing-library/svelte @testing-library/jest-dom \\</span>\n<span style=\"color: #C9CDD7\">    svelte-jester @types/jest \\</span>\n<span style=\"color: #C9CDD7\">    babel-jest @babel/preset-env</span></code></pre>\n</div>\n<h2 id=\"4-add-test-script-to-packagejson\">4. Add <code>test</code> script to package.json</h2>\n\n<p>With this addition, you’ll be able to run <code>npm test</code> to run the tests, or <code>npm run test:watch</code> to run them &amp; watch for changes.</p>\n\n<div class=\"code-filename\">package.json</div>\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"scripts\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> {</span>\n<span style=\"color: #C9CDD7\">    </span><span style=\"color: #F8F8F0\">...</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"test\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"jest\"</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"test:watch\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"npm test -- --watch\"</span>\n</span><span style=\"color: #C9CDD7\">  }</span>\n<span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<h2 id=\"5-add-the-jest-config-to-packagejson\">5. Add the Jest config to package.json</h2>\n\n<p>We need to configure Jest to tell it what to do with <code>.svelte</code>, <code>.ts</code>, and <code>.js</code> files. If you only want to write test in TypeScript, you can skip the <code>.js</code> config.</p>\n\n<p>This needs to be a top-level key in <code>package.json</code>, at the same level as “scripts” and “dependencies” and the others.</p>\n\n<div class=\"code-filename\">package.json</div>\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"scripts\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> { </span><span style=\"color: #F8F8F0\">...</span><span style=\"color: #C9CDD7\"> }</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #F8F8F0\">...</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"jest\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> {</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"transform\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> {</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"^.+\\\\.svelte$\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> [</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">        </span><span style=\"color: #F5D66B\">\"svelte-jester\"</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">        {</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">          </span><span style=\"color: #76DCE8\">\"preprocess\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">true</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">        }</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      ]</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"^.+\\\\.ts$\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"ts-jest\"</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      </span><span style=\"color: #76DCE8\">\"^.+\\\\.js$\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"babel-jest\"</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    }</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"moduleFileExtensions\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> [</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      </span><span style=\"color: #F5D66B\">\"js\"</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      </span><span style=\"color: #F5D66B\">\"ts\"</span><span style=\"color: #D1D5DE\">,</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">      </span><span style=\"color: #F5D66B\">\"svelte\"</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    ]</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  }</span>\n</span><span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<h2 id=\"6-create-svelteconfigjs\">6. Create <code>svelte.config.js</code></h2>\n\n<p>Make a new file at the root of the project named <code>svelte.config.js</code> and paste in this code.</p>\n\n<div class=\"code-filename\">svelte.config.js</div>\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">sveltePreprocess</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">require</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">\"svelte-preprocess\"</span><span style=\"color: #9CA5B7\">)</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #7D9AEF\">module</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #7D9AEF\">exports</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  preprocess</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">sveltePreprocess</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #D1D5DE\">,</span>\n<span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p>The <code>svelte-preprocess</code> package comes by default with the Svelte starter project that we cloned, so we don’t need to install it.</p>\n\n<p>I noticed that everything worked fine <em>without</em> this file until I added support for JS tests with Babel. So if you’re writing your tests in TS and skipping the Babel stuff, you might not need this.</p>\n\n<h2 id=\"7-add-jest-to-tsconfigjson\">7. Add jest to tsconfig.json</h2>\n\n<p>Open your <code>tsconfig.json</code> file, which should already exist since running the <code>setupTypeScript.js</code> script, and add this <code>compilerOptions</code> section.</p>\n\n<div class=\"code-filename\">tsconfig.json</div>\n<div class=\"codeblock\"><pre class=\"shiki highlighted\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"json\"><code><span style=\"color: #C9CDD7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #F8F8F0\">...</span>\n<span class=\"hl\"><span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">\"compilerOptions\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> {</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">    </span><span style=\"color: #76DCE8\">\"types\"</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> [</span><span style=\"color: #F5D66B\">\"jest\"</span><span style=\"color: #C9CDD7\">]</span>\n</span><span class=\"hl\"><span style=\"color: #C9CDD7\">  }</span>\n</span><span style=\"color: #C9CDD7\">}</span></code></pre>\n</div>\n<h2 id=\"8-create-tests-under-src__tests__\">8. Create tests under <code>src/__tests__</code></h2>\n\n<p>To verify that everything is working, create a <code>src/__tests__/hello.test.ts</code> file and paste this in:</p>\n\n<p>Jest will look for tests under the <code>src/__tests__</code> directory.</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"js\"><code><span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">render</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"@testing-library/svelte\"</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #FF8383\">import</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #D1D5DE\">App</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #FF8383\">from</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"../App.svelte\"</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #AFF19F\">test</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">\"should render\"</span><span style=\"color: #D1D5DE\">,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span>\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #76DCE8\">const</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">results</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">=</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #AFF19F\">render</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #D1D5DE\">App,</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> props</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">{</span><span style=\"color: #C9CDD7\"> name</span><span style=\"color: #D1D5DE\">:</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #F5D66B\">\"world\"</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">}</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span>\n\n<span style=\"color: #C9CDD7\">  </span><span style=\"color: #AFF19F\">expect</span><span style=\"color: #9CA5B7\">(()</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #76DCE8\">=&gt;</span><span style=\"color: #C9CDD7\"> </span><span style=\"color: #93DDFD\">results</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">getByText</span><span style=\"color: #9CA5B7\">(</span><span style=\"color: #F5D66B\">\"Hello world!\"</span><span style=\"color: #9CA5B7\">))</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #93DDFD\">not</span><span style=\"color: #D1D5DE\">.</span><span style=\"color: #AFF19F\">toThrow</span><span style=\"color: #9CA5B7\">()</span><span style=\"color: #C9CDD7\">;</span>\n<span style=\"color: #9CA5B7\">})</span><span style=\"color: #C9CDD7\">;</span></code></pre>\n</div>\n<p>Here we’re using the <code>render</code> function from testing-library to, well, render our Svelte component with some props. Then we check the rendered results to make sure the props we passed in did in face appear on the page.</p>\n\n<h2 id=\"9-try-it-out\">9. Try it out!</h2>\n\n<p>All that’s left is to make sure everything worked. Run the tests, and you should see it pass:</p>\n\n<div class=\"codeblock\"><pre class=\"shiki\" style=\"background-color: #31324e; color: #c9cdd7\" data-language=\"shell\"><code><span style=\"color: #C9CDD7\">npm </span><span style=\"color: #AFF19F\">test</span></code></pre>\n</div>\n    <p><a href=\"https://daveceddia.com/svelte-typescript-jest/\">Svelte with TypeScript and Jest (Starter Project)</a> was originally published by Dave Ceddia at <a href=\"https://daveceddia.com\">Dave Ceddia</a> on October 13, 2020.</p><a href=\"http://www.codeproject.com\" rel=\"tag\" style=\"display:none\">CodeProject</a>",
    "date": "2020-10-13T00:21:19.000Z",
    "url": "https://daveceddia.com/svelte-typescript-jest/"
  }
]